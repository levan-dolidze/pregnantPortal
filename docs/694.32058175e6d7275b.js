"use strict";(self.webpackChunkpregnantPortal=self.webpackChunkpregnantPortal||[]).push([[694],{7523:(Qe,X,m)=>{m.d(X,{KQ:()=>nu});var l=m(5879),T=m(6321),H=m(5592),J=m(2096),V=m(3019),ee=m(7398),g=m(3020),de=m(4664),$=m(6699),De=m(3997),P=m(9360),p=m(8251),G=m(4829),Me=m(2737),fe=m(2420),be=m(9940),_e=m(2994),y=m(6304),w=(m(6365),m(3106)),re=m(4537),L=m(5861),j=m(4303),c=m(9058),le=m(7879);const Ce="@firebase/database";let Q="";function Ae(n){Q=n}class M{constructor(e){this.domStorage_=e,this.prefix_="firebase:"}set(e,t){null==t?this.domStorage_.removeItem(this.prefixedName_(e)):this.domStorage_.setItem(this.prefixedName_(e),(0,c.Wl)(t))}get(e){const t=this.domStorage_.getItem(this.prefixedName_(e));return null==t?null:(0,c.cI)(t)}remove(e){this.domStorage_.removeItem(this.prefixedName_(e))}prefixedName_(e){return this.prefix_+e}toString(){return this.domStorage_.toString()}}class ne{constructor(){this.cache_={},this.isInMemoryStorage=!0}set(e,t){null==t?delete this.cache_[e]:this.cache_[e]=t}get(e){return(0,c.r3)(this.cache_,e)?this.cache_[e]:null}remove(e){delete this.cache_[e]}}const Ee=function(n){try{if(typeof window<"u"&&typeof window[n]<"u"){const e=window[n];return e.setItem("firebase:sentinel","cache"),e.removeItem("firebase:sentinel"),new M(e)}}catch{}return new ne},oe=Ee("localStorage"),xe=Ee("sessionStorage"),Pe=new le.Yd("@firebase/database"),S=function(){let n=1;return function(){return n++}}(),ce=function(n){const e=(0,c.dS)(n),t=new c.gQ;t.update(e);const s=t.digest();return c.US.encodeByteArray(s)},E=function(...n){let e="";for(let t=0;t<n.length;t++){const s=n[t];Array.isArray(s)||s&&"object"==typeof s&&"number"==typeof s.length?e+=E.apply(null,s):e+="object"==typeof s?(0,c.Wl)(s):s,e+=" "}return e};let Z=null,O=!0;const Ke=function(n,e){(0,c.hu)(!e||!0===n||!1===n,"Can't turn on custom loggers persistently."),!0===n?(Pe.logLevel=le.in.VERBOSE,Z=Pe.log.bind(Pe),e&&xe.set("logging_enabled",!0)):"function"==typeof n?Z=n:(Z=null,xe.remove("logging_enabled"))},U=function(...n){if(!0===O&&(O=!1,null===Z&&!0===xe.get("logging_enabled")&&Ke(!0)),Z){const e=E.apply(null,n);Z(e)}},nt=function(n){return function(...e){U(n,...e)}},It=function(...n){const e="FIREBASE INTERNAL ERROR: "+E(...n);Pe.error(e)},Ne=function(...n){const e=`FIREBASE FATAL ERROR: ${E(...n)}`;throw Pe.error(e),new Error(e)},se=function(...n){const e="FIREBASE WARNING: "+E(...n);Pe.warn(e)},qt=function(n){return"number"==typeof n&&(n!=n||n===Number.POSITIVE_INFINITY||n===Number.NEGATIVE_INFINITY)},je="[MIN_NAME]",Ue="[MAX_NAME]",st=function(n,e){if(n===e)return 0;if(n===je||e===Ue)return-1;if(e===je||n===Ue)return 1;{const t=Qs(n),s=Qs(e);return null!==t?null!==s?t-s==0?n.length-e.length:t-s:-1:null!==s?1:n<e?-1:1}},zr=function(n,e){return n===e?0:n<e?-1:1},St=function(n,e){if(e&&n in e)return e[n];throw new Error("Missing required key ("+n+") in object: "+(0,c.Wl)(e))},kn=function(n){if("object"!=typeof n||null===n)return(0,c.Wl)(n);const e=[];for(const s in n)e.push(s);e.sort();let t="{";for(let s=0;s<e.length;s++)0!==s&&(t+=","),t+=(0,c.Wl)(e[s]),t+=":",t+=kn(n[e[s]]);return t+="}",t},Ws=function(n,e){const t=n.length;if(t<=e)return[n];const s=[];for(let i=0;i<t;i+=e)s.push(n.substring(i,i+e>t?t:i+e));return s};function z(n,e){for(const t in n)n.hasOwnProperty(t)&&e(t,n[t])}const Bs=function(n){(0,c.hu)(!qt(n),"Invalid JSON number");const s=1023;let i,r,o,a,u;0===n?(r=0,o=0,i=1/n==-1/0?1:0):(i=n<0,(n=Math.abs(n))>=Math.pow(2,1-s)?(a=Math.min(Math.floor(Math.log(n)/Math.LN2),s),r=a+s,o=Math.round(n*Math.pow(2,52-a)-Math.pow(2,52))):(r=0,o=Math.round(n/Math.pow(2,-1074))));const h=[];for(u=52;u;u-=1)h.push(o%2?1:0),o=Math.floor(o/2);for(u=11;u;u-=1)h.push(r%2?1:0),r=Math.floor(r/2);h.push(i?1:0),h.reverse();const d=h.join("");let f="";for(u=0;u<64;u+=8){let _=parseInt(d.substr(u,8),2).toString(16);1===_.length&&(_="0"+_),f+=_}return f.toLowerCase()},to=new RegExp("^-?(0*)\\d{1,10}$"),Qs=function(n){if(to.test(n)){const e=Number(n);if(e>=-2147483648&&e<=2147483647)return e}return null},dt=function(n){try{n()}catch(e){setTimeout(()=>{throw se("Exception was thrown by user callback.",e.stack||""),e},Math.floor(0))}},Dt=function(n,e){const t=setTimeout(n,e);return"number"==typeof t&&typeof Deno<"u"&&Deno.unrefTimer?Deno.unrefTimer(t):"object"==typeof t&&t.unref&&t.unref(),t};class ro{constructor(e,t){this.appName_=e,this.appCheckProvider=t,this.appCheck=t?.getImmediate({optional:!0}),this.appCheck||t?.get().then(s=>this.appCheck=s)}getToken(e){return this.appCheck?this.appCheck.getToken(e):new Promise((t,s)=>{setTimeout(()=>{this.appCheck?this.getToken(e).then(t,s):t(null)},0)})}addTokenChangeListener(e){var t;null===(t=this.appCheckProvider)||void 0===t||t.get().then(s=>s.addTokenListener(e))}notifyForInvalidToken(){se(`Provided AppCheck credentials for the app named "${this.appName_}" are invalid. This usually indicates your app was not initialized correctly.`)}}class oo{constructor(e,t,s){this.appName_=e,this.firebaseOptions_=t,this.authProvider_=s,this.auth_=null,this.auth_=s.getImmediate({optional:!0}),this.auth_||s.onInit(i=>this.auth_=i)}getToken(e){return this.auth_?this.auth_.getToken(e).catch(t=>t&&"auth/token-not-initialized"===t.code?(U("Got auth/token-not-initialized error.  Treating as null token."),null):Promise.reject(t)):new Promise((t,s)=>{setTimeout(()=>{this.auth_?this.getToken(e).then(t,s):t(null)},0)})}addTokenChangeListener(e){this.auth_?this.auth_.addAuthTokenListener(e):this.authProvider_.get().then(t=>t.addAuthTokenListener(e))}removeTokenChangeListener(e){this.authProvider_.get().then(t=>t.removeAuthTokenListener(e))}notifyForInvalidToken(){let e='Provided authentication credentials for the app named "'+this.appName_+'" are invalid. This usually indicates your app was not initialized correctly. ';e+="credential"in this.firebaseOptions_?'Make sure the "credential" property provided to initializeApp() is authorized to access the specified "databaseURL" and is from the correct project.':"serviceAccount"in this.firebaseOptions_?'Make sure the "serviceAccount" property provided to initializeApp() is authorized to access the specified "databaseURL" and is from the correct project.':'Make sure the "apiKey" and "databaseURL" properties provided to initializeApp() match the values provided for your app at https://console.firebase.google.com/.',se(e)}}let bt=(()=>{class n{constructor(t){this.accessToken=t}getToken(t){return Promise.resolve({accessToken:this.accessToken})}addTokenChangeListener(t){t(this.accessToken)}removeTokenChangeListener(t){}notifyForInvalidToken(){}}return n.OWNER="owner",n})();const Gs=/(console\.firebase|firebase-console-\w+\.corp|firebase\.corp)\.google\.com/,Js="websocket",$s="long_polling";class Mn{constructor(e,t,s,i,r=!1,o="",a=!1,u=!1){this.secure=t,this.namespace=s,this.webSocketOnly=i,this.nodeAdmin=r,this.persistenceKey=o,this.includeNamespaceInQueryParams=a,this.isUsingEmulator=u,this._host=e.toLowerCase(),this._domain=this._host.substr(this._host.indexOf(".")+1),this.internalHost=oe.get("host:"+e)||this._host}isCacheableHost(){return"s-"===this.internalHost.substr(0,2)}isCustomHost(){return"firebaseio.com"!==this._domain&&"firebaseio-demo.com"!==this._domain}get host(){return this._host}set host(e){e!==this.internalHost&&(this.internalHost=e,this.isCacheableHost()&&oe.set("host:"+this._host,this.internalHost))}toString(){let e=this.toURLString();return this.persistenceKey&&(e+="<"+this.persistenceKey+">"),e}toURLString(){return`${this.secure?"https://":"http://"}${this.host}/${this.includeNamespaceInQueryParams?`?ns=${this.namespace}`:""}`}}function zs(n,e,t){let s;if((0,c.hu)("string"==typeof e,"typeof type must == string"),(0,c.hu)("object"==typeof t,"typeof params must == object"),e===Js)s=(n.secure?"wss://":"ws://")+n.internalHost+"/.ws?";else{if(e!==$s)throw new Error("Unknown connection type: "+e);s=(n.secure?"https://":"http://")+n.internalHost+"/.lp?"}(function ao(n){return n.host!==n.internalHost||n.isCustomHost()||n.includeNamespaceInQueryParams})(n)&&(t.ns=n.namespace);const i=[];return z(t,(r,o)=>{i.push(r+"="+o)}),s+i.join("&")}class lo{constructor(){this.counters_={}}incrementCounter(e,t=1){(0,c.r3)(this.counters_,e)||(this.counters_[e]=0),this.counters_[e]+=t}get(){return(0,c.p$)(this.counters_)}}const Fn={},Un={};function Wn(n){const e=n.toString();return Fn[e]||(Fn[e]=new lo),Fn[e]}class uo{constructor(e){this.onMessage_=e,this.pendingResponses=[],this.currentResponseNum=0,this.closeAfterResponse=-1,this.onClose=null}closeAfter(e,t){this.closeAfterResponse=e,this.onClose=t,this.closeAfterResponse<this.currentResponseNum&&(this.onClose(),this.onClose=null)}handleResponse(e,t){for(this.pendingResponses[e]=t;this.pendingResponses[this.currentResponseNum];){const s=this.pendingResponses[this.currentResponseNum];delete this.pendingResponses[this.currentResponseNum];for(let i=0;i<s.length;++i)s[i]&&dt(()=>{this.onMessage_(s[i])});if(this.currentResponseNum===this.closeAfterResponse){this.onClose&&(this.onClose(),this.onClose=null);break}this.currentResponseNum++}}}class Ye{constructor(e,t,s,i,r,o,a){this.connId=e,this.repoInfo=t,this.applicationId=s,this.appCheckToken=i,this.authToken=r,this.transportSessionId=o,this.lastSessionId=a,this.bytesSent=0,this.bytesReceived=0,this.everConnected_=!1,this.log_=nt(e),this.stats_=Wn(t),this.urlFn=u=>(this.appCheckToken&&(u.ac=this.appCheckToken),zs(t,$s,u))}open(e,t){this.curSegmentNum=0,this.onDisconnect_=t,this.myPacketOrderer=new uo(e),this.isClosed_=!1,this.connectTimeoutTimer_=setTimeout(()=>{this.log_("Timed out trying to connect."),this.onClosed_(),this.connectTimeoutTimer_=null},Math.floor(3e4)),function(n){if((0,c.Yr)()||"complete"===document.readyState)n();else{let e=!1;const t=function(){document.body?e||(e=!0,n()):setTimeout(t,Math.floor(10))};document.addEventListener?(document.addEventListener("DOMContentLoaded",t,!1),window.addEventListener("load",t,!1)):document.attachEvent&&(document.attachEvent("onreadystatechange",()=>{"complete"===document.readyState&&t()}),window.attachEvent("onload",t))}}(()=>{if(this.isClosed_)return;this.scriptTagHolder=new Bn((...r)=>{const[o,a,u,h,d]=r;if(this.incrementIncomingBytes_(r),this.scriptTagHolder)if(this.connectTimeoutTimer_&&(clearTimeout(this.connectTimeoutTimer_),this.connectTimeoutTimer_=null),this.everConnected_=!0,"start"===o)this.id=a,this.password=u;else{if("close"!==o)throw new Error("Unrecognized command received: "+o);a?(this.scriptTagHolder.sendNewPolls=!1,this.myPacketOrderer.closeAfter(a,()=>{this.onClosed_()})):this.onClosed_()}},(...r)=>{const[o,a]=r;this.incrementIncomingBytes_(r),this.myPacketOrderer.handleResponse(o,a)},()=>{this.onClosed_()},this.urlFn);const s={start:"t"};s.ser=Math.floor(1e8*Math.random()),this.scriptTagHolder.uniqueCallbackIdentifier&&(s.cb=this.scriptTagHolder.uniqueCallbackIdentifier),s.v="5",this.transportSessionId&&(s.s=this.transportSessionId),this.lastSessionId&&(s.ls=this.lastSessionId),this.applicationId&&(s.p=this.applicationId),this.appCheckToken&&(s.ac=this.appCheckToken),typeof location<"u"&&location.hostname&&Gs.test(location.hostname)&&(s.r="f");const i=this.urlFn(s);this.log_("Connecting via long-poll to "+i),this.scriptTagHolder.addTag(i,()=>{})})}start(){this.scriptTagHolder.startLongPoll(this.id,this.password),this.addDisconnectPingFrame(this.id,this.password)}static forceAllow(){Ye.forceAllow_=!0}static forceDisallow(){Ye.forceDisallow_=!0}static isAvailable(){return!((0,c.Yr)()||!Ye.forceAllow_&&(Ye.forceDisallow_||!(typeof document<"u")||null==document.createElement||"object"==typeof window&&window.chrome&&window.chrome.extension&&!/^chrome/.test(window.location.href)||"object"==typeof Windows&&"object"==typeof Windows.UI))}markConnectionHealthy(){}shutdown_(){this.isClosed_=!0,this.scriptTagHolder&&(this.scriptTagHolder.close(),this.scriptTagHolder=null),this.myDisconnFrame&&(document.body.removeChild(this.myDisconnFrame),this.myDisconnFrame=null),this.connectTimeoutTimer_&&(clearTimeout(this.connectTimeoutTimer_),this.connectTimeoutTimer_=null)}onClosed_(){this.isClosed_||(this.log_("Longpoll is closing itself"),this.shutdown_(),this.onDisconnect_&&(this.onDisconnect_(this.everConnected_),this.onDisconnect_=null))}close(){this.isClosed_||(this.log_("Longpoll is being closed."),this.shutdown_())}send(e){const t=(0,c.Wl)(e);this.bytesSent+=t.length,this.stats_.incrementCounter("bytes_sent",t.length);const s=(0,c.h$)(t),i=Ws(s,1840);for(let r=0;r<i.length;r++)this.scriptTagHolder.enqueueSegment(this.curSegmentNum,i.length,i[r]),this.curSegmentNum++}addDisconnectPingFrame(e,t){if((0,c.Yr)())return;this.myDisconnFrame=document.createElement("iframe");const s={dframe:"t"};s.id=e,s.pw=t,this.myDisconnFrame.src=this.urlFn(s),this.myDisconnFrame.style.display="none",document.body.appendChild(this.myDisconnFrame)}incrementIncomingBytes_(e){const t=(0,c.Wl)(e).length;this.bytesReceived+=t,this.stats_.incrementCounter("bytes_received",t)}}class Bn{constructor(e,t,s,i){if(this.onDisconnect=s,this.urlFn=i,this.outstandingRequests=new Set,this.pendingSegs=[],this.currentSerial=Math.floor(1e8*Math.random()),this.sendNewPolls=!0,(0,c.Yr)())this.commandCB=e,this.onMessageCB=t;else{this.uniqueCallbackIdentifier=S(),window["pLPCommand"+this.uniqueCallbackIdentifier]=e,window["pRTLPCB"+this.uniqueCallbackIdentifier]=t,this.myIFrame=Bn.createIFrame_();let r="";this.myIFrame.src&&"javascript:"===this.myIFrame.src.substr(0,11)&&(r='<script>document.domain="'+document.domain+'";<\/script>');const o="<html><body>"+r+"</body></html>";try{this.myIFrame.doc.open(),this.myIFrame.doc.write(o),this.myIFrame.doc.close()}catch(a){U("frame writing exception"),a.stack&&U(a.stack),U(a)}}}static createIFrame_(){const e=document.createElement("iframe");if(e.style.display="none",!document.body)throw"Document body has not initialized. Wait to initialize Firebase until after the document is ready.";document.body.appendChild(e);try{e.contentWindow.document||U("No IE domain setting required")}catch{const s=document.domain;e.src="javascript:void((function(){document.open();document.domain='"+s+"';document.close();})())"}return e.contentDocument?e.doc=e.contentDocument:e.contentWindow?e.doc=e.contentWindow.document:e.document&&(e.doc=e.document),e}close(){this.alive=!1,this.myIFrame&&(this.myIFrame.doc.body.textContent="",setTimeout(()=>{null!==this.myIFrame&&(document.body.removeChild(this.myIFrame),this.myIFrame=null)},Math.floor(0)));const e=this.onDisconnect;e&&(this.onDisconnect=null,e())}startLongPoll(e,t){for(this.myID=e,this.myPW=t,this.alive=!0;this.newRequest_(););}newRequest_(){if(this.alive&&this.sendNewPolls&&this.outstandingRequests.size<(this.pendingSegs.length>0?2:1)){this.currentSerial++;const e={};e.id=this.myID,e.pw=this.myPW,e.ser=this.currentSerial;let t=this.urlFn(e),s="",i=0;for(;this.pendingSegs.length>0&&this.pendingSegs[0].d.length+30+s.length<=1870;){const o=this.pendingSegs.shift();s=s+"&seg"+i+"="+o.seg+"&ts"+i+"="+o.ts+"&d"+i+"="+o.d,i++}return t+=s,this.addLongPollTag_(t,this.currentSerial),!0}return!1}enqueueSegment(e,t,s){this.pendingSegs.push({seg:e,ts:t,d:s}),this.alive&&this.newRequest_()}addLongPollTag_(e,t){this.outstandingRequests.add(t);const s=()=>{this.outstandingRequests.delete(t),this.newRequest_()},i=setTimeout(s,Math.floor(25e3));this.addTag(e,()=>{clearTimeout(i),s()})}addTag(e,t){(0,c.Yr)()?this.doNodeLongPoll(e,t):setTimeout(()=>{try{if(!this.sendNewPolls)return;const s=this.myIFrame.doc.createElement("script");s.type="text/javascript",s.async=!0,s.src=e,s.onload=s.onreadystatechange=function(){const i=s.readyState;(!i||"loaded"===i||"complete"===i)&&(s.onload=s.onreadystatechange=null,s.parentNode&&s.parentNode.removeChild(s),t())},s.onerror=()=>{U("Long-poll script failed to load: "+e),this.sendNewPolls=!1,this.close()},this.myIFrame.doc.body.appendChild(s)}catch{}},Math.floor(1))}}let en=null;typeof MozWebSocket<"u"?en=MozWebSocket:typeof WebSocket<"u"&&(en=WebSocket);let ft=(()=>{class n{constructor(t,s,i,r,o,a,u){this.connId=t,this.applicationId=i,this.appCheckToken=r,this.authToken=o,this.keepaliveTimer=null,this.frames=null,this.totalFrames=0,this.bytesSent=0,this.bytesReceived=0,this.log_=nt(this.connId),this.stats_=Wn(s),this.connURL=n.connectionURL_(s,a,u,r,i),this.nodeAdmin=s.nodeAdmin}static connectionURL_(t,s,i,r,o){const a={v:"5"};return!(0,c.Yr)()&&typeof location<"u"&&location.hostname&&Gs.test(location.hostname)&&(a.r="f"),s&&(a.s=s),i&&(a.ls=i),r&&(a.ac=r),o&&(a.p=o),zs(t,Js,a)}open(t,s){this.onDisconnect=s,this.onMessage=t,this.log_("Websocket connecting to "+this.connURL),this.everConnected_=!1,oe.set("previous_websocket_failure",!0);try{let i;if((0,c.Yr)()){i={headers:{"User-Agent":`Firebase/5/${Q}/${process.platform}/${this.nodeAdmin?"AdminNode":"Node"}`,"X-Firebase-GMPID":this.applicationId||""}},this.authToken&&(i.headers.Authorization=`Bearer ${this.authToken}`),this.appCheckToken&&(i.headers["X-Firebase-AppCheck"]=this.appCheckToken);const o=process.env,a=0===this.connURL.indexOf("wss://")?o.HTTPS_PROXY||o.https_proxy:o.HTTP_PROXY||o.http_proxy;a&&(i.proxy={origin:a})}this.mySock=new en(this.connURL,[],i)}catch(i){this.log_("Error instantiating WebSocket.");const r=i.message||i.data;return r&&this.log_(r),void this.onClosed_()}this.mySock.onopen=()=>{this.log_("Websocket connected."),this.everConnected_=!0},this.mySock.onclose=()=>{this.log_("Websocket connection was disconnected."),this.mySock=null,this.onClosed_()},this.mySock.onmessage=i=>{this.handleIncomingFrame(i)},this.mySock.onerror=i=>{this.log_("WebSocket error.  Closing connection.");const r=i.message||i.data;r&&this.log_(r),this.onClosed_()}}start(){}static forceDisallow(){n.forceDisallow_=!0}static isAvailable(){let t=!1;if(typeof navigator<"u"&&navigator.userAgent){const i=navigator.userAgent.match(/Android ([0-9]{0,}\.[0-9]{0,})/);i&&i.length>1&&parseFloat(i[1])<4.4&&(t=!0)}return!t&&null!==en&&!n.forceDisallow_}static previouslyFailed(){return oe.isInMemoryStorage||!0===oe.get("previous_websocket_failure")}markConnectionHealthy(){oe.remove("previous_websocket_failure")}appendFrame_(t){if(this.frames.push(t),this.frames.length===this.totalFrames){const s=this.frames.join("");this.frames=null;const i=(0,c.cI)(s);this.onMessage(i)}}handleNewFrameCount_(t){this.totalFrames=t,this.frames=[]}extractFrameCount_(t){if((0,c.hu)(null===this.frames,"We already have a frame buffer"),t.length<=6){const s=Number(t);if(!isNaN(s))return this.handleNewFrameCount_(s),null}return this.handleNewFrameCount_(1),t}handleIncomingFrame(t){if(null===this.mySock)return;const s=t.data;if(this.bytesReceived+=s.length,this.stats_.incrementCounter("bytes_received",s.length),this.resetKeepAlive(),null!==this.frames)this.appendFrame_(s);else{const i=this.extractFrameCount_(s);null!==i&&this.appendFrame_(i)}}send(t){this.resetKeepAlive();const s=(0,c.Wl)(t);this.bytesSent+=s.length,this.stats_.incrementCounter("bytes_sent",s.length);const i=Ws(s,16384);i.length>1&&this.sendString_(String(i.length));for(let r=0;r<i.length;r++)this.sendString_(i[r])}shutdown_(){this.isClosed_=!0,this.keepaliveTimer&&(clearInterval(this.keepaliveTimer),this.keepaliveTimer=null),this.mySock&&(this.mySock.close(),this.mySock=null)}onClosed_(){this.isClosed_||(this.log_("WebSocket is closing itself"),this.shutdown_(),this.onDisconnect&&(this.onDisconnect(this.everConnected_),this.onDisconnect=null))}close(){this.isClosed_||(this.log_("WebSocket is being closed"),this.shutdown_())}resetKeepAlive(){clearInterval(this.keepaliveTimer),this.keepaliveTimer=setInterval(()=>{this.mySock&&this.sendString_("0"),this.resetKeepAlive()},Math.floor(45e3))}sendString_(t){try{this.mySock.send(t)}catch(s){this.log_("Exception thrown from WebSocket.send():",s.message||s.data,"Closing connection."),setTimeout(this.onClosed_.bind(this),0)}}}return n.responsesRequiredToBeHealthy=2,n.healthyTimeout=3e4,n})(),ii=(()=>{class n{constructor(t){this.initTransports_(t)}static get ALL_TRANSPORTS(){return[Ye,ft]}static get IS_TRANSPORT_INITIALIZED(){return this.globalTransportInitialized_}initTransports_(t){const s=ft&&ft.isAvailable();let i=s&&!ft.previouslyFailed();if(t.webSocketOnly&&(s||se("wss:// URL used, but browser isn't known to support websockets.  Trying anyway."),i=!0),i)this.transports_=[ft];else{const r=this.transports_=[];for(const o of n.ALL_TRANSPORTS)o&&o.isAvailable()&&r.push(o);n.globalTransportInitialized_=!0}}initialTransport(){if(this.transports_.length>0)return this.transports_[0];throw new Error("No transports available")}upgradeTransport(){return this.transports_.length>1?this.transports_[1]:null}}return n.globalTransportInitialized_=!1,n})();class hi{constructor(e,t,s,i,r,o,a,u,h,d){this.id=e,this.repoInfo_=t,this.applicationId_=s,this.appCheckToken_=i,this.authToken_=r,this.onMessage_=o,this.onReady_=a,this.onDisconnect_=u,this.onKill_=h,this.lastSessionId=d,this.connectionCount=0,this.pendingDataMessages=[],this.state_=0,this.log_=nt("c:"+this.id+":"),this.transportManager_=new ii(t),this.log_("Connection created"),this.start_()}start_(){const e=this.transportManager_.initialTransport();this.conn_=new e(this.nextTransportId_(),this.repoInfo_,this.applicationId_,this.appCheckToken_,this.authToken_,null,this.lastSessionId),this.primaryResponsesRequired_=e.responsesRequiredToBeHealthy||0;const t=this.connReceiver_(this.conn_),s=this.disconnReceiver_(this.conn_);this.tx_=this.conn_,this.rx_=this.conn_,this.secondaryConn_=null,this.isHealthy_=!1,setTimeout(()=>{this.conn_&&this.conn_.open(t,s)},Math.floor(0));const i=e.healthyTimeout||0;i>0&&(this.healthyTimeout_=Dt(()=>{this.healthyTimeout_=null,this.isHealthy_||(this.conn_&&this.conn_.bytesReceived>102400?(this.log_("Connection exceeded healthy timeout but has received "+this.conn_.bytesReceived+" bytes.  Marking connection healthy."),this.isHealthy_=!0,this.conn_.markConnectionHealthy()):this.conn_&&this.conn_.bytesSent>10240?this.log_("Connection exceeded healthy timeout but has sent "+this.conn_.bytesSent+" bytes.  Leaving connection alive."):(this.log_("Closing unhealthy connection after timeout."),this.close()))},Math.floor(i)))}nextTransportId_(){return"c:"+this.id+":"+this.connectionCount++}disconnReceiver_(e){return t=>{e===this.conn_?this.onConnectionLost_(t):e===this.secondaryConn_?(this.log_("Secondary connection lost."),this.onSecondaryConnectionLost_()):this.log_("closing an old connection")}}connReceiver_(e){return t=>{2!==this.state_&&(e===this.rx_?this.onPrimaryMessageReceived_(t):e===this.secondaryConn_?this.onSecondaryMessageReceived_(t):this.log_("message on old connection"))}}sendRequest(e){this.sendData_({t:"d",d:e})}tryCleanupConnection(){this.tx_===this.secondaryConn_&&this.rx_===this.secondaryConn_&&(this.log_("cleaning up and promoting a connection: "+this.secondaryConn_.connId),this.conn_=this.secondaryConn_,this.secondaryConn_=null)}onSecondaryControl_(e){if("t"in e){const t=e.t;"a"===t?this.upgradeIfSecondaryHealthy_():"r"===t?(this.log_("Got a reset on secondary, closing it"),this.secondaryConn_.close(),(this.tx_===this.secondaryConn_||this.rx_===this.secondaryConn_)&&this.close()):"o"===t&&(this.log_("got pong on secondary."),this.secondaryResponsesRequired_--,this.upgradeIfSecondaryHealthy_())}}onSecondaryMessageReceived_(e){const t=St("t",e),s=St("d",e);if("c"===t)this.onSecondaryControl_(s);else{if("d"!==t)throw new Error("Unknown protocol layer: "+t);this.pendingDataMessages.push(s)}}upgradeIfSecondaryHealthy_(){this.secondaryResponsesRequired_<=0?(this.log_("Secondary connection is healthy."),this.isHealthy_=!0,this.secondaryConn_.markConnectionHealthy(),this.proceedWithUpgrade_()):(this.log_("sending ping on secondary."),this.secondaryConn_.send({t:"c",d:{t:"p",d:{}}}))}proceedWithUpgrade_(){this.secondaryConn_.start(),this.log_("sending client ack on secondary"),this.secondaryConn_.send({t:"c",d:{t:"a",d:{}}}),this.log_("Ending transmission on primary"),this.conn_.send({t:"c",d:{t:"n",d:{}}}),this.tx_=this.secondaryConn_,this.tryCleanupConnection()}onPrimaryMessageReceived_(e){const t=St("t",e),s=St("d",e);"c"===t?this.onControl_(s):"d"===t&&this.onDataMessage_(s)}onDataMessage_(e){this.onPrimaryResponse_(),this.onMessage_(e)}onPrimaryResponse_(){this.isHealthy_||(this.primaryResponsesRequired_--,this.primaryResponsesRequired_<=0&&(this.log_("Primary connection is healthy."),this.isHealthy_=!0,this.conn_.markConnectionHealthy()))}onControl_(e){const t=St("t",e);if("d"in e){const s=e.d;if("h"===t){const i=Object.assign({},s);this.repoInfo_.isUsingEmulator&&(i.h=this.repoInfo_.host),this.onHandshake_(i)}else if("n"===t){this.log_("recvd end transmission on primary"),this.rx_=this.secondaryConn_;for(let i=0;i<this.pendingDataMessages.length;++i)this.onDataMessage_(this.pendingDataMessages[i]);this.pendingDataMessages=[],this.tryCleanupConnection()}else"s"===t?this.onConnectionShutdown_(s):"r"===t?this.onReset_(s):"e"===t?It("Server Error: "+s):"o"===t?(this.log_("got pong on primary."),this.onPrimaryResponse_(),this.sendPingOnPrimaryIfNecessary_()):It("Unknown control packet command: "+t)}}onHandshake_(e){const t=e.ts,s=e.v,i=e.h;this.sessionId=e.s,this.repoInfo_.host=i,0===this.state_&&(this.conn_.start(),this.onConnectionEstablished_(this.conn_,t),"5"!==s&&se("Protocol version mismatch detected"),this.tryStartUpgrade_())}tryStartUpgrade_(){const e=this.transportManager_.upgradeTransport();e&&this.startUpgrade_(e)}startUpgrade_(e){this.secondaryConn_=new e(this.nextTransportId_(),this.repoInfo_,this.applicationId_,this.appCheckToken_,this.authToken_,this.sessionId),this.secondaryResponsesRequired_=e.responsesRequiredToBeHealthy||0;const t=this.connReceiver_(this.secondaryConn_),s=this.disconnReceiver_(this.secondaryConn_);this.secondaryConn_.open(t,s),Dt(()=>{this.secondaryConn_&&(this.log_("Timed out trying to upgrade."),this.secondaryConn_.close())},Math.floor(6e4))}onReset_(e){this.log_("Reset packet received.  New host: "+e),this.repoInfo_.host=e,1===this.state_?this.close():(this.closeConnections_(),this.start_())}onConnectionEstablished_(e,t){this.log_("Realtime connection established."),this.conn_=e,this.state_=1,this.onReady_&&(this.onReady_(t,this.sessionId),this.onReady_=null),0===this.primaryResponsesRequired_?(this.log_("Primary connection is healthy."),this.isHealthy_=!0):Dt(()=>{this.sendPingOnPrimaryIfNecessary_()},Math.floor(5e3))}sendPingOnPrimaryIfNecessary_(){!this.isHealthy_&&1===this.state_&&(this.log_("sending ping on primary."),this.sendData_({t:"c",d:{t:"p",d:{}}}))}onSecondaryConnectionLost_(){const e=this.secondaryConn_;this.secondaryConn_=null,(this.tx_===e||this.rx_===e)&&this.close()}onConnectionLost_(e){this.conn_=null,e||0!==this.state_?1===this.state_&&this.log_("Realtime connection lost."):(this.log_("Realtime connection failed."),this.repoInfo_.isCacheableHost()&&(oe.remove("host:"+this.repoInfo_.host),this.repoInfo_.internalHost=this.repoInfo_.host)),this.close()}onConnectionShutdown_(e){this.log_("Connection shutdown command received. Shutting down..."),this.onKill_&&(this.onKill_(e),this.onKill_=null),this.onDisconnect_=null,this.close()}sendData_(e){if(1!==this.state_)throw"Connection is not connected";this.tx_.send(e)}close(){2!==this.state_&&(this.log_("Closing realtime connection."),this.state_=2,this.closeConnections_(),this.onDisconnect_&&(this.onDisconnect_(),this.onDisconnect_=null))}closeConnections_(){this.log_("Shutting down all connections"),this.conn_&&(this.conn_.close(),this.conn_=null),this.secondaryConn_&&(this.secondaryConn_.close(),this.secondaryConn_=null),this.healthyTimeout_&&(clearTimeout(this.healthyTimeout_),this.healthyTimeout_=null)}}class di{put(e,t,s,i){}merge(e,t,s,i){}refreshAuthToken(e){}refreshAppCheckToken(e){}onDisconnectPut(e,t,s){}onDisconnectMerge(e,t,s){}onDisconnectCancel(e,t){}reportStats(e){}}class fi{constructor(e){this.allowedEvents_=e,this.listeners_={},(0,c.hu)(Array.isArray(e)&&e.length>0,"Requires a non-empty array")}trigger(e,...t){if(Array.isArray(this.listeners_[e])){const s=[...this.listeners_[e]];for(let i=0;i<s.length;i++)s[i].callback.apply(s[i].context,t)}}on(e,t,s){this.validateEventType_(e),this.listeners_[e]=this.listeners_[e]||[],this.listeners_[e].push({callback:t,context:s});const i=this.getInitialEvent(e);i&&t.apply(s,i)}off(e,t,s){this.validateEventType_(e);const i=this.listeners_[e]||[];for(let r=0;r<i.length;r++)if(i[r].callback===t&&(!s||s===i[r].context))return void i.splice(r,1)}validateEventType_(e){(0,c.hu)(this.allowedEvents_.find(t=>t===e),"Unknown event: "+e)}}class tn extends fi{constructor(){super(["online"]),this.online_=!0,typeof window<"u"&&typeof window.addEventListener<"u"&&!(0,c.uI)()&&(window.addEventListener("online",()=>{this.online_||(this.online_=!0,this.trigger("online",!0))},!1),window.addEventListener("offline",()=>{this.online_&&(this.online_=!1,this.trigger("online",!1))},!1))}static getInstance(){return new tn}getInitialEvent(e){return(0,c.hu)("online"===e,"Unknown event type: "+e),[this.online_]}currentlyOnline(){return this.online_}}class k{constructor(e,t){if(void 0===t){this.pieces_=e.split("/");let s=0;for(let i=0;i<this.pieces_.length;i++)this.pieces_[i].length>0&&(this.pieces_[s]=this.pieces_[i],s++);this.pieces_.length=s,this.pieceNum_=0}else this.pieces_=e,this.pieceNum_=t}toString(){let e="";for(let t=this.pieceNum_;t<this.pieces_.length;t++)""!==this.pieces_[t]&&(e+="/"+this.pieces_[t]);return e||"/"}}function R(){return new k("")}function D(n){return n.pieceNum_>=n.pieces_.length?null:n.pieces_[n.pieceNum_]}function Ge(n){return n.pieces_.length-n.pieceNum_}function F(n){let e=n.pieceNum_;return e<n.pieces_.length&&e++,new k(n.pieces_,e)}function Zn(n){return n.pieceNum_<n.pieces_.length?n.pieces_[n.pieces_.length-1]:null}function At(n,e=0){return n.pieces_.slice(n.pieceNum_+e)}function gi(n){if(n.pieceNum_>=n.pieces_.length)return null;const e=[];for(let t=n.pieceNum_;t<n.pieces_.length-1;t++)e.push(n.pieces_[t]);return new k(e,0)}function K(n,e){const t=[];for(let s=n.pieceNum_;s<n.pieces_.length;s++)t.push(n.pieces_[s]);if(e instanceof k)for(let s=e.pieceNum_;s<e.pieces_.length;s++)t.push(e.pieces_[s]);else{const s=e.split("/");for(let i=0;i<s.length;i++)s[i].length>0&&t.push(s[i])}return new k(t,0)}function b(n){return n.pieceNum_>=n.pieces_.length}function ae(n,e){const t=D(n),s=D(e);if(null===t)return e;if(t===s)return ae(F(n),F(e));throw new Error("INTERNAL ERROR: innerPath ("+e+") is not within outerPath ("+n+")")}function Oo(n,e){const t=At(n,0),s=At(e,0);for(let i=0;i<t.length&&i<s.length;i++){const r=st(t[i],s[i]);if(0!==r)return r}return t.length===s.length?0:t.length<s.length?-1:1}function Kn(n,e){if(Ge(n)!==Ge(e))return!1;for(let t=n.pieceNum_,s=e.pieceNum_;t<=n.pieces_.length;t++,s++)if(n.pieces_[t]!==e.pieces_[s])return!1;return!0}function me(n,e){let t=n.pieceNum_,s=e.pieceNum_;if(Ge(n)>Ge(e))return!1;for(;t<n.pieces_.length;){if(n.pieces_[t]!==e.pieces_[s])return!1;++t,++s}return!0}class ko{constructor(e,t){this.errorPrefix_=t,this.parts_=At(e,0),this.byteLength_=Math.max(1,this.parts_.length);for(let s=0;s<this.parts_.length;s++)this.byteLength_+=(0,c.ug)(this.parts_[s]);mi(this)}}function mi(n){if(n.byteLength_>768)throw new Error(n.errorPrefix_+"has a key path longer than 768 bytes ("+n.byteLength_+").");if(n.parts_.length>32)throw new Error(n.errorPrefix_+"path specified exceeds the maximum depth that can be written (32) or object contains a cycle "+it(n))}function it(n){return 0===n.parts_.length?"":"in property '"+n.parts_.join(".")+"'"}class jn extends fi{constructor(){let e,t;super(["visible"]),typeof document<"u"&&typeof document.addEventListener<"u"&&(typeof document.hidden<"u"?(t="visibilitychange",e="hidden"):typeof document.mozHidden<"u"?(t="mozvisibilitychange",e="mozHidden"):typeof document.msHidden<"u"?(t="msvisibilitychange",e="msHidden"):typeof document.webkitHidden<"u"&&(t="webkitvisibilitychange",e="webkitHidden")),this.visible_=!0,t&&document.addEventListener(t,()=>{const s=!document[e];s!==this.visible_&&(this.visible_=s,this.trigger("visible",s))},!1)}static getInstance(){return new jn}getInitialEvent(e){return(0,c.hu)("visible"===e,"Unknown event type: "+e),[this.visible_]}}const xt=1e3;let sn,rt=(()=>{class n extends di{constructor(t,s,i,r,o,a,u,h){if(super(),this.repoInfo_=t,this.applicationId_=s,this.onDataUpdate_=i,this.onConnectStatus_=r,this.onServerInfoUpdate_=o,this.authTokenProvider_=a,this.appCheckTokenProvider_=u,this.authOverride_=h,this.id=n.nextPersistentConnectionId_++,this.log_=nt("p:"+this.id+":"),this.interruptReasons_={},this.listens=new Map,this.outstandingPuts_=[],this.outstandingGets_=[],this.outstandingPutCount_=0,this.outstandingGetCount_=0,this.onDisconnectRequestQueue_=[],this.connected_=!1,this.reconnectDelay_=xt,this.maxReconnectDelay_=3e5,this.securityDebugCallback_=null,this.lastSessionId=null,this.establishConnectionTimer_=null,this.visible_=!1,this.requestCBHash_={},this.requestNumber_=0,this.realtime_=null,this.authToken_=null,this.appCheckToken_=null,this.forceTokenRefresh_=!1,this.invalidAuthTokenCount_=0,this.invalidAppCheckTokenCount_=0,this.firstConnection_=!0,this.lastConnectionAttemptTime_=null,this.lastConnectionEstablishedTime_=null,h&&!(0,c.Yr)())throw new Error("Auth override specified in options, but not supported on non Node.js platforms");jn.getInstance().on("visible",this.onVisible_,this),-1===t.host.indexOf("fblocal")&&tn.getInstance().on("online",this.onOnline_,this)}sendRequest(t,s,i){const r=++this.requestNumber_,o={r,a:t,b:s};this.log_((0,c.Wl)(o)),(0,c.hu)(this.connected_,"sendRequest call when we're not connected not allowed."),this.realtime_.sendRequest(o),i&&(this.requestCBHash_[r]=i)}get(t){this.initConnection_();const s=new c.BH,r={action:"g",request:{p:t._path.toString(),q:t._queryObject},onComplete:a=>{const u=a.d;"ok"===a.s?s.resolve(u):s.reject(u)}};return this.outstandingGets_.push(r),this.outstandingGetCount_++,this.connected_&&this.sendGet_(this.outstandingGets_.length-1),s.promise}listen(t,s,i,r){this.initConnection_();const o=t._queryIdentifier,a=t._path.toString();this.log_("Listen called for "+a+" "+o),this.listens.has(a)||this.listens.set(a,new Map),(0,c.hu)(t._queryParams.isDefault()||!t._queryParams.loadsAllData(),"listen() called for non-default but complete query"),(0,c.hu)(!this.listens.get(a).has(o),"listen() called twice for same path/queryId.");const u={onComplete:r,hashFn:s,query:t,tag:i};this.listens.get(a).set(o,u),this.connected_&&this.sendListen_(u)}sendGet_(t){const s=this.outstandingGets_[t];this.sendRequest("g",s.request,i=>{delete this.outstandingGets_[t],this.outstandingGetCount_--,0===this.outstandingGetCount_&&(this.outstandingGets_=[]),s.onComplete&&s.onComplete(i)})}sendListen_(t){const s=t.query,i=s._path.toString(),r=s._queryIdentifier;this.log_("Listen on "+i+" for "+r);const o={p:i};t.tag&&(o.q=s._queryObject,o.t=t.tag),o.h=t.hashFn(),this.sendRequest("q",o,u=>{const h=u.d,d=u.s;n.warnOnListenWarnings_(h,s),(this.listens.get(i)&&this.listens.get(i).get(r))===t&&(this.log_("listen response",u),"ok"!==d&&this.removeListen_(i,r),t.onComplete&&t.onComplete(d,h))})}static warnOnListenWarnings_(t,s){if(t&&"object"==typeof t&&(0,c.r3)(t,"w")){const i=(0,c.DV)(t,"w");if(Array.isArray(i)&&~i.indexOf("no_index")){const r='".indexOn": "'+s._queryParams.getIndex().toString()+'"',o=s._path.toString();se(`Using an unspecified index. Your data will be downloaded and filtered on the client. Consider adding ${r} at ${o} to your security rules for better performance.`)}}}refreshAuthToken(t){this.authToken_=t,this.log_("Auth token refreshed"),this.authToken_?this.tryAuth():this.connected_&&this.sendRequest("unauth",{},()=>{}),this.reduceReconnectDelayIfAdminCredential_(t)}reduceReconnectDelayIfAdminCredential_(t){(t&&40===t.length||(0,c.GJ)(t))&&(this.log_("Admin auth credential detected.  Reducing max reconnect time."),this.maxReconnectDelay_=3e4)}refreshAppCheckToken(t){this.appCheckToken_=t,this.log_("App check token refreshed"),this.appCheckToken_?this.tryAppCheck():this.connected_&&this.sendRequest("unappeck",{},()=>{})}tryAuth(){if(this.connected_&&this.authToken_){const t=this.authToken_,s=(0,c.w9)(t)?"auth":"gauth",i={cred:t};null===this.authOverride_?i.noauth=!0:"object"==typeof this.authOverride_&&(i.authvar=this.authOverride_),this.sendRequest(s,i,r=>{const o=r.s,a=r.d||"error";this.authToken_===t&&("ok"===o?this.invalidAuthTokenCount_=0:this.onAuthRevoked_(o,a))})}}tryAppCheck(){this.connected_&&this.appCheckToken_&&this.sendRequest("appcheck",{token:this.appCheckToken_},t=>{const s=t.s,i=t.d||"error";"ok"===s?this.invalidAppCheckTokenCount_=0:this.onAppCheckRevoked_(s,i)})}unlisten(t,s){const i=t._path.toString(),r=t._queryIdentifier;this.log_("Unlisten called for "+i+" "+r),(0,c.hu)(t._queryParams.isDefault()||!t._queryParams.loadsAllData(),"unlisten() called for non-default but complete query"),this.removeListen_(i,r)&&this.connected_&&this.sendUnlisten_(i,r,t._queryObject,s)}sendUnlisten_(t,s,i,r){this.log_("Unlisten on "+t+" for "+s);const o={p:t};r&&(o.q=i,o.t=r),this.sendRequest("n",o)}onDisconnectPut(t,s,i){this.initConnection_(),this.connected_?this.sendOnDisconnect_("o",t,s,i):this.onDisconnectRequestQueue_.push({pathString:t,action:"o",data:s,onComplete:i})}onDisconnectMerge(t,s,i){this.initConnection_(),this.connected_?this.sendOnDisconnect_("om",t,s,i):this.onDisconnectRequestQueue_.push({pathString:t,action:"om",data:s,onComplete:i})}onDisconnectCancel(t,s){this.initConnection_(),this.connected_?this.sendOnDisconnect_("oc",t,null,s):this.onDisconnectRequestQueue_.push({pathString:t,action:"oc",data:null,onComplete:s})}sendOnDisconnect_(t,s,i,r){const o={p:s,d:i};this.log_("onDisconnect "+t,o),this.sendRequest(t,o,a=>{r&&setTimeout(()=>{r(a.s,a.d)},Math.floor(0))})}put(t,s,i,r){this.putInternal("p",t,s,i,r)}merge(t,s,i,r){this.putInternal("m",t,s,i,r)}putInternal(t,s,i,r,o){this.initConnection_();const a={p:s,d:i};void 0!==o&&(a.h=o),this.outstandingPuts_.push({action:t,request:a,onComplete:r}),this.outstandingPutCount_++,this.connected_?this.sendPut_(this.outstandingPuts_.length-1):this.log_("Buffering put: "+s)}sendPut_(t){const s=this.outstandingPuts_[t].action,i=this.outstandingPuts_[t].request,r=this.outstandingPuts_[t].onComplete;this.outstandingPuts_[t].queued=this.connected_,this.sendRequest(s,i,o=>{this.log_(s+" response",o),delete this.outstandingPuts_[t],this.outstandingPutCount_--,0===this.outstandingPutCount_&&(this.outstandingPuts_=[]),r&&r(o.s,o.d)})}reportStats(t){if(this.connected_){const s={c:t};this.log_("reportStats",s),this.sendRequest("s",s,i=>{"ok"!==i.s&&this.log_("reportStats","Error sending stats: "+i.d)})}}onDataMessage_(t){if("r"in t){this.log_("from server: "+(0,c.Wl)(t));const s=t.r,i=this.requestCBHash_[s];i&&(delete this.requestCBHash_[s],i(t.b))}else{if("error"in t)throw"A server-side error has occurred: "+t.error;"a"in t&&this.onDataPush_(t.a,t.b)}}onDataPush_(t,s){this.log_("handleServerMessage",t,s),"d"===t?this.onDataUpdate_(s.p,s.d,!1,s.t):"m"===t?this.onDataUpdate_(s.p,s.d,!0,s.t):"c"===t?this.onListenRevoked_(s.p,s.q):"ac"===t?this.onAuthRevoked_(s.s,s.d):"apc"===t?this.onAppCheckRevoked_(s.s,s.d):"sd"===t?this.onSecurityDebugPacket_(s):It("Unrecognized action received from server: "+(0,c.Wl)(t)+"\nAre you using the latest client?")}onReady_(t,s){this.log_("connection ready"),this.connected_=!0,this.lastConnectionEstablishedTime_=(new Date).getTime(),this.handleTimestamp_(t),this.lastSessionId=s,this.firstConnection_&&this.sendConnectStats_(),this.restoreState_(),this.firstConnection_=!1,this.onConnectStatus_(!0)}scheduleConnect_(t){(0,c.hu)(!this.realtime_,"Scheduling a connect when we're already connected/ing?"),this.establishConnectionTimer_&&clearTimeout(this.establishConnectionTimer_),this.establishConnectionTimer_=setTimeout(()=>{this.establishConnectionTimer_=null,this.establishConnection_()},Math.floor(t))}initConnection_(){!this.realtime_&&this.firstConnection_&&this.scheduleConnect_(0)}onVisible_(t){t&&!this.visible_&&this.reconnectDelay_===this.maxReconnectDelay_&&(this.log_("Window became visible.  Reducing delay."),this.reconnectDelay_=xt,this.realtime_||this.scheduleConnect_(0)),this.visible_=t}onOnline_(t){t?(this.log_("Browser went online."),this.reconnectDelay_=xt,this.realtime_||this.scheduleConnect_(0)):(this.log_("Browser went offline.  Killing connection."),this.realtime_&&this.realtime_.close())}onRealtimeDisconnect_(){if(this.log_("data client disconnected"),this.connected_=!1,this.realtime_=null,this.cancelSentTransactions_(),this.requestCBHash_={},this.shouldReconnect_()){this.visible_?this.lastConnectionEstablishedTime_&&((new Date).getTime()-this.lastConnectionEstablishedTime_>3e4&&(this.reconnectDelay_=xt),this.lastConnectionEstablishedTime_=null):(this.log_("Window isn't visible.  Delaying reconnect."),this.reconnectDelay_=this.maxReconnectDelay_,this.lastConnectionAttemptTime_=(new Date).getTime());const t=(new Date).getTime()-this.lastConnectionAttemptTime_;let s=Math.max(0,this.reconnectDelay_-t);s=Math.random()*s,this.log_("Trying to reconnect in "+s+"ms"),this.scheduleConnect_(s),this.reconnectDelay_=Math.min(this.maxReconnectDelay_,1.3*this.reconnectDelay_)}this.onConnectStatus_(!1)}establishConnection_(){var t=this;return(0,L.Z)(function*(){if(t.shouldReconnect_()){t.log_("Making a connection attempt"),t.lastConnectionAttemptTime_=(new Date).getTime(),t.lastConnectionEstablishedTime_=null;const s=t.onDataMessage_.bind(t),i=t.onReady_.bind(t),r=t.onRealtimeDisconnect_.bind(t),o=t.id+":"+n.nextConnectionId_++,a=t.lastSessionId;let u=!1,h=null;const d=function(){h?h.close():(u=!0,r())};t.realtime_={close:d,sendRequest:function(v){(0,c.hu)(h,"sendRequest call when we're not connected not allowed."),h.sendRequest(v)}};const _=t.forceTokenRefresh_;t.forceTokenRefresh_=!1;try{const[v,C]=yield Promise.all([t.authTokenProvider_.getToken(_),t.appCheckTokenProvider_.getToken(_)]);u?U("getToken() completed but was canceled"):(U("getToken() completed. Creating connection."),t.authToken_=v&&v.accessToken,t.appCheckToken_=C&&C.token,h=new hi(o,t.repoInfo_,t.applicationId_,t.appCheckToken_,t.authToken_,s,i,r,N=>{se(N+" ("+t.repoInfo_.toString()+")"),t.interrupt("server_kill")},a))}catch(v){t.log_("Failed to get token: "+v),u||(t.repoInfo_.nodeAdmin&&se(v),d())}}})()}interrupt(t){U("Interrupting connection for reason: "+t),this.interruptReasons_[t]=!0,this.realtime_?this.realtime_.close():(this.establishConnectionTimer_&&(clearTimeout(this.establishConnectionTimer_),this.establishConnectionTimer_=null),this.connected_&&this.onRealtimeDisconnect_())}resume(t){U("Resuming connection for reason: "+t),delete this.interruptReasons_[t],(0,c.xb)(this.interruptReasons_)&&(this.reconnectDelay_=xt,this.realtime_||this.scheduleConnect_(0))}handleTimestamp_(t){const s=t-(new Date).getTime();this.onServerInfoUpdate_({serverTimeOffset:s})}cancelSentTransactions_(){for(let t=0;t<this.outstandingPuts_.length;t++){const s=this.outstandingPuts_[t];s&&"h"in s.request&&s.queued&&(s.onComplete&&s.onComplete("disconnect"),delete this.outstandingPuts_[t],this.outstandingPutCount_--)}0===this.outstandingPutCount_&&(this.outstandingPuts_=[])}onListenRevoked_(t,s){let i;i=s?s.map(o=>kn(o)).join("$"):"default";const r=this.removeListen_(t,i);r&&r.onComplete&&r.onComplete("permission_denied")}removeListen_(t,s){const i=new k(t).toString();let r;if(this.listens.has(i)){const o=this.listens.get(i);r=o.get(s),o.delete(s),0===o.size&&this.listens.delete(i)}else r=void 0;return r}onAuthRevoked_(t,s){U("Auth token revoked: "+t+"/"+s),this.authToken_=null,this.forceTokenRefresh_=!0,this.realtime_.close(),("invalid_token"===t||"permission_denied"===t)&&(this.invalidAuthTokenCount_++,this.invalidAuthTokenCount_>=3&&(this.reconnectDelay_=3e4,this.authTokenProvider_.notifyForInvalidToken()))}onAppCheckRevoked_(t,s){U("App check token revoked: "+t+"/"+s),this.appCheckToken_=null,this.forceTokenRefresh_=!0,("invalid_token"===t||"permission_denied"===t)&&(this.invalidAppCheckTokenCount_++,this.invalidAppCheckTokenCount_>=3&&this.appCheckTokenProvider_.notifyForInvalidToken())}onSecurityDebugPacket_(t){this.securityDebugCallback_?this.securityDebugCallback_(t):"msg"in t&&console.log("FIREBASE: "+t.msg.replace("\n","\nFIREBASE: "))}restoreState_(){this.tryAuth(),this.tryAppCheck();for(const t of this.listens.values())for(const s of t.values())this.sendListen_(s);for(let t=0;t<this.outstandingPuts_.length;t++)this.outstandingPuts_[t]&&this.sendPut_(t);for(;this.onDisconnectRequestQueue_.length;){const t=this.onDisconnectRequestQueue_.shift();this.sendOnDisconnect_(t.action,t.pathString,t.data,t.onComplete)}for(let t=0;t<this.outstandingGets_.length;t++)this.outstandingGets_[t]&&this.sendGet_(t)}sendConnectStats_(){const t={};let s="js";(0,c.Yr)()&&(s=this.repoInfo_.nodeAdmin?"admin_node":"node"),t["sdk."+s+"."+Q.replace(/\./g,"-")]=1,(0,c.uI)()?t["framework.cordova"]=1:(0,c.b$)()&&(t["framework.reactnative"]=1),this.reportStats(t)}shouldReconnect_(){const t=tn.getInstance().currentlyOnline();return(0,c.xb)(this.interruptReasons_)&&t}}return n.nextPersistentConnectionId_=0,n.nextConnectionId_=0,n})();class A{constructor(e,t){this.name=e,this.node=t}static Wrap(e,t){return new A(e,t)}}class nn{getCompare(){return this.compare.bind(this)}indexedValueChanged(e,t){const s=new A(je,e),i=new A(je,t);return 0!==this.compare(s,i)}minPost(){return A.MIN}}class Ci extends nn{static get __EMPTY_NODE(){return sn}static set __EMPTY_NODE(e){sn=e}compare(e,t){return st(e.name,t.name)}isDefinedOn(e){throw(0,c.g5)("KeyIndex.isDefinedOn not expected to be called.")}indexedValueChanged(e,t){return!1}minPost(){return A.MIN}maxPost(){return new A(Ue,sn)}makePost(e,t){return(0,c.hu)("string"==typeof e,"KeyIndex indexValue must always be a string."),new A(e,sn)}toString(){return".key"}}const Re=new Ci;class rn{constructor(e,t,s,i,r=null){this.isReverse_=i,this.resultGenerator_=r,this.nodeStack_=[];let o=1;for(;!e.isEmpty();)if(o=t?s(e.key,t):1,i&&(o*=-1),o<0)e=this.isReverse_?e.left:e.right;else{if(0===o){this.nodeStack_.push(e);break}this.nodeStack_.push(e),e=this.isReverse_?e.right:e.left}}getNext(){if(0===this.nodeStack_.length)return null;let t,e=this.nodeStack_.pop();if(t=this.resultGenerator_?this.resultGenerator_(e.key,e.value):{key:e.key,value:e.value},this.isReverse_)for(e=e.left;!e.isEmpty();)this.nodeStack_.push(e),e=e.right;else for(e=e.right;!e.isEmpty();)this.nodeStack_.push(e),e=e.left;return t}hasNext(){return this.nodeStack_.length>0}peek(){if(0===this.nodeStack_.length)return null;const e=this.nodeStack_[this.nodeStack_.length-1];return this.resultGenerator_?this.resultGenerator_(e.key,e.value):{key:e.key,value:e.value}}}let Gn,we=(()=>{class n{constructor(t,s,i,r,o){this.key=t,this.value=s,this.color=i??n.RED,this.left=r??ue.EMPTY_NODE,this.right=o??ue.EMPTY_NODE}copy(t,s,i,r,o){return new n(t??this.key,s??this.value,i??this.color,r??this.left,o??this.right)}count(){return this.left.count()+1+this.right.count()}isEmpty(){return!1}inorderTraversal(t){return this.left.inorderTraversal(t)||!!t(this.key,this.value)||this.right.inorderTraversal(t)}reverseTraversal(t){return this.right.reverseTraversal(t)||t(this.key,this.value)||this.left.reverseTraversal(t)}min_(){return this.left.isEmpty()?this:this.left.min_()}minKey(){return this.min_().key}maxKey(){return this.right.isEmpty()?this.key:this.right.maxKey()}insert(t,s,i){let r=this;const o=i(t,r.key);return r=o<0?r.copy(null,null,null,r.left.insert(t,s,i),null):0===o?r.copy(null,s,null,null,null):r.copy(null,null,null,null,r.right.insert(t,s,i)),r.fixUp_()}removeMin_(){if(this.left.isEmpty())return ue.EMPTY_NODE;let t=this;return!t.left.isRed_()&&!t.left.left.isRed_()&&(t=t.moveRedLeft_()),t=t.copy(null,null,null,t.left.removeMin_(),null),t.fixUp_()}remove(t,s){let i,r;if(i=this,s(t,i.key)<0)!i.left.isEmpty()&&!i.left.isRed_()&&!i.left.left.isRed_()&&(i=i.moveRedLeft_()),i=i.copy(null,null,null,i.left.remove(t,s),null);else{if(i.left.isRed_()&&(i=i.rotateRight_()),!i.right.isEmpty()&&!i.right.isRed_()&&!i.right.left.isRed_()&&(i=i.moveRedRight_()),0===s(t,i.key)){if(i.right.isEmpty())return ue.EMPTY_NODE;r=i.right.min_(),i=i.copy(r.key,r.value,null,null,i.right.removeMin_())}i=i.copy(null,null,null,null,i.right.remove(t,s))}return i.fixUp_()}isRed_(){return this.color}fixUp_(){let t=this;return t.right.isRed_()&&!t.left.isRed_()&&(t=t.rotateLeft_()),t.left.isRed_()&&t.left.left.isRed_()&&(t=t.rotateRight_()),t.left.isRed_()&&t.right.isRed_()&&(t=t.colorFlip_()),t}moveRedLeft_(){let t=this.colorFlip_();return t.right.left.isRed_()&&(t=t.copy(null,null,null,null,t.right.rotateRight_()),t=t.rotateLeft_(),t=t.colorFlip_()),t}moveRedRight_(){let t=this.colorFlip_();return t.left.left.isRed_()&&(t=t.rotateRight_(),t=t.colorFlip_()),t}rotateLeft_(){const t=this.copy(null,null,n.RED,null,this.right.left);return this.right.copy(null,null,this.color,t,null)}rotateRight_(){const t=this.copy(null,null,n.RED,this.left.right,null);return this.left.copy(null,null,this.color,null,t)}colorFlip_(){const t=this.left.copy(null,null,!this.left.color,null,null),s=this.right.copy(null,null,!this.right.color,null,null);return this.copy(null,null,!this.color,t,s)}checkMaxDepth_(){const t=this.check_();return Math.pow(2,t)<=this.count()+1}check_(){if(this.isRed_()&&this.left.isRed_())throw new Error("Red node has red child("+this.key+","+this.value+")");if(this.right.isRed_())throw new Error("Right child of ("+this.key+","+this.value+") is red");const t=this.left.check_();if(t!==this.right.check_())throw new Error("Black depths differ");return t+(this.isRed_()?0:1)}}return n.RED=!0,n.BLACK=!1,n})();class ue{constructor(e,t=ue.EMPTY_NODE){this.comparator_=e,this.root_=t}insert(e,t){return new ue(this.comparator_,this.root_.insert(e,t,this.comparator_).copy(null,null,we.BLACK,null,null))}remove(e){return new ue(this.comparator_,this.root_.remove(e,this.comparator_).copy(null,null,we.BLACK,null,null))}get(e){let t,s=this.root_;for(;!s.isEmpty();){if(t=this.comparator_(e,s.key),0===t)return s.value;t<0?s=s.left:t>0&&(s=s.right)}return null}getPredecessorKey(e){let t,s=this.root_,i=null;for(;!s.isEmpty();){if(t=this.comparator_(e,s.key),0===t){if(s.left.isEmpty())return i?i.key:null;for(s=s.left;!s.right.isEmpty();)s=s.right;return s.key}t<0?s=s.left:t>0&&(i=s,s=s.right)}throw new Error("Attempted to find predecessor key for a nonexistent key.  What gives?")}isEmpty(){return this.root_.isEmpty()}count(){return this.root_.count()}minKey(){return this.root_.minKey()}maxKey(){return this.root_.maxKey()}inorderTraversal(e){return this.root_.inorderTraversal(e)}reverseTraversal(e){return this.root_.reverseTraversal(e)}getIterator(e){return new rn(this.root_,null,this.comparator_,!1,e)}getIteratorFrom(e,t){return new rn(this.root_,e,this.comparator_,!1,t)}getReverseIteratorFrom(e,t){return new rn(this.root_,e,this.comparator_,!0,t)}getReverseIterator(e){return new rn(this.root_,null,this.comparator_,!0,e)}}function Zo(n,e){return st(n.name,e.name)}function Yn(n,e){return st(n,e)}ue.EMPTY_NODE=new class Qo{copy(e,t,s,i,r){return this}insert(e,t,s){return new we(e,t,null)}remove(e,t){return this}count(){return 0}isEmpty(){return!0}inorderTraversal(e){return!1}reverseTraversal(e){return!1}minKey(){return null}maxKey(){return null}check_(){return 0}isRed_(){return!1}};const Ei=function(n){return"number"==typeof n?"number:"+Bs(n):"string:"+n},wi=function(n){if(n.isLeafNode()){const e=n.val();(0,c.hu)("string"==typeof e||"number"==typeof e||"object"==typeof e&&(0,c.r3)(e,".sv"),"Priority must be a string or number.")}else(0,c.hu)(n===Gn||n.isEmpty(),"priority of unexpected type.");(0,c.hu)(n===Gn||n.getPriority().isEmpty(),"Priority nodes can't have a priority of their own.")};let Ti,Ii,Si,_t=(()=>{class n{constructor(t,s=n.__childrenNodeConstructor.EMPTY_NODE){this.value_=t,this.priorityNode_=s,this.lazyHash_=null,(0,c.hu)(null!=this.value_,"LeafNode shouldn't be created with null/undefined value."),wi(this.priorityNode_)}static set __childrenNodeConstructor(t){Ti=t}static get __childrenNodeConstructor(){return Ti}isLeafNode(){return!0}getPriority(){return this.priorityNode_}updatePriority(t){return new n(this.value_,t)}getImmediateChild(t){return".priority"===t?this.priorityNode_:n.__childrenNodeConstructor.EMPTY_NODE}getChild(t){return b(t)?this:".priority"===D(t)?this.priorityNode_:n.__childrenNodeConstructor.EMPTY_NODE}hasChild(){return!1}getPredecessorChildName(t,s){return null}updateImmediateChild(t,s){return".priority"===t?this.updatePriority(s):s.isEmpty()&&".priority"!==t?this:n.__childrenNodeConstructor.EMPTY_NODE.updateImmediateChild(t,s).updatePriority(this.priorityNode_)}updateChild(t,s){const i=D(t);return null===i?s:s.isEmpty()&&".priority"!==i?this:((0,c.hu)(".priority"!==i||1===Ge(t),".priority must be the last token in a path"),this.updateImmediateChild(i,n.__childrenNodeConstructor.EMPTY_NODE.updateChild(F(t),s)))}isEmpty(){return!1}numChildren(){return 0}forEachChild(t,s){return!1}val(t){return t&&!this.getPriority().isEmpty()?{".value":this.getValue(),".priority":this.getPriority().val()}:this.getValue()}hash(){if(null===this.lazyHash_){let t="";this.priorityNode_.isEmpty()||(t+="priority:"+Ei(this.priorityNode_.val())+":");const s=typeof this.value_;t+=s+":",t+="number"===s?Bs(this.value_):this.value_,this.lazyHash_=ce(t)}return this.lazyHash_}getValue(){return this.value_}compareTo(t){return t===n.__childrenNodeConstructor.EMPTY_NODE?1:t instanceof n.__childrenNodeConstructor?-1:((0,c.hu)(t.isLeafNode(),"Unknown node type"),this.compareToLeafNode_(t))}compareToLeafNode_(t){const s=typeof t.value_,i=typeof this.value_,r=n.VALUE_TYPE_ORDER.indexOf(s),o=n.VALUE_TYPE_ORDER.indexOf(i);return(0,c.hu)(r>=0,"Unknown leaf type: "+s),(0,c.hu)(o>=0,"Unknown leaf type: "+i),r===o?"object"===i?0:this.value_<t.value_?-1:this.value_===t.value_?0:1:o-r}withIndex(){return this}isIndexed(){return!0}equals(t){return t===this||!!t.isLeafNode()&&(this.value_===t.value_&&this.priorityNode_.equals(t.priorityNode_))}}return n.VALUE_TYPE_ORDER=["object","boolean","number","string"],n})();const W=new class Go extends nn{compare(e,t){const s=e.node.getPriority(),i=t.node.getPriority(),r=s.compareTo(i);return 0===r?st(e.name,t.name):r}isDefinedOn(e){return!e.getPriority().isEmpty()}indexedValueChanged(e,t){return!e.getPriority().equals(t.getPriority())}minPost(){return A.MIN}maxPost(){return new A(Ue,new _t("[PRIORITY-POST]",Si))}makePost(e,t){const s=Ii(e);return new A(t,new _t("[PRIORITY-POST]",s))}toString(){return".priority"}},Vo=Math.log(2);class Ho{constructor(e){this.count=parseInt(Math.log(e+1)/Vo,10),this.current_=this.count-1;const i=(r=>parseInt(Array(this.count+1).join("1"),2))();this.bits_=e+1&i}nextBitIsOne(){const e=!(this.bits_&1<<this.current_);return this.current_--,e}}const on=function(n,e,t,s){n.sort(e);const i=function(u,h){const d=h-u;let f,_;if(0===d)return null;if(1===d)return f=n[u],_=t?t(f):f,new we(_,f.node,we.BLACK,null,null);{const v=parseInt(d/2,10)+u,C=i(u,v),N=i(v+1,h);return f=n[v],_=t?t(f):f,new we(_,f.node,we.BLACK,C,N)}},a=function(u){let h=null,d=null,f=n.length;const _=function(C,N){const q=f-C,Le=f;f-=C;const Be=i(q+1,Le),Tt=n[q],su=t?t(Tt):Tt;v(new we(su,Tt.node,N,null,Be))},v=function(C){h?(h.left=C,h=C):(d=C,h=C)};for(let C=0;C<u.count;++C){const N=u.nextBitIsOne(),q=Math.pow(2,u.count-(C+1));N?_(q,we.BLACK):(_(q,we.BLACK),_(q,we.RED))}return d}(new Ho(n.length));return new ue(s||e,a)};let Vn;const pt={};class We{constructor(e,t){this.indexes_=e,this.indexSet_=t}static get Default(){return(0,c.hu)(pt&&W,"ChildrenNode.ts has not been loaded"),Vn=Vn||new We({".priority":pt},{".priority":W}),Vn}get(e){const t=(0,c.DV)(this.indexes_,e);if(!t)throw new Error("No index defined for "+e);return t instanceof ue?t:null}hasIndex(e){return(0,c.r3)(this.indexSet_,e.toString())}addIndex(e,t){(0,c.hu)(e!==Re,"KeyIndex always exists and isn't meant to be added to the IndexMap.");const s=[];let i=!1;const r=t.getIterator(A.Wrap);let a,o=r.getNext();for(;o;)i=i||e.isDefinedOn(o.node),s.push(o),o=r.getNext();a=i?on(s,e.getCompare()):pt;const u=e.toString(),h=Object.assign({},this.indexSet_);h[u]=e;const d=Object.assign({},this.indexes_);return d[u]=a,new We(d,h)}addToIndexes(e,t){const s=(0,c.UI)(this.indexes_,(i,r)=>{const o=(0,c.DV)(this.indexSet_,r);if((0,c.hu)(o,"Missing index implementation for "+r),i===pt){if(o.isDefinedOn(e.node)){const a=[],u=t.getIterator(A.Wrap);let h=u.getNext();for(;h;)h.name!==e.name&&a.push(h),h=u.getNext();return a.push(e),on(a,o.getCompare())}return pt}{const a=t.get(e.name);let u=i;return a&&(u=u.remove(new A(e.name,a))),u.insert(e,e.node)}});return new We(s,this.indexSet_)}removeFromIndexes(e,t){const s=(0,c.UI)(this.indexes_,i=>{if(i===pt)return i;{const r=t.get(e.name);return r?i.remove(new A(e.name,r)):i}});return new We(s,this.indexSet_)}}let Pt,I=(()=>{class n{constructor(t,s,i){this.children_=t,this.priorityNode_=s,this.indexMap_=i,this.lazyHash_=null,this.priorityNode_&&wi(this.priorityNode_),this.children_.isEmpty()&&(0,c.hu)(!this.priorityNode_||this.priorityNode_.isEmpty(),"An empty node cannot have a priority")}static get EMPTY_NODE(){return Pt||(Pt=new n(new ue(Yn),null,We.Default))}isLeafNode(){return!1}getPriority(){return this.priorityNode_||Pt}updatePriority(t){return this.children_.isEmpty()?this:new n(this.children_,t,this.indexMap_)}getImmediateChild(t){if(".priority"===t)return this.getPriority();{const s=this.children_.get(t);return null===s?Pt:s}}getChild(t){const s=D(t);return null===s?this:this.getImmediateChild(s).getChild(F(t))}hasChild(t){return null!==this.children_.get(t)}updateImmediateChild(t,s){if((0,c.hu)(s,"We should always be passing snapshot nodes"),".priority"===t)return this.updatePriority(s);{const i=new A(t,s);let r,o;s.isEmpty()?(r=this.children_.remove(t),o=this.indexMap_.removeFromIndexes(i,this.children_)):(r=this.children_.insert(t,s),o=this.indexMap_.addToIndexes(i,this.children_));const a=r.isEmpty()?Pt:this.priorityNode_;return new n(r,a,o)}}updateChild(t,s){const i=D(t);if(null===i)return s;{(0,c.hu)(".priority"!==D(t)||1===Ge(t),".priority must be the last token in a path");const r=this.getImmediateChild(i).updateChild(F(t),s);return this.updateImmediateChild(i,r)}}isEmpty(){return this.children_.isEmpty()}numChildren(){return this.children_.count()}val(t){if(this.isEmpty())return null;const s={};let i=0,r=0,o=!0;if(this.forEachChild(W,(a,u)=>{s[a]=u.val(t),i++,o&&n.INTEGER_REGEXP_.test(a)?r=Math.max(r,Number(a)):o=!1}),!t&&o&&r<2*i){const a=[];for(const u in s)a[u]=s[u];return a}return t&&!this.getPriority().isEmpty()&&(s[".priority"]=this.getPriority().val()),s}hash(){if(null===this.lazyHash_){let t="";this.getPriority().isEmpty()||(t+="priority:"+Ei(this.getPriority().val())+":"),this.forEachChild(W,(s,i)=>{const r=i.hash();""!==r&&(t+=":"+s+":"+r)}),this.lazyHash_=""===t?"":ce(t)}return this.lazyHash_}getPredecessorChildName(t,s,i){const r=this.resolveIndex_(i);if(r){const o=r.getPredecessorKey(new A(t,s));return o?o.name:null}return this.children_.getPredecessorKey(t)}getFirstChildName(t){const s=this.resolveIndex_(t);if(s){const i=s.minKey();return i&&i.name}return this.children_.minKey()}getFirstChild(t){const s=this.getFirstChildName(t);return s?new A(s,this.children_.get(s)):null}getLastChildName(t){const s=this.resolveIndex_(t);if(s){const i=s.maxKey();return i&&i.name}return this.children_.maxKey()}getLastChild(t){const s=this.getLastChildName(t);return s?new A(s,this.children_.get(s)):null}forEachChild(t,s){const i=this.resolveIndex_(t);return i?i.inorderTraversal(r=>s(r.name,r.node)):this.children_.inorderTraversal(s)}getIterator(t){return this.getIteratorFrom(t.minPost(),t)}getIteratorFrom(t,s){const i=this.resolveIndex_(s);if(i)return i.getIteratorFrom(t,r=>r);{const r=this.children_.getIteratorFrom(t.name,A.Wrap);let o=r.peek();for(;null!=o&&s.compare(o,t)<0;)r.getNext(),o=r.peek();return r}}getReverseIterator(t){return this.getReverseIteratorFrom(t.maxPost(),t)}getReverseIteratorFrom(t,s){const i=this.resolveIndex_(s);if(i)return i.getReverseIteratorFrom(t,r=>r);{const r=this.children_.getReverseIteratorFrom(t.name,A.Wrap);let o=r.peek();for(;null!=o&&s.compare(o,t)>0;)r.getNext(),o=r.peek();return r}}compareTo(t){return this.isEmpty()?t.isEmpty()?0:-1:t.isLeafNode()||t.isEmpty()?1:t===Nt?-1:0}withIndex(t){if(t===Re||this.indexMap_.hasIndex(t))return this;{const s=this.indexMap_.addIndex(t,this.children_);return new n(this.children_,this.priorityNode_,s)}}isIndexed(t){return t===Re||this.indexMap_.hasIndex(t)}equals(t){if(t===this)return!0;if(t.isLeafNode())return!1;{const s=t;if(this.getPriority().equals(s.getPriority())){if(this.children_.count()===s.children_.count()){const i=this.getIterator(W),r=s.getIterator(W);let o=i.getNext(),a=r.getNext();for(;o&&a;){if(o.name!==a.name||!o.node.equals(a.node))return!1;o=i.getNext(),a=r.getNext()}return null===o&&null===a}return!1}return!1}}resolveIndex_(t){return t===Re?null:this.indexMap_.get(t.toString())}}return n.INTEGER_REGEXP_=/^(0|[1-9]\d*)$/,n})();const Nt=new class Jo extends I{constructor(){super(new ue(Yn),I.EMPTY_NODE,We.Default)}compareTo(e){return e===this?0:1}equals(e){return e===this}getPriority(){return this}getImmediateChild(e){return I.EMPTY_NODE}isEmpty(){return!1}};Object.defineProperties(A,{MIN:{value:new A(je,I.EMPTY_NODE)},MAX:{value:new A(Ue,Nt)}}),Ci.__EMPTY_NODE=I.EMPTY_NODE,_t.__childrenNodeConstructor=I,function Ko(n){Gn=n}(Nt),function Yo(n){Si=n}(Nt);const $o=!0;function Y(n,e=null){if(null===n)return I.EMPTY_NODE;if("object"==typeof n&&".priority"in n&&(e=n[".priority"]),(0,c.hu)(null===e||"string"==typeof e||"number"==typeof e||"object"==typeof e&&".sv"in e,"Invalid priority type found: "+typeof e),"object"==typeof n&&".value"in n&&null!==n[".value"]&&(n=n[".value"]),"object"!=typeof n||".sv"in n)return new _t(n,Y(e));if(n instanceof Array||!$o){let t=I.EMPTY_NODE;return z(n,(s,i)=>{if((0,c.r3)(n,s)&&"."!==s.substring(0,1)){const r=Y(i);(r.isLeafNode()||!r.isEmpty())&&(t=t.updateImmediateChild(s,r))}}),t.updatePriority(Y(e))}{const t=[];let s=!1;if(z(n,(o,a)=>{if("."!==o.substring(0,1)){const u=Y(a);u.isEmpty()||(s=s||!u.getPriority().isEmpty(),t.push(new A(o,u)))}}),0===t.length)return I.EMPTY_NODE;const r=on(t,Zo,o=>o.name,Yn);if(s){const o=on(t,W.getCompare());return new I(r,Y(e),new We({".priority":o},{".priority":W}))}return new I(r,Y(e),We.Default)}}!function jo(n){Ii=n}(Y);class Hn extends nn{constructor(e){super(),this.indexPath_=e,(0,c.hu)(!b(e)&&".priority"!==D(e),"Can't create PathIndex with empty path or .priority key")}extractChild(e){return e.getChild(this.indexPath_)}isDefinedOn(e){return!e.getChild(this.indexPath_).isEmpty()}compare(e,t){const s=this.extractChild(e.node),i=this.extractChild(t.node),r=s.compareTo(i);return 0===r?st(e.name,t.name):r}makePost(e,t){const s=Y(e),i=I.EMPTY_NODE.updateChild(this.indexPath_,s);return new A(t,i)}maxPost(){const e=I.EMPTY_NODE.updateChild(this.indexPath_,Nt);return new A(Ue,e)}toString(){return At(this.indexPath_,0).join("/")}}const Jn=new class zo extends nn{compare(e,t){const s=e.node.compareTo(t.node);return 0===s?st(e.name,t.name):s}isDefinedOn(e){return!0}indexedValueChanged(e,t){return!e.equals(t)}minPost(){return A.MIN}maxPost(){return A.MAX}makePost(e,t){const s=Y(e);return new A(t,s)}toString(){return".value"}};function Di(n){return{type:"value",snapshotNode:n}}function gt(n,e){return{type:"child_added",snapshotNode:e,childName:n}}function Rt(n,e){return{type:"child_removed",snapshotNode:e,childName:n}}function Ot(n,e,t){return{type:"child_changed",snapshotNode:e,childName:n,oldSnap:t}}class $n{constructor(e){this.index_=e}updateChild(e,t,s,i,r,o){(0,c.hu)(e.isIndexed(this.index_),"A node must be indexed if only a child is updated");const a=e.getImmediateChild(t);return a.getChild(i).equals(s.getChild(i))&&a.isEmpty()===s.isEmpty()||(null!=o&&(s.isEmpty()?e.hasChild(t)?o.trackChildChange(Rt(t,a)):(0,c.hu)(e.isLeafNode(),"A child remove without an old child only makes sense on a leaf node"):a.isEmpty()?o.trackChildChange(gt(t,s)):o.trackChildChange(Ot(t,s,a))),e.isLeafNode()&&s.isEmpty())?e:e.updateImmediateChild(t,s).withIndex(this.index_)}updateFullNode(e,t,s){return null!=s&&(e.isLeafNode()||e.forEachChild(W,(i,r)=>{t.hasChild(i)||s.trackChildChange(Rt(i,r))}),t.isLeafNode()||t.forEachChild(W,(i,r)=>{if(e.hasChild(i)){const o=e.getImmediateChild(i);o.equals(r)||s.trackChildChange(Ot(i,r,o))}else s.trackChildChange(gt(i,r))})),t.withIndex(this.index_)}updatePriority(e,t){return e.isEmpty()?I.EMPTY_NODE:e.updatePriority(t)}filtersNodes(){return!1}getIndexedFilter(){return this}getIndex(){return this.index_}}class kt{constructor(e){this.indexedFilter_=new $n(e.getIndex()),this.index_=e.getIndex(),this.startPost_=kt.getStartPost_(e),this.endPost_=kt.getEndPost_(e),this.startIsInclusive_=!e.startAfterSet_,this.endIsInclusive_=!e.endBeforeSet_}getStartPost(){return this.startPost_}getEndPost(){return this.endPost_}matches(e){const t=this.startIsInclusive_?this.index_.compare(this.getStartPost(),e)<=0:this.index_.compare(this.getStartPost(),e)<0,s=this.endIsInclusive_?this.index_.compare(e,this.getEndPost())<=0:this.index_.compare(e,this.getEndPost())<0;return t&&s}updateChild(e,t,s,i,r,o){return this.matches(new A(t,s))||(s=I.EMPTY_NODE),this.indexedFilter_.updateChild(e,t,s,i,r,o)}updateFullNode(e,t,s){t.isLeafNode()&&(t=I.EMPTY_NODE);let i=t.withIndex(this.index_);i=i.updatePriority(I.EMPTY_NODE);const r=this;return t.forEachChild(W,(o,a)=>{r.matches(new A(o,a))||(i=i.updateImmediateChild(o,I.EMPTY_NODE))}),this.indexedFilter_.updateFullNode(e,i,s)}updatePriority(e,t){return e}filtersNodes(){return!0}getIndexedFilter(){return this.indexedFilter_}getIndex(){return this.index_}static getStartPost_(e){if(e.hasStart()){const t=e.getIndexStartName();return e.getIndex().makePost(e.getIndexStartValue(),t)}return e.getIndex().minPost()}static getEndPost_(e){if(e.hasEnd()){const t=e.getIndexEndName();return e.getIndex().makePost(e.getIndexEndValue(),t)}return e.getIndex().maxPost()}}class Xo{constructor(e){this.withinDirectionalStart=t=>this.reverse_?this.withinEndPost(t):this.withinStartPost(t),this.withinDirectionalEnd=t=>this.reverse_?this.withinStartPost(t):this.withinEndPost(t),this.withinStartPost=t=>{const s=this.index_.compare(this.rangedFilter_.getStartPost(),t);return this.startIsInclusive_?s<=0:s<0},this.withinEndPost=t=>{const s=this.index_.compare(t,this.rangedFilter_.getEndPost());return this.endIsInclusive_?s<=0:s<0},this.rangedFilter_=new kt(e),this.index_=e.getIndex(),this.limit_=e.getLimit(),this.reverse_=!e.isViewFromLeft(),this.startIsInclusive_=!e.startAfterSet_,this.endIsInclusive_=!e.endBeforeSet_}updateChild(e,t,s,i,r,o){return this.rangedFilter_.matches(new A(t,s))||(s=I.EMPTY_NODE),e.getImmediateChild(t).equals(s)?e:e.numChildren()<this.limit_?this.rangedFilter_.getIndexedFilter().updateChild(e,t,s,i,r,o):this.fullLimitUpdateChild_(e,t,s,r,o)}updateFullNode(e,t,s){let i;if(t.isLeafNode()||t.isEmpty())i=I.EMPTY_NODE.withIndex(this.index_);else if(2*this.limit_<t.numChildren()&&t.isIndexed(this.index_)){let r;i=I.EMPTY_NODE.withIndex(this.index_),r=this.reverse_?t.getReverseIteratorFrom(this.rangedFilter_.getEndPost(),this.index_):t.getIteratorFrom(this.rangedFilter_.getStartPost(),this.index_);let o=0;for(;r.hasNext()&&o<this.limit_;){const a=r.getNext();if(this.withinDirectionalStart(a)){if(!this.withinDirectionalEnd(a))break;i=i.updateImmediateChild(a.name,a.node),o++}}}else{let r;i=t.withIndex(this.index_),i=i.updatePriority(I.EMPTY_NODE),r=this.reverse_?i.getReverseIterator(this.index_):i.getIterator(this.index_);let o=0;for(;r.hasNext();){const a=r.getNext();o<this.limit_&&this.withinDirectionalStart(a)&&this.withinDirectionalEnd(a)?o++:i=i.updateImmediateChild(a.name,I.EMPTY_NODE)}}return this.rangedFilter_.getIndexedFilter().updateFullNode(e,i,s)}updatePriority(e,t){return e}filtersNodes(){return!0}getIndexedFilter(){return this.rangedFilter_.getIndexedFilter()}getIndex(){return this.index_}fullLimitUpdateChild_(e,t,s,i,r){let o;if(this.reverse_){const f=this.index_.getCompare();o=(_,v)=>f(v,_)}else o=this.index_.getCompare();const a=e;(0,c.hu)(a.numChildren()===this.limit_,"");const u=new A(t,s),h=this.reverse_?a.getFirstChild(this.index_):a.getLastChild(this.index_),d=this.rangedFilter_.matches(u);if(a.hasChild(t)){const f=a.getImmediateChild(t);let _=i.getChildAfterChild(this.index_,h,this.reverse_);for(;null!=_&&(_.name===t||a.hasChild(_.name));)_=i.getChildAfterChild(this.index_,_,this.reverse_);const v=null==_?1:o(_,u);if(d&&!s.isEmpty()&&v>=0)return r?.trackChildChange(Ot(t,s,f)),a.updateImmediateChild(t,s);{r?.trackChildChange(Rt(t,f));const N=a.updateImmediateChild(t,I.EMPTY_NODE);return null!=_&&this.rangedFilter_.matches(_)?(r?.trackChildChange(gt(_.name,_.node)),N.updateImmediateChild(_.name,_.node)):N}}return s.isEmpty()?e:d&&o(h,u)>=0?(null!=r&&(r.trackChildChange(Rt(h.name,h.node)),r.trackChildChange(gt(t,s))),a.updateImmediateChild(t,s).updateImmediateChild(h.name,I.EMPTY_NODE)):e}}class an{constructor(){this.limitSet_=!1,this.startSet_=!1,this.startNameSet_=!1,this.startAfterSet_=!1,this.endSet_=!1,this.endNameSet_=!1,this.endBeforeSet_=!1,this.limit_=0,this.viewFrom_="",this.indexStartValue_=null,this.indexStartName_="",this.indexEndValue_=null,this.indexEndName_="",this.index_=W}hasStart(){return this.startSet_}isViewFromLeft(){return""===this.viewFrom_?this.startSet_:"l"===this.viewFrom_}getIndexStartValue(){return(0,c.hu)(this.startSet_,"Only valid if start has been set"),this.indexStartValue_}getIndexStartName(){return(0,c.hu)(this.startSet_,"Only valid if start has been set"),this.startNameSet_?this.indexStartName_:je}hasEnd(){return this.endSet_}getIndexEndValue(){return(0,c.hu)(this.endSet_,"Only valid if end has been set"),this.indexEndValue_}getIndexEndName(){return(0,c.hu)(this.endSet_,"Only valid if end has been set"),this.endNameSet_?this.indexEndName_:Ue}hasLimit(){return this.limitSet_}hasAnchoredLimit(){return this.limitSet_&&""!==this.viewFrom_}getLimit(){return(0,c.hu)(this.limitSet_,"Only valid if limit has been set"),this.limit_}getIndex(){return this.index_}loadsAllData(){return!(this.startSet_||this.endSet_||this.limitSet_)}isDefault(){return this.loadsAllData()&&this.index_===W}copy(){const e=new an;return e.limitSet_=this.limitSet_,e.limit_=this.limit_,e.startSet_=this.startSet_,e.startAfterSet_=this.startAfterSet_,e.indexStartValue_=this.indexStartValue_,e.startNameSet_=this.startNameSet_,e.indexStartName_=this.indexStartName_,e.endSet_=this.endSet_,e.endBeforeSet_=this.endBeforeSet_,e.indexEndValue_=this.indexEndValue_,e.endNameSet_=this.endNameSet_,e.indexEndName_=this.indexEndName_,e.index_=this.index_,e.viewFrom_=this.viewFrom_,e}}function zn(n,e,t){const s=n.copy();return s.startSet_=!0,void 0===e&&(e=null),s.indexStartValue_=e,null!=t?(s.startNameSet_=!0,s.indexStartName_=t):(s.startNameSet_=!1,s.indexStartName_=""),s}function qn(n,e,t){const s=n.copy();return s.endSet_=!0,void 0===e&&(e=null),s.indexEndValue_=e,void 0!==t?(s.endNameSet_=!0,s.indexEndName_=t):(s.endNameSet_=!1,s.indexEndName_=""),s}function ln(n,e){const t=n.copy();return t.index_=e,t}function bi(n){const e={};if(n.isDefault())return e;let t;if(n.index_===W?t="$priority":n.index_===Jn?t="$value":n.index_===Re?t="$key":((0,c.hu)(n.index_ instanceof Hn,"Unrecognized index type!"),t=n.index_.toString()),e.orderBy=(0,c.Wl)(t),n.startSet_){const s=n.startAfterSet_?"startAfter":"startAt";e[s]=(0,c.Wl)(n.indexStartValue_),n.startNameSet_&&(e[s]+=","+(0,c.Wl)(n.indexStartName_))}if(n.endSet_){const s=n.endBeforeSet_?"endBefore":"endAt";e[s]=(0,c.Wl)(n.indexEndValue_),n.endNameSet_&&(e[s]+=","+(0,c.Wl)(n.indexEndName_))}return n.limitSet_&&(n.isViewFromLeft()?e.limitToFirst=n.limit_:e.limitToLast=n.limit_),e}function Ai(n){const e={};if(n.startSet_&&(e.sp=n.indexStartValue_,n.startNameSet_&&(e.sn=n.indexStartName_),e.sin=!n.startAfterSet_),n.endSet_&&(e.ep=n.indexEndValue_,n.endNameSet_&&(e.en=n.indexEndName_),e.ein=!n.endBeforeSet_),n.limitSet_){e.l=n.limit_;let t=n.viewFrom_;""===t&&(t=n.isViewFromLeft()?"l":"r"),e.vf=t}return n.index_!==W&&(e.i=n.index_.toString()),e}class cn extends di{constructor(e,t,s,i){super(),this.repoInfo_=e,this.onDataUpdate_=t,this.authTokenProvider_=s,this.appCheckTokenProvider_=i,this.log_=nt("p:rest:"),this.listens_={}}reportStats(e){throw new Error("Method not implemented.")}static getListenId_(e,t){return void 0!==t?"tag$"+t:((0,c.hu)(e._queryParams.isDefault(),"should have a tag if it's not a default query."),e._path.toString())}listen(e,t,s,i){const r=e._path.toString();this.log_("Listen called for "+r+" "+e._queryIdentifier);const o=cn.getListenId_(e,s),a={};this.listens_[o]=a;const u=bi(e._queryParams);this.restRequest_(r+".json",u,(h,d)=>{let f=d;if(404===h&&(f=null,h=null),null===h&&this.onDataUpdate_(r,f,!1,s),(0,c.DV)(this.listens_,o)===a){let _;_=h?401===h?"permission_denied":"rest_error:"+h:"ok",i(_,null)}})}unlisten(e,t){const s=cn.getListenId_(e,t);delete this.listens_[s]}get(e){const t=bi(e._queryParams),s=e._path.toString(),i=new c.BH;return this.restRequest_(s+".json",t,(r,o)=>{let a=o;404===r&&(a=null,r=null),null===r?(this.onDataUpdate_(s,a,!1,null),i.resolve(a)):i.reject(new Error(a))}),i.promise}refreshAuthToken(e){}restRequest_(e,t={},s){return t.format="export",Promise.all([this.authTokenProvider_.getToken(!1),this.appCheckTokenProvider_.getToken(!1)]).then(([i,r])=>{i&&i.accessToken&&(t.auth=i.accessToken),r&&r.token&&(t.ac=r.token);const o=(this.repoInfo_.secure?"https://":"http://")+this.repoInfo_.host+e+"?ns="+this.repoInfo_.namespace+(0,c.xO)(t);this.log_("Sending REST request for "+o);const a=new XMLHttpRequest;a.onreadystatechange=()=>{if(s&&4===a.readyState){this.log_("REST Response for "+o+" received. status:",a.status,"response:",a.responseText);let u=null;if(a.status>=200&&a.status<300){try{u=(0,c.cI)(a.responseText)}catch{se("Failed to parse JSON response for "+o+": "+a.responseText)}s(null,u)}else 401!==a.status&&404!==a.status&&se("Got unsuccessful REST response for "+o+" Status: "+a.status),s(a.status);s=null}},a.open("GET",o,!0),a.send()})}}class ra{constructor(){this.rootNode_=I.EMPTY_NODE}getNode(e){return this.rootNode_.getChild(e)}updateSnapshot(e,t){this.rootNode_=this.rootNode_.updateChild(e,t)}}function un(){return{value:null,children:new Map}}function mt(n,e,t){if(b(e))n.value=t,n.children.clear();else if(null!==n.value)n.value=n.value.updateChild(e,t);else{const s=D(e);n.children.has(s)||n.children.set(s,un()),mt(n.children.get(s),e=F(e),t)}}function Xn(n,e){if(b(e))return n.value=null,n.children.clear(),!0;if(null!==n.value){if(n.value.isLeafNode())return!1;{const t=n.value;return n.value=null,t.forEachChild(W,(s,i)=>{mt(n,new k(s),i)}),Xn(n,e)}}if(n.children.size>0){const t=D(e);return e=F(e),n.children.has(t)&&Xn(n.children.get(t),e)&&n.children.delete(t),0===n.children.size}return!0}function es(n,e,t){null!==n.value?t(e,n.value):function oa(n,e){n.children.forEach((t,s)=>{e(s,t)})}(n,(s,i)=>{es(i,new k(e.toString()+"/"+s),t)})}class aa{constructor(e){this.collection_=e,this.last_=null}get(){const e=this.collection_.get(),t=Object.assign({},e);return this.last_&&z(this.last_,(s,i)=>{t[s]=t[s]-i}),this.last_=e,t}}class ua{constructor(e,t){this.server_=t,this.statsToReport_={},this.statsListener_=new aa(e);const s=1e4+2e4*Math.random();Dt(this.reportStats_.bind(this),Math.floor(s))}reportStats_(){const e=this.statsListener_.get(),t={};let s=!1;z(e,(i,r)=>{r>0&&(0,c.r3)(this.statsToReport_,i)&&(t[i]=r,s=!0)}),s&&this.server_.reportStats(t),Dt(this.reportStats_.bind(this),Math.floor(2*Math.random()*3e5))}}var Oe=function(n){return n[n.OVERWRITE=0]="OVERWRITE",n[n.MERGE=1]="MERGE",n[n.ACK_USER_WRITE=2]="ACK_USER_WRITE",n[n.LISTEN_COMPLETE=3]="LISTEN_COMPLETE",n}(Oe||{});function ss(n){return{fromUser:!1,fromServer:!0,queryId:n,tagged:!0}}class hn{constructor(e,t,s){this.path=e,this.affectedTree=t,this.revert=s,this.type=Oe.ACK_USER_WRITE,this.source={fromUser:!0,fromServer:!1,queryId:null,tagged:!1}}operationForChild(e){if(b(this.path)){if(null!=this.affectedTree.value)return(0,c.hu)(this.affectedTree.children.isEmpty(),"affectedTree should not have overlapping affected paths."),this;{const t=this.affectedTree.subtree(new k(e));return new hn(R(),t,this.revert)}}return(0,c.hu)(D(this.path)===e,"operationForChild called for unrelated child."),new hn(F(this.path),this.affectedTree,this.revert)}}class Lt{constructor(e,t){this.source=e,this.path=t,this.type=Oe.LISTEN_COMPLETE}operationForChild(e){return b(this.path)?new Lt(this.source,R()):new Lt(this.source,F(this.path))}}class ot{constructor(e,t,s){this.source=e,this.path=t,this.snap=s,this.type=Oe.OVERWRITE}operationForChild(e){return b(this.path)?new ot(this.source,R(),this.snap.getImmediateChild(e)):new ot(this.source,F(this.path),this.snap)}}class vt{constructor(e,t,s){this.source=e,this.path=t,this.children=s,this.type=Oe.MERGE}operationForChild(e){if(b(this.path)){const t=this.children.subtree(new k(e));return t.isEmpty()?null:t.value?new ot(this.source,R(),t.value):new vt(this.source,R(),t)}return(0,c.hu)(D(this.path)===e,"Can't get a merge for a child not on the path of the operation"),new vt(this.source,F(this.path),this.children)}toString(){return"Operation("+this.path+": "+this.source.toString()+" merge: "+this.children.toString()+")"}}class Ve{constructor(e,t,s){this.node_=e,this.fullyInitialized_=t,this.filtered_=s}isFullyInitialized(){return this.fullyInitialized_}isFiltered(){return this.filtered_}isCompleteForPath(e){if(b(e))return this.isFullyInitialized()&&!this.filtered_;const t=D(e);return this.isCompleteForChild(t)}isCompleteForChild(e){return this.isFullyInitialized()&&!this.filtered_||this.node_.hasChild(e)}getNode(){return this.node_}}class ha{constructor(e){this.query_=e,this.index_=this.query_._queryParams.getIndex()}}function Mt(n,e,t,s,i,r){const o=s.filter(a=>a.type===t);o.sort((a,u)=>function _a(n,e,t){if(null==e.childName||null==t.childName)throw(0,c.g5)("Should only compare child_ events.");const s=new A(e.childName,e.snapshotNode),i=new A(t.childName,t.snapshotNode);return n.index_.compare(s,i)}(n,a,u)),o.forEach(a=>{const u=function fa(n,e,t){return"value"===e.type||"child_removed"===e.type||(e.prevName=t.getPredecessorChildName(e.childName,e.snapshotNode,n.index_)),e}(n,a,r);i.forEach(h=>{h.respondsTo(a.type)&&e.push(h.createEvent(u,n.query_))})})}function dn(n,e){return{eventCache:n,serverCache:e}}function Ft(n,e,t,s){return dn(new Ve(e,t,s),n.serverCache)}function Pi(n,e,t,s){return dn(n.eventCache,new Ve(e,t,s))}function fn(n){return n.eventCache.isFullyInitialized()?n.eventCache.getNode():null}function at(n){return n.serverCache.isFullyInitialized()?n.serverCache.getNode():null}let is;class B{constructor(e,t=(()=>(is||(is=new ue(zr)),is))()){this.value=e,this.children=t}static fromObject(e){let t=new B(null);return z(e,(s,i)=>{t=t.set(new k(s),i)}),t}isEmpty(){return null===this.value&&this.children.isEmpty()}findRootMostMatchingPathAndValue(e,t){if(null!=this.value&&t(this.value))return{path:R(),value:this.value};if(b(e))return null;{const s=D(e),i=this.children.get(s);if(null!==i){const r=i.findRootMostMatchingPathAndValue(F(e),t);return null!=r?{path:K(new k(s),r.path),value:r.value}:null}return null}}findRootMostValueAndPath(e){return this.findRootMostMatchingPathAndValue(e,()=>!0)}subtree(e){if(b(e))return this;{const t=D(e),s=this.children.get(t);return null!==s?s.subtree(F(e)):new B(null)}}set(e,t){if(b(e))return new B(t,this.children);{const s=D(e),r=(this.children.get(s)||new B(null)).set(F(e),t),o=this.children.insert(s,r);return new B(this.value,o)}}remove(e){if(b(e))return this.children.isEmpty()?new B(null):new B(null,this.children);{const t=D(e),s=this.children.get(t);if(s){const i=s.remove(F(e));let r;return r=i.isEmpty()?this.children.remove(t):this.children.insert(t,i),null===this.value&&r.isEmpty()?new B(null):new B(this.value,r)}return this}}get(e){if(b(e))return this.value;{const t=D(e),s=this.children.get(t);return s?s.get(F(e)):null}}setTree(e,t){if(b(e))return t;{const s=D(e),r=(this.children.get(s)||new B(null)).setTree(F(e),t);let o;return o=r.isEmpty()?this.children.remove(s):this.children.insert(s,r),new B(this.value,o)}}fold(e){return this.fold_(R(),e)}fold_(e,t){const s={};return this.children.inorderTraversal((i,r)=>{s[i]=r.fold_(K(e,i),t)}),t(e,this.value,s)}findOnPath(e,t){return this.findOnPath_(e,R(),t)}findOnPath_(e,t,s){const i=!!this.value&&s(t,this.value);if(i)return i;if(b(e))return null;{const r=D(e),o=this.children.get(r);return o?o.findOnPath_(F(e),K(t,r),s):null}}foreachOnPath(e,t){return this.foreachOnPath_(e,R(),t)}foreachOnPath_(e,t,s){if(b(e))return this;{this.value&&s(t,this.value);const i=D(e),r=this.children.get(i);return r?r.foreachOnPath_(F(e),K(t,i),s):new B(null)}}foreach(e){this.foreach_(R(),e)}foreach_(e,t){this.children.inorderTraversal((s,i)=>{i.foreach_(K(e,s),t)}),this.value&&t(e,this.value)}foreachChild(e){this.children.inorderTraversal((t,s)=>{s.value&&e(t,s.value)})}}class Te{constructor(e){this.writeTree_=e}static empty(){return new Te(new B(null))}}function Ut(n,e,t){if(b(e))return new Te(new B(t));{const s=n.writeTree_.findRootMostValueAndPath(e);if(null!=s){const i=s.path;let r=s.value;const o=ae(i,e);return r=r.updateChild(o,t),new Te(n.writeTree_.set(i,r))}{const i=new B(t),r=n.writeTree_.setTree(e,i);return new Te(r)}}}function rs(n,e,t){let s=n;return z(t,(i,r)=>{s=Ut(s,K(e,i),r)}),s}function Ni(n,e){if(b(e))return Te.empty();{const t=n.writeTree_.setTree(e,new B(null));return new Te(t)}}function os(n,e){return null!=lt(n,e)}function lt(n,e){const t=n.writeTree_.findRootMostValueAndPath(e);return null!=t?n.writeTree_.get(t.path).getChild(ae(t.path,e)):null}function Ri(n){const e=[],t=n.writeTree_.value;return null!=t?t.isLeafNode()||t.forEachChild(W,(s,i)=>{e.push(new A(s,i))}):n.writeTree_.children.inorderTraversal((s,i)=>{null!=i.value&&e.push(new A(s,i.value))}),e}function He(n,e){if(b(e))return n;{const t=lt(n,e);return new Te(null!=t?new B(t):n.writeTree_.subtree(e))}}function as(n){return n.writeTree_.isEmpty()}function yt(n,e){return Oi(R(),n.writeTree_,e)}function Oi(n,e,t){if(null!=e.value)return t.updateChild(n,e.value);{let s=null;return e.children.inorderTraversal((i,r)=>{".priority"===i?((0,c.hu)(null!==r.value,"Priority writes must always be leaf nodes"),s=r.value):t=Oi(K(n,i),r,t)}),!t.getChild(n).isEmpty()&&null!==s&&(t=t.updateChild(K(n,".priority"),s)),t}}function _n(n,e){return Ui(e,n)}function Ca(n,e){if(n.snap)return me(n.path,e);for(const t in n.children)if(n.children.hasOwnProperty(t)&&me(K(n.path,t),e))return!0;return!1}function wa(n){return n.visible}function ki(n,e,t){let s=Te.empty();for(let i=0;i<n.length;++i){const r=n[i];if(e(r)){const o=r.path;let a;if(r.snap)me(t,o)?(a=ae(t,o),s=Ut(s,a,r.snap)):me(o,t)&&(a=ae(o,t),s=Ut(s,R(),r.snap.getChild(a)));else{if(!r.children)throw(0,c.g5)("WriteRecord should have .snap or .children");if(me(t,o))a=ae(t,o),s=rs(s,a,r.children);else if(me(o,t))if(a=ae(o,t),b(a))s=rs(s,R(),r.children);else{const u=(0,c.DV)(r.children,D(a));if(u){const h=u.getChild(F(a));s=Ut(s,R(),h)}}}}}return s}function Li(n,e,t,s,i){if(s||i){const r=He(n.visibleWrites,e);return!i&&as(r)?t:i||null!=t||os(r,R())?yt(ki(n.allWrites,function(h){return(h.visible||i)&&(!s||!~s.indexOf(h.writeId))&&(me(h.path,e)||me(e,h.path))},e),t||I.EMPTY_NODE):null}{const r=lt(n.visibleWrites,e);if(null!=r)return r;{const o=He(n.visibleWrites,e);return as(o)?t:null!=t||os(o,R())?yt(o,t||I.EMPTY_NODE):null}}}function pn(n,e,t,s){return Li(n.writeTree,n.treePath,e,t,s)}function ls(n,e){return function Ta(n,e,t){let s=I.EMPTY_NODE;const i=lt(n.visibleWrites,e);if(i)return i.isLeafNode()||i.forEachChild(W,(r,o)=>{s=s.updateImmediateChild(r,o)}),s;if(t){const r=He(n.visibleWrites,e);return t.forEachChild(W,(o,a)=>{const u=yt(He(r,new k(o)),a);s=s.updateImmediateChild(o,u)}),Ri(r).forEach(o=>{s=s.updateImmediateChild(o.name,o.node)}),s}return Ri(He(n.visibleWrites,e)).forEach(o=>{s=s.updateImmediateChild(o.name,o.node)}),s}(n.writeTree,n.treePath,e)}function Mi(n,e,t,s){return function Ia(n,e,t,s,i){(0,c.hu)(s||i,"Either existingEventSnap or existingServerSnap must exist");const r=K(e,t);if(os(n.visibleWrites,r))return null;{const o=He(n.visibleWrites,r);return as(o)?i.getChild(t):yt(o,i.getChild(t))}}(n.writeTree,n.treePath,e,t,s)}function gn(n,e){return function Da(n,e){return lt(n.visibleWrites,e)}(n.writeTree,K(n.treePath,e))}function cs(n,e,t){return function Sa(n,e,t,s){const i=K(e,t),r=lt(n.visibleWrites,i);return null!=r?r:s.isCompleteForChild(t)?yt(He(n.visibleWrites,i),s.getNode().getImmediateChild(t)):null}(n.writeTree,n.treePath,e,t)}function Fi(n,e){return Ui(K(n.treePath,e),n.writeTree)}function Ui(n,e){return{treePath:n,writeTree:e}}class Pa{constructor(){this.changeMap=new Map}trackChildChange(e){const t=e.type,s=e.childName;(0,c.hu)("child_added"===t||"child_changed"===t||"child_removed"===t,"Only child changes supported for tracking"),(0,c.hu)(".priority"!==s,"Only non-priority child changes can be tracked.");const i=this.changeMap.get(s);if(i){const r=i.type;if("child_added"===t&&"child_removed"===r)this.changeMap.set(s,Ot(s,e.snapshotNode,i.snapshotNode));else if("child_removed"===t&&"child_added"===r)this.changeMap.delete(s);else if("child_removed"===t&&"child_changed"===r)this.changeMap.set(s,Rt(s,i.oldSnap));else if("child_changed"===t&&"child_added"===r)this.changeMap.set(s,gt(s,e.snapshotNode));else{if("child_changed"!==t||"child_changed"!==r)throw(0,c.g5)("Illegal combination of changes: "+e+" occurred after "+i);this.changeMap.set(s,Ot(s,e.snapshotNode,i.oldSnap))}}else this.changeMap.set(s,e)}getChanges(){return Array.from(this.changeMap.values())}}const Wi=new class Na{getCompleteChild(e){return null}getChildAfterChild(e,t,s){return null}};class us{constructor(e,t,s=null){this.writes_=e,this.viewCache_=t,this.optCompleteServerCache_=s}getCompleteChild(e){const t=this.viewCache_.eventCache;if(t.isCompleteForChild(e))return t.getNode().getImmediateChild(e);{const s=null!=this.optCompleteServerCache_?new Ve(this.optCompleteServerCache_,!0,!1):this.viewCache_.serverCache;return cs(this.writes_,e,s)}}getChildAfterChild(e,t,s){const i=null!=this.optCompleteServerCache_?this.optCompleteServerCache_:at(this.viewCache_),r=function xa(n,e,t,s,i,r){return function ba(n,e,t,s,i,r,o){let a;const u=He(n.visibleWrites,e),h=lt(u,R());if(null!=h)a=h;else{if(null==t)return[];a=yt(u,t)}if(a=a.withIndex(o),a.isEmpty()||a.isLeafNode())return[];{const d=[],f=o.getCompare(),_=r?a.getReverseIteratorFrom(s,o):a.getIteratorFrom(s,o);let v=_.getNext();for(;v&&d.length<i;)0!==f(v,s)&&d.push(v),v=_.getNext();return d}}(n.writeTree,n.treePath,e,t,s,i,r)}(this.writes_,i,t,1,s,e);return 0===r.length?null:r[0]}}function Bi(n,e,t,s,i,r){const o=e.eventCache;if(null!=gn(s,t))return e;{let a,u;if(b(t))if((0,c.hu)(e.serverCache.isFullyInitialized(),"If change path is empty, we must have complete server data"),e.serverCache.isFiltered()){const h=at(e),f=ls(s,h instanceof I?h:I.EMPTY_NODE);a=n.filter.updateFullNode(e.eventCache.getNode(),f,r)}else{const h=pn(s,at(e));a=n.filter.updateFullNode(e.eventCache.getNode(),h,r)}else{const h=D(t);if(".priority"===h){(0,c.hu)(1===Ge(t),"Can't have a priority with additional path components");const d=o.getNode();u=e.serverCache.getNode();const f=Mi(s,t,d,u);a=null!=f?n.filter.updatePriority(d,f):o.getNode()}else{const d=F(t);let f;if(o.isCompleteForChild(h)){u=e.serverCache.getNode();const _=Mi(s,t,o.getNode(),u);f=null!=_?o.getNode().getImmediateChild(h).updateChild(d,_):o.getNode().getImmediateChild(h)}else f=cs(s,h,e.serverCache);a=null!=f?n.filter.updateChild(o.getNode(),h,f,d,i,r):o.getNode()}}return Ft(e,a,o.isFullyInitialized()||b(t),n.filter.filtersNodes())}}function mn(n,e,t,s,i,r,o,a){const u=e.serverCache;let h;const d=o?n.filter:n.filter.getIndexedFilter();if(b(t))h=d.updateFullNode(u.getNode(),s,null);else if(d.filtersNodes()&&!u.isFiltered()){const v=u.getNode().updateChild(t,s);h=d.updateFullNode(u.getNode(),v,null)}else{const v=D(t);if(!u.isCompleteForPath(t)&&Ge(t)>1)return e;const C=F(t),q=u.getNode().getImmediateChild(v).updateChild(C,s);h=".priority"===v?d.updatePriority(u.getNode(),q):d.updateChild(u.getNode(),v,q,C,Wi,null)}const f=Pi(e,h,u.isFullyInitialized()||b(t),d.filtersNodes());return Bi(n,f,t,i,new us(i,f,r),a)}function hs(n,e,t,s,i,r,o){const a=e.eventCache;let u,h;const d=new us(i,e,r);if(b(t))h=n.filter.updateFullNode(e.eventCache.getNode(),s,o),u=Ft(e,h,!0,n.filter.filtersNodes());else{const f=D(t);if(".priority"===f)h=n.filter.updatePriority(e.eventCache.getNode(),s),u=Ft(e,h,a.isFullyInitialized(),a.isFiltered());else{const _=F(t),v=a.getNode().getImmediateChild(f);let C;if(b(_))C=s;else{const N=d.getCompleteChild(f);C=null!=N?".priority"===Zn(_)&&N.getChild(gi(_)).isEmpty()?N:N.updateChild(_,s):I.EMPTY_NODE}u=v.equals(C)?e:Ft(e,n.filter.updateChild(a.getNode(),f,C,_,d,o),a.isFullyInitialized(),n.filter.filtersNodes())}}return u}function Qi(n,e){return n.eventCache.isCompleteForChild(e)}function Zi(n,e,t){return t.foreach((s,i)=>{e=e.updateChild(s,i)}),e}function ds(n,e,t,s,i,r,o,a){if(e.serverCache.getNode().isEmpty()&&!e.serverCache.isFullyInitialized())return e;let h,u=e;h=b(t)?s:new B(null).setTree(t,s);const d=e.serverCache.getNode();return h.children.inorderTraversal((f,_)=>{if(d.hasChild(f)){const C=Zi(0,e.serverCache.getNode().getImmediateChild(f),_);u=mn(n,u,new k(f),C,i,r,o,a)}}),h.children.inorderTraversal((f,_)=>{const v=!e.serverCache.isCompleteForChild(f)&&null===_.value;if(!d.hasChild(f)&&!v){const N=Zi(0,e.serverCache.getNode().getImmediateChild(f),_);u=mn(n,u,new k(f),N,i,r,o,a)}}),u}class Ba{constructor(e,t){this.query_=e,this.eventRegistrations_=[];const s=this.query_._queryParams,i=new $n(s.getIndex()),r=function ea(n){return n.loadsAllData()?new $n(n.getIndex()):n.hasLimit()?new Xo(n):new kt(n)}(s);this.processor_=function Ra(n){return{filter:n}}(r);const o=t.serverCache,a=t.eventCache,u=i.updateFullNode(I.EMPTY_NODE,o.getNode(),null),h=r.updateFullNode(I.EMPTY_NODE,a.getNode(),null),d=new Ve(u,o.isFullyInitialized(),i.filtersNodes()),f=new Ve(h,a.isFullyInitialized(),r.filtersNodes());this.viewCache_=dn(f,d),this.eventGenerator_=new ha(this.query_)}get query(){return this.query_}}function Ka(n,e){const t=at(n.viewCache_);return t&&(n.query._queryParams.loadsAllData()||!b(e)&&!t.getImmediateChild(D(e)).isEmpty())?t.getChild(e):null}function Ki(n){return 0===n.eventRegistrations_.length}function ji(n,e,t){const s=[];if(t){(0,c.hu)(null==e,"A cancel should cancel all event registrations.");const i=n.query._path;n.eventRegistrations_.forEach(r=>{const o=r.createCancelEvent(t,i);o&&s.push(o)})}if(e){let i=[];for(let r=0;r<n.eventRegistrations_.length;++r){const o=n.eventRegistrations_[r];if(o.matches(e)){if(e.hasAnyCallback()){i=i.concat(n.eventRegistrations_.slice(r+1));break}}else i.push(o)}n.eventRegistrations_=i}else n.eventRegistrations_=[];return s}function Yi(n,e,t,s){e.type===Oe.MERGE&&null!==e.source.queryId&&((0,c.hu)(at(n.viewCache_),"We should always have a full cache before handling merges"),(0,c.hu)(fn(n.viewCache_),"Missing event cache, even though we have a server cache"));const i=n.viewCache_,r=function ka(n,e,t,s,i){const r=new Pa;let o,a;if(t.type===Oe.OVERWRITE){const h=t;h.source.fromUser?o=hs(n,e,h.path,h.snap,s,i,r):((0,c.hu)(h.source.fromServer,"Unknown source."),a=h.source.tagged||e.serverCache.isFiltered()&&!b(h.path),o=mn(n,e,h.path,h.snap,s,i,a,r))}else if(t.type===Oe.MERGE){const h=t;h.source.fromUser?o=function Ma(n,e,t,s,i,r,o){let a=e;return s.foreach((u,h)=>{const d=K(t,u);Qi(e,D(d))&&(a=hs(n,a,d,h,i,r,o))}),s.foreach((u,h)=>{const d=K(t,u);Qi(e,D(d))||(a=hs(n,a,d,h,i,r,o))}),a}(n,e,h.path,h.children,s,i,r):((0,c.hu)(h.source.fromServer,"Unknown source."),a=h.source.tagged||e.serverCache.isFiltered(),o=ds(n,e,h.path,h.children,s,i,a,r))}else if(t.type===Oe.ACK_USER_WRITE){const h=t;o=h.revert?function Wa(n,e,t,s,i,r){let o;if(null!=gn(s,t))return e;{const a=new us(s,e,i),u=e.eventCache.getNode();let h;if(b(t)||".priority"===D(t)){let d;if(e.serverCache.isFullyInitialized())d=pn(s,at(e));else{const f=e.serverCache.getNode();(0,c.hu)(f instanceof I,"serverChildren would be complete if leaf node"),d=ls(s,f)}h=n.filter.updateFullNode(u,d,r)}else{const d=D(t);let f=cs(s,d,e.serverCache);null==f&&e.serverCache.isCompleteForChild(d)&&(f=u.getImmediateChild(d)),h=null!=f?n.filter.updateChild(u,d,f,F(t),a,r):e.eventCache.getNode().hasChild(d)?n.filter.updateChild(u,d,I.EMPTY_NODE,F(t),a,r):u,h.isEmpty()&&e.serverCache.isFullyInitialized()&&(o=pn(s,at(e)),o.isLeafNode()&&(h=n.filter.updateFullNode(h,o,r)))}return o=e.serverCache.isFullyInitialized()||null!=gn(s,R()),Ft(e,h,o,n.filter.filtersNodes())}}(n,e,h.path,s,i,r):function Fa(n,e,t,s,i,r,o){if(null!=gn(i,t))return e;const a=e.serverCache.isFiltered(),u=e.serverCache;if(null!=s.value){if(b(t)&&u.isFullyInitialized()||u.isCompleteForPath(t))return mn(n,e,t,u.getNode().getChild(t),i,r,a,o);if(b(t)){let h=new B(null);return u.getNode().forEachChild(Re,(d,f)=>{h=h.set(new k(d),f)}),ds(n,e,t,h,i,r,a,o)}return e}{let h=new B(null);return s.foreach((d,f)=>{const _=K(t,d);u.isCompleteForPath(_)&&(h=h.set(d,u.getNode().getChild(_)))}),ds(n,e,t,h,i,r,a,o)}}(n,e,h.path,h.affectedTree,s,i,r)}else{if(t.type!==Oe.LISTEN_COMPLETE)throw(0,c.g5)("Unknown operation type: "+t.type);o=function Ua(n,e,t,s,i){const r=e.serverCache;return Bi(n,Pi(e,r.getNode(),r.isFullyInitialized()||b(t),r.isFiltered()),t,s,Wi,i)}(n,e,t.path,s,r)}const u=r.getChanges();return function La(n,e,t){const s=e.eventCache;if(s.isFullyInitialized()){const i=s.getNode().isLeafNode()||s.getNode().isEmpty(),r=fn(n);(t.length>0||!n.eventCache.isFullyInitialized()||i&&!s.getNode().equals(r)||!s.getNode().getPriority().equals(r.getPriority()))&&t.push(Di(fn(e)))}}(e,o,u),{viewCache:o,changes:u}}(n.processor_,i,e,t,s);return function Oa(n,e){(0,c.hu)(e.eventCache.getNode().isIndexed(n.filter.getIndex()),"Event snap not indexed"),(0,c.hu)(e.serverCache.getNode().isIndexed(n.filter.getIndex()),"Server snap not indexed")}(n.processor_,r.viewCache),(0,c.hu)(r.viewCache.serverCache.isFullyInitialized()||!i.serverCache.isFullyInitialized(),"Once a server snap is complete, it should never go back"),n.viewCache_=r.viewCache,Gi(n,r.changes,r.viewCache.eventCache.getNode(),null)}function Gi(n,e,t,s){return function da(n,e,t,s){const i=[],r=[];return e.forEach(o=>{"child_changed"===o.type&&n.index_.indexedValueChanged(o.oldSnap,o.snapshotNode)&&r.push(function qo(n,e){return{type:"child_moved",snapshotNode:e,childName:n}}(o.childName,o.snapshotNode))}),Mt(n,i,"child_removed",e,s,t),Mt(n,i,"child_added",e,s,t),Mt(n,i,"child_moved",r,s,t),Mt(n,i,"child_changed",e,s,t),Mt(n,i,"value",e,s,t),i}(n.eventGenerator_,e,t,s?[s]:n.eventRegistrations_)}let vn,Cn;class Vi{constructor(){this.views=new Map}}function fs(n,e,t,s){const i=e.source.queryId;if(null!==i){const r=n.views.get(i);return(0,c.hu)(null!=r,"SyncTree gave us an op for an invalid query."),Yi(r,e,t,s)}{let r=[];for(const o of n.views.values())r=r.concat(Yi(o,e,t,s));return r}}function Hi(n,e,t,s,i){const o=n.views.get(e._queryIdentifier);if(!o){let a=pn(t,i?s:null),u=!1;a?u=!0:s instanceof I?(a=ls(t,s),u=!1):(a=I.EMPTY_NODE,u=!1);const h=dn(new Ve(a,u,!1),new Ve(s,i,!1));return new Ba(e,h)}return o}function Ji(n){const e=[];for(const t of n.views.values())t.query._queryParams.loadsAllData()||e.push(t);return e}function Je(n,e){let t=null;for(const s of n.views.values())t=t||Ka(s,e);return t}function $i(n,e){return e._queryParams.loadsAllData()?yn(n):n.views.get(e._queryIdentifier)}function zi(n,e){return null!=$i(n,e)}function $e(n){return null!=yn(n)}function yn(n){for(const e of n.views.values())if(e.query._queryParams.loadsAllData())return e;return null}let Xa=1;class qi{constructor(e){this.listenProvider_=e,this.syncPointTree_=new B(null),this.pendingWriteTree_=function Aa(){return{visibleWrites:Te.empty(),allWrites:[],lastWriteId:-1}}(),this.tagToQueryMap=new Map,this.queryToTagMap=new Map}}function _s(n,e,t,s,i){return function ga(n,e,t,s,i){(0,c.hu)(s>n.lastWriteId,"Stacking an older write on top of newer ones"),void 0===i&&(i=!0),n.allWrites.push({path:e,snap:t,writeId:s,visible:i}),i&&(n.visibleWrites=Ut(n.visibleWrites,e,t)),n.lastWriteId=s}(n.pendingWriteTree_,e,t,s,i),i?Ct(n,new ot({fromUser:!0,fromServer:!1,queryId:null,tagged:!1},e,t)):[]}function ze(n,e,t=!1){const s=function va(n,e){for(let t=0;t<n.allWrites.length;t++){const s=n.allWrites[t];if(s.writeId===e)return s}return null}(n.pendingWriteTree_,e);if(function ya(n,e){const t=n.allWrites.findIndex(a=>a.writeId===e);(0,c.hu)(t>=0,"removeWrite called with nonexistent writeId.");const s=n.allWrites[t];n.allWrites.splice(t,1);let i=s.visible,r=!1,o=n.allWrites.length-1;for(;i&&o>=0;){const a=n.allWrites[o];a.visible&&(o>=t&&Ca(a,s.path)?i=!1:me(s.path,a.path)&&(r=!0)),o--}return!!i&&(r?(function Ea(n){n.visibleWrites=ki(n.allWrites,wa,R()),n.lastWriteId=n.allWrites.length>0?n.allWrites[n.allWrites.length-1].writeId:-1}(n),!0):(s.snap?n.visibleWrites=Ni(n.visibleWrites,s.path):z(s.children,u=>{n.visibleWrites=Ni(n.visibleWrites,K(s.path,u))}),!0))}(n.pendingWriteTree_,e)){let r=new B(null);return null!=s.snap?r=r.set(R(),!0):z(s.children,o=>{r=r.set(new k(o),!0)}),Ct(n,new hn(s.path,r,t))}return[]}function Wt(n,e,t){return Ct(n,new ot({fromUser:!1,fromServer:!0,queryId:null,tagged:!1},e,t))}function En(n,e,t,s,i=!1){const r=e._path,o=n.syncPointTree_.get(r);let a=[];if(o&&("default"===e._queryIdentifier||zi(o,e))){const u=function $a(n,e,t,s){const i=e._queryIdentifier,r=[];let o=[];const a=$e(n);if("default"===i)for(const[u,h]of n.views.entries())o=o.concat(ji(h,t,s)),Ki(h)&&(n.views.delete(u),h.query._queryParams.loadsAllData()||r.push(h.query));else{const u=n.views.get(i);u&&(o=o.concat(ji(u,t,s)),Ki(u)&&(n.views.delete(i),u.query._queryParams.loadsAllData()||r.push(u.query)))}return a&&!$e(n)&&r.push(new(function Va(){return(0,c.hu)(vn,"Reference.ts has not been loaded"),vn}())(e._repo,e._path)),{removed:r,events:o}}(o,e,t,s);(function Ha(n){return 0===n.views.size})(o)&&(n.syncPointTree_=n.syncPointTree_.remove(r));const h=u.removed;if(a=u.events,!i){const d=-1!==h.findIndex(_=>_._queryParams.loadsAllData()),f=n.syncPointTree_.findOnPath(r,(_,v)=>$e(v));if(d&&!f){const _=n.syncPointTree_.subtree(r);if(!_.isEmpty()){const v=function ol(n){return n.fold((e,t,s)=>{if(t&&$e(t))return[yn(t)];{let i=[];return t&&(i=Ji(t)),z(s,(r,o)=>{i=i.concat(o)}),i}})}(_);for(let C=0;C<v.length;++C){const N=v[C],q=N.query,Le=nr(n,N);n.listenProvider_.startListening(Qt(q),Bt(n,q),Le.hashFn,Le.onComplete)}}}!f&&h.length>0&&!s&&(d?n.listenProvider_.stopListening(Qt(e),null):h.forEach(_=>{const v=n.queryToTagMap.get(Tn(_));n.listenProvider_.stopListening(Qt(_),v)}))}!function al(n,e){for(let t=0;t<e.length;++t){const s=e[t];if(!s._queryParams.loadsAllData()){const i=Tn(s),r=n.queryToTagMap.get(i);n.queryToTagMap.delete(i),n.tagToQueryMap.delete(r)}}}(n,h)}return a}function Xi(n,e,t,s){const i=gs(n,s);if(null!=i){const r=ms(i),o=r.path,a=r.queryId,u=ae(o,e);return vs(n,o,new ot(ss(a),u,t))}return[]}function ps(n,e,t,s=!1){const i=e._path;let r=null,o=!1;n.syncPointTree_.foreachOnPath(i,(_,v)=>{const C=ae(_,i);r=r||Je(v,C),o=o||$e(v)});let u,a=n.syncPointTree_.get(i);a?(o=o||$e(a),r=r||Je(a,R())):(a=new Vi,n.syncPointTree_=n.syncPointTree_.set(i,a)),null!=r?u=!0:(u=!1,r=I.EMPTY_NODE,n.syncPointTree_.subtree(i).foreachChild((v,C)=>{const N=Je(C,R());N&&(r=r.updateImmediateChild(v,N))}));const h=zi(a,e);if(!h&&!e._queryParams.loadsAllData()){const _=Tn(e);(0,c.hu)(!n.queryToTagMap.has(_),"View does not exist, but we have a tag");const v=function ll(){return Xa++}();n.queryToTagMap.set(_,v),n.tagToQueryMap.set(v,_)}let f=function Ja(n,e,t,s,i,r){const o=Hi(n,e,s,i,r);return n.views.has(e._queryIdentifier)||n.views.set(e._queryIdentifier,o),function ja(n,e){n.eventRegistrations_.push(e)}(o,t),function Ya(n,e){const t=n.viewCache_.eventCache,s=[];return t.getNode().isLeafNode()||t.getNode().forEachChild(W,(r,o)=>{s.push(gt(r,o))}),t.isFullyInitialized()&&s.push(Di(t.getNode())),Gi(n,s,t.getNode(),e)}(o,t)}(a,e,t,_n(n.pendingWriteTree_,i),r,u);if(!h&&!o&&!s){const _=$i(a,e);f=f.concat(function cl(n,e,t){const s=e._path,i=Bt(n,e),r=nr(n,t),o=n.listenProvider_.startListening(Qt(e),i,r.hashFn,r.onComplete),a=n.syncPointTree_.subtree(s);if(i)(0,c.hu)(!$e(a.value),"If we're adding a query, it shouldn't be shadowed");else{const u=a.fold((h,d,f)=>{if(!b(h)&&d&&$e(d))return[yn(d).query];{let _=[];return d&&(_=_.concat(Ji(d).map(v=>v.query))),z(f,(v,C)=>{_=_.concat(C)}),_}});for(let h=0;h<u.length;++h){const d=u[h];n.listenProvider_.stopListening(Qt(d),Bt(n,d))}}return o}(n,e,_))}return f}function wn(n,e,t){const i=n.pendingWriteTree_,r=n.syncPointTree_.findOnPath(e,(o,a)=>{const h=Je(a,ae(o,e));if(h)return h});return Li(i,e,r,t,!0)}function Ct(n,e){return er(e,n.syncPointTree_,null,_n(n.pendingWriteTree_,R()))}function er(n,e,t,s){if(b(n.path))return tr(n,e,t,s);{const i=e.get(R());null==t&&null!=i&&(t=Je(i,R()));let r=[];const o=D(n.path),a=n.operationForChild(o),u=e.children.get(o);if(u&&a){const h=t?t.getImmediateChild(o):null,d=Fi(s,o);r=r.concat(er(a,u,h,d))}return i&&(r=r.concat(fs(i,n,s,t))),r}}function tr(n,e,t,s){const i=e.get(R());null==t&&null!=i&&(t=Je(i,R()));let r=[];return e.children.inorderTraversal((o,a)=>{const u=t?t.getImmediateChild(o):null,h=Fi(s,o),d=n.operationForChild(o);d&&(r=r.concat(tr(d,a,u,h)))}),i&&(r=r.concat(fs(i,n,s,t))),r}function nr(n,e){const t=e.query,s=Bt(n,t);return{hashFn:()=>(function Qa(n){return n.viewCache_.serverCache.getNode()}(e)||I.EMPTY_NODE).hash(),onComplete:i=>{if("ok"===i)return s?function sl(n,e,t){const s=gs(n,t);if(s){const i=ms(s),r=i.path,o=i.queryId,a=ae(r,e);return vs(n,r,new Lt(ss(o),a))}return[]}(n,t._path,s):function nl(n,e){return Ct(n,new Lt({fromUser:!1,fromServer:!0,queryId:null,tagged:!1},e))}(n,t._path);{const r=function eo(n,e){let t="Unknown Error";"too_big"===n?t="The data requested exceeds the maximum size that can be accessed with a single request.":"permission_denied"===n?t="Client doesn't have permission to access the desired data.":"unavailable"===n&&(t="The service is unavailable");const s=new Error(n+" at "+e._path.toString()+": "+t);return s.code=n.toUpperCase(),s}(i,t);return En(n,t,null,r)}}}}function Bt(n,e){const t=Tn(e);return n.queryToTagMap.get(t)}function Tn(n){return n._path.toString()+"$"+n._queryIdentifier}function gs(n,e){return n.tagToQueryMap.get(e)}function ms(n){const e=n.indexOf("$");return(0,c.hu)(-1!==e&&e<n.length-1,"Bad queryKey."),{queryId:n.substr(e+1),path:new k(n.substr(0,e))}}function vs(n,e,t){const s=n.syncPointTree_.get(e);return(0,c.hu)(s,"Missing sync point for query tag that we're tracking"),fs(s,t,_n(n.pendingWriteTree_,e),null)}function Qt(n){return n._queryParams.loadsAllData()&&!n._queryParams.isDefault()?new(function qa(){return(0,c.hu)(Cn,"Reference.ts has not been loaded"),Cn}())(n._repo,n._path):n}class ys{constructor(e){this.node_=e}getImmediateChild(e){const t=this.node_.getImmediateChild(e);return new ys(t)}node(){return this.node_}}class Cs{constructor(e,t){this.syncTree_=e,this.path_=t}getImmediateChild(e){const t=K(this.path_,e);return new Cs(this.syncTree_,t)}node(){return wn(this.syncTree_,this.path_)}}const ul=function(n){return(n=n||{}).timestamp=n.timestamp||(new Date).getTime(),n},sr=function(n,e,t){return n&&"object"==typeof n?((0,c.hu)(".sv"in n,"Unexpected leaf node or priority contents"),"string"==typeof n[".sv"]?hl(n[".sv"],e,t):"object"==typeof n[".sv"]?dl(n[".sv"],e):void(0,c.hu)(!1,"Unexpected server value: "+JSON.stringify(n,null,2))):n},hl=function(n,e,t){if("timestamp"===n)return t.timestamp;(0,c.hu)(!1,"Unexpected server value: "+n)},dl=function(n,e,t){n.hasOwnProperty("increment")||(0,c.hu)(!1,"Unexpected server value: "+JSON.stringify(n,null,2));const s=n.increment;"number"!=typeof s&&(0,c.hu)(!1,"Unexpected increment value: "+s);const i=e.node();if((0,c.hu)(null!==i&&typeof i<"u","Expected ChildrenNode.EMPTY_NODE for nulls"),!i.isLeafNode())return s;const o=i.getValue();return"number"!=typeof o?s:o+s},ir=function(n,e,t,s){return ws(e,new Cs(t,n),s)},Es=function(n,e,t){return ws(n,new ys(e),t)};function ws(n,e,t){const s=n.getPriority().val(),i=sr(s,e.getImmediateChild(".priority"),t);let r;if(n.isLeafNode()){const o=n,a=sr(o.getValue(),e,t);return a!==o.getValue()||i!==o.getPriority().val()?new _t(a,Y(i)):n}{const o=n;return r=o,i!==o.getPriority().val()&&(r=r.updatePriority(new _t(i))),o.forEachChild(W,(a,u)=>{const h=ws(u,e.getImmediateChild(a),t);h!==u&&(r=r.updateImmediateChild(a,h))}),r}}class Ts{constructor(e="",t=null,s={children:{},childCount:0}){this.name=e,this.parent=t,this.node=s}}function In(n,e){let t=e instanceof k?e:new k(e),s=n,i=D(t);for(;null!==i;){const r=(0,c.DV)(s.node.children,i)||{children:{},childCount:0};s=new Ts(i,s,r),t=F(t),i=D(t)}return s}function ct(n){return n.node.value}function Is(n,e){n.node.value=e,Ss(n)}function rr(n){return n.node.childCount>0}function Sn(n,e){z(n.node.children,(t,s)=>{e(new Ts(t,n,s))})}function or(n,e,t,s){t&&!s&&e(n),Sn(n,i=>{or(i,e,!0,s)}),t&&s&&e(n)}function Zt(n){return new k(null===n.parent?n.name:Zt(n.parent)+"/"+n.name)}function Ss(n){null!==n.parent&&function pl(n,e,t){const s=function fl(n){return void 0===ct(n)&&!rr(n)}(t),i=(0,c.r3)(n.node.children,e);s&&i?(delete n.node.children[e],n.node.childCount--,Ss(n)):!s&&!i&&(n.node.children[e]=t.node,n.node.childCount++,Ss(n))}(n.parent,n.name,n)}const gl=/[\[\].#$\/\u0000-\u001F\u007F]/,ml=/[\[\].#$\u0000-\u001F\u007F]/,Ds=10485760,Dn=function(n){return"string"==typeof n&&0!==n.length&&!gl.test(n)},ar=function(n){return"string"==typeof n&&0!==n.length&&!ml.test(n)},Kt=function(n){return null===n||"string"==typeof n||"number"==typeof n&&!qt(n)||n&&"object"==typeof n&&(0,c.r3)(n,".sv")},ke=function(n,e,t,s){s&&void 0===e||jt((0,c.gK)(n,"value"),e,t)},jt=function(n,e,t){const s=t instanceof k?new ko(t,n):t;if(void 0===e)throw new Error(n+"contains undefined "+it(s));if("function"==typeof e)throw new Error(n+"contains a function "+it(s)+" with contents = "+e.toString());if(qt(e))throw new Error(n+"contains "+e.toString()+" "+it(s));if("string"==typeof e&&e.length>Ds/3&&(0,c.ug)(e)>Ds)throw new Error(n+"contains a string greater than "+Ds+" utf8 bytes "+it(s)+" ('"+e.substring(0,50)+"...')");if(e&&"object"==typeof e){let i=!1,r=!1;if(z(e,(o,a)=>{if(".value"===o)i=!0;else if(".priority"!==o&&".sv"!==o&&(r=!0,!Dn(o)))throw new Error(n+" contains an invalid key ("+o+") "+it(s)+'.  Keys must be non-empty strings and can\'t contain ".", "#", "$", "/", "[", or "]"');(function Lo(n,e){n.parts_.length>0&&(n.byteLength_+=1),n.parts_.push(e),n.byteLength_+=(0,c.ug)(e),mi(n)})(s,o),jt(n,a,s),function Mo(n){const e=n.parts_.pop();n.byteLength_-=(0,c.ug)(e),n.parts_.length>0&&(n.byteLength_-=1)}(s)}),i&&r)throw new Error(n+' contains ".value" child '+it(s)+" in addition to actual children.")}},lr=function(n,e,t,s){if(s&&void 0===e)return;const i=(0,c.gK)(n,"values");if(!e||"object"!=typeof e||Array.isArray(e))throw new Error(i+" must be an object containing the children to replace.");const r=[];z(e,(o,a)=>{const u=new k(o);if(jt(i,a,K(t,u)),".priority"===Zn(u)&&!Kt(a))throw new Error(i+"contains an invalid value for '"+u.toString()+"', which must be a valid Firebase priority (a string, finite number, server value, or null).");r.push(u)}),function(n,e){let t,s;for(t=0;t<e.length;t++){s=e[t];const r=At(s);for(let o=0;o<r.length;o++)if((".priority"!==r[o]||o!==r.length-1)&&!Dn(r[o]))throw new Error(n+"contains an invalid key ("+r[o]+") in path "+s.toString()+'. Keys must be non-empty strings and can\'t contain ".", "#", "$", "/", "[", or "]"')}e.sort(Oo);let i=null;for(t=0;t<e.length;t++){if(s=e[t],null!==i&&me(i,s))throw new Error(n+"contains a path "+i.toString()+" that is ancestor of another path "+s.toString());i=s}}(i,r)},bs=function(n,e,t){if(!t||void 0!==e){if(qt(e))throw new Error((0,c.gK)(n,"priority")+"is "+e.toString()+", but must be a valid Firebase priority (a string, finite number, server value, or null).");if(!Kt(e))throw new Error((0,c.gK)(n,"priority")+"must be a valid Firebase priority (a string, finite number, server value, or null).")}},Yt=function(n,e,t,s){if(!(s&&void 0===t||Dn(t)))throw new Error((0,c.gK)(n,e)+'was an invalid key = "'+t+'".  Firebase keys must be non-empty strings and can\'t contain ".", "#", "$", "/", "[", or "]").')},Gt=function(n,e,t,s){if(!(s&&void 0===t||ar(t)))throw new Error((0,c.gK)(n,e)+'was an invalid path = "'+t+'". Paths must be non-empty strings and can\'t contain ".", "#", "$", "[", or "]"')},Cl=function(n,e,t,s){t&&(t=t.replace(/^\/*\.info(\/|$)/,"/")),Gt(n,e,t,s)},ve=function(n,e){if(".info"===D(e))throw new Error(n+" failed = Can't modify data under /.info/")},cr=function(n,e){const t=e.path.toString();if("string"!=typeof e.repoInfo.host||0===e.repoInfo.host.length||!Dn(e.repoInfo.namespace)&&"localhost"!==e.repoInfo.host.split(":")[0]||0!==t.length&&!function(n){return n&&(n=n.replace(/^\/*\.info(\/|$)/,"/")),ar(n)}(t))throw new Error((0,c.gK)(n,"url")+'must be a valid firebase URL and the path can\'t contain ".", "#", "$", "[", or "]".')};class El{constructor(){this.eventLists_=[],this.recursionDepth_=0}}function bn(n,e){let t=null;for(let s=0;s<e.length;s++){const i=e[s],r=i.getPath();null!==t&&!Kn(r,t.path)&&(n.eventLists_.push(t),t=null),null===t&&(t={events:[],path:r}),t.events.push(i)}t&&n.eventLists_.push(t)}function ur(n,e,t){bn(n,t),hr(n,s=>Kn(s,e))}function pe(n,e,t){bn(n,t),hr(n,s=>me(s,e)||me(e,s))}function hr(n,e){n.recursionDepth_++;let t=!0;for(let s=0;s<n.eventLists_.length;s++){const i=n.eventLists_[s];i&&(e(i.path)?(wl(n.eventLists_[s]),n.eventLists_[s]=null):t=!1)}t&&(n.eventLists_=[]),n.recursionDepth_--}function wl(n){for(let e=0;e<n.events.length;e++){const t=n.events[e];if(null!==t){n.events[e]=null;const s=t.getEventRunner();Z&&U("event: "+t.toString()),dt(s)}}}const dr="repo_interrupt",Tl=25;class Il{constructor(e,t,s,i){this.repoInfo_=e,this.forceRestClient_=t,this.authTokenProvider_=s,this.appCheckProvider_=i,this.dataUpdateCount=0,this.statsListener_=null,this.eventQueue_=new El,this.nextWriteId_=1,this.interceptServerDataCallback_=null,this.onDisconnect_=un(),this.transactionQueueTree_=new Ts,this.persistentConnection_=null,this.key=this.repoInfo_.toURLString()}toString(){return(this.repoInfo_.secure?"https://":"http://")+this.repoInfo_.host}}function fr(n){const t=n.infoData_.getNode(new k(".info/serverTimeOffset")).val()||0;return(new Date).getTime()+t}function Vt(n){return ul({timestamp:fr(n)})}function _r(n,e,t,s,i){n.dataUpdateCount++;const r=new k(e);t=n.interceptServerDataCallback_?n.interceptServerDataCallback_(e,t):t;let o=[];if(i)if(s){const u=(0,c.UI)(t,h=>Y(h));o=function il(n,e,t,s){const i=gs(n,s);if(i){const r=ms(i),o=r.path,a=r.queryId,u=ae(o,e),h=B.fromObject(t);return vs(n,o,new vt(ss(a),u,h))}return[]}(n.serverSyncTree_,r,u,i)}else{const u=Y(t);o=Xi(n.serverSyncTree_,r,u,i)}else if(s){const u=(0,c.UI)(t,h=>Y(h));o=function tl(n,e,t){const s=B.fromObject(t);return Ct(n,new vt({fromUser:!1,fromServer:!0,queryId:null,tagged:!1},e,s))}(n.serverSyncTree_,r,u)}else{const u=Y(t);o=Wt(n.serverSyncTree_,r,u)}let a=r;o.length>0&&(a=wt(n,r)),pe(n.eventQueue_,a,o)}function pr(n,e){As(n,"connected",e),!1===e&&function xl(n){Et(n,"onDisconnectEvents");const e=Vt(n),t=un();es(n.onDisconnect_,R(),(i,r)=>{const o=ir(i,r,n.serverSyncTree_,e);mt(t,i,o)});let s=[];es(t,R(),(i,r)=>{s=s.concat(Wt(n.serverSyncTree_,i,r));const o=Rs(n,i);wt(n,o)}),n.onDisconnect_=un(),pe(n.eventQueue_,R(),s)}(n)}function As(n,e,t){const s=new k("/.info/"+e),i=Y(t);n.infoData_.updateSnapshot(s,i);const r=Wt(n.infoSyncTree_,s,i);pe(n.eventQueue_,s,r)}function An(n){return n.nextWriteId_++}function xs(n,e,t,s,i){Et(n,"set",{path:e.toString(),value:t,priority:s});const r=Vt(n),o=Y(t,s),a=wn(n.serverSyncTree_,e),u=Es(o,a,r),h=An(n),d=_s(n.serverSyncTree_,e,u,h,!0);bn(n.eventQueue_,d),n.server_.put(e.toString(),o.val(!0),(_,v)=>{const C="ok"===_;C||se("set at "+e+" failed: "+_);const N=ze(n.serverSyncTree_,h,!C);pe(n.eventQueue_,e,N),qe(0,i,_,v)});const f=Rs(n,e);wt(n,f),pe(n.eventQueue_,f,[])}function Pl(n,e,t){n.server_.onDisconnectCancel(e.toString(),(s,i)=>{"ok"===s&&Xn(n.onDisconnect_,e),qe(0,t,s,i)})}function gr(n,e,t,s){const i=Y(t);n.server_.onDisconnectPut(e.toString(),i.val(!0),(r,o)=>{"ok"===r&&mt(n.onDisconnect_,e,i),qe(0,s,r,o)})}function Ps(n,e,t){let s;s=".info"===D(e._path)?En(n.infoSyncTree_,e,t):En(n.serverSyncTree_,e,t),ur(n.eventQueue_,e._path,s)}function mr(n){n.persistentConnection_&&n.persistentConnection_.interrupt(dr)}function Et(n,...e){let t="";n.persistentConnection_&&(t=n.persistentConnection_.id+":"),U(t,...e)}function qe(n,e,t,s){e&&dt(()=>{if("ok"===t)e(null);else{const i=(t||"error").toUpperCase();let r=i;s&&(r+=": "+s);const o=new Error(r);o.code=i,e(o)}})}function Ns(n,e,t){return wn(n.serverSyncTree_,e,t)||I.EMPTY_NODE}function xn(n,e=n.transactionQueueTree_){if(e||Pn(n,e),ct(e)){const t=yr(n,e);(0,c.hu)(t.length>0,"Sending zero length transaction queue"),t.every(i=>0===i.status)&&function Ml(n,e,t){const s=t.map(h=>h.currentWriteId),i=Ns(n,e,s);let r=i;const o=i.hash();for(let h=0;h<t.length;h++){const d=t[h];(0,c.hu)(0===d.status,"tryToSendTransactionQueue_: items in queue should all be run."),d.status=1,d.retryCount++;const f=ae(e,d.path);r=r.updateChild(f,d.currentOutputSnapshotRaw)}const a=r.val(!0),u=e;n.server_.put(u.toString(),a,h=>{Et(n,"transaction put response",{path:u.toString(),status:h});let d=[];if("ok"===h){const f=[];for(let _=0;_<t.length;_++)t[_].status=2,d=d.concat(ze(n.serverSyncTree_,t[_].currentWriteId)),t[_].onComplete&&f.push(()=>t[_].onComplete(null,!0,t[_].currentOutputSnapshotResolved)),t[_].unwatcher();Pn(n,In(n.transactionQueueTree_,e)),xn(n,n.transactionQueueTree_),pe(n.eventQueue_,e,d);for(let _=0;_<f.length;_++)dt(f[_])}else{if("datastale"===h)for(let f=0;f<t.length;f++)t[f].status=3===t[f].status?4:0;else{se("transaction at "+u.toString()+" failed: "+h);for(let f=0;f<t.length;f++)t[f].status=4,t[f].abortReason=h}wt(n,e)}},o)}(n,Zt(e),t)}else rr(e)&&Sn(e,t=>{xn(n,t)})}function wt(n,e){const t=vr(n,e),s=Zt(t);return function Fl(n,e,t){if(0===e.length)return;const s=[];let i=[];const o=e.filter(a=>0===a.status).map(a=>a.currentWriteId);for(let a=0;a<e.length;a++){const u=e[a],h=ae(t,u.path);let f,d=!1;if((0,c.hu)(null!==h,"rerunTransactionsUnderNode_: relativePath should not be null."),4===u.status)d=!0,f=u.abortReason,i=i.concat(ze(n.serverSyncTree_,u.currentWriteId,!0));else if(0===u.status)if(u.retryCount>=Tl)d=!0,f="maxretry",i=i.concat(ze(n.serverSyncTree_,u.currentWriteId,!0));else{const _=Ns(n,u.path,o);u.currentInputSnapshot=_;const v=e[a].update(_.val());if(void 0!==v){jt("transaction failed: Data returned ",v,u.path);let C=Y(v);"object"==typeof v&&null!=v&&(0,c.r3)(v,".priority")||(C=C.updatePriority(_.getPriority()));const q=u.currentWriteId,Le=Vt(n),Be=Es(C,_,Le);u.currentOutputSnapshotRaw=C,u.currentOutputSnapshotResolved=Be,u.currentWriteId=An(n),o.splice(o.indexOf(q),1),i=i.concat(_s(n.serverSyncTree_,u.path,Be,u.currentWriteId,u.applyLocally)),i=i.concat(ze(n.serverSyncTree_,q,!0))}else d=!0,f="nodata",i=i.concat(ze(n.serverSyncTree_,u.currentWriteId,!0))}pe(n.eventQueue_,t,i),i=[],d&&(e[a].status=2,setTimeout(e[a].unwatcher,Math.floor(0)),e[a].onComplete&&s.push("nodata"===f?()=>e[a].onComplete(null,!1,e[a].currentInputSnapshot):()=>e[a].onComplete(new Error(f),!1,null)))}Pn(n,n.transactionQueueTree_);for(let a=0;a<s.length;a++)dt(s[a]);xn(n,n.transactionQueueTree_)}(n,yr(n,t),s),s}function vr(n,e){let t,s=n.transactionQueueTree_;for(t=D(e);null!==t&&void 0===ct(s);)s=In(s,t),t=D(e=F(e));return s}function yr(n,e){const t=[];return Cr(n,e,t),t.sort((s,i)=>s.order-i.order),t}function Cr(n,e,t){const s=ct(e);if(s)for(let i=0;i<s.length;i++)t.push(s[i]);Sn(e,i=>{Cr(n,i,t)})}function Pn(n,e){const t=ct(e);if(t){let s=0;for(let i=0;i<t.length;i++)2!==t[i].status&&(t[s]=t[i],s++);t.length=s,Is(e,t.length>0?t:void 0)}Sn(e,s=>{Pn(n,s)})}function Rs(n,e){const t=Zt(vr(n,e)),s=In(n.transactionQueueTree_,e);return function _l(n,e,t){let s=t?n:n.parent;for(;null!==s;){if(e(s))return!0;s=s.parent}}(s,i=>{Os(n,i)}),Os(n,s),or(s,i=>{Os(n,i)}),t}function Os(n,e){const t=ct(e);if(t){const s=[];let i=[],r=-1;for(let o=0;o<t.length;o++)3===t[o].status||(1===t[o].status?((0,c.hu)(r===o-1,"All SENT items should be at beginning of queue."),r=o,t[o].status=3,t[o].abortReason="set"):((0,c.hu)(0===t[o].status,"Unexpected transaction status in abort"),t[o].unwatcher(),i=i.concat(ze(n.serverSyncTree_,t[o].currentWriteId,!0)),t[o].onComplete&&s.push(t[o].onComplete.bind(null,new Error("set"),!1,null))));-1===r?Is(e,void 0):t.length=r+1,pe(n.eventQueue_,Zt(e),i);for(let o=0;o<s.length;o++)dt(s[o])}}const ks=function(n,e){const t=Bl(n),s=t.namespace;return"firebase.com"===t.domain&&Ne(t.host+" is no longer supported. Please use <YOUR FIREBASE>.firebaseio.com instead"),(!s||"undefined"===s)&&"localhost"!==t.domain&&Ne("Cannot parse Firebase url. Please use https://<YOUR FIREBASE>.firebaseio.com"),t.secure||typeof window<"u"&&window.location&&window.location.protocol&&-1!==window.location.protocol.indexOf("https:")&&se("Insecure Firebase access from a secure page. Please use https in calls to new Firebase()."),{repoInfo:new Mn(t.host,t.secure,s,"ws"===t.scheme||"wss"===t.scheme,e,"",s!==t.subdomain),path:new k(t.pathString)}},Bl=function(n){let e="",t="",s="",i="",r="",o=!0,a="https",u=443;if("string"==typeof n){let h=n.indexOf("//");h>=0&&(a=n.substring(0,h-1),n=n.substring(h+2));let d=n.indexOf("/");-1===d&&(d=n.length);let f=n.indexOf("?");-1===f&&(f=n.length),e=n.substring(0,Math.min(d,f)),d<f&&(i=function Ul(n){let e="";const t=n.split("/");for(let s=0;s<t.length;s++)if(t[s].length>0){let i=t[s];try{i=decodeURIComponent(i.replace(/\+/g," "))}catch{}e+="/"+i}return e}(n.substring(d,f)));const _=function Wl(n){const e={};"?"===n.charAt(0)&&(n=n.substring(1));for(const t of n.split("&")){if(0===t.length)continue;const s=t.split("=");2===s.length?e[decodeURIComponent(s[0])]=decodeURIComponent(s[1]):se(`Invalid query segment '${t}' in query '${n}'`)}return e}(n.substring(Math.min(n.length,f)));h=e.indexOf(":"),h>=0?(o="https"===a||"wss"===a,u=parseInt(e.substring(h+1),10)):h=e.length;const v=e.slice(0,h);if("localhost"===v.toLowerCase())t="localhost";else if(v.split(".").length<=2)t=v;else{const C=e.indexOf(".");s=e.substring(0,C).toLowerCase(),t=e.substring(C+1),r=s}"ns"in _&&(r=_.ns)}return{host:e,port:u,domain:t,subdomain:s,secure:o,scheme:a,pathString:i,namespace:r}},Er="-0123456789ABCDEFGHIJKLMNOPQRSTUVWXYZ_abcdefghijklmnopqrstuvwxyz",Ql=function(){let n=0;const e=[];return function(t){const s=t===n;let i;n=t;const r=new Array(8);for(i=7;i>=0;i--)r[i]=Er.charAt(t%64),t=Math.floor(t/64);(0,c.hu)(0===t,"Cannot push at time == 0");let o=r.join("");if(s){for(i=11;i>=0&&63===e[i];i--)e[i]=0;e[i]++}else for(i=0;i<12;i++)e[i]=Math.floor(64*Math.random());for(i=0;i<12;i++)o+=Er.charAt(e[i]);return(0,c.hu)(20===o.length,"nextPushId: Length should be 20."),o}}();class wr{constructor(e,t,s,i){this.eventType=e,this.eventRegistration=t,this.snapshot=s,this.prevName=i}getPath(){const e=this.snapshot.ref;return"value"===this.eventType?e._path:e.parent._path}getEventType(){return this.eventType}getEventRunner(){return this.eventRegistration.getEventRunner(this)}toString(){return this.getPath().toString()+":"+this.eventType+":"+(0,c.Wl)(this.snapshot.exportVal())}}class Tr{constructor(e,t,s){this.eventRegistration=e,this.error=t,this.path=s}getPath(){return this.path}getEventType(){return"cancel"}getEventRunner(){return this.eventRegistration.getEventRunner(this)}toString(){return this.path.toString()+":cancel"}}class Ls{constructor(e,t){this.snapshotCallback=e,this.cancelCallback=t}onValue(e,t){this.snapshotCallback.call(null,e,t)}onCancel(e){return(0,c.hu)(this.hasCancelCallback,"Raising a cancel event on a listener with no cancel callback"),this.cancelCallback.call(null,e)}get hasCancelCallback(){return!!this.cancelCallback}matches(e){return this.snapshotCallback===e.snapshotCallback||void 0!==this.snapshotCallback.userCallback&&this.snapshotCallback.userCallback===e.snapshotCallback.userCallback&&this.snapshotCallback.context===e.snapshotCallback.context}}class Ir{constructor(e,t){this._repo=e,this._path=t}cancel(){const e=new c.BH;return Pl(this._repo,this._path,e.wrapCallback(()=>{})),e.promise}remove(){ve("OnDisconnect.remove",this._path);const e=new c.BH;return gr(this._repo,this._path,null,e.wrapCallback(()=>{})),e.promise}set(e){ve("OnDisconnect.set",this._path),ke("OnDisconnect.set",e,this._path,!1);const t=new c.BH;return gr(this._repo,this._path,e,t.wrapCallback(()=>{})),t.promise}setWithPriority(e,t){ve("OnDisconnect.setWithPriority",this._path),ke("OnDisconnect.setWithPriority",e,this._path,!1),bs("OnDisconnect.setWithPriority",t,!1);const s=new c.BH;return function Nl(n,e,t,s,i){const r=Y(t,s);n.server_.onDisconnectPut(e.toString(),r.val(!0),(o,a)=>{"ok"===o&&mt(n.onDisconnect_,e,r),qe(0,i,o,a)})}(this._repo,this._path,e,t,s.wrapCallback(()=>{})),s.promise}update(e){ve("OnDisconnect.update",this._path),lr("OnDisconnect.update",e,this._path,!1);const t=new c.BH;return function Rl(n,e,t,s){if((0,c.xb)(t))return U("onDisconnect().update() called with empty data.  Don't do anything."),void qe(0,s,"ok",void 0);n.server_.onDisconnectMerge(e.toString(),t,(i,r)=>{"ok"===i&&z(t,(o,a)=>{const u=Y(a);mt(n.onDisconnect_,K(e,o),u)}),qe(0,s,i,r)})}(this._repo,this._path,e,t.wrapCallback(()=>{})),t.promise}}class he{constructor(e,t,s,i){this._repo=e,this._path=t,this._queryParams=s,this._orderByCalled=i}get key(){return b(this._path)?null:Zn(this._path)}get ref(){return new ye(this._repo,this._path)}get _queryIdentifier(){const e=Ai(this._queryParams),t=kn(e);return"{}"===t?"default":t}get _queryObject(){return Ai(this._queryParams)}isEqual(e){if(!((e=(0,c.m9)(e))instanceof he))return!1;const t=this._repo===e._repo,s=Kn(this._path,e._path);return t&&s&&this._queryIdentifier===e._queryIdentifier}toJSON(){return this.toString()}toString(){return this._repo.toString()+function Ro(n){let e="";for(let t=n.pieceNum_;t<n.pieces_.length;t++)""!==n.pieces_[t]&&(e+="/"+encodeURIComponent(String(n.pieces_[t])));return e||"/"}(this._path)}}function Nn(n,e){if(!0===n._orderByCalled)throw new Error(e+": You can't combine multiple orderBy calls.")}function Xe(n){let e=null,t=null;if(n.hasStart()&&(e=n.getIndexStartValue()),n.hasEnd()&&(t=n.getIndexEndValue()),n.getIndex()===Re){const s="Query: When ordering by key, you may only pass one argument to startAt(), endAt(), or equalTo().",i="Query: When ordering by key, the argument passed to startAt(), startAfter(), endAt(), endBefore(), or equalTo() must be a string.";if(n.hasStart()){if(n.getIndexStartName()!==je)throw new Error(s);if("string"!=typeof e)throw new Error(i)}if(n.hasEnd()){if(n.getIndexEndName()!==Ue)throw new Error(s);if("string"!=typeof t)throw new Error(i)}}else if(n.getIndex()===W){if(null!=e&&!Kt(e)||null!=t&&!Kt(t))throw new Error("Query: When ordering by priority, the first argument passed to startAt(), startAfter() endAt(), endBefore(), or equalTo() must be a valid priority value (null, a number, or a string).")}else if((0,c.hu)(n.getIndex()instanceof Hn||n.getIndex()===Jn,"unknown index type."),null!=e&&"object"==typeof e||null!=t&&"object"==typeof t)throw new Error("Query: First argument passed to startAt(), startAfter(), endAt(), endBefore(), or equalTo() cannot be an object.")}function Rn(n){if(n.hasStart()&&n.hasEnd()&&n.hasLimit()&&!n.hasAnchoredLimit())throw new Error("Query: Can't combine startAt(), startAfter(), endAt(), endBefore(), and limit(). Use limitToFirst() or limitToLast() instead.")}class ye extends he{constructor(e,t){super(e,t,new an,!1)}get parent(){const e=gi(this._path);return null===e?null:new ye(this._repo,e)}get root(){let e=this;for(;null!==e.parent;)e=e.parent;return e}}class ut{constructor(e,t,s){this._node=e,this.ref=t,this._index=s}get priority(){return this._node.getPriority().val()}get key(){return this.ref.key}get size(){return this._node.numChildren()}child(e){const t=new k(e),s=ht(this.ref,e);return new ut(this._node.getChild(t),s,W)}exists(){return!this._node.isEmpty()}exportVal(){return this._node.val(!0)}forEach(e){return!this._node.isLeafNode()&&!!this._node.forEachChild(this._index,(s,i)=>e(new ut(i,ht(this.ref,s),W)))}hasChild(e){const t=new k(e);return!this._node.getChild(t).isEmpty()}hasChildren(){return!this._node.isLeafNode()&&!this._node.isEmpty()}toJSON(){return this.exportVal()}val(){return this._node.val()}}function Sr(n,e){return(n=(0,c.m9)(n))._checkNotDeleted("ref"),void 0!==e?ht(n._root,e):n._root}function Dr(n,e){(n=(0,c.m9)(n))._checkNotDeleted("refFromURL");const t=ks(e,n._repo.repoInfo_.nodeAdmin);cr("refFromURL",t);const s=t.repoInfo;return!n._repo.repoInfo_.isCustomHost()&&s.host!==n._repo.repoInfo_.host&&Ne("refFromURL: Host name does not match the current database: (found "+s.host+" but expected "+n._repo.repoInfo_.host+")"),Sr(n,t.path.toString())}function ht(n,e){return null===D((n=(0,c.m9)(n))._path)?Cl("child","path",e,!1):Gt("child","path",e,!1),new ye(n._repo,K(n._path,e))}function Ms(n,e){n=(0,c.m9)(n),ve("set",n._path),ke("set",e,n._path,!1);const t=new c.BH;return xs(n._repo,n._path,e,null,t.wrapCallback(()=>{})),t.promise}function Gl(n,e){lr("update",e,n._path,!1);const t=new c.BH;return function Al(n,e,t,s){Et(n,"update",{path:e.toString(),value:t});let i=!0;const r=Vt(n),o={};if(z(t,(a,u)=>{i=!1,o[a]=ir(K(e,a),Y(u),n.serverSyncTree_,r)}),i)U("update() called with empty data.  Don't do anything."),qe(0,s,"ok",void 0);else{const a=An(n),u=function el(n,e,t,s){!function ma(n,e,t,s){(0,c.hu)(s>n.lastWriteId,"Stacking an older merge on top of newer ones"),n.allWrites.push({path:e,children:t,writeId:s,visible:!0}),n.visibleWrites=rs(n.visibleWrites,e,t),n.lastWriteId=s}(n.pendingWriteTree_,e,t,s);const i=B.fromObject(t);return Ct(n,new vt({fromUser:!0,fromServer:!1,queryId:null,tagged:!1},e,i))}(n.serverSyncTree_,e,o,a);bn(n.eventQueue_,u),n.server_.merge(e.toString(),t,(h,d)=>{const f="ok"===h;f||se("update at "+e+" failed: "+h);const _=ze(n.serverSyncTree_,a,!f),v=_.length>0?wt(n,e):e;pe(n.eventQueue_,v,_),qe(0,s,h,d)}),z(t,h=>{const d=Rs(n,K(e,h));wt(n,d)}),pe(n.eventQueue_,e,[])}}(n._repo,n._path,e,t.wrapCallback(()=>{})),t.promise}function Vl(n){n=(0,c.m9)(n);const e=new Ls(()=>{}),t=new Ht(e);return function bl(n,e,t){const s=function rl(n,e){const t=e._path;let s=null;n.syncPointTree_.foreachOnPath(t,(h,d)=>{const f=ae(h,t);s=s||Je(d,f)});let i=n.syncPointTree_.get(t);i?s=s||Je(i,R()):(i=new Vi,n.syncPointTree_=n.syncPointTree_.set(t,i));const r=null!=s,o=r?new Ve(s,!0,!1):null;return function Za(n){return fn(n.viewCache_)}(Hi(i,e,_n(n.pendingWriteTree_,e._path),r?o.getNode():I.EMPTY_NODE,r))}(n.serverSyncTree_,e);return null!=s?Promise.resolve(s):n.server_.get(e).then(i=>{const r=Y(i).withIndex(e._queryParams.getIndex());let o;if(ps(n.serverSyncTree_,e,t,!0),e._queryParams.loadsAllData())o=Wt(n.serverSyncTree_,e._path,r);else{const a=Bt(n.serverSyncTree_,e);o=Xi(n.serverSyncTree_,e._path,r,a)}return pe(n.eventQueue_,e._path,o),En(n.serverSyncTree_,e,t,null,!0),r},i=>(Et(n,"get for query "+(0,c.Wl)(e)+" failed: "+i),Promise.reject(new Error(i))))}(n._repo,n,t).then(s=>new ut(s,new ye(n._repo,n._path),n._queryParams.getIndex()))}class Ht{constructor(e){this.callbackContext=e}respondsTo(e){return"value"===e}createEvent(e,t){const s=t._queryParams.getIndex();return new wr("value",this,new ut(e.snapshotNode,new ye(t._repo,t._path),s))}getEventRunner(e){return"cancel"===e.getEventType()?()=>this.callbackContext.onCancel(e.error):()=>this.callbackContext.onValue(e.snapshot,null)}createCancelEvent(e,t){return this.callbackContext.hasCancelCallback?new Tr(this,e,t):null}matches(e){return e instanceof Ht&&(!e.callbackContext||!this.callbackContext||e.callbackContext.matches(this.callbackContext))}hasAnyCallback(){return null!==this.callbackContext}}class On{constructor(e,t){this.eventType=e,this.callbackContext=t}respondsTo(e){let t="children_added"===e?"child_added":e;return t="children_removed"===t?"child_removed":t,this.eventType===t}createCancelEvent(e,t){return this.callbackContext.hasCancelCallback?new Tr(this,e,t):null}createEvent(e,t){(0,c.hu)(null!=e.childName,"Child events should have a childName.");const s=ht(new ye(t._repo,t._path),e.childName),i=t._queryParams.getIndex();return new wr(e.type,this,new ut(e.snapshotNode,s,i),e.prevName)}getEventRunner(e){return"cancel"===e.getEventType()?()=>this.callbackContext.onCancel(e.error):()=>this.callbackContext.onValue(e.snapshot,e.prevName)}matches(e){return e instanceof On&&this.eventType===e.eventType&&(!this.callbackContext||!e.callbackContext||this.callbackContext.matches(e.callbackContext))}hasAnyCallback(){return!!this.callbackContext}}function Jt(n,e,t,s,i){let r;if("object"==typeof s&&(r=void 0,i=s),"function"==typeof s&&(r=s),i&&i.onlyOnce){const u=t,h=(d,f)=>{Ps(n._repo,n,a),u(d,f)};h.userCallback=t.userCallback,h.context=t.context,t=h}const o=new Ls(t,r||void 0),a="value"===e?new Ht(o):new On(e,o);return function Ol(n,e,t){let s;s=".info"===D(e._path)?ps(n.infoSyncTree_,e,t):ps(n.serverSyncTree_,e,t),ur(n.eventQueue_,e._path,s)}(n._repo,n,a),()=>Ps(n._repo,n,a)}function Fs(n,e,t,s){return Jt(n,"value",e,t,s)}function br(n,e,t,s){return Jt(n,"child_added",e,t,s)}function Ar(n,e,t,s){return Jt(n,"child_changed",e,t,s)}function xr(n,e,t,s){return Jt(n,"child_moved",e,t,s)}function Pr(n,e,t,s){return Jt(n,"child_removed",e,t,s)}function Nr(n,e,t){let s=null;const i=t?new Ls(t):null;"value"===e?s=new Ht(i):e&&(s=new On(e,i)),Ps(n._repo,n,s)}class Ie{}class Rr extends Ie{constructor(e,t){super(),this._value=e,this._key=t}_apply(e){ke("endAt",this._value,e._path,!0);const t=qn(e._queryParams,this._value,this._key);if(Rn(t),Xe(t),e._queryParams.hasEnd())throw new Error("endAt: Starting point was already set (by another call to endAt, endBefore or equalTo).");return new he(e._repo,e._path,t,e._orderByCalled)}}class Jl extends Ie{constructor(e,t){super(),this._value=e,this._key=t}_apply(e){ke("endBefore",this._value,e._path,!1);const t=function ia(n,e,t){let s;return s=qn(n,e,n.index_===Re||t?t:je),s.endBeforeSet_=!0,s}(e._queryParams,this._value,this._key);if(Rn(t),Xe(t),e._queryParams.hasEnd())throw new Error("endBefore: Starting point was already set (by another call to endAt, endBefore or equalTo).");return new he(e._repo,e._path,t,e._orderByCalled)}}class Or extends Ie{constructor(e,t){super(),this._value=e,this._key=t}_apply(e){ke("startAt",this._value,e._path,!0);const t=zn(e._queryParams,this._value,this._key);if(Rn(t),Xe(t),e._queryParams.hasStart())throw new Error("startAt: Starting point was already set (by another call to startAt, startBefore or equalTo).");return new he(e._repo,e._path,t,e._orderByCalled)}}class ql extends Ie{constructor(e,t){super(),this._value=e,this._key=t}_apply(e){ke("startAfter",this._value,e._path,!1);const t=function sa(n,e,t){let s;return s=zn(n,e,n.index_===Re||t?t:Ue),s.startAfterSet_=!0,s}(e._queryParams,this._value,this._key);if(Rn(t),Xe(t),e._queryParams.hasStart())throw new Error("startAfter: Starting point was already set (by another call to startAt, startAfter, or equalTo).");return new he(e._repo,e._path,t,e._orderByCalled)}}class ec extends Ie{constructor(e){super(),this._limit=e}_apply(e){if(e._queryParams.hasLimit())throw new Error("limitToFirst: Limit was already set (by another call to limitToFirst or limitToLast).");return new he(e._repo,e._path,function ta(n,e){const t=n.copy();return t.limitSet_=!0,t.limit_=e,t.viewFrom_="l",t}(e._queryParams,this._limit),e._orderByCalled)}}class nc extends Ie{constructor(e){super(),this._limit=e}_apply(e){if(e._queryParams.hasLimit())throw new Error("limitToLast: Limit was already set (by another call to limitToFirst or limitToLast).");return new he(e._repo,e._path,function na(n,e){const t=n.copy();return t.limitSet_=!0,t.limit_=e,t.viewFrom_="r",t}(e._queryParams,this._limit),e._orderByCalled)}}class ic extends Ie{constructor(e){super(),this._path=e}_apply(e){Nn(e,"orderByChild");const t=new k(this._path);if(b(t))throw new Error("orderByChild: cannot pass in empty path. Use orderByValue() instead.");const s=new Hn(t),i=ln(e._queryParams,s);return Xe(i),new he(e._repo,e._path,i,!0)}}class oc extends Ie{_apply(e){Nn(e,"orderByKey");const t=ln(e._queryParams,Re);return Xe(t),new he(e._repo,e._path,t,!0)}}class lc extends Ie{_apply(e){Nn(e,"orderByPriority");const t=ln(e._queryParams,W);return Xe(t),new he(e._repo,e._path,t,!0)}}class uc extends Ie{_apply(e){Nn(e,"orderByValue");const t=ln(e._queryParams,Jn);return Xe(t),new he(e._repo,e._path,t,!0)}}class dc extends Ie{constructor(e,t){super(),this._value=e,this._key=t}_apply(e){if(ke("equalTo",this._value,e._path,!1),e._queryParams.hasStart())throw new Error("equalTo: Starting point was already set (by another call to startAt/startAfter or equalTo).");if(e._queryParams.hasEnd())throw new Error("equalTo: Ending point was already set (by another call to endAt/endBefore or equalTo).");return new Rr(this._value,this._key)._apply(new Or(this._value,this._key)._apply(e))}}function Se(n,...e){let t=(0,c.m9)(n);for(const s of e)t=s._apply(t);return t}(function Ga(n){(0,c.hu)(!vn,"__referenceConstructor has already been defined"),vn=n})(ye),function za(n){(0,c.hu)(!Cn,"__referenceConstructor has already been defined"),Cn=n}(ye);const Us={};function Lr(n,e,t,s,i){let r=s||n.options.databaseURL;void 0===r&&(n.options.projectId||Ne("Can't determine Firebase Database URL. Be sure to include  a Project ID when calling firebase.initializeApp()."),U("Using default host for project ",n.options.projectId),r=`${n.options.projectId}-default-rtdb.firebaseio.com`);let u,h,o=ks(r,i),a=o.repoInfo;typeof process<"u"&&process.env&&(h=process.env.FIREBASE_DATABASE_EMULATOR_HOST),h?(u=!0,r=`http://${h}?ns=${a.namespace}`,o=ks(r,i),a=o.repoInfo):u=!o.repoInfo.secure;const d=i&&u?new bt(bt.OWNER):new oo(n.name,n.options,e);cr("Invalid Firebase Database URL",o),b(o.path)||Ne("Database URL must point to the root of a Firebase Database (not including a child path).");const f=function mc(n,e,t,s){let i=Us[e.name];i||(i={},Us[e.name]=i);let r=i[n.toURLString()];return r&&Ne("Database initialized multiple times. Please make sure the format of the database URL matches with each database() call."),r=new Il(n,false,t,s),i[n.toURLString()]=r,r}(a,n,d,new ro(n.name,t));return new yc(f,n)}class yc{constructor(e,t){this._repoInternal=e,this.app=t,this.type="database",this._instanceStarted=!1}get _repo(){return this._instanceStarted||(function Sl(n,e,t){if(n.stats_=Wn(n.repoInfo_),n.forceRestClient_||("object"==typeof window&&window.navigator&&window.navigator.userAgent||"").search(/googlebot|google webmaster tools|bingbot|yahoo! slurp|baiduspider|yandexbot|duckduckbot/i)>=0)n.server_=new cn(n.repoInfo_,(s,i,r,o)=>{_r(n,s,i,r,o)},n.authTokenProvider_,n.appCheckProvider_),setTimeout(()=>pr(n,!0),0);else{if(typeof t<"u"&&null!==t){if("object"!=typeof t)throw new Error("Only objects are supported for option databaseAuthVariableOverride");try{(0,c.Wl)(t)}catch(s){throw new Error("Invalid authOverride provided: "+s)}}n.persistentConnection_=new rt(n.repoInfo_,e,(s,i,r,o)=>{_r(n,s,i,r,o)},s=>{pr(n,s)},s=>{!function Dl(n,e){z(e,(t,s)=>{As(n,t,s)})}(n,s)},n.authTokenProvider_,n.appCheckProvider_,t),n.server_=n.persistentConnection_}n.authTokenProvider_.addTokenChangeListener(s=>{n.server_.refreshAuthToken(s)}),n.appCheckProvider_.addTokenChangeListener(s=>{n.server_.refreshAppCheckToken(s.token)}),n.statsReporter_=function co(n,e){const t=n.toString();return Un[t]||(Un[t]=e()),Un[t]}(n.repoInfo_,()=>new ua(n.stats_,n.server_)),n.infoData_=new ra,n.infoSyncTree_=new qi({startListening:(s,i,r,o)=>{let a=[];const u=n.infoData_.getNode(s._path);return u.isEmpty()||(a=Wt(n.infoSyncTree_,s._path,u),setTimeout(()=>{o("ok")},0)),a},stopListening:()=>{}}),As(n,"connected",!1),n.serverSyncTree_=new qi({startListening:(s,i,r,o)=>(n.server_.listen(s,r,i,(a,u)=>{const h=o(a,u);pe(n.eventQueue_,s._path,h)}),[]),stopListening:(s,i)=>{n.server_.unlisten(s,i)}})}(this._repoInternal,this.app.options.appId,this.app.options.databaseAuthVariableOverride),this._instanceStarted=!0),this._repoInternal}get _root(){return this._rootInternal||(this._rootInternal=new ye(this._repo,R())),this._rootInternal}_delete(){return null!==this._rootInternal&&(function gc(n,e){const t=Us[e];(!t||t[n.key]!==n)&&Ne(`Database ${e}(${n.repoInfo_}) has already been deleted.`),mr(n),delete t[n.key]}(this._repo,this.app.name),this._repoInternal=null,this._rootInternal=null),Promise.resolve()}_checkNotDeleted(e){null===this._rootInternal&&Ne("Cannot call "+e+" on a deleted database.")}}function Mr(){ii.IS_TRANSPORT_INITIALIZED&&se("Transport has already been initialized. Please call this function before calling ref or setting up a listener")}function Cc(){Mr(),Ye.forceDisallow()}function Ec(){Mr(),ft.forceDisallow(),Ye.forceAllow()}function Ic(n,e){Ke(n,e)}const Dc={".sv":"timestamp"};class xc{constructor(e,t){this.committed=e,this.snapshot=t}toJSON(){return{committed:this.committed,snapshot:this.snapshot.toJSON()}}}rt.prototype.simpleListen=function(n,e){this.sendRequest("q",{p:n},e)},rt.prototype.echo=function(n,e){this.sendRequest("echo",{d:n},e)},function Sc(n){Ae(j.SDK_VERSION),(0,j._registerComponent)(new re.wA("database",(e,{instanceIdentifier:t})=>Lr(e.getProvider("app").getImmediate(),e.getProvider("auth-internal"),e.getProvider("app-check-internal"),t),"PUBLIC").setMultipleInstances(!0)),(0,j.registerVersion)(Ce,"0.14.4",n),(0,j.registerVersion)(Ce,"0.14.4","esm2017")}();const Oc=new le.Yd("@firebase/database-compat"),Ur=function(n){Oc.warn("FIREBASE WARNING: "+n)};class Mc{constructor(e){this._delegate=e}cancel(e){(0,c.Dv)("OnDisconnect.cancel",0,1,arguments.length),(0,c.Wj)("OnDisconnect.cancel","onComplete",e,!0);const t=this._delegate.cancel();return e&&t.then(()=>e(null),s=>e(s)),t}remove(e){(0,c.Dv)("OnDisconnect.remove",0,1,arguments.length),(0,c.Wj)("OnDisconnect.remove","onComplete",e,!0);const t=this._delegate.remove();return e&&t.then(()=>e(null),s=>e(s)),t}set(e,t){(0,c.Dv)("OnDisconnect.set",1,2,arguments.length),(0,c.Wj)("OnDisconnect.set","onComplete",t,!0);const s=this._delegate.set(e);return t&&s.then(()=>t(null),i=>t(i)),s}setWithPriority(e,t,s){(0,c.Dv)("OnDisconnect.setWithPriority",2,3,arguments.length),(0,c.Wj)("OnDisconnect.setWithPriority","onComplete",s,!0);const i=this._delegate.setWithPriority(e,t);return s&&i.then(()=>s(null),r=>s(r)),i}update(e,t){if((0,c.Dv)("OnDisconnect.update",1,2,arguments.length),Array.isArray(e)){const i={};for(let r=0;r<e.length;++r)i[""+r]=e[r];e=i,Ur("Passing an Array to firebase.database.onDisconnect().update() is deprecated. Use set() if you want to overwrite the existing data, or an Object with integer keys if you really do want to only update some of the children.")}(0,c.Wj)("OnDisconnect.update","onComplete",t,!0);const s=this._delegate.update(e);return t&&s.then(()=>t(null),i=>t(i)),s}}class Fc{constructor(e,t){this.committed=e,this.snapshot=t}toJSON(){return(0,c.Dv)("TransactionResult.toJSON",0,1,arguments.length),{committed:this.committed,snapshot:this.snapshot.toJSON()}}}class et{constructor(e,t){this._database=e,this._delegate=t}val(){return(0,c.Dv)("DataSnapshot.val",0,0,arguments.length),this._delegate.val()}exportVal(){return(0,c.Dv)("DataSnapshot.exportVal",0,0,arguments.length),this._delegate.exportVal()}toJSON(){return(0,c.Dv)("DataSnapshot.toJSON",0,1,arguments.length),this._delegate.toJSON()}exists(){return(0,c.Dv)("DataSnapshot.exists",0,0,arguments.length),this._delegate.exists()}child(e){return(0,c.Dv)("DataSnapshot.child",0,1,arguments.length),e=String(e),Gt("DataSnapshot.child","path",e,!1),new et(this._database,this._delegate.child(e))}hasChild(e){return(0,c.Dv)("DataSnapshot.hasChild",1,1,arguments.length),Gt("DataSnapshot.hasChild","path",e,!1),this._delegate.hasChild(e)}getPriority(){return(0,c.Dv)("DataSnapshot.getPriority",0,0,arguments.length),this._delegate.priority}forEach(e){return(0,c.Dv)("DataSnapshot.forEach",1,1,arguments.length),(0,c.Wj)("DataSnapshot.forEach","action",e,!1),this._delegate.forEach(t=>e(new et(this._database,t)))}hasChildren(){return(0,c.Dv)("DataSnapshot.hasChildren",0,0,arguments.length),this._delegate.hasChildren()}get key(){return this._delegate.key}numChildren(){return(0,c.Dv)("DataSnapshot.numChildren",0,0,arguments.length),this._delegate.size}getRef(){return(0,c.Dv)("DataSnapshot.ref",0,0,arguments.length),new ge(this._database,this._delegate.ref)}get ref(){return this.getRef()}}class te{constructor(e,t){this.database=e,this._delegate=t}on(e,t,s,i){var r;(0,c.Dv)("Query.on",2,4,arguments.length),(0,c.Wj)("Query.on","callback",t,!1);const o=te.getCancelAndContextArgs_("Query.on",s,i),a=(h,d)=>{t.call(o.context,new et(this.database,h),d)};a.userCallback=t,a.context=o.context;const u=null===(r=o.cancel)||void 0===r?void 0:r.bind(o.context);switch(e){case"value":return Fs(this._delegate,a,u),t;case"child_added":return br(this._delegate,a,u),t;case"child_removed":return Pr(this._delegate,a,u),t;case"child_changed":return Ar(this._delegate,a,u),t;case"child_moved":return xr(this._delegate,a,u),t;default:throw new Error((0,c.gK)("Query.on","eventType")+'must be a valid event type = "value", "child_added", "child_removed", "child_changed", or "child_moved".')}}off(e,t,s){if((0,c.Dv)("Query.off",0,3,arguments.length),function(n,e,t){if(void 0!==e)switch(e){case"value":case"child_added":case"child_removed":case"child_changed":case"child_moved":break;default:throw new Error((0,c.gK)("Query.off","eventType")+'must be a valid event type = "value", "child_added", "child_removed", "child_changed", or "child_moved".')}}(0,e),(0,c.Wj)("Query.off","callback",t,!0),(0,c.lb)("Query.off","context",s,!0),t){const i=()=>{};i.userCallback=t,i.context=s,Nr(this._delegate,e,i)}else Nr(this._delegate,e)}get(){return Vl(this._delegate).then(e=>new et(this.database,e))}once(e,t,s,i){(0,c.Dv)("Query.once",1,4,arguments.length),(0,c.Wj)("Query.once","callback",t,!0);const r=te.getCancelAndContextArgs_("Query.once",s,i),o=new c.BH,a=(h,d)=>{const f=new et(this.database,h);t&&t.call(r.context,f,d),o.resolve(f)};a.userCallback=t,a.context=r.context;const u=h=>{r.cancel&&r.cancel.call(r.context,h),o.reject(h)};switch(e){case"value":Fs(this._delegate,a,u,{onlyOnce:!0});break;case"child_added":br(this._delegate,a,u,{onlyOnce:!0});break;case"child_removed":Pr(this._delegate,a,u,{onlyOnce:!0});break;case"child_changed":Ar(this._delegate,a,u,{onlyOnce:!0});break;case"child_moved":xr(this._delegate,a,u,{onlyOnce:!0});break;default:throw new Error((0,c.gK)("Query.once","eventType")+'must be a valid event type = "value", "child_added", "child_removed", "child_changed", or "child_moved".')}return o.promise}limitToFirst(e){return(0,c.Dv)("Query.limitToFirst",1,1,arguments.length),new te(this.database,Se(this._delegate,function tc(n){if("number"!=typeof n||Math.floor(n)!==n||n<=0)throw new Error("limitToFirst: First argument must be a positive integer.");return new ec(n)}(e)))}limitToLast(e){return(0,c.Dv)("Query.limitToLast",1,1,arguments.length),new te(this.database,Se(this._delegate,function sc(n){if("number"!=typeof n||Math.floor(n)!==n||n<=0)throw new Error("limitToLast: First argument must be a positive integer.");return new nc(n)}(e)))}orderByChild(e){return(0,c.Dv)("Query.orderByChild",1,1,arguments.length),new te(this.database,Se(this._delegate,function rc(n){if("$key"===n)throw new Error('orderByChild: "$key" is invalid.  Use orderByKey() instead.');if("$priority"===n)throw new Error('orderByChild: "$priority" is invalid.  Use orderByPriority() instead.');if("$value"===n)throw new Error('orderByChild: "$value" is invalid.  Use orderByValue() instead.');return Gt("orderByChild","path",n,!1),new ic(n)}(e)))}orderByKey(){return(0,c.Dv)("Query.orderByKey",0,0,arguments.length),new te(this.database,Se(this._delegate,function ac(){return new oc}()))}orderByPriority(){return(0,c.Dv)("Query.orderByPriority",0,0,arguments.length),new te(this.database,Se(this._delegate,function cc(){return new lc}()))}orderByValue(){return(0,c.Dv)("Query.orderByValue",0,0,arguments.length),new te(this.database,Se(this._delegate,function hc(){return new uc}()))}startAt(e=null,t){return(0,c.Dv)("Query.startAt",0,2,arguments.length),new te(this.database,Se(this._delegate,function zl(n=null,e){return Yt("startAt","key",e,!0),new Or(n,e)}(e,t)))}startAfter(e=null,t){return(0,c.Dv)("Query.startAfter",0,2,arguments.length),new te(this.database,Se(this._delegate,function Xl(n,e){return Yt("startAfter","key",e,!0),new ql(n,e)}(e,t)))}endAt(e=null,t){return(0,c.Dv)("Query.endAt",0,2,arguments.length),new te(this.database,Se(this._delegate,function Hl(n,e){return Yt("endAt","key",e,!0),new Rr(n,e)}(e,t)))}endBefore(e=null,t){return(0,c.Dv)("Query.endBefore",0,2,arguments.length),new te(this.database,Se(this._delegate,function $l(n,e){return Yt("endBefore","key",e,!0),new Jl(n,e)}(e,t)))}equalTo(e,t){return(0,c.Dv)("Query.equalTo",1,2,arguments.length),new te(this.database,Se(this._delegate,function fc(n,e){return Yt("equalTo","key",e,!0),new dc(n,e)}(e,t)))}toString(){return(0,c.Dv)("Query.toString",0,0,arguments.length),this._delegate.toString()}toJSON(){return(0,c.Dv)("Query.toJSON",0,1,arguments.length),this._delegate.toJSON()}isEqual(e){if((0,c.Dv)("Query.isEqual",1,1,arguments.length),!(e instanceof te))throw new Error("Query.isEqual failed: First argument must be an instance of firebase.database.Query.");return this._delegate.isEqual(e._delegate)}static getCancelAndContextArgs_(e,t,s){const i={cancel:void 0,context:void 0};if(t&&s)i.cancel=t,(0,c.Wj)(e,"cancel",i.cancel,!0),i.context=s,(0,c.lb)(e,"context",i.context,!0);else if(t)if("object"==typeof t&&null!==t)i.context=t;else{if("function"!=typeof t)throw new Error((0,c.gK)(e,"cancelOrContext")+" must either be a cancel callback or a context object.");i.cancel=t}return i}get ref(){return new ge(this.database,new ye(this._delegate._repo,this._delegate._path))}}class ge extends te{constructor(e,t){super(e,new he(t._repo,t._path,new an,!1)),this.database=e,this._delegate=t}getKey(){return(0,c.Dv)("Reference.key",0,0,arguments.length),this._delegate.key}child(e){return(0,c.Dv)("Reference.child",1,1,arguments.length),"number"==typeof e&&(e=String(e)),new ge(this.database,ht(this._delegate,e))}getParent(){(0,c.Dv)("Reference.parent",0,0,arguments.length);const e=this._delegate.parent;return e?new ge(this.database,e):null}getRoot(){return(0,c.Dv)("Reference.root",0,0,arguments.length),new ge(this.database,this._delegate.root)}set(e,t){(0,c.Dv)("Reference.set",1,2,arguments.length),(0,c.Wj)("Reference.set","onComplete",t,!0);const s=Ms(this._delegate,e);return t&&s.then(()=>t(null),i=>t(i)),s}update(e,t){if((0,c.Dv)("Reference.update",1,2,arguments.length),Array.isArray(e)){const i={};for(let r=0;r<e.length;++r)i[""+r]=e[r];e=i,Ur("Passing an Array to Firebase.update() is deprecated. Use set() if you want to overwrite the existing data, or an Object with integer keys if you really do want to only update some of the children.")}ve("Reference.update",this._delegate._path),(0,c.Wj)("Reference.update","onComplete",t,!0);const s=Gl(this._delegate,e);return t&&s.then(()=>t(null),i=>t(i)),s}setWithPriority(e,t,s){(0,c.Dv)("Reference.setWithPriority",2,3,arguments.length),(0,c.Wj)("Reference.setWithPriority","onComplete",s,!0);const i=function Yl(n,e,t){if(ve("setWithPriority",n._path),ke("setWithPriority",e,n._path,!1),bs("setWithPriority",t,!1),".length"===n.key||".keys"===n.key)throw"setWithPriority failed: "+n.key+" is a read-only object.";const s=new c.BH;return xs(n._repo,n._path,e,t,s.wrapCallback(()=>{})),s.promise}(this._delegate,e,t);return s&&i.then(()=>s(null),r=>s(r)),i}remove(e){(0,c.Dv)("Reference.remove",0,1,arguments.length),(0,c.Wj)("Reference.remove","onComplete",e,!0);const t=function Kl(n){return ve("remove",n._path),Ms(n,null)}(this._delegate);return e&&t.then(()=>e(null),s=>e(s)),t}transaction(e,t,s){(0,c.Dv)("Reference.transaction",1,3,arguments.length),(0,c.Wj)("Reference.transaction","transactionUpdate",e,!1),(0,c.Wj)("Reference.transaction","onComplete",t,!0),function(n,e,t,s){if(void 0!==t&&"boolean"!=typeof t)throw new Error((0,c.gK)("Reference.transaction","applyLocally")+"must be a boolean.")}(0,0,s);const i=function Pc(n,e,t){var s;if(n=(0,c.m9)(n),ve("Reference.transaction",n._path),".length"===n.key||".keys"===n.key)throw"Reference.transaction failed: "+n.key+" is a read-only object.";const i=null===(s=t?.applyLocally)||void 0===s||s,r=new c.BH,a=Fs(n,()=>{});return function Ll(n,e,t,s,i,r){Et(n,"transaction on "+e);const o={path:e,update:t,onComplete:s,status:null,order:S(),applyLocally:r,retryCount:0,unwatcher:i,abortReason:null,currentWriteId:null,currentInputSnapshot:null,currentOutputSnapshotRaw:null,currentOutputSnapshotResolved:null},a=Ns(n,e,void 0);o.currentInputSnapshot=a;const u=o.update(a.val());if(void 0===u)o.unwatcher(),o.currentOutputSnapshotRaw=null,o.currentOutputSnapshotResolved=null,o.onComplete&&o.onComplete(null,!1,o.currentInputSnapshot);else{jt("transaction failed: Data returned ",u,o.path),o.status=0;const h=In(n.transactionQueueTree_,e),d=ct(h)||[];let f;d.push(o),Is(h,d),"object"==typeof u&&null!==u&&(0,c.r3)(u,".priority")?(f=(0,c.DV)(u,".priority"),(0,c.hu)(Kt(f),"Invalid priority returned by transaction. Priority must be a valid string, finite number, server value, or null.")):f=(wn(n.serverSyncTree_,e)||I.EMPTY_NODE).getPriority().val();const _=Vt(n),v=Y(u,f),C=Es(v,a,_);o.currentOutputSnapshotRaw=v,o.currentOutputSnapshotResolved=C,o.currentWriteId=An(n);const N=_s(n.serverSyncTree_,e,C,o.currentWriteId,o.applyLocally);pe(n.eventQueue_,e,N),xn(n,n.transactionQueueTree_)}}(n._repo,n._path,e,(u,h,d)=>{let f=null;u?r.reject(u):(f=new ut(d,new ye(n._repo,n._path),W),r.resolve(new xc(h,f)))},a,i),r.promise}(this._delegate,e,{applyLocally:s}).then(r=>new Fc(r.committed,new et(this.database,r.snapshot)));return t&&i.then(r=>t(null,r.committed,r.snapshot),r=>t(r,!1,null)),i}setPriority(e,t){(0,c.Dv)("Reference.setPriority",1,2,arguments.length),(0,c.Wj)("Reference.setPriority","onComplete",t,!0);const s=function jl(n,e){n=(0,c.m9)(n),ve("setPriority",n._path),bs("setPriority",e,!1);const t=new c.BH;return xs(n._repo,K(n._path,".priority"),e,null,t.wrapCallback(()=>{})),t.promise}(this._delegate,e);return t&&s.then(()=>t(null),i=>t(i)),s}push(e,t){(0,c.Dv)("Reference.push",0,2,arguments.length),(0,c.Wj)("Reference.push","onComplete",t,!0);const s=function Zl(n,e){n=(0,c.m9)(n),ve("push",n._path),ke("push",e,n._path,!0);const t=fr(n._repo),s=Ql(t),i=ht(n,s),r=ht(n,s);let o;return o=null!=e?Ms(r,e).then(()=>r):Promise.resolve(r),i.then=o.then.bind(o),i.catch=o.then.bind(o,void 0),i}(this._delegate,e),i=s.then(o=>new ge(this.database,o));t&&i.then(()=>t(null),o=>t(o));const r=new ge(this.database,s);return r.then=i.then.bind(i),r.catch=i.catch.bind(i,void 0),r}onDisconnect(){return ve("Reference.onDisconnect",this._delegate._path),new Mc(new Ir(this._delegate._repo,this._delegate._path))}get key(){return this.getKey()}get parent(){return this.getParent()}get root(){return this.getRoot()}}class $t{constructor(e,t){this._delegate=e,this.app=t,this.INTERNAL={delete:()=>this._delegate._delete(),forceWebSockets:Cc,forceLongPolling:Ec}}useEmulator(e,t,s={}){!function Fr(n,e,t,s={}){(n=(0,c.m9)(n))._checkNotDeleted("useEmulator"),n._instanceStarted&&Ne("Cannot call useEmulator() after instance has already been initialized.");const i=n._repoInternal;let r;if(i.repoInfo_.nodeAdmin)s.mockUserToken&&Ne('mockUserToken is not supported by the Admin SDK. For client access with mock users, please use the "firebase" package instead of "firebase-admin".'),r=new bt(bt.OWNER);else if(s.mockUserToken){const o="string"==typeof s.mockUserToken?s.mockUserToken:(0,c.Sg)(s.mockUserToken,n.app.options.projectId);r=new bt(o)}!function pc(n,e,t,s){n.repoInfo_=new Mn(`${e}:${t}`,!1,n.repoInfo_.namespace,n.repoInfo_.webSocketOnly,n.repoInfo_.nodeAdmin,n.repoInfo_.persistenceKey,n.repoInfo_.includeNamespaceInQueryParams,!0),s&&(n.authTokenProvider_=s)}(i,e,t,r)}(this._delegate,e,t,s)}ref(e){if((0,c.Dv)("database.ref",0,1,arguments.length),e instanceof ge){const t=Dr(this._delegate,e.toString());return new ge(this,t)}{const t=Sr(this._delegate,e);return new ge(this,t)}}refFromURL(e){(0,c.Dv)("database.refFromURL",1,1,arguments.length);const s=Dr(this._delegate,e);return new ge(this,s)}goOffline(){return(0,c.Dv)("database.goOffline",0,0,arguments.length),function wc(n){(n=(0,c.m9)(n))._checkNotDeleted("goOffline"),mr(n._repo)}(this._delegate)}goOnline(){return(0,c.Dv)("database.goOnline",0,0,arguments.length),function Tc(n){(n=(0,c.m9)(n))._checkNotDeleted("goOnline"),function kl(n){n.persistentConnection_&&n.persistentConnection_.resume(dr)}(n._repo)}(this._delegate)}}$t.ServerValue={TIMESTAMP:function bc(){return Dc}(),increment:n=>function Ac(n){return{".sv":{increment:n}}}(n)};var Wc=Object.freeze({__proto__:null,initStandalone:function Uc({app:n,url:e,version:t,customAuthImpl:s,namespace:i,nodeAdmin:r=!1}){Ae(t);const o=new re.zt("auth-internal",new re.H0("database-standalone"));return o.setComponent(new re.wA("auth-internal",()=>s,"PRIVATE")),{instance:new $t(Lr(n,o,void 0,e,r),n),namespace:i}}});const Bc=$t.ServerValue;!function Qc(n){n.INTERNAL.registerComponent(new re.wA("database-compat",(e,{instanceIdentifier:t})=>{const s=e.getProvider("app-compat").getImmediate(),i=e.getProvider("database").getImmediate({identifier:t});return new $t(i,s)},"PUBLIC").setServiceProps({Reference:ge,Query:te,Database:$t,DataSnapshot:et,enableLogging:Ic,INTERNAL:Wc,ServerValue:Bc}).setMultipleInstances(!0)),n.registerVersion("@firebase/database-compat","0.3.4")}(w.Z);var tt=m(7046),Zc=m(8697);function Wr(n){return null==n}function Br(n){return"function"==typeof n.set}function Qr(n,e){return Br(e)?e:n.ref(e)}function Zr(n,e){if(function Kc(n){return"string"==typeof n}(n))return e.stringCase();if(Br(n))return e.firebaseCase();if(function jc(n){return"function"==typeof n.exportVal}(n))return e.snapshotCase();throw new Error("Expects a string, snapshot, or reference. Got: "+typeof n)}function zt(n,e,t="on",s=T.z){return new H.y(i=>{let r=null;return r=n[t](e,(o,a)=>{s.schedule(()=>{i.next({snapshot:o,prevKey:a})}),"once"===t&&s.schedule(()=>i.complete())},o=>{s.schedule(()=>i.error(o))}),"on"===t?{unsubscribe(){null!=r&&n.off(e,r)}}:{unsubscribe(){}}}).pipe((0,ee.U)(i=>{const{snapshot:r,prevKey:o}=i;let a=null;return r.exists()&&(a=r.key),{type:e,payload:r,prevKey:o,key:a}}),(0,g.B)())}function Kr(n,e){const t=n.length;for(let s=0;s<t;s++)if(n[s].payload.key===e)return s;return-1}function Vc(n,e){const{payload:t,prevKey:s,key:i}=e,r=Kr(n,i),o=function Gc(n,e){if(Wr(e))return 0;{const t=Kr(n,e);return-1===t?n.length:t+1}}(n,s);switch(e.type){case"value":if(e.payload&&e.payload.exists()){let a=null;e.payload.forEach(u=>{const h={payload:u,type:"value",prevKey:a,key:u.key};return a=u.key,n=[...n,h],!1})}return n;case"child_added":if(r>-1){const a=n[r-1];(a&&a.key||null)!==s&&(n=n.filter(u=>u.payload.key!==t.key)).splice(o,0,e)}else{if(null==s)return[e,...n];(n=n.slice()).splice(o,0,e)}return n;case"child_removed":return n.filter(a=>a.payload.key!==t.key);case"child_changed":return n.map(a=>a.payload.key===i?e:a);case"child_moved":if(r>-1){const a=n.splice(r,1)[0];return(n=n.slice()).splice(o,0,a),n}return n;default:return n}}function jr(n){return(Wr(n)||0===n.length)&&(n=["child_added","child_removed","child_changed","child_moved"]),n}function Yr(n,e,t){return function Yc(n,e,t){return zt(n,"value","once",t).pipe((0,de.w)(s=>{const i=[(0,J.of)(s)];return e.forEach(r=>i.push(zt(n,r,"on",t))),(0,V.T)(...i).pipe((0,$.R)(Vc,[]))}),(0,De.x)())}(n,e=jr(e),t)}function Gr(n,e,t){const s=(e=jr(e)).map(i=>zt(n,i,"on",t));return(0,V.T)(...s)}function Vr(n,e){return function(s,i){return Zr(s,{stringCase:()=>n.child(s)[e](i),firebaseCase:()=>s[e](i),snapshotCase:()=>s.ref[e](i)})}}function zc(n){return function(t){return t?Zr(t,{stringCase:()=>n.child(t).remove(),firebaseCase:()=>t.remove(),snapshotCase:()=>t.ref.remove()}):n.remove()}}function Hr(n,e){return function(){return zt(n,"value","on",e)}}m(7142);const eu=new l.OlP("angularfire2.realtimeDatabaseURL"),tu=new l.OlP("angularfire2.database.use-emulator");let nu=(()=>{class n{constructor(t,s,i,r,o,a,u,h,d,f,_,v,C,N,q){this.schedulers=a;const Le=u,Be=(0,y.on)(t,o,s);h&&(0,tt.nw)(Be,o,d,_,v,C,f,N),this.database=(0,y.cc)(`${Be.name}.database.${i}`,"AngularFireDatabase",Be.name,()=>{const Tt=o.runOutsideAngular(()=>Be.database(i||void 0));return Le&&Tt.useEmulator(...Le),Tt},[Le])}list(t,s){const i=this.schedulers.ngZone.runOutsideAngular(()=>Qr(this.database,t));let r=i;return s&&(r=s(i)),function qc(n,e){const t=e.schedulers.outsideAngular,s=e.schedulers.ngZone.run(()=>n.ref);return{query:n,update:Vr(s,"update"),set:Vr(s,"set"),push:i=>s.push(i),remove:zc(s),snapshotChanges:i=>Yr(n,i,t).pipe(_e.iC),stateChanges:i=>Gr(n,i,t).pipe(_e.iC),auditTrail:i=>function Hc(n,e,t){return function $c(n,e,t){return function Jc(n,e){return zt(n,"value","on",e).pipe((0,ee.U)(t=>{let s;return t.payload.forEach(i=>(s=i.key,!1)),{data:t,lastKeyToLoad:s}}))}(n,t).pipe(function Fe(...n){const e=(0,be.jO)(n);return(0,P.e)((t,s)=>{const i=n.length,r=new Array(i);let o=n.map(()=>!1),a=!1;for(let u=0;u<i;u++)(0,G.Xf)(n[u]).subscribe((0,p.x)(s,h=>{r[u]=h,!a&&!o[u]&&(o[u]=!0,(a=o.every(Me.y))&&(o=null))},fe.Z));t.subscribe((0,p.x)(s,u=>{if(a){const h=[u,...r];s.next(e?e(...h):h)}}))})}(e),(0,ee.U)(([i,r])=>{const o=i.lastKeyToLoad,a=r.map(u=>u.key);return{actions:r,lastKeyToLoad:o,loadedKeys:a}}),function ie(n){return(0,P.e)((e,t)=>{let s=!1,i=0;e.subscribe((0,p.x)(t,r=>(s||(s=!n(r,i++)))&&t.next(r)))})}(i=>-1===i.loadedKeys.indexOf(i.lastKeyToLoad)),(0,ee.U)(i=>i.actions))}(n,Gr(n,e).pipe((0,$.R)((i,r)=>[...i,r],[])),t)}(n,i,t).pipe(_e.iC),valueChanges:(i,r)=>Yr(n,i,t).pipe((0,ee.U)(a=>a.map(u=>r&&r.idField?Object.assign(Object.assign({},u.payload.val()),{[r.idField]:u.key}):u.payload.val())),_e.iC)}}(r,this)}object(t){return function Xc(n,e){return{query:n,snapshotChanges:()=>Hr(n,e.schedulers.outsideAngular)().pipe(_e.iC),update:t=>n.ref.update(t),set:t=>n.ref.set(t),remove:()=>n.ref.remove(),valueChanges:()=>Hr(n,e.schedulers.outsideAngular)().pipe(_e.iC,(0,ee.U)(s=>s.payload.exists()?s.payload.val():null))}}(this.schedulers.ngZone.runOutsideAngular(()=>Qr(this.database,t)),this)}createPushId(){return this.schedulers.ngZone.runOutsideAngular(()=>this.database.ref()).push().key}}return n.\u0275fac=function(t){return new(t||n)(l.LFG(y.Dh),l.LFG(y.xv,8),l.LFG(eu,8),l.LFG(l.Lbi),l.LFG(l.R0b),l.LFG(_e.HU),l.LFG(tu,8),l.LFG(tt.zQ,8),l.LFG(tt.Qv,8),l.LFG(tt.L6,8),l.LFG(tt._Q,8),l.LFG(tt.rT,8),l.LFG(tt.lh,8),l.LFG(tt.f7,8),l.LFG(Zc.nm,8))},n.\u0275prov=l.Yz7({token:n,factory:n.\u0275fac,providedIn:"any"}),n})()},3980:(Qe,X,m)=>{m.d(X,{r:()=>Fe});var l=m(5619),T=m(7398),H=m(940),J=m(4664),V=m(5879),ee=m(9209),g=m(7523);const de="/AddNewStuff.json",$="/AddNewCourse.json",De="/AddNewFullCourse.json",P="/AddConfirmedCourse.json",p="/Question.json",G="/doctorAnswer.json",be="/AddBlogPost.json";let Fe=(()=>{class ie{constructor(y,x){this.apiService=y,this.firebase=x,this.dataSubject=new l.X(null)}addNewStuff(y){return this.apiService.post(de,y)}addNewCourse(y){return this.apiService.post($,y)}addNewFullCourse(y){return this.apiService.post(De,y)}addBlogPost(y){return this.apiService.post(be,y)}askQuestion(y){return this.apiService.post(p,y)}doctorAnswer(y){return this.apiService.post(G,y)}getBlogPost(){return this.apiService.get(be).pipe((0,T.U)(y=>{if(y){const x=[];for(const w in y)x.push({...y[w],key:w});return x}return[]}),(0,H.d)())}getQuestions(){return this.apiService.get(p).pipe((0,T.U)(y=>{if(y){const x=[];for(const w in y)x.push({...y[w],key:w});return x}return[]}))}getStuffs(){return this.apiService.get(de).pipe((0,T.U)(y=>{if(y){const x=[];for(const w in y)x.push({...y[w],key:w});return x}return[]}))}getCourses(){return this.apiService.get($).pipe((0,T.U)(y=>{if(y){const x=[];for(const w in y)x.push({...y[w],key:w});return x}return[]}))}getFullCourses(){return this.apiService.get(De).pipe((0,T.U)(y=>{if(y){const x=[];for(const w in y)x.push({...y[w],key:w});return x}return[]}))}confirmFullCourse(y){return this.apiService.post(P,y)}getMyConfirmedCourses(){return this.apiService.get(P).pipe((0,T.U)(y=>{if(y){const x=[];for(const w in y)x.push({...y[w],key:w});return x}return[]}))}getDoctorAnswers(){return this.apiService.get(G).pipe((0,T.U)(y=>{if(y){const x=[];for(const w in y)x.push({...y[w],key:w});return x}return[]}))}deleteStuff(y){return this.apiService.delete("/AddNewStuff/",y).pipe((0,J.w)(()=>this.getStuffs().pipe((0,T.U)(x=>(this.dataSubject.next(x),x)))))}deleteBlogPost(y){return this.apiService.delete("/AddBlogPost/",y).pipe((0,J.w)(()=>this.getBlogPost().pipe((0,T.U)(x=>(this.dataSubject.next(x),x)))))}insertStuff(y){this.stuffList.push(y)}getStuffList(){this.stuffList=this.firebase.list("stuff")}static#e=this.\u0275fac=function(x){return new(x||ie)(V.LFG(ee.s),V.LFG(g.KQ))};static#t=this.\u0275prov=V.Yz7({token:ie,factory:ie.\u0275fac,providedIn:"root"})}return ie})()},2959:(Qe,X,m)=>{m.d(X,{D:()=>x});var l=m(5861),T=m(6223),H=m(8189),J=m(1498),V=m(4351),ee=m(7160),g=m(5879),de=m(9758),$=m(4190),De=m(6814),P=m(1075),p=m(6005),G=m(9548),Me=m(1365);function fe(w,re){1&w&&(g.TgZ(0,"mat-error"),g._uU(1," \u10d5\u10d4\u10da\u10d8 \u10e1\u10d0\u10d5\u10d0\u10da\u10d3\u10d4\u10d1\u10e3\u10da\u10dd\u10d0 "),g.qZA())}function be(w,re){1&w&&(g.TgZ(0,"mat-error"),g._uU(1," \u10d0\u10e0\u10d0\u10e1\u10ec\u10dd\u10e0\u10d8 \u10e4\u10dd\u10e0\u10db\u10d0\u10e2\u10d8 "),g.qZA())}function Fe(w,re){if(1&w&&(g.ynx(0),g.YNc(1,fe,2,0,"mat-error",3),g.YNc(2,be,2,0,"mat-error",3),g.BQk()),2&w){const L=g.oxw();g.xp6(1),g.Q6J("ngIf",null==L.form.get("userName").errors?null:L.form.get("userName").errors.required),g.xp6(1),g.Q6J("ngIf",null==L.form.get("userName").errors?null:L.form.get("userName").errors.pattern)}}function ie(w,re){1&w&&(g.TgZ(0,"mat-error"),g._uU(1," \u10d5\u10d4\u10da\u10d8 \u10e1\u10d0\u10d5\u10d0\u10da\u10d3\u10d4\u10d1\u10e3\u10da\u10dd\u10d0 "),g.qZA())}function _e(w,re){1&w&&(g.TgZ(0,"mat-error"),g._uU(1," \u10de\u10d0\u10e0\u10dd\u10da\u10d8\u10e1 \u10d0\u10e0\u10d0\u10e1\u10ec\u10dd\u10e0\u10d8 \u10e4\u10dd\u10e0\u10db\u10d0\u10e2\u10d8 "),g.qZA())}function y(w,re){if(1&w&&(g.ynx(0),g.YNc(1,ie,2,0,"mat-error",3),g.YNc(2,_e,2,0,"mat-error",3),g.BQk()),2&w){const L=g.oxw();let j;g.xp6(1),g.Q6J("ngIf",null==L.form.get("password").errors?null:L.form.get("password").errors.required),g.xp6(1),g.Q6J("ngIf",null==(j=L.form.get("password"))?null:j.hasError("minLength"))}}let x=(()=>{class w{constructor(L,j,c,le,Ce,Ze){this.dialogRef=L,this.data=j,this.authService=c,this.fb=le,this.router=Ce,this.dialog=Ze}ngOnInit(){this.initForm()}initForm(){this.form=this.fb.group({userName:[null,[T.kI.required,T.kI.pattern(ee.b.email)]],password:[null,[T.kI.required,T.kI.minLength(6)]]})}onSubmit(){var L=this;return(0,l.Z)(function*(){if(L.form.invalid)V.W.formFieldsModeControl("markAsDirty",L.form);else{const j=L.form.value;yield L.authService.signIn(j.userName,j.password).then(c=>{console.log(c),L.dialogRef.close(),L.router.navigate([""])})}})()}signUp(L){this.dialogRef.close(),this.dialog.open({signUp:{component:J.b,width:"500px"}}[L].component,{width:"500px",panelClass:"border-16"})}static#e=this.\u0275fac=function(j){return new(j||w)(g.Y36(H.so,8),g.Y36(H.WI),g.Y36(de.e),g.Y36(T.qu),g.Y36($.F0),g.Y36(H.uw))};static#t=this.\u0275cmp=g.Xpm({type:w,selectors:[["app-log-in"]],decls:26,vars:24,consts:[[3,"formGroup","ngSubmit"],["appearance","outline"],["matInput","","formControlName","userName",3,"placeholder"],[4,"ngIf"],["matInput","","formControlName","password","type","password",3,"placeholder"],[2,"margin-bottom","5px","cursor","pointer",3,"click"],["type","submit","mat-raised-button","","color","primary"]],template:function(j,c){if(1&j&&(g.TgZ(0,"form",0),g.NdJ("ngSubmit",function(){return c.onSubmit()}),g.TgZ(1,"h4"),g._uU(2),g.ALo(3,"translate"),g.qZA(),g.TgZ(4,"div")(5,"mat-form-field",1)(6,"mat-label"),g._uU(7),g.ALo(8,"translate"),g.qZA(),g._UZ(9,"input",2),g.ALo(10,"translate"),g.qZA(),g.YNc(11,Fe,3,2,"ng-container",3),g.qZA(),g.TgZ(12,"div")(13,"mat-form-field",1)(14,"mat-label"),g._uU(15),g.ALo(16,"translate"),g.qZA(),g._UZ(17,"input",4),g.ALo(18,"translate"),g.qZA(),g.YNc(19,y,3,2,"ng-container",3),g.qZA(),g.TgZ(20,"div",5),g.NdJ("click",function(){return c.signUp("signUp")}),g._uU(21),g.ALo(22,"translate"),g.qZA(),g.TgZ(23,"button",6),g._uU(24),g.ALo(25,"translate"),g.qZA()()),2&j){let le,Ce;g.Q6J("formGroup",c.form),g.xp6(2),g.Oqu(g.lcZ(3,10,"logIn")),g.xp6(5),g.Oqu(g.lcZ(8,12,"user")),g.xp6(2),g.s9C("placeholder",g.lcZ(10,14,"user")),g.xp6(2),g.Q6J("ngIf",null==(le=c.form.get("userName"))?null:le.dirty),g.xp6(4),g.Oqu(g.lcZ(16,16,"password")),g.xp6(2),g.s9C("placeholder",g.lcZ(18,18,"password")),g.xp6(2),g.Q6J("ngIf",null==(Ce=c.form.get("password"))?null:Ce.dirty),g.xp6(2),g.hij(" ",g.lcZ(22,20,"signUp")," "),g.xp6(3),g.Oqu(g.lcZ(25,22,"logIn"))}},dependencies:[De.O5,P.lW,p.TO,p.KE,p.hX,G.Nt,T._Y,T.Fj,T.JJ,T.JL,T.sg,T.u,Me.X$],styles:["form[_ngcontent-%COMP%]{width:100%}form[_ngcontent-%COMP%]   h4[_ngcontent-%COMP%]{margin:0 0 10px;text-align:center}form[_ngcontent-%COMP%]   div[_ngcontent-%COMP%]{width:100%}form[_ngcontent-%COMP%]   div[_ngcontent-%COMP%]   mat-form-field[_ngcontent-%COMP%]{width:100%}form[_ngcontent-%COMP%]   button[_ngcontent-%COMP%]{width:100%}"]})}return w})()},1498:(Qe,X,m)=>{m.d(X,{b:()=>Ze});var l=m(5861),T=m(6223),H=m(8189),J=m(1623),$=(m(9058),m(4303),m(7879),m(4537),m(7160)),De=m(3966),P=m(4351),p=m(5879),G=m(9758),Me=m(4190),fe=m(5992),be=m(7046),Fe=m(7523),ie=m(6814),_e=m(1075),y=m(6005),x=m(9548),w=m(1365);function re(Q,Ae){1&Q&&(p.TgZ(0,"mat-error"),p._uU(1," \u10d5\u10d4\u10da\u10d8 \u10e1\u10d0\u10d5\u10d0\u10da\u10d3\u10d4\u10d1\u10e3\u10da\u10dd\u10d0 "),p.qZA())}function L(Q,Ae){1&Q&&(p.TgZ(0,"mat-error"),p._uU(1," \u10d0\u10e0\u10d0\u10e1\u10ec\u10dd\u10e0\u10d8 \u10e4\u10dd\u10e0\u10db\u10d0\u10e2\u10d8 "),p.qZA())}function j(Q,Ae){if(1&Q&&(p.ynx(0),p.YNc(1,re,2,0,"mat-error",3),p.YNc(2,L,2,0,"mat-error",3),p.BQk()),2&Q){const M=p.oxw();p.xp6(1),p.Q6J("ngIf",null==M.form.get("email").errors?null:M.form.get("email").errors.required),p.xp6(1),p.Q6J("ngIf",null==M.form.get("email").errors?null:M.form.get("email").errors.pattern)}}function c(Q,Ae){1&Q&&(p.TgZ(0,"mat-error"),p._uU(1," \u10d5\u10d4\u10da\u10d8 \u10e1\u10d0\u10d5\u10d0\u10da\u10d3\u10d4\u10d1\u10e3\u10da\u10dd\u10d0 "),p.qZA())}function le(Q,Ae){1&Q&&(p.TgZ(0,"mat-error"),p._uU(1," \u10de\u10d0\u10e0\u10dd\u10da\u10d8\u10e1 \u10d0\u10e0\u10d0\u10e1\u10ec\u10dd\u10e0\u10d8 \u10e4\u10dd\u10e0\u10db\u10d0\u10e2\u10d8 "),p.qZA())}function Ce(Q,Ae){if(1&Q&&(p.ynx(0),p.YNc(1,c,2,0,"mat-error",3),p.YNc(2,le,2,0,"mat-error",3),p.BQk()),2&Q){const M=p.oxw();let ne;p.xp6(1),p.Q6J("ngIf",null==M.form.get("password").errors?null:M.form.get("password").errors.required),p.xp6(1),p.Q6J("ngIf",null==(ne=M.form.get("password"))?null:ne.hasError("minLength"))}}let Ze=(()=>{class Q{constructor(M,ne,Ee,oe,xe,Pe,S,ce){this.dialogRef=M,this.data=ne,this.authservice=Ee,this.fb=oe,this.router=xe,this._snackBar=Pe,this.afAuth=S,this.db=ce}ngOnInit(){this.initForm()}initForm(){this.form=this.fb.group({email:[null,[T.kI.required,T.kI.pattern($.b.email)]],password:[null,[T.kI.required,T.kI.minLength(6)]]})}onSignUp(){var M=this;return(0,l.Z)(function*(){if(M.form.invalid)P.W.formFieldsModeControl("markAsDirty",M.form);else{const ne=M.form.value;yield M.authservice.signUp(ne),M.verifyEmail()}})()}verifyEmail(){const M=(0,J.n)();console.log(M.currentUser),M.currentUser&&(0,J.ab)(M.currentUser).then(()=>{this.dialogRef.close(),this.router.navigate([""]),this._snackBar.openFromComponent(De.w,{duration:5e3,data:{message:"\u10d7\u10e5\u10d5\u10d4\u10dc\u10e1 \u10db\u10d4\u10d8\u10da\u10d6\u10d4 \u10d2\u10d0\u10d2\u10d6\u10d0\u10d5\u10dc\u10d8\u10da\u10d8\u10d0 \u10d5\u10d4\u10e0\u10d8\u10e4\u10d8\u10d9\u10d0\u10ea\u10d8\u10d8\u10e1 \u10da\u10d8\u10dc\u10d9\u10d8, \u10d2\u10d7\u10ee\u10dd\u10d5\u10d7 \u10d2\u10d0\u10ee\u10dc\u10d0\u10d7 \u10d2\u10d0\u10db\u10dd\u10d2\u10d6\u10d0\u10d5\u10dc\u10d8\u10da\u10d8 \u10da\u10d8\u10dc\u10d9\u10d8!",type:"error"}})})}static#e=this.\u0275fac=function(ne){return new(ne||Q)(p.Y36(H.so,8),p.Y36(H.WI),p.Y36(G.e),p.Y36(T.qu),p.Y36(Me.F0),p.Y36(fe.ux),p.Y36(be.zQ),p.Y36(Fe.KQ))};static#t=this.\u0275cmp=p.Xpm({type:Q,selectors:[["app-sign-up"]],decls:23,vars:21,consts:[[3,"formGroup","ngSubmit"],["appearance","outline"],["matInput","","value","Sushi","formControlName","email",3,"placeholder"],[4,"ngIf"],["matInput","","formControlName","password","value","Sushi",3,"placeholder"],["type","submit","mat-raised-button","","color","primary"]],template:function(ne,Ee){if(1&ne&&(p.TgZ(0,"form",0),p.NdJ("ngSubmit",function(){return Ee.onSignUp()}),p.TgZ(1,"h4"),p._uU(2),p.ALo(3,"translate"),p.qZA(),p.TgZ(4,"div")(5,"mat-form-field",1)(6,"mat-label"),p._uU(7),p.ALo(8,"translate"),p.qZA(),p._UZ(9,"input",2),p.ALo(10,"translate"),p.qZA(),p.YNc(11,j,3,2,"ng-container",3),p.qZA(),p.TgZ(12,"div")(13,"mat-form-field",1)(14,"mat-label"),p._uU(15),p.ALo(16,"translate"),p.qZA(),p._UZ(17,"input",4),p.ALo(18,"translate"),p.qZA(),p.YNc(19,Ce,3,2,"ng-container",3),p.qZA(),p.TgZ(20,"button",5),p._uU(21),p.ALo(22,"translate"),p.qZA()()),2&ne){let oe,xe;p.Q6J("formGroup",Ee.form),p.xp6(2),p.Oqu(p.lcZ(3,9,"signUp")),p.xp6(5),p.Oqu(p.lcZ(8,11,"email")),p.xp6(2),p.s9C("placeholder",p.lcZ(10,13,"email")),p.xp6(2),p.Q6J("ngIf",null==(oe=Ee.form.get("email"))?null:oe.dirty),p.xp6(4),p.Oqu(p.lcZ(16,15,"password")),p.xp6(2),p.s9C("placeholder",p.lcZ(18,17,"password")),p.xp6(2),p.Q6J("ngIf",null==(xe=Ee.form.get("password"))?null:xe.dirty),p.xp6(2),p.Oqu(p.lcZ(22,19,"signUp"))}},dependencies:[ie.O5,_e.lW,y.TO,y.KE,y.hX,x.Nt,T._Y,T.Fj,T.JJ,T.JL,T.sg,T.u,w.X$],styles:["form[_ngcontent-%COMP%]{width:100%}form[_ngcontent-%COMP%]   h4[_ngcontent-%COMP%]{margin:0 0 10px;text-align:center}form[_ngcontent-%COMP%]   div[_ngcontent-%COMP%]{width:100%}form[_ngcontent-%COMP%]   div[_ngcontent-%COMP%]   mat-form-field[_ngcontent-%COMP%]{width:100%}form[_ngcontent-%COMP%]   button[_ngcontent-%COMP%]{width:100%}"]})}return Q})()},330:(Qe,X,m)=>{m.d(X,{d:()=>de});var l=m(7398),T=m(5879),H=m(9209);const ee="/CourseOrder.json",g="/StuffOrder.json";let de=(()=>{class ${constructor(P){this.apiService=P}getStuffs(){return this.apiService.get("/AddNewStuff.json").pipe((0,l.U)(P=>{if(P){const p=[];for(const G in P)p.push({...P[G],key:G});return p}return[]}))}getCourses(){return this.apiService.get("/AddNewCourse.json").pipe((0,l.U)(P=>{if(P){const p=[];for(const G in P)p.push({...P[G],key:G});return p}return[]}))}buyCourse(P){return this.apiService.post(ee,P)}buyStuff(P){return this.apiService.post(g,P)}getOrderedCourse(){return this.apiService.get(ee).pipe((0,l.U)(P=>{if(P){const p=[];for(const G in P)p.push({...P[G],key:G});return p}return[]}))}getOrderedStuff(){return this.apiService.get(g).pipe((0,l.U)(P=>{if(P){const p=[];for(const G in P)p.push({...P[G],key:G});return p}return[]}))}static#e=this.\u0275fac=function(p){return new(p||$)(T.LFG(H.s))};static#t=this.\u0275prov=T.Yz7({token:$,factory:$.\u0275fac,providedIn:"root"})}return $})()},4351:(Qe,X,m)=>{m.d(X,{W:()=>l});class l{static formFieldsModeControl(H,J){Object.keys(J.controls).forEach(V=>{J.get(V)[H]({onlySelf:!0})})}}},7694:(Qe,X,m)=>{m.d(X,{$:()=>Pe});var l=m(5879),T=m(7394),H=m(9315),J=m(940),V=m(2959),ee=m(1498),g=m(4190),de=m(8189),$=m(1365),De=m(9758),P=m(4310),p=m(330),G=m(3980),Me=m(6814),fe=m(6223),be=m(1075),Fe=m(7841),ie=m(2916);const _e=function(){return["/logOut"]};function y(S,ce){if(1&S){const E=l.EpF();l.TgZ(0,"button",17),l.NdJ("click",function(){l.CHM(E);const O=l.oxw();return l.KtG(O.onLogOut())}),l._uU(1),l.ALo(2,"translate"),l.qZA()}2&S&&(l.Q6J("routerLink",l.DdM(4,_e)),l.xp6(1),l.hij(" ",l.lcZ(2,2,"logOut")," "))}const x=function(){return["/signUp"]};function w(S,ce){if(1&S){const E=l.EpF();l.TgZ(0,"button",17),l.NdJ("click",function(){l.CHM(E);const O=l.oxw();return l.KtG(O.loginSignUp("signUp"))}),l._uU(1),l.ALo(2,"translate"),l.qZA()}2&S&&(l.Q6J("routerLink",l.DdM(4,x)),l.xp6(1),l.hij(" ",l.lcZ(2,2,"signUp")," "))}const re=function(){return["/logIn"]};function L(S,ce){if(1&S){const E=l.EpF();l.TgZ(0,"button",17),l.NdJ("click",function(){l.CHM(E);const O=l.oxw();return l.KtG(O.loginSignUp("logIn"))}),l._uU(1),l.ALo(2,"translate"),l.qZA()}2&S&&(l.Q6J("routerLink",l.DdM(4,re)),l.xp6(1),l.hij(" ",l.lcZ(2,2,"logIn")," "))}function j(S,ce){if(1&S&&l._UZ(0,"span",20),2&S){const E=l.oxw(3);l.Q6J("matBadge",E.generalNotification)}}function c(S,ce){if(1&S&&(l.TgZ(0,"button",19),l._uU(1),l.ALo(2,"translate"),l.YNc(3,j,1,1,"span",13),l.qZA()),2&S){const E=l.oxw(2),Z=l.MAs(33);l.Q6J("matMenuTriggerFor",Z),l.xp6(1),l.hij(" ",l.lcZ(2,3,"admin")," "),l.xp6(2),l.Q6J("ngIf",E.generalNotification)}}function le(S,ce){if(1&S&&(l.TgZ(0,"button",19),l._uU(1),l.ALo(2,"translate"),l.qZA()),2&S){l.oxw(2);const E=l.MAs(66);l.Q6J("matMenuTriggerFor",E),l.xp6(1),l.hij(" ",l.lcZ(2,2,"my_page")," ")}}function Ce(S,ce){if(1&S&&(l.ynx(0),l.YNc(1,c,4,5,"button",18),l.YNc(2,le,3,4,"button",18),l.BQk()),2&S){const E=l.oxw();l.xp6(1),l.Q6J("ngIf",E.userState()),l.xp6(1),l.Q6J("ngIf",!E.userState())}}function Ze(S,ce){if(1&S&&l._UZ(0,"span",20),2&S){const E=l.oxw();l.Q6J("matBadge",null==E.orderedCourses?null:E.orderedCourses.length)}}function Q(S,ce){if(1&S&&l._UZ(0,"span",20),2&S){const E=l.oxw();l.Q6J("matBadge",null==E.orderedItems?null:E.orderedItems.length)}}function Ae(S,ce){if(1&S&&l._UZ(0,"span",20),2&S){const E=l.oxw();l.Q6J("matBadge",null==E.contact?null:E.contact.length)}}const M=function(){return["/lending"]},ne=function(){return["/courses"]},Ee=function(){return["/shop"]},oe=function(){return["/blog"]},xe=function(){return["/contact"]};let Pe=(()=>{class S{constructor(E,Z,O,Ke,U,nt,It){this.route=E,this.dialog=Z,this.translate=O,this.authService=Ke,this.languageService=U,this.shopService=nt,this.adminHttp=It,this.prise=15,this.subscriobtion$=new T.w0,this.userState=this.authService.userState,this.isUserLoggedInState=this.authService.isUserLoggedInState,this.authActions=[],this.adminBtns=[],this.userWorldBtns=[],this.pageName=this.route.snapshot.data.pageName,(0,l.cEC)(()=>{this.userState()&&this.returnNotifications()})}ngOnInit(){this.languageService.setLanguage(),this.selectedLang=this.languageService.defaultLang}returnNotifications(){this.observable$=(0,H.D)({orderedCourses:this.shopService.getOrderedCourse(),orderedItems:this.shopService.getOrderedStuff(),contact:this.adminHttp.getQuestions()}).pipe((0,J.d)()),this.subscriobtion$=this.observable$.subscribe(E=>{console.log(E),this.orderedCourses=E.orderedCourses,this.orderedItems=E.orderedItems,this.contact=E.contact,this.commonNotifications(E)})}commonNotifications(E){let Z=[],O=[E.orderedCourses,E.orderedItems,E.contact];for(const Ke of O){for(const U of Ke)Z.push(U);this.generalNotification=Z?.length}}ngOnDestroy(){this.subscriobtion$.unsubscribe()}onLogOut(){this.authService.logOut()}changeLang(E){localStorage.setItem("lang",E.value),this.translate.use(E.value)}loginSignUp(E){this.dialog.open({logIn:{component:V.D,width:"500px"},signUp:{component:ee.b,width:"500px"}}[E].component,{width:"500px",panelClass:"border-16"})}static#e=this.\u0275fac=function(Z){return new(Z||S)(l.Y36(g.gz),l.Y36(de.uw),l.Y36($.sK),l.Y36(De.e),l.Y36(P.T),l.Y36(p.d),l.Y36(G.r))};static#t=this.\u0275cmp=l.Xpm({type:S,selectors:[["app-layout"]],decls:78,vars:83,consts:[[1,"navbar-content"],[1,"navbar-inner"],[1,"navbar-title"],[1,"navbar-navigation"],[1,"navigation-inner"],["mat-button","",3,"routerLink"],[3,"ngModel","change","ngModelChange"],["value","ka",3,"selected"],["value","en",3,"selected"],["mat-button","",3,"routerLink","click",4,"ngIf"],[4,"ngIf"],["adminMenu","matMenu"],["mat-menu-item","",3,"routerLink"],["matBadgeColor","warn",3,"matBadge",4,"ngIf"],["simpleUser","matMenu"],[1,"page-name"],[1,"page-container"],["mat-button","",3,"routerLink","click"],["mat-button","",3,"matMenuTriggerFor",4,"ngIf"],["mat-button","",3,"matMenuTriggerFor"],["matBadgeColor","warn",3,"matBadge"]],template:function(Z,O){1&Z&&(l.TgZ(0,"div",0)(1,"div",1)(2,"div",2),l._uU(3),l.ALo(4,"translate"),l.qZA(),l.TgZ(5,"div",3)(6,"div",4)(7,"button",5),l._uU(8),l.ALo(9,"translate"),l.qZA(),l.TgZ(10,"button",5),l._uU(11),l.ALo(12,"translate"),l.qZA(),l.TgZ(13,"button",5),l._uU(14),l.ALo(15,"translate"),l.qZA(),l.TgZ(16,"button",5),l._uU(17),l.ALo(18,"translate"),l.qZA(),l.TgZ(19,"button",5),l._uU(20),l.ALo(21,"translate"),l.qZA(),l.TgZ(22,"span")(23,"select",6),l.NdJ("change",function(U){return O.changeLang(U.target)})("ngModelChange",function(U){return O.selectedLang=U}),l.TgZ(24,"option",7),l._uU(25,"KA"),l.qZA(),l.TgZ(26,"option",8),l._uU(27,"ENG"),l.qZA()(),l.YNc(28,y,3,5,"button",9),l.YNc(29,w,3,5,"button",9),l.YNc(30,L,3,5,"button",9),l.YNc(31,Ce,3,2,"ng-container",10),l.TgZ(32,"mat-menu",null,11),l.ynx(34),l.TgZ(35,"button",12),l._uU(36),l.ALo(37,"translate"),l.YNc(38,Ze,1,1,"span",13),l.qZA(),l.TgZ(39,"button",12),l._uU(40),l.ALo(41,"translate"),l.YNc(42,Q,1,1,"span",13),l.qZA(),l.TgZ(43,"button",12),l._uU(44),l.ALo(45,"translate"),l.qZA(),l.TgZ(46,"button",12),l._uU(47),l.ALo(48,"translate"),l.YNc(49,Ae,1,1,"span",13),l.qZA(),l.TgZ(50,"button",12),l._uU(51),l.ALo(52,"translate"),l.qZA(),l.TgZ(53,"button",12),l._uU(54),l.ALo(55,"translate"),l.qZA(),l.TgZ(56,"button",12),l._uU(57),l.ALo(58,"translate"),l.qZA(),l.TgZ(59,"button",12),l._uU(60),l.ALo(61,"translate"),l.qZA(),l.TgZ(62,"button",12),l._uU(63),l.ALo(64,"translate"),l.qZA(),l.BQk(),l.qZA(),l.TgZ(65,"mat-menu",null,14),l.ynx(67),l.TgZ(68,"button",12),l._uU(69),l.ALo(70,"translate"),l.qZA(),l.TgZ(71,"button",12),l._uU(72),l.ALo(73,"translate"),l.qZA(),l.BQk(),l.qZA()()()()(),l.TgZ(74,"div",15),l._uU(75),l.qZA(),l.TgZ(76,"div",16),l._UZ(77,"router-outlet"),l.qZA()()),2&Z&&(l.xp6(3),l.hij(" ",l.lcZ(4,44,"headerTitle")," "),l.xp6(4),l.Q6J("routerLink",l.DdM(78,M)),l.xp6(1),l.hij(" ",l.lcZ(9,46,"home")," "),l.xp6(2),l.Q6J("routerLink",l.DdM(79,ne)),l.xp6(1),l.hij(" ",l.lcZ(12,48,"courses")," "),l.xp6(2),l.Q6J("routerLink",l.DdM(80,Ee)),l.xp6(1),l.hij(" ",l.lcZ(15,50,"shop")," "),l.xp6(2),l.Q6J("routerLink",l.DdM(81,oe)),l.xp6(1),l.hij(" ",l.lcZ(18,52,"blog")," "),l.xp6(2),l.Q6J("routerLink",l.DdM(82,xe)),l.xp6(1),l.hij(" ",l.lcZ(21,54,"contact")," "),l.xp6(3),l.Q6J("ngModel",O.selectedLang),l.xp6(1),l.Q6J("selected","ka"==O.lang),l.xp6(2),l.Q6J("selected","en"==O.lang),l.xp6(2),l.Q6J("ngIf",O.isUserLoggedInState()),l.xp6(1),l.Q6J("ngIf",!O.isUserLoggedInState()),l.xp6(1),l.Q6J("ngIf",!O.isUserLoggedInState()),l.xp6(1),l.Q6J("ngIf",O.isUserLoggedInState()),l.xp6(4),l.Q6J("routerLink","/admin/admin-courses"),l.xp6(1),l.hij(" ",l.lcZ(37,56,"ordered_courses")," "),l.xp6(2),l.Q6J("ngIf",null==O.orderedCourses?null:O.orderedCourses.length),l.xp6(1),l.Q6J("routerLink","/admin/admin-pregnancy"),l.xp6(1),l.hij(" ",l.lcZ(41,58,"ordered_pregnancy_stuff")," "),l.xp6(2),l.Q6J("ngIf",null==O.orderedItems?null:O.orderedItems.length),l.xp6(1),l.Q6J("routerLink","/admin/admin-message"),l.xp6(1),l.hij(" ",l.lcZ(45,60,"customer_message")," "),l.xp6(2),l.Q6J("routerLink","/admin/admin-contact"),l.xp6(1),l.hij(" ",l.lcZ(48,62,"contact")," "),l.xp6(2),l.Q6J("ngIf",null==O.contact?null:O.contact.length),l.xp6(1),l.Q6J("routerLink","/admin/admin-message"),l.xp6(1),l.hij(" ",l.lcZ(52,64,"Patient_appointment")," "),l.xp6(2),l.Q6J("routerLink","/admin/admin-home"),l.xp6(1),l.hij(" ",l.lcZ(55,66,"home")," "),l.xp6(2),l.Q6J("routerLink","/admin/admin-about"),l.xp6(1),l.hij(" ",l.lcZ(58,68,"about")," "),l.xp6(2),l.Q6J("routerLink","/admin/admin-shop"),l.xp6(1),l.hij(" ",l.lcZ(61,70,"shop")," "),l.xp6(2),l.Q6J("routerLink","/admin/admin-blog"),l.xp6(1),l.hij(" ",l.lcZ(64,72,"blog")," "),l.xp6(5),l.Q6J("routerLink","/my-courses"),l.xp6(1),l.hij(" ",l.lcZ(70,74,"user_courses")," "),l.xp6(2),l.Q6J("routerLink","/my-communication"),l.xp6(1),l.hij(" ",l.lcZ(73,76,"user_communications")," "),l.xp6(3),l.hij("",O.pageName," >"))},dependencies:[Me.O5,g.lC,g.rH,fe.YN,fe.Kr,fe.EJ,fe.JJ,fe.On,be.lW,Fe.k,ie.VK,ie.OP,ie.p6,$.X$],styles:[".navbar-content[_ngcontent-%COMP%]{height:100%;position:relative}.navbar-content[_ngcontent-%COMP%]   .page-name[_ngcontent-%COMP%]{padding:20px}.navbar-content[_ngcontent-%COMP%]   .page-container[_ngcontent-%COMP%]{width:90%;margin:0 auto}.navbar-content[_ngcontent-%COMP%]   .footer[_ngcontent-%COMP%]{position:fixed;left:0;bottom:0;width:100%;height:200px;background-color:#fff;padding:20px;border:1px solid rgb(194,228,246)}.navbar-title[_ngcontent-%COMP%]{background-color:#c2e4f6;color:#000;text-align:center;width:100%;padding:10px 0}.navbar-navigation[_ngcontent-%COMP%]{display:flex;justify-content:center;width:100%}.navbar-navigation[_ngcontent-%COMP%]   .navigation-inner[_ngcontent-%COMP%]{padding:20px;background-color:#fff;width:100%}.navbar-navigation[_ngcontent-%COMP%]   .navigation-inner[_ngcontent-%COMP%]   span[_ngcontent-%COMP%]{float:right}.navbar-navigation[_ngcontent-%COMP%]   .navigation-inner[_ngcontent-%COMP%]   button[_ngcontent-%COMP%]{margin-right:16px}"]})}return S})()},4310:(Qe,X,m)=>{m.d(X,{T:()=>J});var l=m(5619),T=m(5879),H=m(1365);let J=(()=>{class V{constructor(g){this.translate=g,this.language=new l.X("")}get defaultLang(){return this.language.value}setLanguage(){const g=localStorage.getItem("lang");return g?(this.translate.use(g),this.language.next(g)):(this.translate.setDefaultLang("ka"),this.language.next("ka"))}static#e=this.\u0275fac=function(de){return new(de||V)(T.LFG(H.sK))};static#t=this.\u0275prov=T.Yz7({token:V,factory:V.\u0275fac,providedIn:"root"})}return V})()},7160:(Qe,X,m)=>{m.d(X,{b:()=>l});const l={estimate:/^(([1-9]\d{0,2}[,\/\.]\d{1,2}h?\s?|0+[,\/\.]([1-9]0?|0[1-9]){1,2}h?\s?)|0+h\s((0?[1-9]|[1-9]\d)m)\s?|([1-9]\d?)h\s?(([1-9]\d{0,2}?|0?\d{1,2})m)?\s?|[1-9]\d{0,2}h?\s?|(0?[1-9]|[1-9]\d)m\s?|[,\/\.]([1-9]0?|0[1-9]){1,2}h)$/,time:/^(((2+[0-3]|1+\d|[1-2]0?|[1-9])[,\/\.]\d{1,2}h?\s?|0+[,\/\.]([1-9]0?|0[1-9]){1,2}h?\s?)|0+h\s((\d?[1-9]|[1-9]0)m)|(2+[0-3]|1+\d|[1-2]0?|[1-9])h\s{0,2}(([1-9]\d{0,2}?|0?\d{1,2})m)?\s{0,2}|(2+[0-4]?|1+\d|[1-9])h?\s?|([1-9]\d?|0[1-9])m\s?|[,\/\.]([1-9]0?|0[1-9]){1,2}h)$/,timeInt:/^((\d+h)?\s{0,2}?(\d+m)?\s{0,2}?|\d+$)$/,timeFloat:/^(\d+[,\/\.]\d{0,2}h|[,\/\.]\d{0,2}h|\d+[,\/\.]\d+$)$/,timeHours:/^(([1-9]|1[0-9]|2[0-3])([,\/\.][0-9]{1,2})?|24)h?$/,timeAnyHours:/^(\d+([,\/\.][0-9]{1,2})?)h?$/,dateTime:/^\d{1,2}\/\w{3}\/\d{1,2}\s\d{1,2}:\d{1,2}\s[AP]{1}[M]{1}$/i,date:/^\d{2}\/\w{3}\/\d{2}/i,email:/^(([^<>()\[\]\\.,;:\s@"]+(\.[^<>()\[\]\\.,;:\s@"]+)*)|(".+"))@((\[[0-9]{1,3}\.[0-9]{1,3}\.[0-9]{1,3}\.[0-9]{1,3}])|(([a-zA-Z\-0-9]+\.)+[a-zA-Z]{2,}))$/,onlyNumbers:"[0-9]*",onlyNumbersAndLatinLetters:"[0-9a-zA-Z]*",onlyFiveLatin:"^[a-zA-Z]{1,5}$"}}}]);