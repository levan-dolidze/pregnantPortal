"use strict";(self.webpackChunkpregnantPortal=self.webpackChunkpregnantPortal||[]).push([[124],{6217:(Zt,xe,A)=>{A.d(xe,{nm:()=>Kt});var m=A(2122);A(4650),A(259);var ve=A(5861),Ve=A(9681),je=A(3475),lt=A(2090),F=A(1877);const we=new Map,Qe={activated:!1,tokenObservers:[]},It={initialized:!1,enabled:!1};function p(T){return we.get(T)||Object.assign({},Qe)}function be(){return It}const Ze="https://content-firebaseappcheck.googleapis.com/v1",Dt="exchangeDebugToken",nt={OFFSET_DURATION:3e5,RETRIAL_MIN_WAIT:3e4,RETRIAL_MAX_WAIT:96e4};class Ye{constructor(I,R,O,U,Y){if(this.operation=I,this.retryPolicy=R,this.getWaitDuration=O,this.lowerBound=U,this.upperBound=Y,this.pending=null,this.nextErrorWaitInterval=U,U>Y)throw new Error("Proactive refresh lower bound greater than upper bound!")}start(){this.nextErrorWaitInterval=this.lowerBound,this.process(!0).catch(()=>{})}stop(){this.pending&&(this.pending.reject("cancelled"),this.pending=null)}isRunning(){return!!this.pending}process(I){var R=this;return(0,ve.Z)(function*(){R.stop();try{R.pending=new lt.BH,yield function qe(T){return new Promise(I=>{setTimeout(I,T)})}(R.getNextRun(I)),R.pending.resolve(),yield R.pending.promise,R.pending=new lt.BH,yield R.operation(),R.pending.resolve(),yield R.pending.promise,R.process(!0).catch(()=>{})}catch(O){R.retryPolicy(O)?R.process(!1).catch(()=>{}):R.stop()}})()}getNextRun(I){if(I)return this.nextErrorWaitInterval=this.lowerBound,this.getWaitDuration();{const R=this.nextErrorWaitInterval;return this.nextErrorWaitInterval*=2,this.nextErrorWaitInterval>this.upperBound&&(this.nextErrorWaitInterval=this.upperBound),R}}}const Ne=new lt.LL("appCheck","AppCheck",{"already-initialized":"You have already called initializeAppCheck() for FirebaseApp {$appName} with different options. To avoid this error, call initializeAppCheck() with the same options as when it was originally called. This will return the already initialized instance.","use-before-activation":"App Check is being used before initializeAppCheck() is called for FirebaseApp {$appName}. Call initializeAppCheck() before instantiating other Firebase services.","fetch-network-error":"Fetch failed to connect to a network. Check Internet connection. Original error: {$originalErrorMessage}.","fetch-parse-error":"Fetch client could not parse response. Original error: {$originalErrorMessage}.","fetch-status-error":"Fetch server returned an HTTP error status. HTTP status: {$httpStatus}.","storage-open":"Error thrown when opening storage. Original error: {$originalErrorMessage}.","storage-get":"Error thrown when reading from storage. Original error: {$originalErrorMessage}.","storage-set":"Error thrown when writing to storage. Original error: {$originalErrorMessage}.","recaptcha-error":"ReCAPTCHA error.",throttled:"Requests throttled due to {$httpStatus} error. Attempts allowed again after {$time}"});function rt(T,I){return oe.apply(this,arguments)}function oe(){return(oe=(0,ve.Z)(function*({url:T,body:I},R){const O={"Content-Type":"application/json"},U=R.getImmediate({optional:!0});if(U){const Je=yield U.getHeartbeatsHeader();Je&&(O["X-Firebase-Client"]=Je)}const Y={method:"POST",body:JSON.stringify(I),headers:O};let K,q;try{K=yield fetch(T,Y)}catch(Je){throw Ne.create("fetch-network-error",{originalErrorMessage:Je?.message})}if(200!==K.status)throw Ne.create("fetch-status-error",{httpStatus:K.status});try{q=yield K.json()}catch(Je){throw Ne.create("fetch-parse-error",{originalErrorMessage:Je?.message})}const $=q.ttl.match(/^([\d.]+)(s)$/);if(!$||!$[2]||isNaN(Number($[1])))throw Ne.create("fetch-parse-error",{originalErrorMessage:`ttl field (timeToLive) is not in standard Protobuf Duration format: ${q.ttl}`});const St=1e3*Number($[1]),ge=Date.now();return{token:q.token,expireTimeMillis:ge+St,issuedAtTimeMillis:ge}})).apply(this,arguments)}const ee="firebase-app-check-database",ot=1,We="firebase-app-check-store";let V=null;function et(T,I){return Ee.apply(this,arguments)}function Ee(){return(Ee=(0,ve.Z)(function*(T,I){const O=(yield function X(){return V||(V=new Promise((T,I)=>{try{const R=indexedDB.open(ee,ot);R.onsuccess=O=>{T(O.target.result)},R.onerror=O=>{var U;I(Ne.create("storage-open",{originalErrorMessage:null===(U=O.target.error)||void 0===U?void 0:U.message}))},R.onupgradeneeded=O=>{0===O.oldVersion&&O.target.result.createObjectStore(We,{keyPath:"compositeKey"})}}catch(R){I(Ne.create("storage-open",{originalErrorMessage:R?.message}))}}),V)}()).transaction(We,"readwrite"),Y=O.objectStore(We).put({compositeKey:T,value:I});return new Promise((K,q)=>{Y.onsuccess=$=>{K()},O.onerror=$=>{var St;q(Ne.create("storage-set",{originalErrorMessage:null===(St=$.target.error)||void 0===St?void 0:St.message}))}})})).apply(this,arguments)}const Et=new F.Yd("@firebase/app-check");function _n(T,I){return(0,lt.hl)()?function z(T,I){return et(function He(T){return`${T.options.appId}-${T.name}`}(T),I)}(T,I).catch(R=>{Et.warn(`Failed to write token to IndexedDB. Error: ${R}`)}):Promise.resolve()}function Tt(){return wn.apply(this,arguments)}function wn(){return(wn=(0,ve.Z)(function*(){const T=be();if(T.enabled&&T.token)return T.token.promise;throw Error("\n            Can't get debug token in production mode.\n        ")})).apply(this,arguments)}const bt={error:"UNKNOWN_ERROR"};function Gt(T){return lt.US.encodeString(JSON.stringify(T),!1)}function Ct(T){return gt.apply(this,arguments)}function gt(){return(gt=(0,ve.Z)(function*(T,I=!1){const R=T.app;!function ye(T){if(!p(T).activated)throw Ne.create("use-before-activation",{appName:T.name})}(R);const O=p(R);let Y,U=O.token;if(U&&!k(U)&&(O.token=void 0,U=void 0),!U){const $=yield O.cachedTokenPromise;$&&(k($)?U=$:yield _n(R,void 0))}if(!I&&U&&k(U))return{token:U.token};let q,K=!1;if(function gn(){return be().enabled}()){O.exchangeTokenPromise||(O.exchangeTokenPromise=rt(function Ke(T,I){const{projectId:R,appId:O,apiKey:U}=T.options;return{url:`${Ze}/projects/${R}/apps/${O}:${Dt}?key=${U}`,body:{debug_token:I}}}(R,yield Tt()),T.heartbeatServiceProvider).finally(()=>{O.exchangeTokenPromise=void 0}),K=!0);const $=yield O.exchangeTokenPromise;return yield _n(R,$),O.token=$,{token:$.token}}try{O.exchangeTokenPromise||(O.exchangeTokenPromise=O.provider.getToken().finally(()=>{O.exchangeTokenPromise=void 0}),K=!0),U=yield p(R).exchangeTokenPromise}catch($){"appCheck/throttled"===$.code?Et.warn($.message):Et.error($),Y=$}return U?Y?q=k(U)?{token:U.token,internalError:Y}:E(Y):(q={token:U.token},O.token=U,yield _n(R,U)):q=E(Y),K&&function xt(T,I){const R=p(T).tokenObservers;for(const O of R)try{"EXTERNAL"===O.type&&null!=I.error?O.error(I.error):O.next(I)}catch{}}(R,q),q})).apply(this,arguments)}function Rn(T,I){const R=p(T),O=R.tokenObservers.filter(U=>U.next!==I);0===O.length&&R.tokenRefresher&&R.tokenRefresher.isRunning()&&R.tokenRefresher.stop(),R.tokenObservers=O}function un(T){const{app:I}=T,R=p(I);let O=R.tokenRefresher;O||(O=function Xt(T){const{app:I}=T;return new Ye((0,ve.Z)(function*(){let O;if(O=p(I).token?yield Ct(T,!0):yield Ct(T),O.error)throw O.error;if(O.internalError)throw O.internalError}),()=>!0,()=>{const R=p(I);if(R.token){let O=R.token.issuedAtTimeMillis+.5*(R.token.expireTimeMillis-R.token.issuedAtTimeMillis)+3e5;return O=Math.min(O,R.token.expireTimeMillis-3e5),Math.max(0,O-Date.now())}return 0},nt.RETRIAL_MIN_WAIT,nt.RETRIAL_MAX_WAIT)}(T),R.tokenRefresher=O),!O.isRunning()&&R.isTokenAutoRefreshEnabled&&O.start()}function k(T){return T.expireTimeMillis-Date.now()>0}function E(T){return{token:Gt(bt),error:T}}class y{constructor(I,R){this.app=I,this.heartbeatServiceProvider=R}_delete(){const{tokenObservers:I}=p(this.app);for(const R of I)Rn(this.app,R.next);return Promise.resolve()}}const mn="app-check-internal";!function jr(){(0,Ve._registerComponent)(new je.wA("app-check",T=>function x(T,I){return new y(T,I)}(T.getProvider("app").getImmediate(),T.getProvider("heartbeat")),"PUBLIC").setInstantiationMode("EXPLICIT").setInstanceCreatedCallback((T,I,R)=>{T.getProvider(mn).initialize()})),(0,Ve._registerComponent)(new je.wA(mn,T=>function B(T){return{getToken:I=>Ct(T,I),addTokenListener:I=>function dt(T,I,R,O){const{app:U}=T,Y=p(U);if(Y.tokenObservers=[...Y.tokenObservers,{next:R,error:O,type:I}],Y.token&&k(Y.token)){const q=Y.token;Promise.resolve().then(()=>{R({token:q.token}),un(T)}).catch(()=>{})}Y.cachedTokenPromise.then(()=>un(T))}(T,"INTERNAL",I),removeTokenListener:I=>Rn(T.app,I)}}(T.getProvider("app-check").getImmediate()),"PUBLIC").setInstantiationMode("EXPLICIT")),(0,Ve.registerVersion)("@firebase/app-check","0.6.4")}();class Kt{constructor(){return(0,m.vb)("app-check")}}typeof window<"u"&&window},3385:(Zt,xe,A)=>{A.d(xe,{zQ:()=>p,rT:()=>F,f7:()=>Qe,L6:()=>je,_Q:()=>lt,lh:()=>we,Qv:()=>Ve,nw:()=>It});var m=A(4650),w=A(7579),C=A(9646),J=A(9751),D=A(8996),ie=A(6451),W=A(5363),G=A(3900),me=A(4004),ct=A(3151),ae=A(590),he=A(576);function Ae(be,Ze){return(0,he.m)(Ze)?(0,G.w)(()=>be,Ze):(0,G.w)(()=>be)}var Te=A(9468),Le=A(9300),_=A(2122),pe=A(2011),ze=A(6895),at=A(6217);A(9260);const Ve=new m.OlP("angularfire2.auth.use-emulator"),je=new m.OlP("angularfire2.auth.settings"),lt=new m.OlP("angularfire2.auth.tenant-id"),F=new m.OlP("angularfire2.auth.langugage-code"),we=new m.OlP("angularfire2.auth.use-device-language"),Qe=new m.OlP("angularfire.auth.persistence"),It=(be,Ze,Re,ft,Dt,nt,Me,Ye)=>(0,pe.cc)(`${be.name}.auth`,"AngularFireAuth",be.name,()=>{const qe=Ze.runOutsideAngular(()=>be.auth());if(Re&&qe.useEmulator(...Re),ft&&(qe.tenantId=ft),qe.languageCode=Dt,nt&&qe.useDeviceLanguage(),Me)for(const[it,Ne]of Object.entries(Me))qe.settings[it]=Ne;return Ye&&qe.setPersistence(Ye),qe},[Re,ft,Dt,nt,Me,Ye]);let p=(()=>{class be{constructor(Re,ft,Dt,nt,Me,Ye,qe,it,Ne,ce,ye,Xe){const pt=new w.x,rt=(0,C.of)(void 0).pipe((0,W.Q)(Me.outsideAngular),(0,G.w)(()=>nt.runOutsideAngular(()=>Promise.resolve().then(A.bind(A,9568)))),(0,me.U)(()=>(0,pe.on)(Re,nt,ft)),(0,me.U)(oe=>It(oe,nt,Ye,it,Ne,ce,qe,ye)),(0,ct.d)({bufferSize:1,refCount:!1}));if((0,ze.PM)(Dt))this.authState=this.user=this.idToken=this.idTokenResult=this.credential=(0,C.of)(null);else{rt.pipe((0,ae.P)()).subscribe();const st=rt.pipe((0,G.w)(ee=>ee.getRedirectResult().then(ot=>ot,()=>null)),_.iC,(0,ct.d)({bufferSize:1,refCount:!1})),_t=rt.pipe((0,G.w)(ee=>new J.y(ot=>({unsubscribe:nt.runOutsideAngular(()=>ee.onAuthStateChanged(We=>ot.next(We),We=>ot.error(We),()=>ot.complete()))})))),Ke=rt.pipe((0,G.w)(ee=>new J.y(ot=>({unsubscribe:nt.runOutsideAngular(()=>ee.onIdTokenChanged(We=>ot.next(We),We=>ot.error(We),()=>ot.complete()))}))));this.authState=st.pipe(Ae(_t),(0,Te.R)(Me.outsideAngular),(0,W.Q)(Me.insideAngular)),this.user=st.pipe(Ae(Ke),(0,Te.R)(Me.outsideAngular),(0,W.Q)(Me.insideAngular)),this.idToken=this.user.pipe((0,G.w)(ee=>ee?(0,D.D)(ee.getIdToken()):(0,C.of)(null))),this.idTokenResult=this.user.pipe((0,G.w)(ee=>ee?(0,D.D)(ee.getIdTokenResult()):(0,C.of)(null))),this.credential=(0,ie.T)(st,pt,this.authState.pipe((0,Le.h)(ee=>!ee))).pipe((0,me.U)(ee=>ee?.user?ee:null),(0,Te.R)(Me.outsideAngular),(0,W.Q)(Me.insideAngular))}return(0,pe.pX)(this,rt,nt,{spy:{apply:(oe,st,_t)=>{(oe.startsWith("signIn")||oe.startsWith("createUser"))&&_t.then(Ke=>pt.next(Ke))}}})}}return be.\u0275fac=function(Re){return new(Re||be)(m.LFG(pe.Dh),m.LFG(pe.xv,8),m.LFG(m.Lbi),m.LFG(m.R0b),m.LFG(_.HU),m.LFG(Ve,8),m.LFG(je,8),m.LFG(lt,8),m.LFG(F,8),m.LFG(we,8),m.LFG(Qe,8),m.LFG(at.nm,8))},be.\u0275prov=m.Yz7({token:be,factory:be.\u0275fac,providedIn:"any"}),be})()},8401:(Zt,xe,A)=>{A.d(xe,{$:()=>aa,A:()=>ae,B:()=>Te,G:()=>vi,H:()=>cn,J:()=>I,L:()=>un,M:()=>re,N:()=>Lt,P:()=>Fa,Q:()=>ia,R:()=>xa,T:()=>ra,U:()=>On,V:()=>ei,W:()=>Si,X:()=>oa,Y:()=>gr,Z:()=>es,_:()=>Ln,a:()=>Wi,a0:()=>Er,a1:()=>ni,a2:()=>Pi,a3:()=>ao,a4:()=>la,a5:()=>rs,a6:()=>os,a7:()=>lo,a8:()=>bi,a9:()=>Ni,aA:()=>Xt,aB:()=>$i,aC:()=>xo,aD:()=>Va,aE:()=>tt,aI:()=>Qt,aL:()=>Dn,aa:()=>ua,ab:()=>ca,ac:()=>da,af:()=>fa,ag:()=>uo,ah:()=>co,ak:()=>fr,al:()=>ga,an:()=>va,ao:()=>Mi,ap:()=>Qe,aq:()=>Oe,ar:()=>te,as:()=>Se,at:()=>qi,au:()=>Bo,av:()=>ut,aw:()=>ve,ax:()=>F,ay:()=>Uo,az:()=>p,b:()=>Bt,c:()=>Do,d:()=>Mr,e:()=>En,f:()=>Za,g:()=>Lo,h:()=>Ha,i:()=>Zi,j:()=>Ur,k:()=>Nt,l:()=>bo,m:()=>Hr,n:()=>Xi,o:()=>G,r:()=>No,s:()=>Ma,u:()=>Dr});var m=A(5861),w=A(2090),C=A(9681),J=A(1877),D=A(655),ie=A(3475);const G={FACEBOOK:"facebook.com",GITHUB:"github.com",GOOGLE:"google.com",PASSWORD:"password",PHONE:"phone",TWITTER:"twitter.com"},ae={EMAIL_SIGNIN:"EMAIL_SIGNIN",PASSWORD_RESET:"PASSWORD_RESET",RECOVER_EMAIL:"RECOVER_EMAIL",REVERT_SECOND_FACTOR_ADDITION:"REVERT_SECOND_FACTOR_ADDITION",VERIFY_AND_CHANGE_EMAIL:"VERIFY_AND_CHANGE_EMAIL",VERIFY_EMAIL:"VERIFY_EMAIL"};const Te=function he(){return{"admin-restricted-operation":"This operation is restricted to administrators only.","argument-error":"","app-not-authorized":"This app, identified by the domain where it's hosted, is not authorized to use Firebase Authentication with the provided API key. Review your key configuration in the Google API console.","app-not-installed":"The requested mobile application corresponding to the identifier (Android package name or iOS bundle ID) provided is not installed on this device.","captcha-check-failed":"The reCAPTCHA response token provided is either invalid, expired, already used or the domain associated with it does not match the list of whitelisted domains.","code-expired":"The SMS code has expired. Please re-send the verification code to try again.","cordova-not-ready":"Cordova framework is not ready.","cors-unsupported":"This browser is not supported.","credential-already-in-use":"This credential is already associated with a different user account.","custom-token-mismatch":"The custom token corresponds to a different audience.","requires-recent-login":"This operation is sensitive and requires recent authentication. Log in again before retrying this request.","dependent-sdk-initialized-before-auth":"Another Firebase SDK was initialized and is trying to use Auth before Auth is initialized. Please be sure to call `initializeAuth` or `getAuth` before starting any other Firebase SDK.","dynamic-link-not-activated":"Please activate Dynamic Links in the Firebase Console and agree to the terms and conditions.","email-change-needs-verification":"Multi-factor users must always have a verified email.","email-already-in-use":"The email address is already in use by another account.","emulator-config-failed":'Auth instance has already been used to make a network call. Auth can no longer be configured to use the emulator. Try calling "connectAuthEmulator()" sooner.',"expired-action-code":"The action code has expired.","cancelled-popup-request":"This operation has been cancelled due to another conflicting popup being opened.","internal-error":"An internal AuthError has occurred.","invalid-app-credential":"The phone verification request contains an invalid application verifier. The reCAPTCHA token response is either invalid or expired.","invalid-app-id":"The mobile app identifier is not registed for the current project.","invalid-user-token":"This user's credential isn't valid for this project. This can happen if the user's token has been tampered with, or if the user isn't for the project associated with this API key.","invalid-auth-event":"An internal AuthError has occurred.","invalid-verification-code":"The SMS verification code used to create the phone auth credential is invalid. Please resend the verification code sms and be sure to use the verification code provided by the user.","invalid-continue-uri":"The continue URL provided in the request is invalid.","invalid-cordova-configuration":"The following Cordova plugins must be installed to enable OAuth sign-in: cordova-plugin-buildinfo, cordova-universal-links-plugin, cordova-plugin-browsertab, cordova-plugin-inappbrowser and cordova-plugin-customurlscheme.","invalid-custom-token":"The custom token format is incorrect. Please check the documentation.","invalid-dynamic-link-domain":"The provided dynamic link domain is not configured or authorized for the current project.","invalid-email":"The email address is badly formatted.","invalid-emulator-scheme":"Emulator URL must start with a valid scheme (http:// or https://).","invalid-api-key":"Your API key is invalid, please check you have copied it correctly.","invalid-cert-hash":"The SHA-1 certificate hash provided is invalid.","invalid-credential":"The supplied auth credential is malformed or has expired.","invalid-message-payload":"The email template corresponding to this action contains invalid characters in its message. Please fix by going to the Auth email templates section in the Firebase Console.","invalid-multi-factor-session":"The request does not contain a valid proof of first factor successful sign-in.","invalid-oauth-provider":"EmailAuthProvider is not supported for this operation. This operation only supports OAuth providers.","invalid-oauth-client-id":"The OAuth client ID provided is either invalid or does not match the specified API key.","unauthorized-domain":"This domain is not authorized for OAuth operations for your Firebase project. Edit the list of authorized domains from the Firebase console.","invalid-action-code":"The action code is invalid. This can happen if the code is malformed, expired, or has already been used.","wrong-password":"The password is invalid or the user does not have a password.","invalid-persistence-type":"The specified persistence type is invalid. It can only be local, session or none.","invalid-phone-number":"The format of the phone number provided is incorrect. Please enter the phone number in a format that can be parsed into E.164 format. E.164 phone numbers are written in the format [+][country code][subscriber number including area code].","invalid-provider-id":"The specified provider ID is invalid.","invalid-recipient-email":"The email corresponding to this action failed to send as the provided recipient email address is invalid.","invalid-sender":"The email template corresponding to this action contains an invalid sender email or name. Please fix by going to the Auth email templates section in the Firebase Console.","invalid-verification-id":"The verification ID used to create the phone auth credential is invalid.","invalid-tenant-id":"The Auth instance's tenant ID is invalid.","login-blocked":"Login blocked by user-provided method: {$originalMessage}","missing-android-pkg-name":"An Android Package Name must be provided if the Android App is required to be installed.","auth-domain-config-required":"Be sure to include authDomain when calling firebase.initializeApp(), by following the instructions in the Firebase console.","missing-app-credential":"The phone verification request is missing an application verifier assertion. A reCAPTCHA response token needs to be provided.","missing-verification-code":"The phone auth credential was created with an empty SMS verification code.","missing-continue-uri":"A continue URL must be provided in the request.","missing-iframe-start":"An internal AuthError has occurred.","missing-ios-bundle-id":"An iOS Bundle ID must be provided if an App Store ID is provided.","missing-or-invalid-nonce":"The request does not contain a valid nonce. This can occur if the SHA-256 hash of the provided raw nonce does not match the hashed nonce in the ID token payload.","missing-multi-factor-info":"No second factor identifier is provided.","missing-multi-factor-session":"The request is missing proof of first factor successful sign-in.","missing-phone-number":"To send verification codes, provide a phone number for the recipient.","missing-verification-id":"The phone auth credential was created with an empty verification ID.","app-deleted":"This instance of FirebaseApp has been deleted.","multi-factor-info-not-found":"The user does not have a second factor matching the identifier provided.","multi-factor-auth-required":"Proof of ownership of a second factor is required to complete sign-in.","account-exists-with-different-credential":"An account already exists with the same email address but different sign-in credentials. Sign in using a provider associated with this email address.","network-request-failed":"A network AuthError (such as timeout, interrupted connection or unreachable host) has occurred.","no-auth-event":"An internal AuthError has occurred.","no-such-provider":"User was not linked to an account with the given provider.","null-user":"A null user object was provided as the argument for an operation which requires a non-null user object.","operation-not-allowed":"The given sign-in provider is disabled for this Firebase project. Enable it in the Firebase console, under the sign-in method tab of the Auth section.","operation-not-supported-in-this-environment":'This operation is not supported in the environment this application is running on. "location.protocol" must be http, https or chrome-extension and web storage must be enabled.',"popup-blocked":"Unable to establish a connection with the popup. It may have been blocked by the browser.","popup-closed-by-user":"The popup has been closed by the user before finalizing the operation.","provider-already-linked":"User can only be linked to one identity for the given provider.","quota-exceeded":"The project's quota for this operation has been exceeded.","redirect-cancelled-by-user":"The redirect operation has been cancelled by the user before finalizing.","redirect-operation-pending":"A redirect sign-in operation is already pending.","rejected-credential":"The request contains malformed or mismatching credentials.","second-factor-already-in-use":"The second factor is already enrolled on this account.","maximum-second-factor-count-exceeded":"The maximum allowed number of second factors on a user has been exceeded.","tenant-id-mismatch":"The provided tenant ID does not match the Auth instance's tenant ID",timeout:"The operation has timed out.","user-token-expired":"The user's credential is no longer valid. The user must sign in again.","too-many-requests":"We have blocked all requests from this device due to unusual activity. Try again later.","unauthorized-continue-uri":"The domain of the continue URL is not whitelisted.  Please whitelist the domain in the Firebase console.","unsupported-first-factor":"Enrolling a second factor or signing in with a multi-factor account requires sign-in with a supported first factor.","unsupported-persistence-type":"The current environment does not support the specified persistence type.","unsupported-tenant-operation":"This operation is not supported in a multi-tenant context.","unverified-email":"The operation requires a verified email.","user-cancelled":"The user did not grant your application the permissions it requested.","user-not-found":"There is no user record corresponding to this identifier. The user may have been deleted.","user-disabled":"The user account has been disabled by an administrator.","user-mismatch":"The supplied credentials do not correspond to the previously signed in user.","user-signed-out":"","weak-password":"The password must be 6 characters long or more.","web-storage-unsupported":"This browser is not supported or 3rd party cookies and data may be disabled.","already-initialized":"initializeAuth() has already been called with different options. To avoid this error, call initializeAuth() with the same options as when it was originally called, or call getAuth() to return the already initialized instance."}},Le=function Ae(){return{"dependent-sdk-initialized-before-auth":"Another Firebase SDK was initialized and is trying to use Auth before Auth is initialized. Please be sure to call `initializeAuth` or `getAuth` before starting any other Firebase SDK."}},_=new w.LL("auth","Firebase",{"dependent-sdk-initialized-before-auth":"Another Firebase SDK was initialized and is trying to use Auth before Auth is initialized. Please be sure to call `initializeAuth` or `getAuth` before starting any other Firebase SDK."}),ze=new J.Yd("@firebase/auth");function at(a,...r){ze.logLevel<=J.in.ERROR&&ze.error(`Auth (${C.SDK_VERSION}): ${a}`,...r)}function Se(a,...r){throw lt(a,...r)}function ve(a,...r){return lt(a,...r)}function Ve(a,r,s){const l=Object.assign(Object.assign({},Le()),{[r]:s});return new w.LL("auth","Firebase",l).create(r,{appName:a.name})}function je(a,r,s){if(!(r instanceof s))throw s.name!==r.constructor.name&&Se(a,"argument-error"),Ve(a,"argument-error",`Type of ${r.constructor.name} does not match expected instance.Did you pass a reference from a different Auth SDK?`)}function lt(a,...r){if("string"!=typeof a){const s=r[0],l=[...r.slice(1)];return l[0]&&(l[0].appName=a.name),a._errorFactory.create(s,...l)}return _.create(a,...r)}function F(a,r,...s){if(!a)throw lt(r,...s)}function we(a){const r="INTERNAL ASSERTION FAILED: "+a;throw at(r),new Error(r)}function Qe(a,r){a||we(r)}const It=new Map;function p(a){Qe(a instanceof Function,"Expected a class definition");let r=It.get(a);return r?(Qe(r instanceof a,"Instance stored in cache mismatched with class"),r):(r=new a,It.set(a,r),r)}function Ze(){var a;return typeof self<"u"&&(null===(a=self.location)||void 0===a?void 0:a.href)||""}function Re(){return"http:"===ft()||"https:"===ft()}function ft(){var a;return typeof self<"u"&&(null===(a=self.location)||void 0===a?void 0:a.protocol)||null}class Me{constructor(r,s){this.shortDelay=r,this.longDelay=s,Qe(s>r,"Short delay should be less than long delay!"),this.isMobile=(0,w.uI)()||(0,w.b$)()}get(){return function Dt(){return!(typeof navigator<"u"&&navigator&&"onLine"in navigator&&"boolean"==typeof navigator.onLine&&(Re()||(0,w.ru)()||"connection"in navigator))||navigator.onLine}()?this.isMobile?this.longDelay:this.shortDelay:Math.min(5e3,this.shortDelay)}}function Ye(a,r){Qe(a.emulator,"Emulator should always be set here");const{url:s}=a.emulator;return r?`${s}${r.startsWith("/")?r.slice(1):r}`:s}class qe{static initialize(r,s,l){this.fetchImpl=r,s&&(this.headersImpl=s),l&&(this.responseImpl=l)}static fetch(){return this.fetchImpl?this.fetchImpl:typeof self<"u"&&"fetch"in self?self.fetch:void we("Could not find fetch implementation, make sure you call FetchProvider.initialize() with an appropriate polyfill")}static headers(){return this.headersImpl?this.headersImpl:typeof self<"u"&&"Headers"in self?self.Headers:void we("Could not find Headers implementation, make sure you call FetchProvider.initialize() with an appropriate polyfill")}static response(){return this.responseImpl?this.responseImpl:typeof self<"u"&&"Response"in self?self.Response:void we("Could not find Response implementation, make sure you call FetchProvider.initialize() with an appropriate polyfill")}}const it={CREDENTIAL_MISMATCH:"custom-token-mismatch",MISSING_CUSTOM_TOKEN:"internal-error",INVALID_IDENTIFIER:"invalid-email",MISSING_CONTINUE_URI:"internal-error",INVALID_PASSWORD:"wrong-password",MISSING_PASSWORD:"internal-error",EMAIL_EXISTS:"email-already-in-use",PASSWORD_LOGIN_DISABLED:"operation-not-allowed",INVALID_IDP_RESPONSE:"invalid-credential",INVALID_PENDING_TOKEN:"invalid-credential",FEDERATED_USER_ID_ALREADY_LINKED:"credential-already-in-use",MISSING_REQ_TYPE:"internal-error",EMAIL_NOT_FOUND:"user-not-found",RESET_PASSWORD_EXCEED_LIMIT:"too-many-requests",EXPIRED_OOB_CODE:"expired-action-code",INVALID_OOB_CODE:"invalid-action-code",MISSING_OOB_CODE:"internal-error",CREDENTIAL_TOO_OLD_LOGIN_AGAIN:"requires-recent-login",INVALID_ID_TOKEN:"invalid-user-token",TOKEN_EXPIRED:"user-token-expired",USER_NOT_FOUND:"user-token-expired",TOO_MANY_ATTEMPTS_TRY_LATER:"too-many-requests",INVALID_CODE:"invalid-verification-code",INVALID_SESSION_INFO:"invalid-verification-id",INVALID_TEMPORARY_PROOF:"invalid-credential",MISSING_SESSION_INFO:"missing-verification-id",SESSION_EXPIRED:"code-expired",MISSING_ANDROID_PACKAGE_NAME:"missing-android-pkg-name",UNAUTHORIZED_DOMAIN:"unauthorized-continue-uri",INVALID_OAUTH_CLIENT_ID:"invalid-oauth-client-id",ADMIN_ONLY_OPERATION:"admin-restricted-operation",INVALID_MFA_PENDING_CREDENTIAL:"invalid-multi-factor-session",MFA_ENROLLMENT_NOT_FOUND:"multi-factor-info-not-found",MISSING_MFA_ENROLLMENT_ID:"missing-multi-factor-info",MISSING_MFA_PENDING_CREDENTIAL:"missing-multi-factor-session",SECOND_FACTOR_EXISTS:"second-factor-already-in-use",SECOND_FACTOR_LIMIT_EXCEEDED:"maximum-second-factor-count-exceeded",BLOCKING_FUNCTION_ERROR_RESPONSE:"internal-error"},Ne=new Me(3e4,6e4);function ce(a,r){return a.tenantId&&!r.tenantId?Object.assign(Object.assign({},r),{tenantId:a.tenantId}):r}function ye(a,r,s,l){return Xe.apply(this,arguments)}function Xe(){return(Xe=(0,m.Z)(function*(a,r,s,l,d={}){return pt(a,d,(0,m.Z)(function*(){let f={},S={};l&&("GET"===r?S=l:f={body:JSON.stringify(l)});const M=(0,w.xO)(Object.assign({key:a.config.apiKey},S)).slice(1),H=yield a._getAdditionalHeaders();return H["Content-Type"]="application/json",a.languageCode&&(H["X-Firebase-Locale"]=a.languageCode),qe.fetch()(_t(a,a.config.apiHost,s,M),Object.assign({method:r,headers:H,referrerPolicy:"no-referrer"},f))}))})).apply(this,arguments)}function pt(a,r,s){return rt.apply(this,arguments)}function rt(){return(rt=(0,m.Z)(function*(a,r,s){a._canInitEmulator=!1;const l=Object.assign(Object.assign({},it),r);try{const d=new Ke(a),f=yield Promise.race([s(),d.promise]);d.clearNetworkTimeout();const S=yield f.json();if("needConfirmation"in S)throw ee(a,"account-exists-with-different-credential",S);if(f.ok&&!("errorMessage"in S))return S;{const M=f.ok?S.errorMessage:S.error.message,[H,j]=M.split(" : ");if("FEDERATED_USER_ID_ALREADY_LINKED"===H)throw ee(a,"credential-already-in-use",S);if("EMAIL_EXISTS"===H)throw ee(a,"email-already-in-use",S);if("USER_DISABLED"===H)throw ee(a,"user-disabled",S);const se=l[H]||H.toLowerCase().replace(/[_\s]+/g,"-");if(j)throw Ve(a,se,j);Se(a,se)}}catch(d){if(d instanceof w.ZR)throw d;Se(a,"internal-error",{message:String(d)})}})).apply(this,arguments)}function oe(a,r,s,l){return st.apply(this,arguments)}function st(){return(st=(0,m.Z)(function*(a,r,s,l,d={}){const f=yield ye(a,r,s,l,d);return"mfaPendingCredential"in f&&Se(a,"multi-factor-auth-required",{_serverResponse:f}),f})).apply(this,arguments)}function _t(a,r,s,l){const d=`${r}${s}?${l}`;return a.config.emulator?Ye(a.config,d):`${a.config.apiScheme}://${d}`}class Ke{constructor(r){this.auth=r,this.timer=null,this.promise=new Promise((s,l)=>{this.timer=setTimeout(()=>l(ve(this.auth,"network-request-failed")),Ne.get())})}clearNetworkTimeout(){clearTimeout(this.timer)}}function ee(a,r,s){const l={appName:a.name};s.email&&(l.email=s.email),s.phoneNumber&&(l.phoneNumber=s.phoneNumber);const d=ve(a,r,l);return d.customData._tokenResponse=s,d}function We(){return(We=(0,m.Z)(function*(a,r){return ye(a,"POST","/v1/accounts:delete",r)})).apply(this,arguments)}function V(){return(V=(0,m.Z)(function*(a,r){return ye(a,"POST","/v1/accounts:update",r)})).apply(this,arguments)}function N(){return(N=(0,m.Z)(function*(a,r){return ye(a,"POST","/v1/accounts:lookup",r)})).apply(this,arguments)}function z(a){if(a)try{const r=new Date(Number(a));if(!isNaN(r.getTime()))return r.toUTCString()}catch{}}function et(){return(et=(0,m.Z)(function*(a,r=!1){const s=(0,w.m9)(a),l=yield s.getIdToken(r),d=kt(l);F(d&&d.exp&&d.auth_time&&d.iat,s.auth,"internal-error");const f="object"==typeof d.firebase?d.firebase:void 0,S=f?.sign_in_provider;return{claims:d,token:l,authTime:z(Ee(d.auth_time)),issuedAtTime:z(Ee(d.iat)),expirationTime:z(Ee(d.exp)),signInProvider:S||null,signInSecondFactor:f?.sign_in_second_factor||null}})).apply(this,arguments)}function Ee(a){return 1e3*Number(a)}function kt(a){const[r,s,l]=a.split(".");if(void 0===r||void 0===s||void 0===l)return at("JWT malformed, contained fewer than 3 sections"),null;try{const d=(0,w.tV)(s);return d?JSON.parse(d):(at("Failed to decode base64 JWT payload"),null)}catch(d){return at("Caught error parsing JWT payload as JSON",d?.toString()),null}}function He(a,r){return Et.apply(this,arguments)}function Et(){return(Et=(0,m.Z)(function*(a,r,s=!1){if(s)return r;try{return yield r}catch(l){throw l instanceof w.ZR&&function An({code:a}){return"auth/user-disabled"===a||"auth/user-token-expired"===a}(l)&&a.auth.currentUser===a&&(yield a.auth.signOut()),l}})).apply(this,arguments)}class Sn{constructor(r){this.user=r,this.isRunning=!1,this.timerId=null,this.errorBackoff=3e4}_start(){this.isRunning||(this.isRunning=!0,this.schedule())}_stop(){this.isRunning&&(this.isRunning=!1,null!==this.timerId&&clearTimeout(this.timerId))}getInterval(r){var s;if(r){const l=this.errorBackoff;return this.errorBackoff=Math.min(2*this.errorBackoff,96e4),l}{this.errorBackoff=3e4;const d=(null!==(s=this.user.stsTokenManager.expirationTime)&&void 0!==s?s:0)-Date.now()-3e5;return Math.max(0,d)}}schedule(r=!1){var s=this;if(!this.isRunning)return;const l=this.getInterval(r);this.timerId=setTimeout((0,m.Z)(function*(){yield s.iteration()}),l)}iteration(){var r=this;return(0,m.Z)(function*(){try{yield r.user.getIdToken(!0)}catch(s){return void("auth/network-request-failed"===s?.code&&r.schedule(!0))}r.schedule()})()}}class _n{constructor(r,s){this.createdAt=r,this.lastLoginAt=s,this._initializeTime()}_initializeTime(){this.lastSignInTime=z(this.lastLoginAt),this.creationTime=z(this.createdAt)}_copy(r){this.createdAt=r.createdAt,this.lastLoginAt=r.lastLoginAt,this._initializeTime()}toJSON(){return{createdAt:this.createdAt,lastLoginAt:this.lastLoginAt}}}function Ht(a){return Pe.apply(this,arguments)}function Pe(){return Pe=(0,m.Z)(function*(a){var r;const s=a.auth,l=yield a.getIdToken(),d=yield He(a,function X(a,r){return N.apply(this,arguments)}(s,{idToken:l}));F(d?.users.length,s,"internal-error");const f=d.users[0];a._notifyReloadListener(f);const S=null!==(r=f.providerUserInfo)&&void 0!==r&&r.length?function Pt(a){return a.map(r=>{var{providerId:s}=r,l=(0,D._T)(r,["providerId"]);return{providerId:s,uid:l.rawId||"",displayName:l.displayName||null,email:l.email||null,phoneNumber:l.phoneNumber||null,photoURL:l.photoUrl||null}})}(f.providerUserInfo):[],M=function wn(a,r){return[...a.filter(l=>!r.some(d=>d.providerId===l.providerId)),...r]}(a.providerData,S),se=!!a.isAnonymous&&!(a.email&&f.passwordHash||M?.length),Be={uid:f.localId,displayName:f.displayName||null,photoURL:f.photoUrl||null,email:f.email||null,emailVerified:f.emailVerified||!1,phoneNumber:f.phoneNumber||null,tenantId:f.tenantId||null,providerData:M,metadata:new _n(f.createdAt,f.lastLoginAt),isAnonymous:se};Object.assign(a,Be)}),Pe.apply(this,arguments)}function Tt(){return(Tt=(0,m.Z)(function*(a){const r=(0,w.m9)(a);yield Ht(r),yield r.auth._persistUserIfCurrent(r),r.auth._notifyListenersIfCurrent(r)})).apply(this,arguments)}function Gt(){return(Gt=(0,m.Z)(function*(a,r){const s=yield pt(a,{},(0,m.Z)(function*(){const l=(0,w.xO)({grant_type:"refresh_token",refresh_token:r}).slice(1),{tokenApiHost:d,apiKey:f}=a.config,S=_t(a,d,"/v1/token",`key=${f}`),M=yield a._getAdditionalHeaders();return M["Content-Type"]="application/x-www-form-urlencoded",qe.fetch()(S,{method:"POST",headers:M,body:l})}));return{accessToken:s.access_token,expiresIn:s.expires_in,refreshToken:s.refresh_token}})).apply(this,arguments)}class Ct{constructor(){this.refreshToken=null,this.accessToken=null,this.expirationTime=null}get isExpired(){return!this.expirationTime||Date.now()>this.expirationTime-3e4}updateFromServerResponse(r){F(r.idToken,"internal-error"),F(typeof r.idToken<"u","internal-error"),F(typeof r.refreshToken<"u","internal-error");const s="expiresIn"in r&&typeof r.expiresIn<"u"?Number(r.expiresIn):function ln(a){const r=kt(a);return F(r,"internal-error"),F(typeof r.exp<"u","internal-error"),F(typeof r.iat<"u","internal-error"),Number(r.exp)-Number(r.iat)}(r.idToken);this.updateTokensAndExpiration(r.idToken,r.refreshToken,s)}getToken(r,s=!1){var l=this;return(0,m.Z)(function*(){return F(!l.accessToken||l.refreshToken,r,"user-token-expired"),s||!l.accessToken||l.isExpired?l.refreshToken?(yield l.refresh(r,l.refreshToken),l.accessToken):null:l.accessToken})()}clearRefreshToken(){this.refreshToken=null}refresh(r,s){var l=this;return(0,m.Z)(function*(){const{accessToken:d,refreshToken:f,expiresIn:S}=yield function bt(a,r){return Gt.apply(this,arguments)}(r,s);l.updateTokensAndExpiration(d,f,Number(S))})()}updateTokensAndExpiration(r,s,l){this.refreshToken=s||null,this.accessToken=r||null,this.expirationTime=Date.now()+1e3*l}static fromJSON(r,s){const{refreshToken:l,accessToken:d,expirationTime:f}=s,S=new Ct;return l&&(F("string"==typeof l,"internal-error",{appName:r}),S.refreshToken=l),d&&(F("string"==typeof d,"internal-error",{appName:r}),S.accessToken=d),f&&(F("number"==typeof f,"internal-error",{appName:r}),S.expirationTime=f),S}toJSON(){return{refreshToken:this.refreshToken,accessToken:this.accessToken,expirationTime:this.expirationTime}}_assign(r){this.accessToken=r.accessToken,this.refreshToken=r.refreshToken,this.expirationTime=r.expirationTime}_clone(){return Object.assign(new Ct,this.toJSON())}_performRefresh(){return we("not implemented")}}function gt(a,r){F("string"==typeof a||typeof a>"u","internal-error",{appName:r})}class dt{constructor(r){var{uid:s,auth:l,stsTokenManager:d}=r,f=(0,D._T)(r,["uid","auth","stsTokenManager"]);this.providerId="firebase",this.proactiveRefresh=new Sn(this),this.reloadUserInfo=null,this.reloadListener=null,this.uid=s,this.auth=l,this.stsTokenManager=d,this.accessToken=d.accessToken,this.displayName=f.displayName||null,this.email=f.email||null,this.emailVerified=f.emailVerified||!1,this.phoneNumber=f.phoneNumber||null,this.photoURL=f.photoURL||null,this.isAnonymous=f.isAnonymous||!1,this.tenantId=f.tenantId||null,this.providerData=f.providerData?[...f.providerData]:[],this.metadata=new _n(f.createdAt||void 0,f.lastLoginAt||void 0)}getIdToken(r){var s=this;return(0,m.Z)(function*(){const l=yield He(s,s.stsTokenManager.getToken(s.auth,r));return F(l,s.auth,"internal-error"),s.accessToken!==l&&(s.accessToken=l,yield s.auth._persistUserIfCurrent(s),s.auth._notifyListenersIfCurrent(s)),l})()}getIdTokenResult(r){return function ke(a){return et.apply(this,arguments)}(this,r)}reload(){return function gn(a){return Tt.apply(this,arguments)}(this)}_assign(r){this!==r&&(F(this.uid===r.uid,this.auth,"internal-error"),this.displayName=r.displayName,this.photoURL=r.photoURL,this.email=r.email,this.emailVerified=r.emailVerified,this.phoneNumber=r.phoneNumber,this.isAnonymous=r.isAnonymous,this.tenantId=r.tenantId,this.providerData=r.providerData.map(s=>Object.assign({},s)),this.metadata._copy(r.metadata),this.stsTokenManager._assign(r.stsTokenManager))}_clone(r){return new dt(Object.assign(Object.assign({},this),{auth:r,stsTokenManager:this.stsTokenManager._clone()}))}_onReload(r){F(!this.reloadListener,this.auth,"internal-error"),this.reloadListener=r,this.reloadUserInfo&&(this._notifyReloadListener(this.reloadUserInfo),this.reloadUserInfo=null)}_notifyReloadListener(r){this.reloadListener?this.reloadListener(r):this.reloadUserInfo=r}_startProactiveRefresh(){this.proactiveRefresh._start()}_stopProactiveRefresh(){this.proactiveRefresh._stop()}_updateTokensIfNecessary(r,s=!1){var l=this;return(0,m.Z)(function*(){let d=!1;r.idToken&&r.idToken!==l.stsTokenManager.accessToken&&(l.stsTokenManager.updateFromServerResponse(r),d=!0),s&&(yield Ht(l)),yield l.auth._persistUserIfCurrent(l),d&&l.auth._notifyListenersIfCurrent(l)})()}delete(){var r=this;return(0,m.Z)(function*(){const s=yield r.getIdToken();return yield He(r,function ot(a,r){return We.apply(this,arguments)}(r.auth,{idToken:s})),r.stsTokenManager.clearRefreshToken(),r.auth.signOut()})()}toJSON(){return Object.assign(Object.assign({uid:this.uid,email:this.email||void 0,emailVerified:this.emailVerified,displayName:this.displayName||void 0,isAnonymous:this.isAnonymous,photoURL:this.photoURL||void 0,phoneNumber:this.phoneNumber||void 0,tenantId:this.tenantId||void 0,providerData:this.providerData.map(r=>Object.assign({},r)),stsTokenManager:this.stsTokenManager.toJSON(),_redirectEventId:this._redirectEventId},this.metadata.toJSON()),{apiKey:this.auth.config.apiKey,appName:this.auth.name})}get refreshToken(){return this.stsTokenManager.refreshToken||""}static _fromJSON(r,s){var l,d,f,S,M,H,j,se;const Be=null!==(l=s.displayName)&&void 0!==l?l:void 0,on=null!==(d=s.email)&&void 0!==d?d:void 0,Tn=null!==(f=s.phoneNumber)&&void 0!==f?f:void 0,pi=null!==(S=s.photoURL)&&void 0!==S?S:void 0,zs=null!==(M=s.tenantId)&&void 0!==M?M:void 0,js=null!==(H=s._redirectEventId)&&void 0!==H?H:void 0,$n=null!==(j=s.createdAt)&&void 0!==j?j:void 0,hn=null!==(se=s.lastLoginAt)&&void 0!==se?se:void 0,{uid:Ys,emailVerified:Gr,isAnonymous:er,providerData:Qs,stsTokenManager:Kn}=s;F(Ys&&Kn,r,"internal-error");const il=Ct.fromJSON(this.name,Kn);F("string"==typeof Ys,r,"internal-error"),gt(Be,r.name),gt(on,r.name),F("boolean"==typeof Gr,r,"internal-error"),F("boolean"==typeof er,r,"internal-error"),gt(Tn,r.name),gt(pi,r.name),gt(zs,r.name),gt(js,r.name),gt($n,r.name),gt(hn,r.name);const $r=new dt({uid:Ys,auth:r,email:on,emailVerified:Gr,displayName:Be,isAnonymous:er,photoURL:pi,phoneNumber:Tn,tenantId:zs,stsTokenManager:il,createdAt:$n,lastLoginAt:hn});return Qs&&Array.isArray(Qs)&&($r.providerData=Qs.map(qo=>Object.assign({},qo))),js&&($r._redirectEventId=js),$r}static _fromIdTokenResponse(r,s,l=!1){return(0,m.Z)(function*(){const d=new Ct;d.updateFromServerResponse(s);const f=new dt({uid:s.localId,auth:r,stsTokenManager:d,isAnonymous:l});return yield Ht(f),f})()}}const un=(()=>{class a{constructor(){this.type="NONE",this.storage={}}_isAvailable(){return(0,m.Z)(function*(){return!0})()}_set(s,l){var d=this;return(0,m.Z)(function*(){d.storage[s]=l})()}_get(s){var l=this;return(0,m.Z)(function*(){const d=l.storage[s];return void 0===d?null:d})()}_remove(s){var l=this;return(0,m.Z)(function*(){delete l.storage[s]})()}_addListener(s,l){}_removeListener(s,l){}}return a.type="NONE",a})();function Xt(a,r,s){return`firebase:${a}:${r}:${s}`}class xt{constructor(r,s,l){this.persistence=r,this.auth=s,this.userKey=l;const{config:d,name:f}=this.auth;this.fullUserKey=Xt(this.userKey,d.apiKey,f),this.fullPersistenceKey=Xt("persistence",d.apiKey,f),this.boundEventHandler=s._onStorageEvent.bind(s),this.persistence._addListener(this.fullUserKey,this.boundEventHandler)}setCurrentUser(r){return this.persistence._set(this.fullUserKey,r.toJSON())}getCurrentUser(){var r=this;return(0,m.Z)(function*(){const s=yield r.persistence._get(r.fullUserKey);return s?dt._fromJSON(r.auth,s):null})()}removeCurrentUser(){return this.persistence._remove(this.fullUserKey)}savePersistenceForRedirect(){return this.persistence._set(this.fullPersistenceKey,this.persistence.type)}setPersistence(r){var s=this;return(0,m.Z)(function*(){if(s.persistence===r)return;const l=yield s.getCurrentUser();return yield s.removeCurrentUser(),s.persistence=r,l?s.setCurrentUser(l):void 0})()}delete(){this.persistence._removeListener(this.fullUserKey,this.boundEventHandler)}static create(r,s,l="authUser"){return(0,m.Z)(function*(){if(!s.length)return new xt(p(un),r,l);const d=(yield Promise.all(s.map(function(){var j=(0,m.Z)(function*(se){if(yield se._isAvailable())return se});return function(se){return j.apply(this,arguments)}}()))).filter(j=>j);let f=d[0]||p(un);const S=Xt(l,r.config.apiKey,r.name);let M=null;for(const j of s)try{const se=yield j._get(S);if(se){const Be=dt._fromJSON(r,se);j!==f&&(M=Be),f=j;break}}catch{}const H=d.filter(j=>j._shouldAllowMigration);return f._shouldAllowMigration&&H.length?(f=H[0],M&&(yield f._set(S,M.toJSON())),yield Promise.all(s.map(function(){var j=(0,m.Z)(function*(se){if(se!==f)try{yield se._remove(S)}catch{}});return function(se){return j.apply(this,arguments)}}())),new xt(f,r,l)):new xt(f,r,l)})()}}function k(a){const r=a.toLowerCase();if(r.includes("opera/")||r.includes("opr/")||r.includes("opios/"))return"Opera";if(B(r))return"IEMobile";if(r.includes("msie")||r.includes("trident/"))return"IE";if(r.includes("edge/"))return"Edge";if(E(r))return"Firefox";if(r.includes("silk/"))return"Silk";if(de(r))return"Blackberry";if(_e(r))return"Webos";if(y(r))return"Safari";if((r.includes("chrome/")||x(r))&&!r.includes("edge/"))return"Chrome";if(te(r))return"Android";{const l=a.match(/([a-zA-Z\d\.]+)\/[a-zA-Z\d\.]*$/);if(2===l?.length)return l[1]}return"Other"}function E(a=(0,w.z$)()){return/firefox\//i.test(a)}function y(a=(0,w.z$)()){const r=a.toLowerCase();return r.includes("safari/")&&!r.includes("chrome/")&&!r.includes("crios/")&&!r.includes("android")}function x(a=(0,w.z$)()){return/crios\//i.test(a)}function B(a=(0,w.z$)()){return/iemobile/i.test(a)}function te(a=(0,w.z$)()){return/android/i.test(a)}function de(a=(0,w.z$)()){return/blackberry/i.test(a)}function _e(a=(0,w.z$)()){return/webos/i.test(a)}function Oe(a=(0,w.z$)()){return/iphone|ipad|ipod/i.test(a)||/macintosh/i.test(a)&&/mobile/i.test(a)}function ut(a=(0,w.z$)()){return/(iPad|iPhone|iPod).*OS 7_\d/i.test(a)||/(iPad|iPhone|iPod).*OS 8_\d/i.test(a)}function mt(a=(0,w.z$)()){return Oe(a)||te(a)||_e(a)||de(a)||/windows phone/i.test(a)||B(a)}function jn(a,r=[]){let s;switch(a){case"Browser":s=k((0,w.z$)());break;case"Worker":s=`${k((0,w.z$)())}-${a}`;break;default:s=a}const l=r.length?r.join(","):"FirebaseCore-web";return`${s}/JsCore/${C.SDK_VERSION}/${l}`}class zr{constructor(r){this.auth=r,this.queue=[]}pushCallback(r,s){const l=f=>new Promise((S,M)=>{try{S(r(f))}catch(H){M(H)}});l.onAbort=s,this.queue.push(l);const d=this.queue.length-1;return()=>{this.queue[d]=()=>Promise.resolve()}}runMiddleware(r){var s=this;return(0,m.Z)(function*(){if(s.auth.currentUser===r)return;const l=[];try{for(const d of s.queue)yield d(r),d.onAbort&&l.push(d.onAbort)}catch(d){l.reverse();for(const f of l)try{f()}catch{}throw s.auth._errorFactory.create("login-blocked",{originalMessage:d?.message})}})()}}class ir{constructor(r,s,l){this.app=r,this.heartbeatServiceProvider=s,this.config=l,this.currentUser=null,this.emulatorConfig=null,this.operations=Promise.resolve(),this.authStateSubscription=new Yn(this),this.idTokenSubscription=new Yn(this),this.beforeStateQueue=new zr(this),this.redirectUser=null,this.isProactiveRefreshEnabled=!1,this._canInitEmulator=!0,this._isInitialized=!1,this._deleted=!1,this._initializationPromise=null,this._popupRedirectResolver=null,this._errorFactory=_,this.lastNotifiedUid=void 0,this.languageCode=null,this.tenantId=null,this.settings={appVerificationDisabledForTesting:!1},this.frameworks=[],this.name=r.name,this.clientVersion=l.sdkClientVersion}_initializeWithPersistence(r,s){var l=this;return s&&(this._popupRedirectResolver=p(s)),this._initializationPromise=this.queue((0,m.Z)(function*(){var d,f;if(!l._deleted&&(l.persistenceManager=yield xt.create(l,r),!l._deleted)){if(null!==(d=l._popupRedirectResolver)&&void 0!==d&&d._shouldInitProactively)try{yield l._popupRedirectResolver._initialize(l)}catch{}yield l.initializeCurrentUser(s),l.lastNotifiedUid=(null===(f=l.currentUser)||void 0===f?void 0:f.uid)||null,!l._deleted&&(l._isInitialized=!0)}})),this._initializationPromise}_onStorageEvent(){var r=this;return(0,m.Z)(function*(){if(r._deleted)return;const s=yield r.assertedPersistence.getCurrentUser();if(r.currentUser||s){if(r.currentUser&&s&&r.currentUser.uid===s.uid)return r._currentUser._assign(s),void(yield r.currentUser.getIdToken());yield r._updateCurrentUser(s,!0)}})()}initializeCurrentUser(r){var s=this;return(0,m.Z)(function*(){var l;const d=yield s.assertedPersistence.getCurrentUser();let f=d,S=!1;if(r&&s.config.authDomain){yield s.getOrInitRedirectPersistenceManager();const M=null===(l=s.redirectUser)||void 0===l?void 0:l._redirectEventId,H=f?._redirectEventId,j=yield s.tryRedirectSignIn(r);(!M||M===H)&&j?.user&&(f=j.user,S=!0)}if(!f)return s.directlySetCurrentUser(null);if(!f._redirectEventId){if(S)try{yield s.beforeStateQueue.runMiddleware(f)}catch(M){f=d,s._popupRedirectResolver._overrideRedirectResult(s,()=>Promise.reject(M))}return f?s.reloadAndSetCurrentUserOrClear(f):s.directlySetCurrentUser(null)}return F(s._popupRedirectResolver,s,"argument-error"),yield s.getOrInitRedirectPersistenceManager(),s.redirectUser&&s.redirectUser._redirectEventId===f._redirectEventId?s.directlySetCurrentUser(f):s.reloadAndSetCurrentUserOrClear(f)})()}tryRedirectSignIn(r){var s=this;return(0,m.Z)(function*(){let l=null;try{l=yield s._popupRedirectResolver._completeRedirectFn(s,r,!0)}catch{yield s._setRedirectUser(null)}return l})()}reloadAndSetCurrentUserOrClear(r){var s=this;return(0,m.Z)(function*(){try{yield Ht(r)}catch(l){if("auth/network-request-failed"!==l?.code)return s.directlySetCurrentUser(null)}return s.directlySetCurrentUser(r)})()}useDeviceLanguage(){this.languageCode=function nt(){if(typeof navigator>"u")return null;const a=navigator;return a.languages&&a.languages[0]||a.language||null}()}_delete(){var r=this;return(0,m.Z)(function*(){r._deleted=!0})()}updateCurrentUser(r){var s=this;return(0,m.Z)(function*(){const l=r?(0,w.m9)(r):null;return l&&F(l.auth.config.apiKey===s.config.apiKey,s,"invalid-user-token"),s._updateCurrentUser(l&&l._clone(s))})()}_updateCurrentUser(r,s=!1){var l=this;return(0,m.Z)(function*(){if(!l._deleted)return r&&F(l.tenantId===r.tenantId,l,"tenant-id-mismatch"),s||(yield l.beforeStateQueue.runMiddleware(r)),l.queue((0,m.Z)(function*(){yield l.directlySetCurrentUser(r),l.notifyAuthListeners()}))})()}signOut(){var r=this;return(0,m.Z)(function*(){return yield r.beforeStateQueue.runMiddleware(null),(r.redirectPersistenceManager||r._popupRedirectResolver)&&(yield r._setRedirectUser(null)),r._updateCurrentUser(null,!0)})()}setPersistence(r){var s=this;return this.queue((0,m.Z)(function*(){yield s.assertedPersistence.setPersistence(p(r))}))}_getPersistence(){return this.assertedPersistence.persistence.type}_updateErrorMap(r){this._errorFactory=new w.LL("auth","Firebase",r())}onAuthStateChanged(r,s,l){return this.registerStateListener(this.authStateSubscription,r,s,l)}beforeAuthStateChanged(r,s){return this.beforeStateQueue.pushCallback(r,s)}onIdTokenChanged(r,s,l){return this.registerStateListener(this.idTokenSubscription,r,s,l)}toJSON(){var r;return{apiKey:this.config.apiKey,authDomain:this.config.authDomain,appName:this.name,currentUser:null===(r=this._currentUser)||void 0===r?void 0:r.toJSON()}}_setRedirectUser(r,s){var l=this;return(0,m.Z)(function*(){const d=yield l.getOrInitRedirectPersistenceManager(s);return null===r?d.removeCurrentUser():d.setCurrentUser(r)})()}getOrInitRedirectPersistenceManager(r){var s=this;return(0,m.Z)(function*(){if(!s.redirectPersistenceManager){const l=r&&p(r)||s._popupRedirectResolver;F(l,s,"argument-error"),s.redirectPersistenceManager=yield xt.create(s,[p(l._redirectPersistence)],"redirectUser"),s.redirectUser=yield s.redirectPersistenceManager.getCurrentUser()}return s.redirectPersistenceManager})()}_redirectUserForId(r){var s=this;return(0,m.Z)(function*(){var l,d;return s._isInitialized&&(yield s.queue((0,m.Z)(function*(){}))),(null===(l=s._currentUser)||void 0===l?void 0:l._redirectEventId)===r?s._currentUser:(null===(d=s.redirectUser)||void 0===d?void 0:d._redirectEventId)===r?s.redirectUser:null})()}_persistUserIfCurrent(r){var s=this;return(0,m.Z)(function*(){if(r===s.currentUser)return s.queue((0,m.Z)(function*(){return s.directlySetCurrentUser(r)}))})()}_notifyListenersIfCurrent(r){r===this.currentUser&&this.notifyAuthListeners()}_key(){return`${this.config.authDomain}:${this.config.apiKey}:${this.name}`}_startProactiveRefresh(){this.isProactiveRefreshEnabled=!0,this.currentUser&&this._currentUser._startProactiveRefresh()}_stopProactiveRefresh(){this.isProactiveRefreshEnabled=!1,this.currentUser&&this._currentUser._stopProactiveRefresh()}get _currentUser(){return this.currentUser}notifyAuthListeners(){var r,s;if(!this._isInitialized)return;this.idTokenSubscription.next(this.currentUser);const l=null!==(s=null===(r=this.currentUser)||void 0===r?void 0:r.uid)&&void 0!==s?s:null;this.lastNotifiedUid!==l&&(this.lastNotifiedUid=l,this.authStateSubscription.next(this.currentUser))}registerStateListener(r,s,l,d){if(this._deleted)return()=>{};const f="function"==typeof s?s:s.next.bind(s),S=this._isInitialized?Promise.resolve():this._initializationPromise;return F(S,this,"internal-error"),S.then(()=>f(this.currentUser)),"function"==typeof s?r.addObserver(s,l,d):r.addObserver(s)}directlySetCurrentUser(r){var s=this;return(0,m.Z)(function*(){s.currentUser&&s.currentUser!==r&&s._currentUser._stopProactiveRefresh(),r&&s.isProactiveRefreshEnabled&&r._startProactiveRefresh(),s.currentUser=r,r?yield s.assertedPersistence.setCurrentUser(r):yield s.assertedPersistence.removeCurrentUser()})()}queue(r){return this.operations=this.operations.then(r,r),this.operations}get assertedPersistence(){return F(this.persistenceManager,this,"internal-error"),this.persistenceManager}_logFramework(r){!r||this.frameworks.includes(r)||(this.frameworks.push(r),this.frameworks.sort(),this.clientVersion=jn(this.config.clientPlatform,this._getFrameworks()))}_getFrameworks(){return this.frameworks}_getAdditionalHeaders(){var r=this;return(0,m.Z)(function*(){var s;const l={"X-Client-Version":r.clientVersion};r.app.options.appId&&(l["X-Firebase-gmpid"]=r.app.options.appId);const d=yield null===(s=r.heartbeatServiceProvider.getImmediate({optional:!0}))||void 0===s?void 0:s.getHeartbeatsHeader();return d&&(l["X-Firebase-Client"]=d),l})()}}function tt(a){return(0,w.m9)(a)}class Yn{constructor(r){this.auth=r,this.observer=null,this.addObserver=(0,w.ne)(s=>this.observer=s)}get next(){return F(this.observer,this.auth,"internal-error"),this.observer.next.bind(this.observer)}}function vi(a,r,s){const l=tt(a);F(l._canInitEmulator,l,"emulator-config-failed"),F(/^https?:\/\//.test(r),l,"invalid-emulator-scheme");const d=!!s?.disableWarnings,f=yi(r),{host:S,port:M}=function rr(a){const r=yi(a),s=/(\/\/)?([^?#/]+)/.exec(a.substr(r.length));if(!s)return{host:"",port:null};const l=s[2].split("@").pop()||"",d=/^(\[[^\]]+\])(:|$)/.exec(l);if(d){const f=d[1];return{host:f,port:Ii(l.substr(f.length+1))}}{const[f,S]=l.split(":");return{host:f,port:Ii(S)}}}(r);l.config.emulator={url:`${f}//${S}${null===M?"":`:${M}`}/`},l.settings.appVerificationDisabledForTesting=!0,l.emulatorConfig=Object.freeze({host:S,port:M,protocol:f.replace(":",""),options:Object.freeze({disableWarnings:d})}),d||function to(){function a(){const r=document.createElement("p"),s=r.style;r.innerText="Running in emulator mode. Do not use with production credentials.",s.position="fixed",s.width="100%",s.backgroundColor="#ffffff",s.border=".1em solid #000000",s.color="#b50000",s.bottom="0px",s.left="0px",s.margin="0px",s.zIndex="10000",s.textAlign="center",r.classList.add("firebase-emulator-warning"),document.body.appendChild(r)}typeof console<"u"&&"function"==typeof console.info&&console.info("WARNING: You are using the Auth Emulator, which is intended for local testing only.  Do not use with production credentials."),typeof window<"u"&&typeof document<"u"&&("loading"===document.readyState?window.addEventListener("DOMContentLoaded",a):a())}()}function yi(a){const r=a.indexOf(":");return r<0?"":a.substr(0,r+1)}function Ii(a){if(!a)return null;const r=Number(a);return isNaN(r)?null:r}class cn{constructor(r,s){this.providerId=r,this.signInMethod=s}toJSON(){return we("not implemented")}_getIdTokenResponse(r){return we("not implemented")}_linkToIdToken(r,s){return we("not implemented")}_getReauthenticationResolver(r){return we("not implemented")}}function sr(a,r){return or.apply(this,arguments)}function or(){return(or=(0,m.Z)(function*(a,r){return ye(a,"POST","/v1/accounts:resetPassword",ce(a,r))})).apply(this,arguments)}function Qn(a,r){return ar.apply(this,arguments)}function ar(){return(ar=(0,m.Z)(function*(a,r){return ye(a,"POST","/v1/accounts:update",r)})).apply(this,arguments)}function mn(){return(mn=(0,m.Z)(function*(a,r){return ye(a,"POST","/v1/accounts:update",ce(a,r))})).apply(this,arguments)}function qn(){return(qn=(0,m.Z)(function*(a,r){return oe(a,"POST","/v1/accounts:signInWithPassword",ce(a,r))})).apply(this,arguments)}function $t(a,r){return Kt.apply(this,arguments)}function Kt(){return(Kt=(0,m.Z)(function*(a,r){return ye(a,"POST","/v1/accounts:sendOobCode",ce(a,r))})).apply(this,arguments)}function Pn(){return(Pn=(0,m.Z)(function*(a,r){return $t(a,r)})).apply(this,arguments)}function Ei(){return(Ei=(0,m.Z)(function*(a,r){return $t(a,r)})).apply(this,arguments)}function bn(){return(bn=(0,m.Z)(function*(a,r){return $t(a,r)})).apply(this,arguments)}function ur(){return(ur=(0,m.Z)(function*(a,r){return $t(a,r)})).apply(this,arguments)}function Ti(){return(Ti=(0,m.Z)(function*(a,r){return oe(a,"POST","/v1/accounts:signInWithEmailLink",ce(a,r))})).apply(this,arguments)}function Ci(){return(Ci=(0,m.Z)(function*(a,r){return oe(a,"POST","/v1/accounts:signInWithEmailLink",ce(a,r))})).apply(this,arguments)}class Nn extends cn{constructor(r,s,l,d=null){super("password",l),this._email=r,this._password=s,this._tenantId=d}static _fromEmailAndPassword(r,s){return new Nn(r,s,"password")}static _fromEmailAndCode(r,s,l=null){return new Nn(r,s,"emailLink",l)}toJSON(){return{email:this._email,password:this._password,signInMethod:this.signInMethod,tenantId:this._tenantId}}static fromJSON(r){const s="string"==typeof r?JSON.parse(r):r;if(s?.email&&s?.password){if("password"===s.signInMethod)return this._fromEmailAndPassword(s.email,s.password);if("emailLink"===s.signInMethod)return this._fromEmailAndCode(s.email,s.password,s.tenantId)}return null}_getIdTokenResponse(r){var s=this;return(0,m.Z)(function*(){switch(s.signInMethod){case"password":return function jr(a,r){return qn.apply(this,arguments)}(r,{returnSecureToken:!0,email:s._email,password:s._password});case"emailLink":return function Qr(a,r){return Ti.apply(this,arguments)}(r,{email:s._email,oobCode:s._password});default:Se(r,"internal-error")}})()}_linkToIdToken(r,s){var l=this;return(0,m.Z)(function*(){switch(l.signInMethod){case"password":return Qn(r,{idToken:s,returnSecureToken:!0,email:l._email,password:l._password});case"emailLink":return function qr(a,r){return Ci.apply(this,arguments)}(r,{idToken:s,email:l._email,oobCode:l._password});default:Se(r,"internal-error")}})()}_getReauthenticationResolver(r){return this._getIdTokenResponse(r)}}function zt(a,r){return cr.apply(this,arguments)}function cr(){return(cr=(0,m.Z)(function*(a,r){return oe(a,"POST","/v1/accounts:signInWithIdp",ce(a,r))})).apply(this,arguments)}class I extends cn{constructor(){super(...arguments),this.pendingToken=null}static _fromParams(r){const s=new I(r.providerId,r.signInMethod);return r.idToken||r.accessToken?(r.idToken&&(s.idToken=r.idToken),r.accessToken&&(s.accessToken=r.accessToken),r.nonce&&!r.pendingToken&&(s.nonce=r.nonce),r.pendingToken&&(s.pendingToken=r.pendingToken)):r.oauthToken&&r.oauthTokenSecret?(s.accessToken=r.oauthToken,s.secret=r.oauthTokenSecret):Se("argument-error"),s}toJSON(){return{idToken:this.idToken,accessToken:this.accessToken,secret:this.secret,nonce:this.nonce,pendingToken:this.pendingToken,providerId:this.providerId,signInMethod:this.signInMethod}}static fromJSON(r){const s="string"==typeof r?JSON.parse(r):r,{providerId:l,signInMethod:d}=s,f=(0,D._T)(s,["providerId","signInMethod"]);if(!l||!d)return null;const S=new I(l,d);return S.idToken=f.idToken||void 0,S.accessToken=f.accessToken||void 0,S.secret=f.secret,S.nonce=f.nonce,S.pendingToken=f.pendingToken||null,S}_getIdTokenResponse(r){return zt(r,this.buildRequest())}_linkToIdToken(r,s){const l=this.buildRequest();return l.idToken=s,zt(r,l)}_getReauthenticationResolver(r){const s=this.buildRequest();return s.autoCreate=!1,zt(r,s)}buildRequest(){const r={requestUri:"http://localhost",returnSecureToken:!0};if(this.pendingToken)r.pendingToken=this.pendingToken;else{const s={};this.idToken&&(s.id_token=this.idToken),this.accessToken&&(s.access_token=this.accessToken),this.secret&&(s.oauth_token_secret=this.secret),s.providerId=this.providerId,this.nonce&&!this.pendingToken&&(s.nonce=this.nonce),r.postBody=(0,w.xO)(s)}return r}}function O(){return(O=(0,m.Z)(function*(a,r){return ye(a,"POST","/v1/accounts:sendVerificationCode",ce(a,r))})).apply(this,arguments)}function Y(){return(Y=(0,m.Z)(function*(a,r){return oe(a,"POST","/v1/accounts:signInWithPhoneNumber",ce(a,r))})).apply(this,arguments)}function q(){return(q=(0,m.Z)(function*(a,r){const s=yield oe(a,"POST","/v1/accounts:signInWithPhoneNumber",ce(a,r));if(s.temporaryProof)throw ee(a,"account-exists-with-different-credential",s);return s})).apply(this,arguments)}const $={USER_NOT_FOUND:"user-not-found"};function ge(){return(ge=(0,m.Z)(function*(a,r){return oe(a,"POST","/v1/accounts:signInWithPhoneNumber",ce(a,Object.assign(Object.assign({},r),{operation:"REAUTH"})),$)})).apply(this,arguments)}class Je extends cn{constructor(r){super("phone","phone"),this.params=r}static _fromVerification(r,s){return new Je({verificationId:r,verificationCode:s})}static _fromTokenResponse(r,s){return new Je({phoneNumber:r,temporaryProof:s})}_getIdTokenResponse(r){return function U(a,r){return Y.apply(this,arguments)}(r,this._makeVerificationRequest())}_linkToIdToken(r,s){return function K(a,r){return q.apply(this,arguments)}(r,Object.assign({idToken:s},this._makeVerificationRequest()))}_getReauthenticationResolver(r){return function St(a,r){return ge.apply(this,arguments)}(r,this._makeVerificationRequest())}_makeVerificationRequest(){const{temporaryProof:r,phoneNumber:s,verificationId:l,verificationCode:d}=this.params;return r&&s?{temporaryProof:r,phoneNumber:s}:{sessionInfo:l,code:d}}toJSON(){const r={providerId:this.providerId};return this.params.phoneNumber&&(r.phoneNumber=this.params.phoneNumber),this.params.temporaryProof&&(r.temporaryProof=this.params.temporaryProof),this.params.verificationCode&&(r.verificationCode=this.params.verificationCode),this.params.verificationId&&(r.verificationId=this.params.verificationId),r}static fromJSON(r){"string"==typeof r&&(r=JSON.parse(r));const{verificationId:s,verificationCode:l,phoneNumber:d,temporaryProof:f}=r;return l||s||d||f?new Je({verificationId:s,verificationCode:l,phoneNumber:d,temporaryProof:f}):null}}class Jn{constructor(r){var s,l,d,f,S,M;const H=(0,w.zd)((0,w.pd)(r)),j=null!==(s=H.apiKey)&&void 0!==s?s:null,se=null!==(l=H.oobCode)&&void 0!==l?l:null,Be=function na(a){switch(a){case"recoverEmail":return"RECOVER_EMAIL";case"resetPassword":return"PASSWORD_RESET";case"signIn":return"EMAIL_SIGNIN";case"verifyEmail":return"VERIFY_EMAIL";case"verifyAndChangeEmail":return"VERIFY_AND_CHANGE_EMAIL";case"revertSecondFactorAddition":return"REVERT_SECOND_FACTOR_ADDITION";default:return null}}(null!==(d=H.mode)&&void 0!==d?d:null);F(j&&se&&Be,"argument-error"),this.apiKey=j,this.operation=Be,this.code=se,this.continueUrl=null!==(f=H.continueUrl)&&void 0!==f?f:null,this.languageCode=null!==(S=H.languageCode)&&void 0!==S?S:null,this.tenantId=null!==(M=H.tenantId)&&void 0!==M?M:null}static parseLink(r){const s=function Ai(a){const r=(0,w.zd)((0,w.pd)(a)).link,s=r?(0,w.zd)((0,w.pd)(r)).deep_link_id:null,l=(0,w.zd)((0,w.pd)(a)).deep_link_id;return(l?(0,w.zd)((0,w.pd)(l)).link:null)||l||s||r||a}(r);try{return new Jn(s)}catch{return null}}}let re=(()=>{class a{constructor(){this.providerId=a.PROVIDER_ID}static credential(s,l){return Nn._fromEmailAndPassword(s,l)}static credentialWithLink(s,l){const d=Jn.parseLink(l);return F(d,"argument-error"),Nn._fromEmailAndCode(s,d.code,d.tenantId)}}return a.PROVIDER_ID="password",a.EMAIL_PASSWORD_SIGN_IN_METHOD="password",a.EMAIL_LINK_SIGN_IN_METHOD="emailLink",a})();class $e{constructor(r){this.providerId=r,this.defaultLanguageCode=null,this.customParameters={}}setDefaultLanguage(r){this.defaultLanguageCode=r}setCustomParameters(r){return this.customParameters=r,this}getCustomParameters(){return this.customParameters}}class Xn extends $e{constructor(){super(...arguments),this.scopes=[]}addScope(r){return this.scopes.includes(r)||this.scopes.push(r),this}getScopes(){return[...this.scopes]}}class On extends Xn{static credentialFromJSON(r){const s="string"==typeof r?JSON.parse(r):r;return F("providerId"in s&&"signInMethod"in s,"argument-error"),I._fromParams(s)}credential(r){return this._credential(Object.assign(Object.assign({},r),{nonce:r.rawNonce}))}_credential(r){return F(r.idToken||r.accessToken,"argument-error"),I._fromParams(Object.assign(Object.assign({},r),{providerId:this.providerId,signInMethod:this.providerId}))}static credentialFromResult(r){return On.oauthCredentialFromTaggedObject(r)}static credentialFromError(r){return On.oauthCredentialFromTaggedObject(r.customData||{})}static oauthCredentialFromTaggedObject({_tokenResponse:r}){if(!r)return null;const{oauthIdToken:s,oauthAccessToken:l,oauthTokenSecret:d,pendingToken:f,nonce:S,providerId:M}=r;if(!l&&!d&&!s&&!f||!M)return null;try{return new On(M)._credential({idToken:s,accessToken:l,nonce:S,pendingToken:f})}catch{return null}}}let Lt=(()=>{class a extends Xn{constructor(){super("facebook.com")}static credential(s){return I._fromParams({providerId:a.PROVIDER_ID,signInMethod:a.FACEBOOK_SIGN_IN_METHOD,accessToken:s})}static credentialFromResult(s){return a.credentialFromTaggedObject(s)}static credentialFromError(s){return a.credentialFromTaggedObject(s.customData||{})}static credentialFromTaggedObject({_tokenResponse:s}){if(!s||!("oauthAccessToken"in s)||!s.oauthAccessToken)return null;try{return a.credential(s.oauthAccessToken)}catch{return null}}}return a.FACEBOOK_SIGN_IN_METHOD="facebook.com",a.PROVIDER_ID="facebook.com",a})(),ia=(()=>{class a extends Xn{constructor(){super("google.com"),this.addScope("profile")}static credential(s,l){return I._fromParams({providerId:a.PROVIDER_ID,signInMethod:a.GOOGLE_SIGN_IN_METHOD,idToken:s,accessToken:l})}static credentialFromResult(s){return a.credentialFromTaggedObject(s)}static credentialFromError(s){return a.credentialFromTaggedObject(s.customData||{})}static credentialFromTaggedObject({_tokenResponse:s}){if(!s)return null;const{oauthIdToken:l,oauthAccessToken:d}=s;if(!l&&!d)return null;try{return a.credential(l,d)}catch{return null}}}return a.GOOGLE_SIGN_IN_METHOD="google.com",a.PROVIDER_ID="google.com",a})(),ra=(()=>{class a extends Xn{constructor(){super("github.com")}static credential(s){return I._fromParams({providerId:a.PROVIDER_ID,signInMethod:a.GITHUB_SIGN_IN_METHOD,accessToken:s})}static credentialFromResult(s){return a.credentialFromTaggedObject(s)}static credentialFromError(s){return a.credentialFromTaggedObject(s.customData||{})}static credentialFromTaggedObject({_tokenResponse:s}){if(!s||!("oauthAccessToken"in s)||!s.oauthAccessToken)return null;try{return a.credential(s.oauthAccessToken)}catch{return null}}}return a.GITHUB_SIGN_IN_METHOD="github.com",a.PROVIDER_ID="github.com",a})();class Dn extends cn{constructor(r,s){super(r,r),this.pendingToken=s}_getIdTokenResponse(r){return zt(r,this.buildRequest())}_linkToIdToken(r,s){const l=this.buildRequest();return l.idToken=s,zt(r,l)}_getReauthenticationResolver(r){const s=this.buildRequest();return s.autoCreate=!1,zt(r,s)}toJSON(){return{signInMethod:this.signInMethod,providerId:this.providerId,pendingToken:this.pendingToken}}static fromJSON(r){const s="string"==typeof r?JSON.parse(r):r,{providerId:l,signInMethod:d,pendingToken:f}=s;return l&&d&&f&&l===d?new Dn(l,f):null}static _create(r,s){return new Dn(r,s)}buildRequest(){return{requestUri:"http://localhost",returnSecureToken:!0,pendingToken:this.pendingToken}}}class ei extends $e{constructor(r){F(r.startsWith("saml."),"argument-error"),super(r)}static credentialFromResult(r){return ei.samlCredentialFromTaggedObject(r)}static credentialFromError(r){return ei.samlCredentialFromTaggedObject(r.customData||{})}static credentialFromJSON(r){const s=Dn.fromJSON(r);return F(s,"argument-error"),s}static samlCredentialFromTaggedObject({_tokenResponse:r}){if(!r)return null;const{pendingToken:s,providerId:l}=r;if(!s||!l)return null;try{return Dn._create(l,s)}catch{return null}}}let Si=(()=>{class a extends Xn{constructor(){super("twitter.com")}static credential(s,l){return I._fromParams({providerId:a.PROVIDER_ID,signInMethod:a.TWITTER_SIGN_IN_METHOD,oauthToken:s,oauthTokenSecret:l})}static credentialFromResult(s){return a.credentialFromTaggedObject(s)}static credentialFromError(s){return a.credentialFromTaggedObject(s.customData||{})}static credentialFromTaggedObject({_tokenResponse:s}){if(!s)return null;const{oauthAccessToken:l,oauthTokenSecret:d}=s;if(!l||!d)return null;try{return a.credential(l,d)}catch{return null}}}return a.TWITTER_SIGN_IN_METHOD="twitter.com",a.PROVIDER_ID="twitter.com",a})();function ro(a,r){return dr.apply(this,arguments)}function dr(){return(dr=(0,m.Z)(function*(a,r){return oe(a,"POST","/v1/accounts:signUp",ce(a,r))})).apply(this,arguments)}class Mt{constructor(r){this.user=r.user,this.providerId=r.providerId,this._tokenResponse=r._tokenResponse,this.operationType=r.operationType}static _fromIdTokenResponse(r,s,l,d=!1){return(0,m.Z)(function*(){const f=yield dt._fromIdTokenResponse(r,l,d),S=so(l);return new Mt({user:f,providerId:S,_tokenResponse:l,operationType:s})})()}static _forOperation(r,s,l){return(0,m.Z)(function*(){yield r._updateTokensIfNecessary(l,!0);const d=so(l);return new Mt({user:r,providerId:d,_tokenResponse:l,operationType:s})})()}}function so(a){return a.providerId?a.providerId:"phoneNumber"in a?"phone":null}function oa(a){return hr.apply(this,arguments)}function hr(){return(hr=(0,m.Z)(function*(a){var r;const s=tt(a);if(yield s._initializationPromise,null!==(r=s.currentUser)&&void 0!==r&&r.isAnonymous)return new Mt({user:s.currentUser,providerId:null,operationType:"signIn"});const l=yield ro(s,{returnSecureToken:!0}),d=yield Mt._fromIdTokenResponse(s,"signIn",l,!0);return yield s._updateCurrentUser(d.user),d})).apply(this,arguments)}class tn extends w.ZR{constructor(r,s,l,d){var f;super(s.code,s.message),this.operationType=l,this.user=d,Object.setPrototypeOf(this,tn.prototype),this.customData={appName:r.name,tenantId:null!==(f=r.tenantId)&&void 0!==f?f:void 0,_serverResponse:s.customData._serverResponse,operationType:l}}static _fromErrorAndOperation(r,s,l,d){return new tn(r,s,l,d)}}function le(a,r,s,l){return("reauthenticate"===r?s._getReauthenticationResolver(a):s._getIdTokenResponse(a)).catch(f=>{throw"auth/multi-factor-auth-required"===f.code?tn._fromErrorAndOperation(a,f,r,l):f})}function wi(a){return new Set(a.map(({providerId:r})=>r).filter(r=>!!r))}function fr(a,r){return pr.apply(this,arguments)}function pr(){return pr=(0,m.Z)(function*(a,r){const s=(0,w.m9)(a);yield wt(!0,s,r);const{providerUserInfo:l}=yield function Jt(a,r){return V.apply(this,arguments)}(s.auth,{idToken:yield s.getIdToken(),deleteProvider:[r]}),d=wi(l||[]);return s.providerData=s.providerData.filter(f=>d.has(f.providerId)),d.has("phone")||(s.phoneNumber=null),yield s.auth._persistUserIfCurrent(s),s}),pr.apply(this,arguments)}function Ft(a,r){return ti.apply(this,arguments)}function ti(){return(ti=(0,m.Z)(function*(a,r,s=!1){const l=yield He(a,r._linkToIdToken(a.auth,yield a.getIdToken()),s);return Mt._forOperation(a,"link",l)})).apply(this,arguments)}function wt(a,r,s){return Jr.apply(this,arguments)}function Jr(){return(Jr=(0,m.Z)(function*(a,r,s){yield Ht(r);const d=!1===a?"provider-already-linked":"no-such-provider";F(wi(r.providerData).has(s)===a,r.auth,d)})).apply(this,arguments)}function vt(a,r){return Xr.apply(this,arguments)}function Xr(){return(Xr=(0,m.Z)(function*(a,r,s=!1){const{auth:l}=a,d="reauthenticate";try{const f=yield He(a,le(l,d,r,a),s);F(f.idToken,l,"internal-error");const S=kt(f.idToken);F(S,l,"internal-error");const{sub:M}=S;return F(a.uid===M,l,"user-mismatch"),Mt._forOperation(a,d,f)}catch(f){throw"auth/user-not-found"===f?.code&&Se(l,"user-mismatch"),f}})).apply(this,arguments)}function _r(a,r){return Ri.apply(this,arguments)}function Ri(){return(Ri=(0,m.Z)(function*(a,r,s=!1){const l="signIn",d=yield le(a,l,r),f=yield Mt._fromIdTokenResponse(a,l,d);return s||(yield a._updateCurrentUser(f.user)),f})).apply(this,arguments)}function gr(a,r){return mr.apply(this,arguments)}function mr(){return(mr=(0,m.Z)(function*(a,r){return _r(tt(a),r)})).apply(this,arguments)}function es(a,r){return vr.apply(this,arguments)}function vr(){return(vr=(0,m.Z)(function*(a,r){const s=(0,w.m9)(a);return yield wt(!1,s,r.providerId),Ft(s,r)})).apply(this,arguments)}function Ln(a,r){return yr.apply(this,arguments)}function yr(){return(yr=(0,m.Z)(function*(a,r){return vt((0,w.m9)(a),r)})).apply(this,arguments)}function ts(){return(ts=(0,m.Z)(function*(a,r){return oe(a,"POST","/v1/accounts:signInWithCustomToken",ce(a,r))})).apply(this,arguments)}function aa(a,r){return ns.apply(this,arguments)}function ns(){return ns=(0,m.Z)(function*(a,r){const s=tt(a),l=yield function oo(a,r){return ts.apply(this,arguments)}(s,{token:r,returnSecureToken:!0}),d=yield Mt._fromIdTokenResponse(s,"signIn",l);return yield s._updateCurrentUser(d.user),d}),ns.apply(this,arguments)}class Ce{constructor(r,s){this.factorId=r,this.uid=s.mfaEnrollmentId,this.enrollmentTime=new Date(s.enrolledAt).toUTCString(),this.displayName=s.displayName}static _fromServerResponse(r,s){return"phoneInfo"in s?is._fromServerResponse(r,s):Se(r,"internal-error")}}class is extends Ce{constructor(r){super("phone",r),this.phoneNumber=r.phoneInfo}static _fromServerResponse(r,s){return new is(s)}}function Ir(a,r,s){var l;F((null===(l=s.url)||void 0===l?void 0:l.length)>0,a,"invalid-continue-uri"),F(typeof s.dynamicLinkDomain>"u"||s.dynamicLinkDomain.length>0,a,"invalid-dynamic-link-domain"),r.continueUrl=s.url,r.dynamicLinkDomain=s.dynamicLinkDomain,r.canHandleCodeInApp=s.handleCodeInApp,s.iOS&&(F(s.iOS.bundleId.length>0,a,"missing-ios-bundle-id"),r.iOSBundleId=s.iOS.bundleId),s.android&&(F(s.android.packageName.length>0,a,"missing-android-pkg-name"),r.androidInstallApp=s.android.installApp,r.androidMinimumVersionCode=s.android.minimumVersion,r.androidPackageName=s.android.packageName)}function Er(a,r,s){return ki.apply(this,arguments)}function ki(){return ki=(0,m.Z)(function*(a,r,s){const l=(0,w.m9)(a),d={requestType:"PASSWORD_RESET",email:r};s&&Ir(l,d,s),yield function no(a,r){return Ei.apply(this,arguments)}(l,d)}),ki.apply(this,arguments)}function ni(a,r,s){return jt.apply(this,arguments)}function jt(){return(jt=(0,m.Z)(function*(a,r,s){yield sr((0,w.m9)(a),{oobCode:r,newPassword:s})})).apply(this,arguments)}function Pi(a,r){return ne.apply(this,arguments)}function ne(){return ne=(0,m.Z)(function*(a,r){yield function en(a,r){return mn.apply(this,arguments)}((0,w.m9)(a),{oobCode:r})}),ne.apply(this,arguments)}function ao(a,r){return Mn.apply(this,arguments)}function Mn(){return(Mn=(0,m.Z)(function*(a,r){const s=(0,w.m9)(a),l=yield sr(s,{oobCode:r}),d=l.requestType;switch(F(d,s,"internal-error"),d){case"EMAIL_SIGNIN":break;case"VERIFY_AND_CHANGE_EMAIL":F(l.newEmail,s,"internal-error");break;case"REVERT_SECOND_FACTOR_ADDITION":F(l.mfaInfo,s,"internal-error");default:F(l.email,s,"internal-error")}let f=null;return l.mfaInfo&&(f=Ce._fromServerResponse(tt(s),l.mfaInfo)),{data:{email:("VERIFY_AND_CHANGE_EMAIL"===l.requestType?l.newEmail:l.email)||null,previousEmail:("VERIFY_AND_CHANGE_EMAIL"===l.requestType?l.email:l.newEmail)||null,multiFactorInfo:f},operation:d}})).apply(this,arguments)}function la(a,r){return Fe.apply(this,arguments)}function Fe(){return(Fe=(0,m.Z)(function*(a,r){const{data:s}=yield ao((0,w.m9)(a),r);return s.email})).apply(this,arguments)}function rs(a,r,s){return ss.apply(this,arguments)}function ss(){return(ss=(0,m.Z)(function*(a,r,s){const l=tt(a),d=yield ro(l,{returnSecureToken:!0,email:r,password:s}),f=yield Mt._fromIdTokenResponse(l,"signIn",d);return yield l._updateCurrentUser(f.user),f})).apply(this,arguments)}function os(a,r,s){return gr((0,w.m9)(a),re.credential(r,s))}function lo(a,r,s){return vn.apply(this,arguments)}function vn(){return vn=(0,m.Z)(function*(a,r,s){const l=(0,w.m9)(a),d={requestType:"EMAIL_SIGNIN",email:r};F(s.handleCodeInApp,l,"argument-error"),s&&Ir(l,d,s),yield function io(a,r){return bn.apply(this,arguments)}(l,d)}),vn.apply(this,arguments)}function bi(a,r){return"EMAIL_SIGNIN"===Jn.parseLink(r)?.operation}function Ni(a,r,s){return as.apply(this,arguments)}function as(){return(as=(0,m.Z)(function*(a,r,s){const l=(0,w.m9)(a),d=re.credentialWithLink(r,s||Ze());return F(d._tenantId===(l.tenantId||null),l,"tenant-id-mismatch"),gr(l,d)})).apply(this,arguments)}function Fn(){return(Fn=(0,m.Z)(function*(a,r){return ye(a,"POST","/v1/accounts:createAuthUri",ce(a,r))})).apply(this,arguments)}function ua(a,r){return ii.apply(this,arguments)}function ii(){return ii=(0,m.Z)(function*(a,r){const l={identifier:r,continueUri:Re()?Ze():"http://localhost"},{signinMethods:d}=yield function ls(a,r){return Fn.apply(this,arguments)}((0,w.m9)(a),l);return d||[]}),ii.apply(this,arguments)}function ca(a,r){return us.apply(this,arguments)}function us(){return us=(0,m.Z)(function*(a,r){const s=(0,w.m9)(a),d={requestType:"VERIFY_EMAIL",idToken:yield a.getIdToken()};r&&Ir(s.auth,d,r);const{email:f}=yield function Yr(a,r){return Pn.apply(this,arguments)}(s.auth,d);f!==a.email&&(yield a.reload())}),us.apply(this,arguments)}function da(a,r,s){return Oi.apply(this,arguments)}function Oi(){return Oi=(0,m.Z)(function*(a,r,s){const l=(0,w.m9)(a),f={requestType:"VERIFY_AND_CHANGE_EMAIL",idToken:yield a.getIdToken(),newEmail:r};s&&Ir(l.auth,f,s);const{email:S}=yield function lr(a,r){return ur.apply(this,arguments)}(l.auth,f);S!==a.email&&(yield a.reload())}),Oi.apply(this,arguments)}function Di(){return(Di=(0,m.Z)(function*(a,r){return ye(a,"POST","/v1/accounts:update",r)})).apply(this,arguments)}function fa(a,r){return ri.apply(this,arguments)}function ri(){return ri=(0,m.Z)(function*(a,{displayName:r,photoURL:s}){if(void 0===r&&void 0===s)return;const l=(0,w.m9)(a),f={idToken:yield l.getIdToken(),displayName:r,photoUrl:s,returnSecureToken:!0},S=yield He(l,function ha(a,r){return Di.apply(this,arguments)}(l.auth,f));l.displayName=S.displayName||null,l.photoURL=S.photoUrl||null;const M=l.providerData.find(({providerId:H})=>"password"===H);M&&(M.displayName=l.displayName,M.photoURL=l.photoURL),yield l._updateTokensIfNecessary(S)}),ri.apply(this,arguments)}function uo(a,r){return xi((0,w.m9)(a),r,null)}function co(a,r){return xi((0,w.m9)(a),null,r)}function xi(a,r,s){return cs.apply(this,arguments)}function cs(){return(cs=(0,m.Z)(function*(a,r,s){const{auth:l}=a,f={idToken:yield a.getIdToken(),returnSecureToken:!0};r&&(f.email=r),s&&(f.password=s);const S=yield He(a,Qn(l,f));yield a._updateTokensIfNecessary(S,!0)})).apply(this,arguments)}class Yt{constructor(r,s,l={}){this.isNewUser=r,this.providerId=s,this.profile=l}}class Cr extends Yt{constructor(r,s,l,d){super(r,s,l),this.username=d}}class ds extends Yt{constructor(r,s){super(r,"facebook.com",s)}}class pa extends Cr{constructor(r,s){super(r,"github.com",s,"string"==typeof s?.login?s?.login:null)}}class _a extends Yt{constructor(r,s){super(r,"google.com",s)}}class ho extends Cr{constructor(r,s,l){super(r,"twitter.com",s,l)}}function ga(a){const{user:r,_tokenResponse:s}=a;return r.isAnonymous&&!s?{providerId:null,isNewUser:!1,profile:null}:function Tr(a){var r,s;if(!a)return null;const{providerId:l}=a,d=a.rawUserInfo?JSON.parse(a.rawUserInfo):{},f=a.isNewUser||"identitytoolkit#SignupNewUserResponse"===a.kind;if(!l&&a?.idToken){const S=null===(s=null===(r=kt(a.idToken))||void 0===r?void 0:r.firebase)||void 0===s?void 0:s.sign_in_provider;if(S)return new Yt(f,"anonymous"!==S&&"custom"!==S?S:null)}if(!l)return null;switch(l){case"facebook.com":return new ds(f,d);case"github.com":return new pa(f,d);case"google.com":return new _a(f,d);case"twitter.com":return new ho(f,d,a.screenName||null);case"custom":case"anonymous":return new Yt(f,null);default:return new Yt(f,l,d)}}(s)}class Wt{constructor(r,s,l){this.type=r,this.credential=s,this.auth=l}static _fromIdtoken(r,s){return new Wt("enroll",r,s)}static _fromMfaPendingCredential(r){return new Wt("signin",r)}toJSON(){return{multiFactorSession:{["enroll"===this.type?"idToken":"pendingCredential"]:this.credential}}}static fromJSON(r){var s,l;if(r?.multiFactorSession){if(null!==(s=r.multiFactorSession)&&void 0!==s&&s.pendingCredential)return Wt._fromMfaPendingCredential(r.multiFactorSession.pendingCredential);if(null!==(l=r.multiFactorSession)&&void 0!==l&&l.idToken)return Wt._fromIdtoken(r.multiFactorSession.idToken)}return null}}class nn{constructor(r,s,l){this.session=r,this.hints=s,this.signInResolver=l}static _fromError(r,s){const l=tt(r),d=s.customData._serverResponse,f=(d.mfaInfo||[]).map(M=>Ce._fromServerResponse(l,M));F(d.mfaPendingCredential,l,"internal-error");const S=Wt._fromMfaPendingCredential(d.mfaPendingCredential);return new nn(S,f,function(){var M=(0,m.Z)(function*(H){const j=yield H._process(l,S);delete d.mfaInfo,delete d.mfaPendingCredential;const se=Object.assign(Object.assign({},d),{idToken:j.idToken,refreshToken:j.refreshToken});switch(s.operationType){case"signIn":const Be=yield Mt._fromIdTokenResponse(l,s.operationType,se);return yield l._updateCurrentUser(Be.user),Be;case"reauthenticate":return F(s.user,l,"internal-error"),Mt._forOperation(s.user,s.operationType,se);default:Se(l,"internal-error")}});return function(H){return M.apply(this,arguments)}}())}resolveSignIn(r){var s=this;return(0,m.Z)(function*(){return s.signInResolver(r)})()}}function va(a,r){var s;const l=(0,w.m9)(a),d=r;return F(r.customData.operationType,l,"argument-error"),F(null===(s=d.customData._serverResponse)||void 0===s?void 0:s.mfaPendingCredential,l,"argument-error"),nn._fromError(l,d)}class fs{constructor(r){this.user=r,this.enrolledFactors=[],r._onReload(s=>{s.mfaInfo&&(this.enrolledFactors=s.mfaInfo.map(l=>Ce._fromServerResponse(r.auth,l)))})}static _fromUser(r){return new fs(r)}getSession(){var r=this;return(0,m.Z)(function*(){return Wt._fromIdtoken(yield r.user.getIdToken(),r.user.auth)})()}enroll(r,s){var l=this;return(0,m.Z)(function*(){const d=r,f=yield l.getSession(),S=yield He(l.user,d._process(l.user.auth,f,s));return yield l.user._updateTokensIfNecessary(S),l.user.reload()})()}unenroll(r){var s=this;return(0,m.Z)(function*(){const l="string"==typeof r?r:r.uid,d=yield s.user.getIdToken();try{const f=yield He(s.user,function Ia(a,r){return ye(a,"POST","/v2/accounts/mfaEnrollment:withdraw",ce(a,r))}(s.user.auth,{idToken:d,mfaEnrollmentId:l}));s.enrolledFactors=s.enrolledFactors.filter(({uid:S})=>S!==l),yield s.user._updateTokensIfNecessary(f),yield s.user.reload()}catch(f){throw f}})()}}const si=new WeakMap;function Mi(a){const r=(0,w.m9)(a);return si.has(r)||si.set(r,fs._fromUser(r)),si.get(r)}const Fi="__sak";class Ui{constructor(r,s){this.storageRetriever=r,this.type=s}_isAvailable(){try{return this.storage?(this.storage.setItem(Fi,"1"),this.storage.removeItem(Fi),Promise.resolve(!0)):Promise.resolve(!1)}catch{return Promise.resolve(!1)}}_set(r,s){return this.storage.setItem(r,JSON.stringify(s)),Promise.resolve()}_get(r){const s=this.storage.getItem(r);return Promise.resolve(s?JSON.parse(s):null)}_remove(r){return this.storage.removeItem(r),Promise.resolve()}get storage(){return this.storageRetriever()}}const Bt=(()=>{class a extends Ui{constructor(){super(()=>window.localStorage,"LOCAL"),this.boundEventHandler=(s,l)=>this.onStorageEvent(s,l),this.listeners={},this.localCache={},this.pollTimer=null,this.safariLocalStorageNotSynced=function Un(){const a=(0,w.z$)();return y(a)||Oe(a)}()&&function kn(){try{return!(!window||window===window.top)}catch{return!1}}(),this.fallbackToPolling=mt(),this._shouldAllowMigration=!0}forAllChangedKeys(s){for(const l of Object.keys(this.listeners)){const d=this.storage.getItem(l),f=this.localCache[l];d!==f&&s(l,f,d)}}onStorageEvent(s,l=!1){if(!s.key)return void this.forAllChangedKeys((M,H,j)=>{this.notifyListeners(M,j)});const d=s.key;if(l?this.detachListener():this.stopPolling(),this.safariLocalStorageNotSynced){const M=this.storage.getItem(d);if(s.newValue!==M)null!==s.newValue?this.storage.setItem(d,s.newValue):this.storage.removeItem(d);else if(this.localCache[d]===s.newValue&&!l)return}const f=()=>{const M=this.storage.getItem(d);!l&&this.localCache[d]===M||this.notifyListeners(d,M)},S=this.storage.getItem(d);!function ue(){return(0,w.w1)()&&10===document.documentMode}()||S===s.newValue||s.newValue===s.oldValue?f():setTimeout(f,10)}notifyListeners(s,l){this.localCache[s]=l;const d=this.listeners[s];if(d)for(const f of Array.from(d))f(l&&JSON.parse(l))}startPolling(){this.stopPolling(),this.pollTimer=setInterval(()=>{this.forAllChangedKeys((s,l,d)=>{this.onStorageEvent(new StorageEvent("storage",{key:s,oldValue:l,newValue:d}),!0)})},1e3)}stopPolling(){this.pollTimer&&(clearInterval(this.pollTimer),this.pollTimer=null)}attachListener(){window.addEventListener("storage",this.boundEventHandler)}detachListener(){window.removeEventListener("storage",this.boundEventHandler)}_addListener(s,l){0===Object.keys(this.listeners).length&&(this.fallbackToPolling?this.startPolling():this.attachListener()),this.listeners[s]||(this.listeners[s]=new Set,this.localCache[s]=this.storage.getItem(s)),this.listeners[s].add(l)}_removeListener(s,l){this.listeners[s]&&(this.listeners[s].delete(l),0===this.listeners[s].size&&delete this.listeners[s]),0===Object.keys(this.listeners).length&&(this.detachListener(),this.stopPolling())}_set(s,l){var d=()=>super._set,f=this;return(0,m.Z)(function*(){yield d().call(f,s,l),f.localCache[s]=JSON.stringify(l)})()}_get(s){var l=()=>super._get,d=this;return(0,m.Z)(function*(){const f=yield l().call(d,s);return d.localCache[s]=JSON.stringify(f),f})()}_remove(s){var l=()=>super._remove,d=this;return(0,m.Z)(function*(){yield l().call(d,s),delete d.localCache[s]})()}}return a.type="LOCAL",a})(),Wi=(()=>{class a extends Ui{constructor(){super(()=>window.sessionStorage,"SESSION")}_addListener(s,l){}_removeListener(s,l){}}return a.type="SESSION",a})();let _s=(()=>{class a{constructor(s){this.eventTarget=s,this.handlersMap={},this.boundEventHandler=this.handleEvent.bind(this)}static _getInstance(s){const l=this.receivers.find(f=>f.isListeningto(s));if(l)return l;const d=new a(s);return this.receivers.push(d),d}isListeningto(s){return this.eventTarget===s}handleEvent(s){var l=this;return(0,m.Z)(function*(){const d=s,{eventId:f,eventType:S,data:M}=d.data,H=l.handlersMap[S];if(!H?.size)return;d.ports[0].postMessage({status:"ack",eventId:f,eventType:S});const j=Array.from(H).map(function(){var Be=(0,m.Z)(function*(on){return on(d.origin,M)});return function(on){return Be.apply(this,arguments)}}()),se=yield function go(a){return Promise.all(a.map(function(){var r=(0,m.Z)(function*(s){try{return{fulfilled:!0,value:yield s}}catch(l){return{fulfilled:!1,reason:l}}});return function(s){return r.apply(this,arguments)}}()))}(j);d.ports[0].postMessage({status:"done",eventId:f,eventType:S,response:se})})()}_subscribe(s,l){0===Object.keys(this.handlersMap).length&&this.eventTarget.addEventListener("message",this.boundEventHandler),this.handlersMap[s]||(this.handlersMap[s]=new Set),this.handlersMap[s].add(l)}_unsubscribe(s,l){this.handlersMap[s]&&l&&this.handlersMap[s].delete(l),(!l||0===this.handlersMap[s].size)&&delete this.handlersMap[s],0===Object.keys(this.handlersMap).length&&this.eventTarget.removeEventListener("message",this.boundEventHandler)}}return a.receivers=[],a})();function Qt(a="",r=10){let s="";for(let l=0;l<r;l++)s+=Math.floor(10*Math.random());return a+s}class mo{constructor(r){this.target=r,this.handlers=new Set}removeMessageHandler(r){r.messageChannel&&(r.messageChannel.port1.removeEventListener("message",r.onMessage),r.messageChannel.port1.close()),this.handlers.delete(r)}_send(r,s,l=50){var d=this;return(0,m.Z)(function*(){const f=typeof MessageChannel<"u"?new MessageChannel:null;if(!f)throw new Error("connection_unavailable");let S,M;return new Promise((H,j)=>{const se=Qt("",20);f.port1.start();const Be=setTimeout(()=>{j(new Error("unsupported_event"))},l);M={messageChannel:f,onMessage(on){const Tn=on;if(Tn.data.eventId===se)switch(Tn.data.status){case"ack":clearTimeout(Be),S=setTimeout(()=>{j(new Error("timeout"))},3e3);break;case"done":clearTimeout(S),H(Tn.data.response);break;default:clearTimeout(Be),clearTimeout(S),j(new Error("invalid_response"))}}},d.handlers.add(M),f.port1.addEventListener("message",M.onMessage),d.target.postMessage({eventType:r,eventId:se,data:s},[f.port2])}).finally(()=>{M&&d.removeMessageHandler(M)})})()}}function De(){return window}function yn(){return typeof De().WorkerGlobalScope<"u"&&"function"==typeof De().importScripts}function oi(){return(oi=(0,m.Z)(function*(){if(!navigator?.serviceWorker)return null;try{return(yield navigator.serviceWorker.ready).active}catch{return null}})).apply(this,arguments)}const yo="firebaseLocalStorageDb",Aa=1,wr="firebaseLocalStorage",Io="fbase_key";class Bi{constructor(r){this.request=r}toPromise(){return new Promise((r,s)=>{this.request.addEventListener("success",()=>{r(this.request.result)}),this.request.addEventListener("error",()=>{s(this.request.error)})})}}function Vi(a,r){return a.transaction([wr],r?"readwrite":"readonly").objectStore(wr)}function ms(){const a=indexedDB.open(yo,Aa);return new Promise((r,s)=>{a.addEventListener("error",()=>{s(a.error)}),a.addEventListener("upgradeneeded",()=>{const l=a.result;try{l.createObjectStore(wr,{keyPath:Io})}catch(d){s(d)}}),a.addEventListener("success",(0,m.Z)(function*(){const l=a.result;l.objectStoreNames.contains(wr)?r(l):(l.close(),yield function Eo(){const a=indexedDB.deleteDatabase(yo);return new Bi(a).toPromise()}(),r(yield ms()))}))})}function To(a,r,s){return vs.apply(this,arguments)}function vs(){return(vs=(0,m.Z)(function*(a,r,s){const l=Vi(a,!0).put({[Io]:r,value:s});return new Bi(l).toPromise()})).apply(this,arguments)}function ys(){return(ys=(0,m.Z)(function*(a,r){const s=Vi(a,!1).get(r),l=yield new Bi(s).toPromise();return void 0===l?null:l.value})).apply(this,arguments)}function Co(a,r){const s=Vi(a,!0).delete(r);return new Bi(s).toPromise()}const Zi=(()=>{class a{constructor(){this.type="LOCAL",this._shouldAllowMigration=!0,this.listeners={},this.localCache={},this.pollTimer=null,this.pendingWrites=0,this.receiver=null,this.sender=null,this.serviceWorkerReceiverAvailable=!1,this.activeServiceWorker=null,this._workerInitializationPromise=this.initializeServiceWorkerMessaging().then(()=>{},()=>{})}_openDb(){var s=this;return(0,m.Z)(function*(){return s.db||(s.db=yield ms()),s.db})()}_withRetries(s){var l=this;return(0,m.Z)(function*(){let d=0;for(;;)try{const f=yield l._openDb();return yield s(f)}catch(f){if(d++>3)throw f;l.db&&(l.db.close(),l.db=void 0)}})()}initializeServiceWorkerMessaging(){var s=this;return(0,m.Z)(function*(){return yn()?s.initializeReceiver():s.initializeSender()})()}initializeReceiver(){var s=this;return(0,m.Z)(function*(){s.receiver=_s._getInstance(function Ca(){return yn()?self:null}()),s.receiver._subscribe("keyChanged",function(){var l=(0,m.Z)(function*(d,f){return{keyProcessed:(yield s._poll()).includes(f.key)}});return function(d,f){return l.apply(this,arguments)}}()),s.receiver._subscribe("ping",function(){var l=(0,m.Z)(function*(d,f){return["keyChanged"]});return function(d,f){return l.apply(this,arguments)}}())})()}initializeSender(){var s=this;return(0,m.Z)(function*(){var l,d;if(s.activeServiceWorker=yield function vo(){return oi.apply(this,arguments)}(),!s.activeServiceWorker)return;s.sender=new mo(s.activeServiceWorker);const f=yield s.sender._send("ping",{},800);f&&null!==(l=f[0])&&void 0!==l&&l.fulfilled&&null!==(d=f[0])&&void 0!==d&&d.value.includes("keyChanged")&&(s.serviceWorkerReceiverAvailable=!0)})()}notifyServiceWorker(s){var l=this;return(0,m.Z)(function*(){if(l.sender&&l.activeServiceWorker&&function Ta(){var a;return(null===(a=navigator?.serviceWorker)||void 0===a?void 0:a.controller)||null}()===l.activeServiceWorker)try{yield l.sender._send("keyChanged",{key:s},l.serviceWorkerReceiverAvailable?800:50)}catch{}})()}_isAvailable(){return(0,m.Z)(function*(){try{if(!indexedDB)return!1;const s=yield ms();return yield To(s,Fi,"1"),yield Co(s,Fi),!0}catch{}return!1})()}_withPendingWrite(s){var l=this;return(0,m.Z)(function*(){l.pendingWrites++;try{yield s()}finally{l.pendingWrites--}})()}_set(s,l){var d=this;return(0,m.Z)(function*(){return d._withPendingWrite((0,m.Z)(function*(){return yield d._withRetries(f=>To(f,s,l)),d.localCache[s]=l,d.notifyServiceWorker(s)}))})()}_get(s){var l=this;return(0,m.Z)(function*(){const d=yield l._withRetries(f=>function Sa(a,r){return ys.apply(this,arguments)}(f,s));return l.localCache[s]=d,d})()}_remove(s){var l=this;return(0,m.Z)(function*(){return l._withPendingWrite((0,m.Z)(function*(){return yield l._withRetries(d=>Co(d,s)),delete l.localCache[s],l.notifyServiceWorker(s)}))})()}_poll(){var s=this;return(0,m.Z)(function*(){const l=yield s._withRetries(S=>{const M=Vi(S,!1).getAll();return new Bi(M).toPromise()});if(!l)return[];if(0!==s.pendingWrites)return[];const d=[],f=new Set;for(const{fbase_key:S,value:M}of l)f.add(S),JSON.stringify(s.localCache[S])!==JSON.stringify(M)&&(s.notifyListeners(S,M),d.push(S));for(const S of Object.keys(s.localCache))s.localCache[S]&&!f.has(S)&&(s.notifyListeners(S,null),d.push(S));return d})()}notifyListeners(s,l){this.localCache[s]=l;const d=this.listeners[s];if(d)for(const f of Array.from(d))f(l)}startPolling(){var s=this;this.stopPolling(),this.pollTimer=setInterval((0,m.Z)(function*(){return s._poll()}),800)}stopPolling(){this.pollTimer&&(clearInterval(this.pollTimer),this.pollTimer=null)}_addListener(s,l){0===Object.keys(this.listeners).length&&this.startPolling(),this.listeners[s]||(this.listeners[s]=new Set,this._get(s)),this.listeners[s].add(l)}_removeListener(s,l){this.listeners[s]&&(this.listeners[s].delete(l),0===this.listeners[s].size&&delete this.listeners[s]),0===Object.keys(this.listeners).length&&this.stopPolling()}}return a.type="LOCAL",a})();function kr(){return(kr=(0,m.Z)(function*(a){return(yield ye(a,"GET","/v1/recaptchaParams")).recaptchaSiteKey||""})).apply(this,arguments)}function So(a){return new Promise((r,s)=>{const l=document.createElement("script");l.setAttribute("src",a),l.onload=r,l.onerror=d=>{const f=ve("internal-error");f.customData=d,s(f)},l.type="text/javascript",l.charset="UTF-8",function ka(){var a,r;return null!==(r=null===(a=document.getElementsByTagName("head"))||void 0===a?void 0:a[0])&&void 0!==r?r:document}().appendChild(l)})}function Ts(a){return`__${a}${Math.floor(1e6*Math.random())}`}const Pr=1e12;class ba{constructor(r){this.auth=r,this.counter=Pr,this._widgets=new Map}render(r,s){const l=this.counter;return this._widgets.set(l,new Na(r,this.auth.name,s||{})),this.counter++,l}reset(r){var s;const l=r||Pr;null===(s=this._widgets.get(l))||void 0===s||s.delete(),this._widgets.delete(l)}getResponse(r){var s;return(null===(s=this._widgets.get(r||Pr))||void 0===s?void 0:s.getResponse())||""}execute(r){var s=this;return(0,m.Z)(function*(){var l;return null===(l=s._widgets.get(r||Pr))||void 0===l||l.execute(),""})()}}class Na{constructor(r,s,l){this.params=l,this.timerId=null,this.deleted=!1,this.responseToken=null,this.clickHandler=()=>{this.execute()};const d="string"==typeof r?document.getElementById(r):r;F(d,"argument-error",{appName:s}),this.container=d,this.isVisible="invisible"!==this.params.size,this.isVisible?this.execute():this.container.addEventListener("click",this.clickHandler)}getResponse(){return this.checkIfDeleted(),this.responseToken}delete(){this.checkIfDeleted(),this.deleted=!0,this.timerId&&(clearTimeout(this.timerId),this.timerId=null),this.container.removeEventListener("click",this.clickHandler)}execute(){this.checkIfDeleted(),!this.timerId&&(this.timerId=window.setTimeout(()=>{this.responseToken=function wo(a){const r=[],s="1234567890abcdefghijklmnopqrstuvwxyzABCDEFGHIJKLMNOPQRSTUVWXYZ";for(let l=0;l<a;l++)r.push(s.charAt(Math.floor(Math.random()*s.length)));return r.join("")}(50);const{callback:r,"expired-callback":s}=this.params;if(r)try{r(this.responseToken)}catch{}this.timerId=window.setTimeout(()=>{if(this.timerId=null,this.responseToken=null,s)try{s()}catch{}this.isVisible&&this.execute()},6e4)},500))}checkIfDeleted(){if(this.deleted)throw new Error("reCAPTCHA mock was already deleted!")}}const ai=Ts("rcb"),As=new Me(3e4,6e4);class Oa{constructor(){var r;this.hostLanguage="",this.counter=0,this.librarySeparatelyLoaded=!(null===(r=De().grecaptcha)||void 0===r||!r.render)}load(r,s=""){return F(function ko(a){return a.length<=6&&/^\s*[a-zA-Z0-9\-]*\s*$/.test(a)}(s),r,"argument-error"),this.shouldResolveImmediately(s)?Promise.resolve(De().grecaptcha):new Promise((l,d)=>{const f=De().setTimeout(()=>{d(ve(r,"network-request-failed"))},As.get());De()[ai]=()=>{De().clearTimeout(f),delete De()[ai];const M=De().grecaptcha;if(!M)return void d(ve(r,"internal-error"));const H=M.render;M.render=(j,se)=>{const Be=H(j,se);return this.counter++,Be},this.hostLanguage=s,l(M)},So(`https://www.google.com/recaptcha/api.js??${(0,w.xO)({onload:ai,render:"explicit",hl:s})}`).catch(()=>{clearTimeout(f),d(ve(r,"internal-error"))})})}clearedOneInstance(){this.counter--}shouldResolveImmediately(r){var s;return!(null===(s=De().grecaptcha)||void 0===s||!s.render)&&(r===this.hostLanguage||this.counter>0||this.librarySeparatelyLoaded)}}class Ss{load(r){return(0,m.Z)(function*(){return new ba(r)})()}clearedOneInstance(){}}const Po="recaptcha",Da={theme:"light",type:"image"};class xa{constructor(r,s=Object.assign({},Da),l){this.parameters=s,this.type=Po,this.destroyed=!1,this.widgetId=null,this.tokenChangeListeners=new Set,this.renderPromise=null,this.recaptcha=null,this.auth=tt(l),this.isInvisible="invisible"===this.parameters.size,F(typeof document<"u",this.auth,"operation-not-supported-in-this-environment");const d="string"==typeof r?document.getElementById(r):r;F(d,this.auth,"argument-error"),this.container=d,this.parameters.callback=this.makeTokenCallback(this.parameters.callback),this._recaptchaLoader=this.auth.settings.appVerificationDisabledForTesting?new Ss:new Oa,this.validateStartingState()}verify(){var r=this;return(0,m.Z)(function*(){r.assertNotDestroyed();const s=yield r.render(),l=r.getAssertedRecaptcha();return l.getResponse(s)||new Promise(f=>{const S=M=>{M&&(r.tokenChangeListeners.delete(S),f(M))};r.tokenChangeListeners.add(S),r.isInvisible&&l.execute(s)})})()}render(){try{this.assertNotDestroyed()}catch(r){return Promise.reject(r)}return this.renderPromise||(this.renderPromise=this.makeRenderPromise().catch(r=>{throw this.renderPromise=null,r})),this.renderPromise}_reset(){this.assertNotDestroyed(),null!==this.widgetId&&this.getAssertedRecaptcha().reset(this.widgetId)}clear(){this.assertNotDestroyed(),this.destroyed=!0,this._recaptchaLoader.clearedOneInstance(),this.isInvisible||this.container.childNodes.forEach(r=>{this.container.removeChild(r)})}validateStartingState(){F(!this.parameters.sitekey,this.auth,"argument-error"),F(this.isInvisible||!this.container.hasChildNodes(),this.auth,"argument-error"),F(typeof document<"u",this.auth,"operation-not-supported-in-this-environment")}makeTokenCallback(r){return s=>{if(this.tokenChangeListeners.forEach(l=>l(s)),"function"==typeof r)r(s);else if("string"==typeof r){const l=De()[r];"function"==typeof l&&l(s)}}}assertNotDestroyed(){F(!this.destroyed,this.auth,"internal-error")}makeRenderPromise(){var r=this;return(0,m.Z)(function*(){if(yield r.init(),!r.widgetId){let s=r.container;if(!r.isInvisible){const l=document.createElement("div");s.appendChild(l),s=l}r.widgetId=r.getAssertedRecaptcha().render(s,r.parameters)}return r.widgetId})()}init(){var r=this;return(0,m.Z)(function*(){F(Re()&&!yn(),r.auth,"internal-error"),yield function La(){let a=null;return new Promise(r=>{"complete"!==document.readyState?(a=()=>r(),window.addEventListener("load",a)):r()}).catch(r=>{throw a&&window.removeEventListener("load",a),r})}(),r.recaptcha=yield r._recaptchaLoader.load(r.auth,r.auth.languageCode||void 0);const s=yield function Ao(a){return kr.apply(this,arguments)}(r.auth);F(s,r.auth,"internal-error"),r.parameters.sitekey=s})()}getAssertedRecaptcha(){return F(this.recaptcha,this.auth,"internal-error"),this.recaptcha}}class ws{constructor(r,s){this.verificationId=r,this.onConfirmation=s}confirm(r){const s=Je._fromVerification(this.verificationId,r);return this.onConfirmation(s)}}function Ma(a,r,s){return Rs.apply(this,arguments)}function Rs(){return(Rs=(0,m.Z)(function*(a,r,s){const l=tt(a),d=yield Nr(l,r,(0,w.m9)(s));return new ws(d,f=>gr(l,f))})).apply(this,arguments)}function bo(a,r,s){return ks.apply(this,arguments)}function ks(){return(ks=(0,m.Z)(function*(a,r,s){const l=(0,w.m9)(a);yield wt(!1,l,"phone");const d=yield Nr(l.auth,r,(0,w.m9)(s));return new ws(d,f=>es(l,f))})).apply(this,arguments)}function No(a,r,s){return br.apply(this,arguments)}function br(){return(br=(0,m.Z)(function*(a,r,s){const l=(0,w.m9)(a),d=yield Nr(l.auth,r,(0,w.m9)(s));return new ws(d,f=>Ln(l,f))})).apply(this,arguments)}function Nr(a,r,s){return Or.apply(this,arguments)}function Or(){return Or=(0,m.Z)(function*(a,r,s){var l;const d=yield s.verify();try{let f;if(F("string"==typeof d,a,"argument-error"),F(s.type===Po,a,"argument-error"),f="string"==typeof r?{phoneNumber:r}:r,"session"in f){const S=f.session;if("phoneNumber"in f)return F("enroll"===S.type,a,"internal-error"),(yield function ya(a,r){return ye(a,"POST","/v2/accounts/mfaEnrollment:start",ce(a,r))}(a,{idToken:S.credential,phoneEnrollmentInfo:{phoneNumber:f.phoneNumber,recaptchaToken:d}})).phoneSessionInfo.sessionInfo;{F("signin"===S.type,a,"internal-error");const M=(null===(l=f.multiFactorHint)||void 0===l?void 0:l.uid)||f.multiFactorUid;return F(M,a,"missing-multi-factor-info"),(yield function Ra(a,r){return ye(a,"POST","/v2/accounts/mfaSignIn:start",ce(a,r))}(a,{mfaPendingCredential:S.credential,mfaEnrollmentId:M,phoneSignInInfo:{recaptchaToken:d}})).phoneResponseInfo.sessionInfo}}{const{sessionInfo:S}=yield function R(a,r){return O.apply(this,arguments)}(a,{phoneNumber:f.phoneNumber,recaptchaToken:d});return S}}finally{s._reset()}}),Or.apply(this,arguments)}function Dr(a,r){return xr.apply(this,arguments)}function xr(){return(xr=(0,m.Z)(function*(a,r){yield Ft((0,w.m9)(a),r)})).apply(this,arguments)}let Fa=(()=>{class a{constructor(s){this.providerId=a.PROVIDER_ID,this.auth=tt(s)}verifyPhoneNumber(s,l){return Nr(this.auth,s,(0,w.m9)(l))}static credential(s,l){return Je._fromVerification(s,l)}static credentialFromResult(s){return a.credentialFromTaggedObject(s)}static credentialFromError(s){return a.credentialFromTaggedObject(s.customData||{})}static credentialFromTaggedObject({_tokenResponse:s}){if(!s)return null;const{phoneNumber:l,temporaryProof:d}=s;return l&&d?Je._fromTokenResponse(l,d):null}}return a.PROVIDER_ID="phone",a.PHONE_SIGN_IN_METHOD="phone",a})();function Wn(a,r){return r?p(r):(F(a._popupRedirectResolver,a,"argument-error"),a._popupRedirectResolver)}class Ps extends cn{constructor(r){super("custom","custom"),this.params=r}_getIdTokenResponse(r){return zt(r,this._buildIdpRequest())}_linkToIdToken(r,s){return zt(r,this._buildIdpRequest(s))}_getReauthenticationResolver(r){return zt(r,this._buildIdpRequest())}_buildIdpRequest(r){const s={requestUri:this.params.requestUri,sessionId:this.params.sessionId,postBody:this.params.postBody,tenantId:this.params.tenantId,pendingToken:this.params.pendingToken,returnSecureToken:!0,returnIdpCredential:!0};return r&&(s.idToken=r),s}}function bs(a){return _r(a.auth,new Ps(a),a.bypassAuthState)}function Oo(a){const{auth:r,user:s}=a;return F(s,r,"internal-error"),vt(s,new Ps(a),a.bypassAuthState)}function Ua(a){return Ns.apply(this,arguments)}function Ns(){return(Ns=(0,m.Z)(function*(a){const{auth:r,user:s}=a;return F(s,r,"internal-error"),Ft(s,new Ps(a),a.bypassAuthState)})).apply(this,arguments)}class Os{constructor(r,s,l,d,f=!1){this.auth=r,this.resolver=l,this.user=d,this.bypassAuthState=f,this.pendingPromise=null,this.eventManager=null,this.filter=Array.isArray(s)?s:[s]}execute(){var r=this;return new Promise(function(){var s=(0,m.Z)(function*(l,d){r.pendingPromise={resolve:l,reject:d};try{r.eventManager=yield r.resolver._initialize(r.auth),yield r.onExecution(),r.eventManager.registerConsumer(r)}catch(f){r.reject(f)}});return function(l,d){return s.apply(this,arguments)}}())}onAuthEvent(r){var s=this;return(0,m.Z)(function*(){const{urlResponse:l,sessionId:d,postBody:f,tenantId:S,error:M,type:H}=r;if(M)return void s.reject(M);const j={auth:s.auth,requestUri:l,sessionId:d,tenantId:S||void 0,postBody:f||void 0,user:s.user,bypassAuthState:s.bypassAuthState};try{s.resolve(yield s.getIdpTask(H)(j))}catch(se){s.reject(se)}})()}onError(r){this.reject(r)}getIdpTask(r){switch(r){case"signInViaPopup":case"signInViaRedirect":return bs;case"linkViaPopup":case"linkViaRedirect":return Ua;case"reauthViaPopup":case"reauthViaRedirect":return Oo;default:Se(this.auth,"internal-error")}}resolve(r){Qe(this.pendingPromise,"Pending promise was never set"),this.pendingPromise.resolve(r),this.unregisterAndCleanUp()}reject(r){Qe(this.pendingPromise,"Pending promise was never set"),this.pendingPromise.reject(r),this.unregisterAndCleanUp()}unregisterAndCleanUp(){this.eventManager&&this.eventManager.unregisterConsumer(this),this.pendingPromise=null,this.cleanUp()}}const In=new Me(2e3,1e4);function Do(a,r,s){return Lr.apply(this,arguments)}function Lr(){return(Lr=(0,m.Z)(function*(a,r,s){const l=tt(a);je(a,r,$e);const d=Wn(l,s);return new xs(l,"signInViaPopup",r,d).executeNotNull()})).apply(this,arguments)}function En(a,r,s){return li.apply(this,arguments)}function li(){return(li=(0,m.Z)(function*(a,r,s){const l=(0,w.m9)(a);je(l.auth,r,$e);const d=Wn(l.auth,s);return new xs(l.auth,"reauthViaPopup",r,d,l).executeNotNull()})).apply(this,arguments)}function Mr(a,r,s){return Ds.apply(this,arguments)}function Ds(){return(Ds=(0,m.Z)(function*(a,r,s){const l=(0,w.m9)(a);je(l.auth,r,$e);const d=Wn(l.auth,s);return new xs(l.auth,"linkViaPopup",r,d,l).executeNotNull()})).apply(this,arguments)}let xs=(()=>{class a extends Os{constructor(s,l,d,f,S){super(s,l,f,S),this.provider=d,this.authWindow=null,this.pollId=null,a.currentPopupAction&&a.currentPopupAction.cancel(),a.currentPopupAction=this}executeNotNull(){var s=this;return(0,m.Z)(function*(){const l=yield s.execute();return F(l,s.auth,"internal-error"),l})()}onExecution(){var s=this;return(0,m.Z)(function*(){Qe(1===s.filter.length,"Popup operations only handle one event");const l=Qt();s.authWindow=yield s.resolver._openPopup(s.auth,s.provider,s.filter[0],l),s.authWindow.associatedEvent=l,s.resolver._originValidation(s.auth).catch(d=>{s.reject(d)}),s.resolver._isIframeWebStorageSupported(s.auth,d=>{d||s.reject(ve(s.auth,"web-storage-unsupported"))}),s.pollUserCancellation()})()}get eventId(){var s;return(null===(s=this.authWindow)||void 0===s?void 0:s.associatedEvent)||null}cancel(){this.reject(ve(this.auth,"cancelled-popup-request"))}cleanUp(){this.authWindow&&this.authWindow.close(),this.pollId&&window.clearTimeout(this.pollId),this.authWindow=null,this.pollId=null,a.currentPopupAction=null}pollUserCancellation(){const s=()=>{var l,d;this.pollId=null!==(d=null===(l=this.authWindow)||void 0===l?void 0:l.window)&&void 0!==d&&d.closed?window.setTimeout(()=>{this.pollId=null,this.reject(ve(this.auth,"popup-closed-by-user"))},2e3):window.setTimeout(s,In.get())};s()}}return a.currentPopupAction=null,a})();const Wa="pendingRedirect",ui=new Map;class Ls extends Os{constructor(r,s,l=!1){super(r,["signInViaRedirect","linkViaRedirect","reauthViaRedirect","unknown"],s,void 0,l),this.eventId=null}execute(){var r=()=>super.execute,s=this;return(0,m.Z)(function*(){let l=ui.get(s.auth._key());if(!l){try{const f=(yield function Ba(a,r){return rn.apply(this,arguments)}(s.resolver,s.auth))?yield r().call(s):null;l=()=>Promise.resolve(f)}catch(d){l=()=>Promise.reject(d)}ui.set(s.auth._key(),l)}return s.bypassAuthState||ui.set(s.auth._key(),()=>Promise.resolve(null)),l()})()}onAuthEvent(r){var s=()=>super.onAuthEvent,l=this;return(0,m.Z)(function*(){if("signInViaRedirect"===r.type)return s().call(l,r);if("unknown"!==r.type){if(r.eventId){const d=yield l.auth._redirectUserForId(r.eventId);if(d)return l.user=d,s().call(l,r);l.resolve(null)}}else l.resolve(null)})()}onExecution(){return(0,m.Z)(function*(){})()}cleanUp(){}}function rn(){return(rn=(0,m.Z)(function*(a,r){const s=Fs(r),l=Hi(a);if(!(yield l._isAvailable()))return!1;const d="true"===(yield l._get(s));return yield l._remove(s),d})).apply(this,arguments)}function Bn(a,r){return Ms.apply(this,arguments)}function Ms(){return(Ms=(0,m.Z)(function*(a,r){return Hi(a)._set(Fs(r),"true")})).apply(this,arguments)}function Va(){ui.clear()}function xo(a,r){ui.set(a._key(),r)}function Hi(a){return p(a._redirectPersistence)}function Fs(a){return Xt(Wa,a.config.apiKey,a.name)}function Za(a,r,s){return function Us(a,r,s){return ci.apply(this,arguments)}(a,r,s)}function ci(){return(ci=(0,m.Z)(function*(a,r,s){const l=tt(a);je(a,r,$e),yield l._initializationPromise;const d=Wn(l,s);return yield Bn(d,l),d._openRedirect(l,r,"signInViaRedirect")})).apply(this,arguments)}function Ha(a,r,s){return function di(a,r,s){return Fr.apply(this,arguments)}(a,r,s)}function Fr(){return(Fr=(0,m.Z)(function*(a,r,s){const l=(0,w.m9)(a);je(l.auth,r,$e),yield l.auth._initializationPromise;const d=Wn(l.auth,s);yield Bn(d,l.auth);const f=yield Fo(l);return d._openRedirect(l.auth,r,"reauthViaRedirect",f)})).apply(this,arguments)}function Lo(a,r,s){return function Mo(a,r,s){return Vn.apply(this,arguments)}(a,r,s)}function Vn(){return(Vn=(0,m.Z)(function*(a,r,s){const l=(0,w.m9)(a);je(l.auth,r,$e),yield l.auth._initializationPromise;const d=Wn(l.auth,s);yield wt(!1,l,r.providerId),yield Bn(d,l.auth);const f=yield Fo(l);return d._openRedirect(l.auth,r,"linkViaRedirect",f)})).apply(this,arguments)}function Ur(a,r){return Gi.apply(this,arguments)}function Gi(){return(Gi=(0,m.Z)(function*(a,r){return yield tt(a)._initializationPromise,$i(a,r,!1)})).apply(this,arguments)}function $i(a,r){return Ki.apply(this,arguments)}function Ki(){return(Ki=(0,m.Z)(function*(a,r,s=!1){const l=tt(a),d=Wn(l,r),S=yield new Ls(l,d,s).execute();return S&&!s&&(delete S.user._redirectEventId,yield l._persistUserIfCurrent(S.user),yield l._setRedirectUser(null,r)),S})).apply(this,arguments)}function Fo(a){return Zn.apply(this,arguments)}function Zn(){return(Zn=(0,m.Z)(function*(a){const r=Qt(`${a.uid}:::`);return a._redirectEventId=r,yield a.auth._setRedirectUser(a),yield a.auth._persistUserIfCurrent(a),r})).apply(this,arguments)}class Uo{constructor(r){this.auth=r,this.cachedEventUids=new Set,this.consumers=new Set,this.queuedRedirectEvent=null,this.hasHandledPotentialRedirect=!1,this.lastProcessedEventTime=Date.now()}registerConsumer(r){this.consumers.add(r),this.queuedRedirectEvent&&this.isEventForConsumer(this.queuedRedirectEvent,r)&&(this.sendToConsumer(this.queuedRedirectEvent,r),this.saveEventToCache(this.queuedRedirectEvent),this.queuedRedirectEvent=null)}unregisterConsumer(r){this.consumers.delete(r)}onEvent(r){if(this.hasEventBeenHandled(r))return!1;let s=!1;return this.consumers.forEach(l=>{this.isEventForConsumer(r,l)&&(s=!0,this.sendToConsumer(r,l),this.saveEventToCache(r))}),this.hasHandledPotentialRedirect||!function Ws(a){switch(a.type){case"signInViaRedirect":case"linkViaRedirect":case"reauthViaRedirect":return!0;case"unknown":return Wr(a);default:return!1}}(r)||(this.hasHandledPotentialRedirect=!0,s||(this.queuedRedirectEvent=r,s=!0)),s}sendToConsumer(r,s){var l;if(r.error&&!Wr(r)){const d=(null===(l=r.error.code)||void 0===l?void 0:l.split("auth/")[1])||"internal-error";s.onError(ve(this.auth,d))}else s.onAuthEvent(r)}isEventForConsumer(r,s){const l=null===s.eventId||!!r.eventId&&r.eventId===s.eventId;return s.filter.includes(r.type)&&l}hasEventBeenHandled(r){return Date.now()-this.lastProcessedEventTime>=6e5&&this.cachedEventUids.clear(),this.cachedEventUids.has(Wo(r))}saveEventToCache(r){this.cachedEventUids.add(Wo(r)),this.lastProcessedEventTime=Date.now()}}function Wo(a){return[a.type,a.eventId,a.sessionId,a.tenantId].filter(r=>r).join("-")}function Wr({type:a,error:r}){return"unknown"===a&&"auth/no-auth-event"===r?.code}function Bo(a){return Br.apply(this,arguments)}function Br(){return(Br=(0,m.Z)(function*(a,r={}){return ye(a,"GET","/v1/projects",r)})).apply(this,arguments)}const $a=/^\d{1,3}\.\d{1,3}\.\d{1,3}\.\d{1,3}$/,Ka=/^https?/;function zi(){return(zi=(0,m.Z)(function*(a){if(a.config.emulator)return;const{authorizedDomains:r}=yield Bo(a);for(const s of r)try{if(Bs(s))return}catch{}Se(a,"unauthorized-domain")})).apply(this,arguments)}function Bs(a){const r=Ze(),{protocol:s,hostname:l}=new URL(r);if(a.startsWith("chrome-extension://")){const S=new URL(a);return""===S.hostname&&""===l?"chrome-extension:"===s&&a.replace("chrome-extension://","")===r.replace("chrome-extension://",""):"chrome-extension:"===s&&S.hostname===l}if(!Ka.test(s))return!1;if($a.test(a))return l===a;const d=a.replace(/\./g,"\\.");return new RegExp("^(.+\\."+d+"|"+d+")$","i").test(l)}const Vs=new Me(3e4,6e4);function ji(){const a=De().___jsl;if(a?.H)for(const r of Object.keys(a.H))if(a.H[r].r=a.H[r].r||[],a.H[r].L=a.H[r].L||[],a.H[r].r=[...a.H[r].L],a.CP)for(let s=0;s<a.CP.length;s++)a.CP[s]=null}let hi=null;const za=new Me(5e3,15e3),Vr="__/auth/iframe",Ho="emulator/auth/iframe",ja={style:{position:"absolute",top:"-100px",width:"1px",height:"1px"},"aria-hidden":"true",tabindex:"-1"},Yi=new Map([["identitytoolkit.googleapis.com","p"],["staging-identitytoolkit.sandbox.googleapis.com","s"],["test-identitytoolkit.sandbox.googleapis.com","t"]]);function Zs(a){const r=a.config;F(r.authDomain,a,"auth-domain-config-required");const s=r.emulator?Ye(r,Ho):`https://${a.config.authDomain}/${Vr}`,l={apiKey:r.apiKey,appName:a.name,v:C.SDK_VERSION},d=Yi.get(a.config.apiHost);d&&(l.eid=d);const f=a._getFrameworks();return f.length&&(l.fw=f.join(",")),`${s}?${(0,w.xO)(l).slice(1)}`}function Hs(){return Hs=(0,m.Z)(function*(a){const r=yield function Zo(a){return hi=hi||function Hn(a){return new Promise((r,s)=>{var l,d,f;function S(){ji(),gapi.load("gapi.iframes",{callback:()=>{r(gapi.iframes.getContext())},ontimeout:()=>{ji(),s(ve(a,"network-request-failed"))},timeout:Vs.get()})}if(null!==(d=null===(l=De().gapi)||void 0===l?void 0:l.iframes)&&void 0!==d&&d.Iframe)r(gapi.iframes.getContext());else{if(null===(f=De().gapi)||void 0===f||!f.load){const M=Ts("iframefcb");return De()[M]=()=>{gapi.load?S():s(ve(a,"network-request-failed"))},So(`https://apis.google.com/js/api.js?onload=${M}`).catch(H=>s(H))}S()}}).catch(r=>{throw hi=null,r})}(a),hi}(a),s=De().gapi;return F(s,a,"internal-error"),r.open({where:document.body,url:Zs(a),messageHandlersFilter:s.iframes.CROSS_ORIGIN_IFRAMES_FILTER,attributes:ja,dontclear:!0},l=>new Promise(function(){var d=(0,m.Z)(function*(f,S){yield l.restyle({setHideOnLeave:!1});const M=ve(a,"network-request-failed"),H=De().setTimeout(()=>{S(M)},za.get());function j(){De().clearTimeout(H),f(l)}l.ping(j).then(j,()=>{S(M)})});return function(f,S){return d.apply(this,arguments)}}()))}),Hs.apply(this,arguments)}const Qa={location:"yes",resizable:"yes",statusbar:"yes",toolbar:"no"},Gs=500,Zr=600,Go="_blank",qa="http://localhost";class fi{constructor(r){this.window=r,this.associatedEvent=null}close(){if(this.window)try{this.window.close()}catch{}}}const Ja="__/auth/handler",$o="emulator/auth/handler";function qi(a,r,s,l,d,f){F(a.config.authDomain,a,"auth-domain-config-required"),F(a.config.apiKey,a,"invalid-api-key");const S={apiKey:a.config.apiKey,appName:a.name,authType:s,redirectUrl:l,v:C.SDK_VERSION,eventId:d};if(r instanceof $e){r.setDefaultLanguage(a.languageCode),S.providerId=r.providerId||"",(0,w.xb)(r.getCustomParameters())||(S.customParameters=JSON.stringify(r.getCustomParameters()));for(const[H,j]of Object.entries(f||{}))S[H]=j}if(r instanceof Xn){const H=r.getScopes().filter(j=>""!==j);H.length>0&&(S.scopes=H.join(","))}a.tenantId&&(S.tid=a.tenantId);const M=S;for(const H of Object.keys(M))void 0===M[H]&&delete M[H];return`${function Ji({config:a}){return a.emulator?Ye(a,$o):`https://${a.authDomain}/${Ja}`}(a)}?${(0,w.xO)(M).slice(1)}`}const Gn="webStorageSupport",Nt=class Xa{constructor(){this.eventManagers={},this.iframes={},this.originValidationPromises={},this._redirectPersistence=Wi,this._completeRedirectFn=$i,this._overrideRedirectResult=xo}_openPopup(r,s,l,d){var f=this;return(0,m.Z)(function*(){var S;Qe(null===(S=f.eventManagers[r._key()])||void 0===S?void 0:S.manager,"_initialize() not called before _openPopup()");const M=qi(r,s,l,Ze(),d);return function sn(a,r,s,l=Gs,d=Zr){const f=Math.max((window.screen.availHeight-d)/2,0).toString(),S=Math.max((window.screen.availWidth-l)/2,0).toString();let M="";const H=Object.assign(Object.assign({},Qa),{width:l.toString(),height:d.toString(),top:f,left:S}),j=(0,w.z$)().toLowerCase();s&&(M=x(j)?Go:s),E(j)&&(r=r||qa,H.scrollbars="yes");const se=Object.entries(H).reduce((on,[Tn,pi])=>`${on}${Tn}=${pi},`,"");if(function At(a=(0,w.z$)()){var r;return Oe(a)&&!(null===(r=window.navigator)||void 0===r||!r.standalone)}(j)&&"_self"!==M)return function Qi(a,r){const s=document.createElement("a");s.href=a,s.target=r;const l=document.createEvent("MouseEvent");l.initMouseEvent("click",!0,!0,window,1,0,0,0,0,!1,!1,!1,!1,1,null),s.dispatchEvent(l)}(r||"",M),new fi(null);const Be=window.open(r||"",M,se);F(Be,a,"popup-blocked");try{Be.focus()}catch{}return new fi(Be)}(r,M,Qt())})()}_openRedirect(r,s,l,d){var f=this;return(0,m.Z)(function*(){return yield f._originValidation(r),function gs(a){De().location.href=a}(qi(r,s,l,Ze(),d)),new Promise(()=>{})})()}_initialize(r){const s=r._key();if(this.eventManagers[s]){const{manager:d,promise:f}=this.eventManagers[s];return d?Promise.resolve(d):(Qe(f,"If manager is not set, promise should be"),f)}const l=this.initAndGetManager(r);return this.eventManagers[s]={promise:l},l.catch(()=>{delete this.eventManagers[s]}),l}initAndGetManager(r){var s=this;return(0,m.Z)(function*(){const l=yield function Ya(a){return Hs.apply(this,arguments)}(r),d=new Uo(r);return l.register("authEvent",f=>(F(f?.authEvent,r,"invalid-auth-event"),{status:d.onEvent(f.authEvent)?"ACK":"ERROR"}),gapi.iframes.CROSS_ORIGIN_IFRAMES_FILTER),s.eventManagers[r._key()]={manager:d},s.iframes[r._key()]=l,d})()}_isIframeWebStorageSupported(r,s){this.iframes[r._key()].send(Gn,{type:Gn},d=>{var f;const S=null===(f=d?.[0])||void 0===f?void 0:f[Gn];void 0!==S&&s(!!S),Se(r,"internal-error")},gapi.iframes.CROSS_ORIGIN_IFRAMES_FILTER)}_originValidation(r){const s=r._key();return this.originValidationPromises[s]||(this.originValidationPromises[s]=function Vo(a){return zi.apply(this,arguments)}(r)),this.originValidationPromises[s]}get _shouldInitProactively(){return mt()||y()||Oe()}};class Ko{constructor(r){this.factorId=r}_process(r,s,l){switch(s.type){case"enroll":return this._finalizeEnroll(r,s.credential,l);case"signin":return this._finalizeSignIn(r,s.credential);default:return we("unexpected MultiFactorSessionType")}}}class $s extends Ko{constructor(r){super("phone"),this.credential=r}static _fromCredential(r){return new $s(r)}_finalizeEnroll(r,s,l){return function Li(a,r){return ye(a,"POST","/v2/accounts/mfaEnrollment:finalize",ce(a,r))}(r,{idToken:s,displayName:l,phoneVerificationInfo:this.credential._makeVerificationRequest()})}_finalizeSignIn(r,s){return function Es(a,r){return ye(a,"POST","/v2/accounts/mfaSignIn:finalize",ce(a,r))}(r,{mfaPendingCredential:s,phoneVerificationInfo:this.credential._makeVerificationRequest()})}}let Hr=(()=>{class a{constructor(){}static assertion(s){return $s._fromCredential(s)}}return a.FACTOR_ID="phone",a})();var Ks="@firebase/auth";class zo{constructor(r){this.auth=r,this.internalListeners=new Map}getUid(){var r;return this.assertAuthConfigured(),(null===(r=this.auth.currentUser)||void 0===r?void 0:r.uid)||null}getToken(r){var s=this;return(0,m.Z)(function*(){return s.assertAuthConfigured(),yield s.auth._initializationPromise,s.auth.currentUser?{accessToken:yield s.auth.currentUser.getIdToken(r)}:null})()}addAuthTokenListener(r){if(this.assertAuthConfigured(),this.internalListeners.has(r))return;const s=this.auth.onIdTokenChanged(l=>{r(l?.stsTokenManager.accessToken||null)});this.internalListeners.set(r,s),this.updateProactiveRefresh()}removeAuthTokenListener(r){this.assertAuthConfigured();const s=this.internalListeners.get(r);s&&(this.internalListeners.delete(r),s(),this.updateProactiveRefresh())}assertAuthConfigured(){F(this.auth._initializationPromise,"dependent-sdk-initialized-before-auth")}updateProactiveRefresh(){this.internalListeners.size>0?this.auth._startProactiveRefresh():this.auth._stopProactiveRefresh()}}const nl=(0,w.Pz)("authIdTokenMaxAge")||300;let Yo=null;const Qo=a=>function(){var r=(0,m.Z)(function*(s){const l=s&&(yield s.getIdTokenResult()),d=l&&((new Date).getTime()-Date.parse(l.issuedAtTime))/1e3;if(d&&d>nl)return;const f=l?.token;Yo!==f&&(Yo=f,yield fetch(a,{method:f?"POST":"DELETE",headers:f?{Authorization:`Bearer ${f}`}:{}}))});return function(s){return r.apply(this,arguments)}}();function Xi(a=(0,C.getApp)()){const r=(0,C._getProvider)(a,"auth");if(r.isInitialized())return r.getImmediate();const s=function Ot(a,r){const s=(0,C._getProvider)(a,"auth");if(s.isInitialized()){const d=s.getImmediate(),f=s.getOptions();if((0,w.vZ)(f,r??{}))return d;Se(d,"already-initialized")}return s.initialize({options:r})}(a,{popupRedirectResolver:Nt,persistence:[Zi,Bt,Wi]}),l=(0,w.Pz)("authTokenSyncURL");if(l){const f=Qo(l);(function Ut(a,r,s){(0,w.m9)(a).beforeAuthStateChanged(r,s)})(s,f,()=>f(s.currentUser)),function ma(a,r,s,l){(0,w.m9)(a).onIdTokenChanged(r,s,l)}(s,S=>f(S))}const d=(0,w.q4)("auth");return d&&vi(s,`http://${d}`),s}!function jo(a){(0,C._registerComponent)(new ie.wA("auth",(r,{options:s})=>{const l=r.getProvider("app").getImmediate(),d=r.getProvider("heartbeat"),{apiKey:f,authDomain:S}=l.options;return((M,H)=>{F(f&&!f.includes(":"),"invalid-api-key",{appName:M.name}),F(!S?.includes(":"),"argument-error",{appName:M.name});const j={apiKey:f,authDomain:S,clientPlatform:a,apiHost:"identitytoolkit.googleapis.com",tokenApiHost:"securetoken.googleapis.com",apiScheme:"https",sdkClientVersion:jn(a)},se=new ir(M,H,j);return function be(a,r){const s=r?.persistence||[],l=(Array.isArray(s)?s:[s]).map(p);r?.errorMap&&a._updateErrorMap(r.errorMap),a._initializeWithPersistence(l,r?.popupRedirectResolver)}(se,s),se})(l,d)},"PUBLIC").setInstantiationMode("EXPLICIT").setInstanceCreatedCallback((r,s,l)=>{r.getProvider("auth-internal").initialize()})),(0,C._registerComponent)(new ie.wA("auth-internal",r=>{const s=tt(r.getProvider("auth").getImmediate());return new zo(s)},"PRIVATE").setInstantiationMode("EXPLICIT")),(0,C.registerVersion)(Ks,"0.21.4",function el(a){switch(a){case"Node":return"node";case"ReactNative":return"rn";case"Worker":return"webworker";case"Cordova":return"cordova";default:return}}(a)),(0,C.registerVersion)(Ks,"0.21.4","esm2017")}("Browser")},2894:(Zt,xe,A)=>{A.d(xe,{r:()=>_c});var m=A(1135),w=A(4004),C=A(3151),J=A(3900),D=A(4650),ie=A(4761),W=A(4986),G=A(9751),me=A(9646),ct=A(6451),ae=A(3099),he=A(5026),Ae=A(1884),Te=A(4482),Le=A(5403),_=A(8421),pe=A(4671),ze=A(5032),at=A(3269),Ve=A(2122),je=A(2011),F=(A(9568),A(3942)),we=A(3475),Qe=A(5861),It=A(9681),p=A(2090),Ot=A(1877);const be="@firebase/database";let Re="";function ft(n){Re=n}class Dt{constructor(t){this.domStorage_=t,this.prefix_="firebase:"}set(t,e){null==e?this.domStorage_.removeItem(this.prefixedName_(t)):this.domStorage_.setItem(this.prefixedName_(t),(0,p.Wl)(e))}get(t){const e=this.domStorage_.getItem(this.prefixedName_(t));return null==e?null:(0,p.cI)(e)}remove(t){this.domStorage_.removeItem(this.prefixedName_(t))}prefixedName_(t){return this.prefix_+t}toString(){return this.domStorage_.toString()}}class nt{constructor(){this.cache_={},this.isInMemoryStorage=!0}set(t,e){null==e?delete this.cache_[t]:this.cache_[t]=e}get(t){return(0,p.r3)(this.cache_,t)?this.cache_[t]:null}remove(t){delete this.cache_[t]}}const Me=function(n){try{if(typeof window<"u"&&typeof window[n]<"u"){const t=window[n];return t.setItem("firebase:sentinel","cache"),t.removeItem("firebase:sentinel"),new Dt(t)}}catch{}return new nt},Ye=Me("localStorage"),qe=Me("sessionStorage"),it=new Ot.Yd("@firebase/database"),Ne=function(){let n=1;return function(){return n++}}(),ce=function(n){const t=(0,p.dS)(n),e=new p.gQ;e.update(t);const i=e.digest();return p.US.encodeByteArray(i)},ye=function(...n){let t="";for(let e=0;e<n.length;e++){const i=n[e];Array.isArray(i)||i&&"object"==typeof i&&"number"==typeof i.length?t+=ye.apply(null,i):t+="object"==typeof i?(0,p.Wl)(i):i,t+=" "}return t};let Xe=null,pt=!0;const rt=function(n,t){(0,p.hu)(!t||!0===n||!1===n,"Can't turn on custom loggers persistently."),!0===n?(it.logLevel=Ot.in.VERBOSE,Xe=it.log.bind(it),t&&qe.set("logging_enabled",!0)):"function"==typeof n?Xe=n:(Xe=null,qe.remove("logging_enabled"))},oe=function(...n){if(!0===pt&&(pt=!1,null===Xe&&!0===qe.get("logging_enabled")&&rt(!0)),Xe){const t=ye.apply(null,n);Xe(t)}},st=function(n){return function(...t){oe(n,...t)}},_t=function(...n){const t="FIREBASE INTERNAL ERROR: "+ye(...n);it.error(t)},Ke=function(...n){const t=`FIREBASE FATAL ERROR: ${ye(...n)}`;throw it.error(t),new Error(t)},ee=function(...n){const t="FIREBASE WARNING: "+ye(...n);it.warn(t)},We=function(n){return"number"==typeof n&&(n!=n||n===Number.POSITIVE_INFINITY||n===Number.NEGATIVE_INFINITY)},V="[MIN_NAME]",X="[MAX_NAME]",N=function(n,t){if(n===t)return 0;if(n===V||t===X)return-1;if(t===V||n===X)return 1;{const e=Ht(n),i=Ht(t);return null!==e?null!==i?e-i==0?n.length-t.length:e-i:-1:null!==i?1:n<t?-1:1}},z=function(n,t){return n===t?0:n<t?-1:1},fe=function(n,t){if(t&&n in t)return t[n];throw new Error("Missing required key ("+n+") in object: "+(0,p.Wl)(t))},ke=function(n){if("object"!=typeof n||null===n)return(0,p.Wl)(n);const t=[];for(const i in n)t.push(i);t.sort();let e="{";for(let i=0;i<t.length;i++)0!==i&&(e+=","),e+=(0,p.Wl)(t[i]),e+=":",e+=ke(n[t[i]]);return e+="}",e},et=function(n,t){const e=n.length;if(e<=t)return[n];const i=[];for(let o=0;o<e;o+=t)i.push(n.substring(o,o+t>e?e:o+t));return i};function Ee(n,t){for(const e in n)n.hasOwnProperty(e)&&t(e,n[e])}const kt=function(n){(0,p.hu)(!We(n),"Invalid JSON number");const i=1023;let o,u,c,h,g;0===n?(u=0,c=0,o=1/n==-1/0?1:0):(o=n<0,(n=Math.abs(n))>=Math.pow(2,1-i)?(h=Math.min(Math.floor(Math.log(n)/Math.LN2),i),u=h+i,c=Math.round(n*Math.pow(2,52-h)-Math.pow(2,52))):(u=0,c=Math.round(n/Math.pow(2,-1074))));const v=[];for(g=52;g;g-=1)v.push(c%2?1:0),c=Math.floor(c/2);for(g=11;g;g-=1)v.push(u%2?1:0),u=Math.floor(u/2);v.push(o?1:0),v.reverse();const P=v.join("");let b="";for(g=0;g<64;g+=8){let L=parseInt(P.substr(g,8),2).toString(16);1===L.length&&(L="0"+L),b+=L}return b.toLowerCase()},An=new RegExp("^-?(0*)\\d{1,10}$"),Ht=function(n){if(An.test(n)){const t=Number(n);if(t>=-2147483648&&t<=2147483647)return t}return null},Pe=function(n){try{n()}catch(t){setTimeout(()=>{throw ee("Exception was thrown by user callback.",t.stack||""),t},Math.floor(0))}},gn=function(){return("object"==typeof window&&window.navigator&&window.navigator.userAgent||"").search(/googlebot|google webmaster tools|bingbot|yahoo! slurp|baiduspider|yandexbot|duckduckbot/i)>=0},Tt=function(n,t){const e=setTimeout(n,t);return"number"==typeof e&&typeof Deno<"u"&&Deno.unrefTimer?Deno.unrefTimer(e):"object"==typeof e&&e.unref&&e.unref(),e};class wn{constructor(t,e){this.appName_=t,this.appCheckProvider=e,this.appCheck=e?.getImmediate({optional:!0}),this.appCheck||e?.get().then(i=>this.appCheck=i)}getToken(t){return this.appCheck?this.appCheck.getToken(t):new Promise((e,i)=>{setTimeout(()=>{this.appCheck?this.getToken(t).then(e,i):e(null)},0)})}addTokenChangeListener(t){var e;null===(e=this.appCheckProvider)||void 0===e||e.get().then(i=>i.addTokenListener(t))}notifyForInvalidToken(){ee(`Provided AppCheck credentials for the app named "${this.appName_}" are invalid. This usually indicates your app was not initialized correctly.`)}}class Pt{constructor(t,e,i){this.appName_=t,this.firebaseOptions_=e,this.authProvider_=i,this.auth_=null,this.auth_=i.getImmediate({optional:!0}),this.auth_||i.onInit(o=>this.auth_=o)}getToken(t){return this.auth_?this.auth_.getToken(t).catch(e=>e&&"auth/token-not-initialized"===e.code?(oe("Got auth/token-not-initialized error.  Treating as null token."),null):Promise.reject(e)):new Promise((e,i)=>{setTimeout(()=>{this.auth_?this.getToken(t).then(e,i):e(null)},0)})}addTokenChangeListener(t){this.auth_?this.auth_.addAuthTokenListener(t):this.authProvider_.get().then(e=>e.addAuthTokenListener(t))}removeTokenChangeListener(t){this.authProvider_.get().then(e=>e.removeAuthTokenListener(t))}notifyForInvalidToken(){let t='Provided authentication credentials for the app named "'+this.appName_+'" are invalid. This usually indicates your app was not initialized correctly. ';t+="credential"in this.firebaseOptions_?'Make sure the "credential" property provided to initializeApp() is authorized to access the specified "databaseURL" and is from the correct project.':"serviceAccount"in this.firebaseOptions_?'Make sure the "serviceAccount" property provided to initializeApp() is authorized to access the specified "databaseURL" and is from the correct project.':'Make sure the "apiKey" and "databaseURL" properties provided to initializeApp() match the values provided for your app at https://console.firebase.google.com/.',ee(t)}}let bt=(()=>{class n{constructor(e){this.accessToken=e}getToken(e){return Promise.resolve({accessToken:this.accessToken})}addTokenChangeListener(e){e(this.accessToken)}removeTokenChangeListener(e){}notifyForInvalidToken(){}}return n.OWNER="owner",n})();const un=/(console\.firebase|firebase-console-\w+\.corp|firebase\.corp)\.google\.com/,k="ac",E="websocket",y="long_polling";class x{constructor(t,e,i,o,u=!1,c="",h=!1,g=!1){this.secure=e,this.namespace=i,this.webSocketOnly=o,this.nodeAdmin=u,this.persistenceKey=c,this.includeNamespaceInQueryParams=h,this.isUsingEmulator=g,this._host=t.toLowerCase(),this._domain=this._host.substr(this._host.indexOf(".")+1),this.internalHost=Ye.get("host:"+t)||this._host}isCacheableHost(){return"s-"===this.internalHost.substr(0,2)}isCustomHost(){return"firebaseio.com"!==this._domain&&"firebaseio-demo.com"!==this._domain}get host(){return this._host}set host(t){t!==this.internalHost&&(this.internalHost=t,this.isCacheableHost()&&Ye.set("host:"+this._host,this.internalHost))}toString(){let t=this.toURLString();return this.persistenceKey&&(t+="<"+this.persistenceKey+">"),t}toURLString(){return`${this.secure?"https://":"http://"}${this.host}/${this.includeNamespaceInQueryParams?`?ns=${this.namespace}`:""}`}}function te(n,t,e){let i;if((0,p.hu)("string"==typeof t,"typeof type must == string"),(0,p.hu)("object"==typeof e,"typeof params must == object"),t===E)i=(n.secure?"wss://":"ws://")+n.internalHost+"/.ws?";else{if(t!==y)throw new Error("Unknown connection type: "+t);i=(n.secure?"https://":"http://")+n.internalHost+"/.lp?"}(function B(n){return n.host!==n.internalHost||n.isCustomHost()||n.includeNamespaceInQueryParams})(n)&&(e.ns=n.namespace);const o=[];return Ee(e,(u,c)=>{o.push(u+"="+c)}),i+o.join("&")}class de{constructor(){this.counters_={}}incrementCounter(t,e=1){(0,p.r3)(this.counters_,t)||(this.counters_[t]=0),this.counters_[t]+=e}get(){return(0,p.p$)(this.counters_)}}const _e={},Oe={};function ut(n){const t=n.toString();return _e[t]||(_e[t]=new de),_e[t]}class ue{constructor(t){this.onMessage_=t,this.pendingResponses=[],this.currentResponseNum=0,this.closeAfterResponse=-1,this.onClose=null}closeAfter(t,e){this.closeAfterResponse=t,this.onClose=e,this.closeAfterResponse<this.currentResponseNum&&(this.onClose(),this.onClose=null)}handleResponse(t,e){for(this.pendingResponses[t]=e;this.pendingResponses[this.currentResponseNum];){const i=this.pendingResponses[this.currentResponseNum];delete this.pendingResponses[this.currentResponseNum];for(let o=0;o<i.length;++o)i[o]&&Pe(()=>{this.onMessage_(i[o])});if(this.currentResponseNum===this.closeAfterResponse){this.onClose&&(this.onClose(),this.onClose=null);break}this.currentResponseNum++}}}class en{constructor(t,e,i,o,u,c,h){this.connId=t,this.repoInfo=e,this.applicationId=i,this.appCheckToken=o,this.authToken=u,this.transportSessionId=c,this.lastSessionId=h,this.bytesSent=0,this.bytesReceived=0,this.everConnected_=!1,this.log_=st(t),this.stats_=ut(e),this.urlFn=g=>(this.appCheckToken&&(g[k]=this.appCheckToken),te(e,y,g))}open(t,e){this.curSegmentNum=0,this.onDisconnect_=e,this.myPacketOrderer=new ue(t),this.isClosed_=!1,this.connectTimeoutTimer_=setTimeout(()=>{this.log_("Timed out trying to connect."),this.onClosed_(),this.connectTimeoutTimer_=null},Math.floor(3e4)),function(n){if((0,p.Yr)()||"complete"===document.readyState)n();else{let t=!1;const e=function(){document.body?t||(t=!0,n()):setTimeout(e,Math.floor(10))};document.addEventListener?(document.addEventListener("DOMContentLoaded",e,!1),window.addEventListener("load",e,!1)):document.attachEvent&&(document.attachEvent("onreadystatechange",()=>{"complete"===document.readyState&&e()}),window.attachEvent("onload",e))}}(()=>{if(this.isClosed_)return;this.scriptTagHolder=new mn((...u)=>{const[c,h,g,v,P]=u;if(this.incrementIncomingBytes_(u),this.scriptTagHolder)if(this.connectTimeoutTimer_&&(clearTimeout(this.connectTimeoutTimer_),this.connectTimeoutTimer_=null),this.everConnected_=!0,"start"===c)this.id=h,this.password=g;else{if("close"!==c)throw new Error("Unrecognized command received: "+c);h?(this.scriptTagHolder.sendNewPolls=!1,this.myPacketOrderer.closeAfter(h,()=>{this.onClosed_()})):this.onClosed_()}},(...u)=>{const[c,h]=u;this.incrementIncomingBytes_(u),this.myPacketOrderer.handleResponse(c,h)},()=>{this.onClosed_()},this.urlFn);const i={start:"t"};i.ser=Math.floor(1e8*Math.random()),this.scriptTagHolder.uniqueCallbackIdentifier&&(i.cb=this.scriptTagHolder.uniqueCallbackIdentifier),i.v="5",this.transportSessionId&&(i.s=this.transportSessionId),this.lastSessionId&&(i.ls=this.lastSessionId),this.applicationId&&(i.p=this.applicationId),this.appCheckToken&&(i[k]=this.appCheckToken),typeof location<"u"&&location.hostname&&un.test(location.hostname)&&(i.r="f");const o=this.urlFn(i);this.log_("Connecting via long-poll to "+o),this.scriptTagHolder.addTag(o,()=>{})})}start(){this.scriptTagHolder.startLongPoll(this.id,this.password),this.addDisconnectPingFrame(this.id,this.password)}static forceAllow(){en.forceAllow_=!0}static forceDisallow(){en.forceDisallow_=!0}static isAvailable(){return!((0,p.Yr)()||!en.forceAllow_&&(en.forceDisallow_||!(typeof document<"u")||null==document.createElement||"object"==typeof window&&window.chrome&&window.chrome.extension&&!/^chrome/.test(window.location.href)||"object"==typeof Windows&&"object"==typeof Windows.UI))}markConnectionHealthy(){}shutdown_(){this.isClosed_=!0,this.scriptTagHolder&&(this.scriptTagHolder.close(),this.scriptTagHolder=null),this.myDisconnFrame&&(document.body.removeChild(this.myDisconnFrame),this.myDisconnFrame=null),this.connectTimeoutTimer_&&(clearTimeout(this.connectTimeoutTimer_),this.connectTimeoutTimer_=null)}onClosed_(){this.isClosed_||(this.log_("Longpoll is closing itself"),this.shutdown_(),this.onDisconnect_&&(this.onDisconnect_(this.everConnected_),this.onDisconnect_=null))}close(){this.isClosed_||(this.log_("Longpoll is being closed."),this.shutdown_())}send(t){const e=(0,p.Wl)(t);this.bytesSent+=e.length,this.stats_.incrementCounter("bytes_sent",e.length);const i=(0,p.h$)(e),o=et(i,1840);for(let u=0;u<o.length;u++)this.scriptTagHolder.enqueueSegment(this.curSegmentNum,o.length,o[u]),this.curSegmentNum++}addDisconnectPingFrame(t,e){if((0,p.Yr)())return;this.myDisconnFrame=document.createElement("iframe");const i={dframe:"t"};i.id=t,i.pw=e,this.myDisconnFrame.src=this.urlFn(i),this.myDisconnFrame.style.display="none",document.body.appendChild(this.myDisconnFrame)}incrementIncomingBytes_(t){const e=(0,p.Wl)(t).length;this.bytesReceived+=e,this.stats_.incrementCounter("bytes_received",e)}}class mn{constructor(t,e,i,o){if(this.onDisconnect=i,this.urlFn=o,this.outstandingRequests=new Set,this.pendingSegs=[],this.currentSerial=Math.floor(1e8*Math.random()),this.sendNewPolls=!0,(0,p.Yr)())this.commandCB=t,this.onMessageCB=e;else{this.uniqueCallbackIdentifier=Ne(),window["pLPCommand"+this.uniqueCallbackIdentifier]=t,window["pRTLPCB"+this.uniqueCallbackIdentifier]=e,this.myIFrame=mn.createIFrame_();let u="";this.myIFrame.src&&"javascript:"===this.myIFrame.src.substr(0,11)&&(u='<script>document.domain="'+document.domain+'";<\/script>');const c="<html><body>"+u+"</body></html>";try{this.myIFrame.doc.open(),this.myIFrame.doc.write(c),this.myIFrame.doc.close()}catch(h){oe("frame writing exception"),h.stack&&oe(h.stack),oe(h)}}}static createIFrame_(){const t=document.createElement("iframe");if(t.style.display="none",!document.body)throw"Document body has not initialized. Wait to initialize Firebase until after the document is ready.";document.body.appendChild(t);try{t.contentWindow.document||oe("No IE domain setting required")}catch{const i=document.domain;t.src="javascript:void((function(){document.open();document.domain='"+i+"';document.close();})())"}return t.contentDocument?t.doc=t.contentDocument:t.contentWindow?t.doc=t.contentWindow.document:t.document&&(t.doc=t.document),t}close(){this.alive=!1,this.myIFrame&&(this.myIFrame.doc.body.textContent="",setTimeout(()=>{null!==this.myIFrame&&(document.body.removeChild(this.myIFrame),this.myIFrame=null)},Math.floor(0)));const t=this.onDisconnect;t&&(this.onDisconnect=null,t())}startLongPoll(t,e){for(this.myID=t,this.myPW=e,this.alive=!0;this.newRequest_(););}newRequest_(){if(this.alive&&this.sendNewPolls&&this.outstandingRequests.size<(this.pendingSegs.length>0?2:1)){this.currentSerial++;const t={};t.id=this.myID,t.pw=this.myPW,t.ser=this.currentSerial;let e=this.urlFn(t),i="",o=0;for(;this.pendingSegs.length>0&&this.pendingSegs[0].d.length+30+i.length<=1870;){const c=this.pendingSegs.shift();i=i+"&seg"+o+"="+c.seg+"&ts"+o+"="+c.ts+"&d"+o+"="+c.d,o++}return e+=i,this.addLongPollTag_(e,this.currentSerial),!0}return!1}enqueueSegment(t,e,i){this.pendingSegs.push({seg:t,ts:e,d:i}),this.alive&&this.newRequest_()}addLongPollTag_(t,e){this.outstandingRequests.add(e);const i=()=>{this.outstandingRequests.delete(e),this.newRequest_()},o=setTimeout(i,Math.floor(25e3));this.addTag(t,()=>{clearTimeout(o),i()})}addTag(t,e){(0,p.Yr)()?this.doNodeLongPoll(t,e):setTimeout(()=>{try{if(!this.sendNewPolls)return;const i=this.myIFrame.doc.createElement("script");i.type="text/javascript",i.async=!0,i.src=t,i.onload=i.onreadystatechange=function(){const o=i.readyState;(!o||"loaded"===o||"complete"===o)&&(i.onload=i.onreadystatechange=null,i.parentNode&&i.parentNode.removeChild(i),e())},i.onerror=()=>{oe("Long-poll script failed to load: "+t),this.sendNewPolls=!1,this.close()},this.myIFrame.doc.body.appendChild(i)}catch{}},Math.floor(1))}}let $t=null;typeof MozWebSocket<"u"?$t=MozWebSocket:typeof WebSocket<"u"&&($t=WebSocket);let Kt=(()=>{class n{constructor(e,i,o,u,c,h,g){this.connId=e,this.applicationId=o,this.appCheckToken=u,this.authToken=c,this.keepaliveTimer=null,this.frames=null,this.totalFrames=0,this.bytesSent=0,this.bytesReceived=0,this.log_=st(this.connId),this.stats_=ut(i),this.connURL=n.connectionURL_(i,h,g,u,o),this.nodeAdmin=i.nodeAdmin}static connectionURL_(e,i,o,u,c){const h={v:"5"};return!(0,p.Yr)()&&typeof location<"u"&&location.hostname&&un.test(location.hostname)&&(h.r="f"),i&&(h.s=i),o&&(h.ls=o),u&&(h[k]=u),c&&(h.p=c),te(e,E,h)}open(e,i){this.onDisconnect=i,this.onMessage=e,this.log_("Websocket connecting to "+this.connURL),this.everConnected_=!1,Ye.set("previous_websocket_failure",!0);try{let o;if((0,p.Yr)()){o={headers:{"User-Agent":`Firebase/5/${Re}/${process.platform}/${this.nodeAdmin?"AdminNode":"Node"}`,"X-Firebase-GMPID":this.applicationId||""}},this.authToken&&(o.headers.Authorization=`Bearer ${this.authToken}`),this.appCheckToken&&(o.headers["X-Firebase-AppCheck"]=this.appCheckToken);const c=process.env,h=0===this.connURL.indexOf("wss://")?c.HTTPS_PROXY||c.https_proxy:c.HTTP_PROXY||c.http_proxy;h&&(o.proxy={origin:h})}this.mySock=new $t(this.connURL,[],o)}catch(o){this.log_("Error instantiating WebSocket.");const u=o.message||o.data;return u&&this.log_(u),void this.onClosed_()}this.mySock.onopen=()=>{this.log_("Websocket connected."),this.everConnected_=!0},this.mySock.onclose=()=>{this.log_("Websocket connection was disconnected."),this.mySock=null,this.onClosed_()},this.mySock.onmessage=o=>{this.handleIncomingFrame(o)},this.mySock.onerror=o=>{this.log_("WebSocket error.  Closing connection.");const u=o.message||o.data;u&&this.log_(u),this.onClosed_()}}start(){}static forceDisallow(){n.forceDisallow_=!0}static isAvailable(){let e=!1;if(typeof navigator<"u"&&navigator.userAgent){const o=navigator.userAgent.match(/Android ([0-9]{0,}\.[0-9]{0,})/);o&&o.length>1&&parseFloat(o[1])<4.4&&(e=!0)}return!e&&null!==$t&&!n.forceDisallow_}static previouslyFailed(){return Ye.isInMemoryStorage||!0===Ye.get("previous_websocket_failure")}markConnectionHealthy(){Ye.remove("previous_websocket_failure")}appendFrame_(e){if(this.frames.push(e),this.frames.length===this.totalFrames){const i=this.frames.join("");this.frames=null;const o=(0,p.cI)(i);this.onMessage(o)}}handleNewFrameCount_(e){this.totalFrames=e,this.frames=[]}extractFrameCount_(e){if((0,p.hu)(null===this.frames,"We already have a frame buffer"),e.length<=6){const i=Number(e);if(!isNaN(i))return this.handleNewFrameCount_(i),null}return this.handleNewFrameCount_(1),e}handleIncomingFrame(e){if(null===this.mySock)return;const i=e.data;if(this.bytesReceived+=i.length,this.stats_.incrementCounter("bytes_received",i.length),this.resetKeepAlive(),null!==this.frames)this.appendFrame_(i);else{const o=this.extractFrameCount_(i);null!==o&&this.appendFrame_(o)}}send(e){this.resetKeepAlive();const i=(0,p.Wl)(e);this.bytesSent+=i.length,this.stats_.incrementCounter("bytes_sent",i.length);const o=et(i,16384);o.length>1&&this.sendString_(String(o.length));for(let u=0;u<o.length;u++)this.sendString_(o[u])}shutdown_(){this.isClosed_=!0,this.keepaliveTimer&&(clearInterval(this.keepaliveTimer),this.keepaliveTimer=null),this.mySock&&(this.mySock.close(),this.mySock=null)}onClosed_(){this.isClosed_||(this.log_("WebSocket is closing itself"),this.shutdown_(),this.onDisconnect&&(this.onDisconnect(this.everConnected_),this.onDisconnect=null))}close(){this.isClosed_||(this.log_("WebSocket is being closed"),this.shutdown_())}resetKeepAlive(){clearInterval(this.keepaliveTimer),this.keepaliveTimer=setInterval(()=>{this.mySock&&this.sendString_("0"),this.resetKeepAlive()},Math.floor(45e3))}sendString_(e){try{this.mySock.send(e)}catch(i){this.log_("Exception thrown from WebSocket.send():",i.message||i.data,"Closing connection."),setTimeout(this.onClosed_.bind(this),0)}}}return n.responsesRequiredToBeHealthy=2,n.healthyTimeout=3e4,n})(),Yr=(()=>{class n{constructor(e){this.initTransports_(e)}static get ALL_TRANSPORTS(){return[en,Kt]}static get IS_TRANSPORT_INITIALIZED(){return this.globalTransportInitialized_}initTransports_(e){const i=Kt&&Kt.isAvailable();let o=i&&!Kt.previouslyFailed();if(e.webSocketOnly&&(i||ee("wss:// URL used, but browser isn't known to support websockets.  Trying anyway."),o=!0),o)this.transports_=[Kt];else{const u=this.transports_=[];for(const c of n.ALL_TRANSPORTS)c&&c.isAvailable()&&u.push(c);n.globalTransportInitialized_=!0}}initialTransport(){if(this.transports_.length>0)return this.transports_[0];throw new Error("No transports available")}upgradeTransport(){return this.transports_.length>1?this.transports_[1]:null}}return n.globalTransportInitialized_=!1,n})();class T{constructor(t,e,i,o,u,c,h,g,v,P){this.id=t,this.repoInfo_=e,this.applicationId_=i,this.appCheckToken_=o,this.authToken_=u,this.onMessage_=c,this.onReady_=h,this.onDisconnect_=g,this.onKill_=v,this.lastSessionId=P,this.connectionCount=0,this.pendingDataMessages=[],this.state_=0,this.log_=st("c:"+this.id+":"),this.transportManager_=new Yr(e),this.log_("Connection created"),this.start_()}start_(){const t=this.transportManager_.initialTransport();this.conn_=new t(this.nextTransportId_(),this.repoInfo_,this.applicationId_,this.appCheckToken_,this.authToken_,null,this.lastSessionId),this.primaryResponsesRequired_=t.responsesRequiredToBeHealthy||0;const e=this.connReceiver_(this.conn_),i=this.disconnReceiver_(this.conn_);this.tx_=this.conn_,this.rx_=this.conn_,this.secondaryConn_=null,this.isHealthy_=!1,setTimeout(()=>{this.conn_&&this.conn_.open(e,i)},Math.floor(0));const o=t.healthyTimeout||0;o>0&&(this.healthyTimeout_=Tt(()=>{this.healthyTimeout_=null,this.isHealthy_||(this.conn_&&this.conn_.bytesReceived>102400?(this.log_("Connection exceeded healthy timeout but has received "+this.conn_.bytesReceived+" bytes.  Marking connection healthy."),this.isHealthy_=!0,this.conn_.markConnectionHealthy()):this.conn_&&this.conn_.bytesSent>10240?this.log_("Connection exceeded healthy timeout but has sent "+this.conn_.bytesSent+" bytes.  Leaving connection alive."):(this.log_("Closing unhealthy connection after timeout."),this.close()))},Math.floor(o)))}nextTransportId_(){return"c:"+this.id+":"+this.connectionCount++}disconnReceiver_(t){return e=>{t===this.conn_?this.onConnectionLost_(e):t===this.secondaryConn_?(this.log_("Secondary connection lost."),this.onSecondaryConnectionLost_()):this.log_("closing an old connection")}}connReceiver_(t){return e=>{2!==this.state_&&(t===this.rx_?this.onPrimaryMessageReceived_(e):t===this.secondaryConn_?this.onSecondaryMessageReceived_(e):this.log_("message on old connection"))}}sendRequest(t){this.sendData_({t:"d",d:t})}tryCleanupConnection(){this.tx_===this.secondaryConn_&&this.rx_===this.secondaryConn_&&(this.log_("cleaning up and promoting a connection: "+this.secondaryConn_.connId),this.conn_=this.secondaryConn_,this.secondaryConn_=null)}onSecondaryControl_(t){if("t"in t){const e=t.t;"a"===e?this.upgradeIfSecondaryHealthy_():"r"===e?(this.log_("Got a reset on secondary, closing it"),this.secondaryConn_.close(),(this.tx_===this.secondaryConn_||this.rx_===this.secondaryConn_)&&this.close()):"o"===e&&(this.log_("got pong on secondary."),this.secondaryResponsesRequired_--,this.upgradeIfSecondaryHealthy_())}}onSecondaryMessageReceived_(t){const e=fe("t",t),i=fe("d",t);if("c"===e)this.onSecondaryControl_(i);else{if("d"!==e)throw new Error("Unknown protocol layer: "+e);this.pendingDataMessages.push(i)}}upgradeIfSecondaryHealthy_(){this.secondaryResponsesRequired_<=0?(this.log_("Secondary connection is healthy."),this.isHealthy_=!0,this.secondaryConn_.markConnectionHealthy(),this.proceedWithUpgrade_()):(this.log_("sending ping on secondary."),this.secondaryConn_.send({t:"c",d:{t:"p",d:{}}}))}proceedWithUpgrade_(){this.secondaryConn_.start(),this.log_("sending client ack on secondary"),this.secondaryConn_.send({t:"c",d:{t:"a",d:{}}}),this.log_("Ending transmission on primary"),this.conn_.send({t:"c",d:{t:"n",d:{}}}),this.tx_=this.secondaryConn_,this.tryCleanupConnection()}onPrimaryMessageReceived_(t){const e=fe("t",t),i=fe("d",t);"c"===e?this.onControl_(i):"d"===e&&this.onDataMessage_(i)}onDataMessage_(t){this.onPrimaryResponse_(),this.onMessage_(t)}onPrimaryResponse_(){this.isHealthy_||(this.primaryResponsesRequired_--,this.primaryResponsesRequired_<=0&&(this.log_("Primary connection is healthy."),this.isHealthy_=!0,this.conn_.markConnectionHealthy()))}onControl_(t){const e=fe("t",t);if("d"in t){const i=t.d;if("h"===e){const o=Object.assign({},i);this.repoInfo_.isUsingEmulator&&(o.h=this.repoInfo_.host),this.onHandshake_(o)}else if("n"===e){this.log_("recvd end transmission on primary"),this.rx_=this.secondaryConn_;for(let o=0;o<this.pendingDataMessages.length;++o)this.onDataMessage_(this.pendingDataMessages[o]);this.pendingDataMessages=[],this.tryCleanupConnection()}else"s"===e?this.onConnectionShutdown_(i):"r"===e?this.onReset_(i):"e"===e?_t("Server Error: "+i):"o"===e?(this.log_("got pong on primary."),this.onPrimaryResponse_(),this.sendPingOnPrimaryIfNecessary_()):_t("Unknown control packet command: "+e)}}onHandshake_(t){const e=t.ts,i=t.v,o=t.h;this.sessionId=t.s,this.repoInfo_.host=o,0===this.state_&&(this.conn_.start(),this.onConnectionEstablished_(this.conn_,e),"5"!==i&&ee("Protocol version mismatch detected"),this.tryStartUpgrade_())}tryStartUpgrade_(){const t=this.transportManager_.upgradeTransport();t&&this.startUpgrade_(t)}startUpgrade_(t){this.secondaryConn_=new t(this.nextTransportId_(),this.repoInfo_,this.applicationId_,this.appCheckToken_,this.authToken_,this.sessionId),this.secondaryResponsesRequired_=t.responsesRequiredToBeHealthy||0;const e=this.connReceiver_(this.secondaryConn_),i=this.disconnReceiver_(this.secondaryConn_);this.secondaryConn_.open(e,i),Tt(()=>{this.secondaryConn_&&(this.log_("Timed out trying to upgrade."),this.secondaryConn_.close())},Math.floor(6e4))}onReset_(t){this.log_("Reset packet received.  New host: "+t),this.repoInfo_.host=t,1===this.state_?this.close():(this.closeConnections_(),this.start_())}onConnectionEstablished_(t,e){this.log_("Realtime connection established."),this.conn_=t,this.state_=1,this.onReady_&&(this.onReady_(e,this.sessionId),this.onReady_=null),0===this.primaryResponsesRequired_?(this.log_("Primary connection is healthy."),this.isHealthy_=!0):Tt(()=>{this.sendPingOnPrimaryIfNecessary_()},Math.floor(5e3))}sendPingOnPrimaryIfNecessary_(){!this.isHealthy_&&1===this.state_&&(this.log_("sending ping on primary."),this.sendData_({t:"c",d:{t:"p",d:{}}}))}onSecondaryConnectionLost_(){const t=this.secondaryConn_;this.secondaryConn_=null,(this.tx_===t||this.rx_===t)&&this.close()}onConnectionLost_(t){this.conn_=null,t||0!==this.state_?1===this.state_&&this.log_("Realtime connection lost."):(this.log_("Realtime connection failed."),this.repoInfo_.isCacheableHost()&&(Ye.remove("host:"+this.repoInfo_.host),this.repoInfo_.internalHost=this.repoInfo_.host)),this.close()}onConnectionShutdown_(t){this.log_("Connection shutdown command received. Shutting down..."),this.onKill_&&(this.onKill_(t),this.onKill_=null),this.onDisconnect_=null,this.close()}sendData_(t){if(1!==this.state_)throw"Connection is not connected";this.tx_.send(t)}close(){2!==this.state_&&(this.log_("Closing realtime connection."),this.state_=2,this.closeConnections_(),this.onDisconnect_&&(this.onDisconnect_(),this.onDisconnect_=null))}closeConnections_(){this.log_("Shutting down all connections"),this.conn_&&(this.conn_.close(),this.conn_=null),this.secondaryConn_&&(this.secondaryConn_.close(),this.secondaryConn_=null),this.healthyTimeout_&&(clearTimeout(this.healthyTimeout_),this.healthyTimeout_=null)}}class I{put(t,e,i,o){}merge(t,e,i,o){}refreshAuthToken(t){}refreshAppCheckToken(t){}onDisconnectPut(t,e,i){}onDisconnectMerge(t,e,i){}onDisconnectCancel(t,e){}reportStats(t){}}class R{constructor(t){this.allowedEvents_=t,this.listeners_={},(0,p.hu)(Array.isArray(t)&&t.length>0,"Requires a non-empty array")}trigger(t,...e){if(Array.isArray(this.listeners_[t])){const i=[...this.listeners_[t]];for(let o=0;o<i.length;o++)i[o].callback.apply(i[o].context,e)}}on(t,e,i){this.validateEventType_(t),this.listeners_[t]=this.listeners_[t]||[],this.listeners_[t].push({callback:e,context:i});const o=this.getInitialEvent(t);o&&e.apply(i,o)}off(t,e,i){this.validateEventType_(t);const o=this.listeners_[t]||[];for(let u=0;u<o.length;u++)if(o[u].callback===e&&(!i||i===o[u].context))return void o.splice(u,1)}validateEventType_(t){(0,p.hu)(this.allowedEvents_.find(e=>e===t),"Unknown event: "+t)}}class O extends R{constructor(){super(["online"]),this.online_=!0,typeof window<"u"&&typeof window.addEventListener<"u"&&!(0,p.uI)()&&(window.addEventListener("online",()=>{this.online_||(this.online_=!0,this.trigger("online",!0))},!1),window.addEventListener("offline",()=>{this.online_&&(this.online_=!1,this.trigger("online",!1))},!1))}static getInstance(){return new O}getInitialEvent(t){return(0,p.hu)("online"===t,"Unknown event type: "+t),[this.online_]}currentlyOnline(){return this.online_}}const U=32,Y=768;class K{constructor(t,e){if(void 0===e){this.pieces_=t.split("/");let i=0;for(let o=0;o<this.pieces_.length;o++)this.pieces_[o].length>0&&(this.pieces_[i]=this.pieces_[o],i++);this.pieces_.length=i,this.pieceNum_=0}else this.pieces_=t,this.pieceNum_=e}toString(){let t="";for(let e=this.pieceNum_;e<this.pieces_.length;e++)""!==this.pieces_[e]&&(t+="/"+this.pieces_[e]);return t||"/"}}function q(){return new K("")}function $(n){return n.pieceNum_>=n.pieces_.length?null:n.pieces_[n.pieceNum_]}function St(n){return n.pieces_.length-n.pieceNum_}function ge(n){let t=n.pieceNum_;return t<n.pieces_.length&&t++,new K(n.pieces_,t)}function Je(n){return n.pieceNum_<n.pieces_.length?n.pieces_[n.pieces_.length-1]:null}function Ai(n,t=0){return n.pieces_.slice(n.pieceNum_+t)}function Jn(n){if(n.pieceNum_>=n.pieces_.length)return null;const t=[];for(let e=n.pieceNum_;e<n.pieces_.length-1;e++)t.push(n.pieces_[e]);return new K(t,0)}function Ge(n,t){const e=[];for(let i=n.pieceNum_;i<n.pieces_.length;i++)e.push(n.pieces_[i]);if(t instanceof K)for(let i=t.pieceNum_;i<t.pieces_.length;i++)e.push(t.pieces_[i]);else{const i=t.split("/");for(let o=0;o<i.length;o++)i[o].length>0&&e.push(i[o])}return new K(e,0)}function re(n){return n.pieceNum_>=n.pieces_.length}function $e(n,t){const e=$(n),i=$(t);if(null===e)return t;if(e===i)return $e(ge(n),ge(t));throw new Error("INTERNAL ERROR: innerPath ("+t+") is not within outerPath ("+n+")")}function Xn(n,t){const e=Ai(n,0),i=Ai(t,0);for(let o=0;o<e.length&&o<i.length;o++){const u=N(e[o],i[o]);if(0!==u)return u}return e.length===i.length?0:e.length<i.length?-1:1}function On(n,t){if(St(n)!==St(t))return!1;for(let e=n.pieceNum_,i=t.pieceNum_;e<=n.pieces_.length;e++,i++)if(n.pieces_[e]!==t.pieces_[i])return!1;return!0}function Lt(n,t){let e=n.pieceNum_,i=t.pieceNum_;if(St(n)>St(t))return!1;for(;e<n.pieces_.length;){if(n.pieces_[e]!==t.pieces_[i])return!1;++e,++i}return!0}class ia{constructor(t,e){this.errorPrefix_=e,this.parts_=Ai(t,0),this.byteLength_=Math.max(1,this.parts_.length);for(let i=0;i<this.parts_.length;i++)this.byteLength_+=(0,p.ug)(this.parts_[i]);Dn(this)}}function Dn(n){if(n.byteLength_>Y)throw new Error(n.errorPrefix_+"has a key path longer than "+Y+" bytes ("+n.byteLength_+").");if(n.parts_.length>U)throw new Error(n.errorPrefix_+"path specified exceeds the maximum depth that can be written ("+U+") or object contains a cycle "+xn(n))}function xn(n){return 0===n.parts_.length?"":"in property '"+n.parts_.join(".")+"'"}class ei extends R{constructor(){let t,e;super(["visible"]),typeof document<"u"&&typeof document.addEventListener<"u"&&(typeof document.hidden<"u"?(e="visibilitychange",t="hidden"):typeof document.mozHidden<"u"?(e="mozvisibilitychange",t="mozHidden"):typeof document.msHidden<"u"?(e="msvisibilitychange",t="msHidden"):typeof document.webkitHidden<"u"&&(e="webkitvisibilitychange",t="webkitHidden")),this.visible_=!0,e&&document.addEventListener(e,()=>{const i=!document[t];i!==this.visible_&&(this.visible_=i,this.trigger("visible",i))},!1)}static getInstance(){return new ei}getInitialEvent(t){return(0,p.hu)("visible"===t,"Unknown event type: "+t),[this.visible_]}}const Si=1e3;let fr,tn=(()=>{class n extends I{constructor(e,i,o,u,c,h,g,v){if(super(),this.repoInfo_=e,this.applicationId_=i,this.onDataUpdate_=o,this.onConnectStatus_=u,this.onServerInfoUpdate_=c,this.authTokenProvider_=h,this.appCheckTokenProvider_=g,this.authOverride_=v,this.id=n.nextPersistentConnectionId_++,this.log_=st("p:"+this.id+":"),this.interruptReasons_={},this.listens=new Map,this.outstandingPuts_=[],this.outstandingGets_=[],this.outstandingPutCount_=0,this.outstandingGetCount_=0,this.onDisconnectRequestQueue_=[],this.connected_=!1,this.reconnectDelay_=Si,this.maxReconnectDelay_=3e5,this.securityDebugCallback_=null,this.lastSessionId=null,this.establishConnectionTimer_=null,this.visible_=!1,this.requestCBHash_={},this.requestNumber_=0,this.realtime_=null,this.authToken_=null,this.appCheckToken_=null,this.forceTokenRefresh_=!1,this.invalidAuthTokenCount_=0,this.invalidAppCheckTokenCount_=0,this.firstConnection_=!0,this.lastConnectionAttemptTime_=null,this.lastConnectionEstablishedTime_=null,v&&!(0,p.Yr)())throw new Error("Auth override specified in options, but not supported on non Node.js platforms");ei.getInstance().on("visible",this.onVisible_,this),-1===e.host.indexOf("fblocal")&&O.getInstance().on("online",this.onOnline_,this)}sendRequest(e,i,o){const u=++this.requestNumber_,c={r:u,a:e,b:i};this.log_((0,p.Wl)(c)),(0,p.hu)(this.connected_,"sendRequest call when we're not connected not allowed."),this.realtime_.sendRequest(c),o&&(this.requestCBHash_[u]=o)}get(e){this.initConnection_();const i=new p.BH,u={action:"g",request:{p:e._path.toString(),q:e._queryObject},onComplete:h=>{const g=h.d;"ok"===h.s?i.resolve(g):i.reject(g)}};return this.outstandingGets_.push(u),this.outstandingGetCount_++,this.connected_&&this.sendGet_(this.outstandingGets_.length-1),i.promise}listen(e,i,o,u){this.initConnection_();const c=e._queryIdentifier,h=e._path.toString();this.log_("Listen called for "+h+" "+c),this.listens.has(h)||this.listens.set(h,new Map),(0,p.hu)(e._queryParams.isDefault()||!e._queryParams.loadsAllData(),"listen() called for non-default but complete query"),(0,p.hu)(!this.listens.get(h).has(c),"listen() called twice for same path/queryId.");const g={onComplete:u,hashFn:i,query:e,tag:o};this.listens.get(h).set(c,g),this.connected_&&this.sendListen_(g)}sendGet_(e){const i=this.outstandingGets_[e];this.sendRequest("g",i.request,o=>{delete this.outstandingGets_[e],this.outstandingGetCount_--,0===this.outstandingGetCount_&&(this.outstandingGets_=[]),i.onComplete&&i.onComplete(o)})}sendListen_(e){const i=e.query,o=i._path.toString(),u=i._queryIdentifier;this.log_("Listen on "+o+" for "+u);const c={p:o};e.tag&&(c.q=i._queryObject,c.t=e.tag),c.h=e.hashFn(),this.sendRequest("q",c,g=>{const v=g.d,P=g.s;n.warnOnListenWarnings_(v,i),(this.listens.get(o)&&this.listens.get(o).get(u))===e&&(this.log_("listen response",g),"ok"!==P&&this.removeListen_(o,u),e.onComplete&&e.onComplete(P,v))})}static warnOnListenWarnings_(e,i){if(e&&"object"==typeof e&&(0,p.r3)(e,"w")){const o=(0,p.DV)(e,"w");if(Array.isArray(o)&&~o.indexOf("no_index")){const u='".indexOn": "'+i._queryParams.getIndex().toString()+'"',c=i._path.toString();ee(`Using an unspecified index. Your data will be downloaded and filtered on the client. Consider adding ${u} at ${c} to your security rules for better performance.`)}}}refreshAuthToken(e){this.authToken_=e,this.log_("Auth token refreshed"),this.authToken_?this.tryAuth():this.connected_&&this.sendRequest("unauth",{},()=>{}),this.reduceReconnectDelayIfAdminCredential_(e)}reduceReconnectDelayIfAdminCredential_(e){(e&&40===e.length||(0,p.GJ)(e))&&(this.log_("Admin auth credential detected.  Reducing max reconnect time."),this.maxReconnectDelay_=3e4)}refreshAppCheckToken(e){this.appCheckToken_=e,this.log_("App check token refreshed"),this.appCheckToken_?this.tryAppCheck():this.connected_&&this.sendRequest("unappeck",{},()=>{})}tryAuth(){if(this.connected_&&this.authToken_){const e=this.authToken_,i=(0,p.w9)(e)?"auth":"gauth",o={cred:e};null===this.authOverride_?o.noauth=!0:"object"==typeof this.authOverride_&&(o.authvar=this.authOverride_),this.sendRequest(i,o,u=>{const c=u.s,h=u.d||"error";this.authToken_===e&&("ok"===c?this.invalidAuthTokenCount_=0:this.onAuthRevoked_(c,h))})}}tryAppCheck(){this.connected_&&this.appCheckToken_&&this.sendRequest("appcheck",{token:this.appCheckToken_},e=>{const i=e.s,o=e.d||"error";"ok"===i?this.invalidAppCheckTokenCount_=0:this.onAppCheckRevoked_(i,o)})}unlisten(e,i){const o=e._path.toString(),u=e._queryIdentifier;this.log_("Unlisten called for "+o+" "+u),(0,p.hu)(e._queryParams.isDefault()||!e._queryParams.loadsAllData(),"unlisten() called for non-default but complete query"),this.removeListen_(o,u)&&this.connected_&&this.sendUnlisten_(o,u,e._queryObject,i)}sendUnlisten_(e,i,o,u){this.log_("Unlisten on "+e+" for "+i);const c={p:e};u&&(c.q=o,c.t=u),this.sendRequest("n",c)}onDisconnectPut(e,i,o){this.initConnection_(),this.connected_?this.sendOnDisconnect_("o",e,i,o):this.onDisconnectRequestQueue_.push({pathString:e,action:"o",data:i,onComplete:o})}onDisconnectMerge(e,i,o){this.initConnection_(),this.connected_?this.sendOnDisconnect_("om",e,i,o):this.onDisconnectRequestQueue_.push({pathString:e,action:"om",data:i,onComplete:o})}onDisconnectCancel(e,i){this.initConnection_(),this.connected_?this.sendOnDisconnect_("oc",e,null,i):this.onDisconnectRequestQueue_.push({pathString:e,action:"oc",data:null,onComplete:i})}sendOnDisconnect_(e,i,o,u){const c={p:i,d:o};this.log_("onDisconnect "+e,c),this.sendRequest(e,c,h=>{u&&setTimeout(()=>{u(h.s,h.d)},Math.floor(0))})}put(e,i,o,u){this.putInternal("p",e,i,o,u)}merge(e,i,o,u){this.putInternal("m",e,i,o,u)}putInternal(e,i,o,u,c){this.initConnection_();const h={p:i,d:o};void 0!==c&&(h.h=c),this.outstandingPuts_.push({action:e,request:h,onComplete:u}),this.outstandingPutCount_++,this.connected_?this.sendPut_(this.outstandingPuts_.length-1):this.log_("Buffering put: "+i)}sendPut_(e){const i=this.outstandingPuts_[e].action,o=this.outstandingPuts_[e].request,u=this.outstandingPuts_[e].onComplete;this.outstandingPuts_[e].queued=this.connected_,this.sendRequest(i,o,c=>{this.log_(i+" response",c),delete this.outstandingPuts_[e],this.outstandingPutCount_--,0===this.outstandingPutCount_&&(this.outstandingPuts_=[]),u&&u(c.s,c.d)})}reportStats(e){if(this.connected_){const i={c:e};this.log_("reportStats",i),this.sendRequest("s",i,o=>{"ok"!==o.s&&this.log_("reportStats","Error sending stats: "+o.d)})}}onDataMessage_(e){if("r"in e){this.log_("from server: "+(0,p.Wl)(e));const i=e.r,o=this.requestCBHash_[i];o&&(delete this.requestCBHash_[i],o(e.b))}else{if("error"in e)throw"A server-side error has occurred: "+e.error;"a"in e&&this.onDataPush_(e.a,e.b)}}onDataPush_(e,i){this.log_("handleServerMessage",e,i),"d"===e?this.onDataUpdate_(i.p,i.d,!1,i.t):"m"===e?this.onDataUpdate_(i.p,i.d,!0,i.t):"c"===e?this.onListenRevoked_(i.p,i.q):"ac"===e?this.onAuthRevoked_(i.s,i.d):"apc"===e?this.onAppCheckRevoked_(i.s,i.d):"sd"===e?this.onSecurityDebugPacket_(i):_t("Unrecognized action received from server: "+(0,p.Wl)(e)+"\nAre you using the latest client?")}onReady_(e,i){this.log_("connection ready"),this.connected_=!0,this.lastConnectionEstablishedTime_=(new Date).getTime(),this.handleTimestamp_(e),this.lastSessionId=i,this.firstConnection_&&this.sendConnectStats_(),this.restoreState_(),this.firstConnection_=!1,this.onConnectStatus_(!0)}scheduleConnect_(e){(0,p.hu)(!this.realtime_,"Scheduling a connect when we're already connected/ing?"),this.establishConnectionTimer_&&clearTimeout(this.establishConnectionTimer_),this.establishConnectionTimer_=setTimeout(()=>{this.establishConnectionTimer_=null,this.establishConnection_()},Math.floor(e))}initConnection_(){!this.realtime_&&this.firstConnection_&&this.scheduleConnect_(0)}onVisible_(e){e&&!this.visible_&&this.reconnectDelay_===this.maxReconnectDelay_&&(this.log_("Window became visible.  Reducing delay."),this.reconnectDelay_=Si,this.realtime_||this.scheduleConnect_(0)),this.visible_=e}onOnline_(e){e?(this.log_("Browser went online."),this.reconnectDelay_=Si,this.realtime_||this.scheduleConnect_(0)):(this.log_("Browser went offline.  Killing connection."),this.realtime_&&this.realtime_.close())}onRealtimeDisconnect_(){if(this.log_("data client disconnected"),this.connected_=!1,this.realtime_=null,this.cancelSentTransactions_(),this.requestCBHash_={},this.shouldReconnect_()){this.visible_?this.lastConnectionEstablishedTime_&&((new Date).getTime()-this.lastConnectionEstablishedTime_>3e4&&(this.reconnectDelay_=Si),this.lastConnectionEstablishedTime_=null):(this.log_("Window isn't visible.  Delaying reconnect."),this.reconnectDelay_=this.maxReconnectDelay_,this.lastConnectionAttemptTime_=(new Date).getTime());const e=(new Date).getTime()-this.lastConnectionAttemptTime_;let i=Math.max(0,this.reconnectDelay_-e);i=Math.random()*i,this.log_("Trying to reconnect in "+i+"ms"),this.scheduleConnect_(i),this.reconnectDelay_=Math.min(this.maxReconnectDelay_,1.3*this.reconnectDelay_)}this.onConnectStatus_(!1)}establishConnection_(){var e=this;return(0,Qe.Z)(function*(){if(e.shouldReconnect_()){e.log_("Making a connection attempt"),e.lastConnectionAttemptTime_=(new Date).getTime(),e.lastConnectionEstablishedTime_=null;const i=e.onDataMessage_.bind(e),o=e.onReady_.bind(e),u=e.onRealtimeDisconnect_.bind(e),c=e.id+":"+n.nextConnectionId_++,h=e.lastSessionId;let g=!1,v=null;const P=function(){v?v.close():(g=!0,u())};e.realtime_={close:P,sendRequest:function(Z){(0,p.hu)(v,"sendRequest call when we're not connected not allowed."),v.sendRequest(Z)}};const L=e.forceTokenRefresh_;e.forceTokenRefresh_=!1;try{const[Z,Q]=yield Promise.all([e.authTokenProvider_.getToken(L),e.appCheckTokenProvider_.getToken(L)]);g?oe("getToken() completed but was canceled"):(oe("getToken() completed. Creating connection."),e.authToken_=Z&&Z.accessToken,e.appCheckToken_=Q&&Q.token,v=new T(c,e.repoInfo_,e.applicationId_,e.appCheckToken_,e.authToken_,i,o,u,Ie=>{ee(Ie+" ("+e.repoInfo_.toString()+")"),e.interrupt("server_kill")},h))}catch(Z){e.log_("Failed to get token: "+Z),g||(e.repoInfo_.nodeAdmin&&ee(Z),P())}}})()}interrupt(e){oe("Interrupting connection for reason: "+e),this.interruptReasons_[e]=!0,this.realtime_?this.realtime_.close():(this.establishConnectionTimer_&&(clearTimeout(this.establishConnectionTimer_),this.establishConnectionTimer_=null),this.connected_&&this.onRealtimeDisconnect_())}resume(e){oe("Resuming connection for reason: "+e),delete this.interruptReasons_[e],(0,p.xb)(this.interruptReasons_)&&(this.reconnectDelay_=Si,this.realtime_||this.scheduleConnect_(0))}handleTimestamp_(e){const i=e-(new Date).getTime();this.onServerInfoUpdate_({serverTimeOffset:i})}cancelSentTransactions_(){for(let e=0;e<this.outstandingPuts_.length;e++){const i=this.outstandingPuts_[e];i&&"h"in i.request&&i.queued&&(i.onComplete&&i.onComplete("disconnect"),delete this.outstandingPuts_[e],this.outstandingPutCount_--)}0===this.outstandingPutCount_&&(this.outstandingPuts_=[])}onListenRevoked_(e,i){let o;o=i?i.map(c=>ke(c)).join("$"):"default";const u=this.removeListen_(e,o);u&&u.onComplete&&u.onComplete("permission_denied")}removeListen_(e,i){const o=new K(e).toString();let u;if(this.listens.has(o)){const c=this.listens.get(o);u=c.get(i),c.delete(i),0===c.size&&this.listens.delete(o)}else u=void 0;return u}onAuthRevoked_(e,i){oe("Auth token revoked: "+e+"/"+i),this.authToken_=null,this.forceTokenRefresh_=!0,this.realtime_.close(),("invalid_token"===e||"permission_denied"===e)&&(this.invalidAuthTokenCount_++,this.invalidAuthTokenCount_>=3&&(this.reconnectDelay_=3e4,this.authTokenProvider_.notifyForInvalidToken()))}onAppCheckRevoked_(e,i){oe("App check token revoked: "+e+"/"+i),this.appCheckToken_=null,this.forceTokenRefresh_=!0,("invalid_token"===e||"permission_denied"===e)&&(this.invalidAppCheckTokenCount_++,this.invalidAppCheckTokenCount_>=3&&this.appCheckTokenProvider_.notifyForInvalidToken())}onSecurityDebugPacket_(e){this.securityDebugCallback_?this.securityDebugCallback_(e):"msg"in e&&console.log("FIREBASE: "+e.msg.replace("\n","\nFIREBASE: "))}restoreState_(){this.tryAuth(),this.tryAppCheck();for(const e of this.listens.values())for(const i of e.values())this.sendListen_(i);for(let e=0;e<this.outstandingPuts_.length;e++)this.outstandingPuts_[e]&&this.sendPut_(e);for(;this.onDisconnectRequestQueue_.length;){const e=this.onDisconnectRequestQueue_.shift();this.sendOnDisconnect_(e.action,e.pathString,e.data,e.onComplete)}for(let e=0;e<this.outstandingGets_.length;e++)this.outstandingGets_[e]&&this.sendGet_(e)}sendConnectStats_(){const e={};let i="js";(0,p.Yr)()&&(i=this.repoInfo_.nodeAdmin?"admin_node":"node"),e["sdk."+i+"."+Re.replace(/\./g,"-")]=1,(0,p.uI)()?e["framework.cordova"]=1:(0,p.b$)()&&(e["framework.reactnative"]=1),this.reportStats(e)}shouldReconnect_(){const e=O.getInstance().currentlyOnline();return(0,p.xb)(this.interruptReasons_)&&e}}return n.nextPersistentConnectionId_=0,n.nextConnectionId_=0,n})();class le{constructor(t,e){this.name=t,this.node=e}static Wrap(t,e){return new le(t,e)}}class wi{getCompare(){return this.compare.bind(this)}indexedValueChanged(t,e){const i=new le(V,t),o=new le(V,e);return 0!==this.compare(i,o)}minPost(){return le.MIN}}class pr extends wi{static get __EMPTY_NODE(){return fr}static set __EMPTY_NODE(t){fr=t}compare(t,e){return N(t.name,e.name)}isDefinedOn(t){throw(0,p.g5)("KeyIndex.isDefinedOn not expected to be called.")}indexedValueChanged(t,e){return!1}minPost(){return le.MIN}maxPost(){return new le(X,fr)}makePost(t,e){return(0,p.hu)("string"==typeof t,"KeyIndex indexValue must always be a string."),new le(t,fr)}toString(){return".key"}}const Ft=new pr;class ti{constructor(t,e,i,o,u=null){this.isReverse_=o,this.resultGenerator_=u,this.nodeStack_=[];let c=1;for(;!t.isEmpty();)if(c=e?i(t.key,e):1,o&&(c*=-1),c<0)t=this.isReverse_?t.left:t.right;else{if(0===c){this.nodeStack_.push(t);break}this.nodeStack_.push(t),t=this.isReverse_?t.right:t.left}}getNext(){if(0===this.nodeStack_.length)return null;let e,t=this.nodeStack_.pop();if(e=this.resultGenerator_?this.resultGenerator_(t.key,t.value):{key:t.key,value:t.value},this.isReverse_)for(t=t.left;!t.isEmpty();)this.nodeStack_.push(t),t=t.right;else for(t=t.right;!t.isEmpty();)this.nodeStack_.push(t),t=t.left;return e}hasNext(){return this.nodeStack_.length>0}peek(){if(0===this.nodeStack_.length)return null;const t=this.nodeStack_[this.nodeStack_.length-1];return this.resultGenerator_?this.resultGenerator_(t.key,t.value):{key:t.key,value:t.value}}}let Ri,wt=(()=>{class n{constructor(e,i,o,u,c){this.key=e,this.value=i,this.color=o??n.RED,this.left=u??vt.EMPTY_NODE,this.right=c??vt.EMPTY_NODE}copy(e,i,o,u,c){return new n(e??this.key,i??this.value,o??this.color,u??this.left,c??this.right)}count(){return this.left.count()+1+this.right.count()}isEmpty(){return!1}inorderTraversal(e){return this.left.inorderTraversal(e)||!!e(this.key,this.value)||this.right.inorderTraversal(e)}reverseTraversal(e){return this.right.reverseTraversal(e)||e(this.key,this.value)||this.left.reverseTraversal(e)}min_(){return this.left.isEmpty()?this:this.left.min_()}minKey(){return this.min_().key}maxKey(){return this.right.isEmpty()?this.key:this.right.maxKey()}insert(e,i,o){let u=this;const c=o(e,u.key);return u=c<0?u.copy(null,null,null,u.left.insert(e,i,o),null):0===c?u.copy(null,i,null,null,null):u.copy(null,null,null,null,u.right.insert(e,i,o)),u.fixUp_()}removeMin_(){if(this.left.isEmpty())return vt.EMPTY_NODE;let e=this;return!e.left.isRed_()&&!e.left.left.isRed_()&&(e=e.moveRedLeft_()),e=e.copy(null,null,null,e.left.removeMin_(),null),e.fixUp_()}remove(e,i){let o,u;if(o=this,i(e,o.key)<0)!o.left.isEmpty()&&!o.left.isRed_()&&!o.left.left.isRed_()&&(o=o.moveRedLeft_()),o=o.copy(null,null,null,o.left.remove(e,i),null);else{if(o.left.isRed_()&&(o=o.rotateRight_()),!o.right.isEmpty()&&!o.right.isRed_()&&!o.right.left.isRed_()&&(o=o.moveRedRight_()),0===i(e,o.key)){if(o.right.isEmpty())return vt.EMPTY_NODE;u=o.right.min_(),o=o.copy(u.key,u.value,null,null,o.right.removeMin_())}o=o.copy(null,null,null,null,o.right.remove(e,i))}return o.fixUp_()}isRed_(){return this.color}fixUp_(){let e=this;return e.right.isRed_()&&!e.left.isRed_()&&(e=e.rotateLeft_()),e.left.isRed_()&&e.left.left.isRed_()&&(e=e.rotateRight_()),e.left.isRed_()&&e.right.isRed_()&&(e=e.colorFlip_()),e}moveRedLeft_(){let e=this.colorFlip_();return e.right.left.isRed_()&&(e=e.copy(null,null,null,null,e.right.rotateRight_()),e=e.rotateLeft_(),e=e.colorFlip_()),e}moveRedRight_(){let e=this.colorFlip_();return e.left.left.isRed_()&&(e=e.rotateRight_(),e=e.colorFlip_()),e}rotateLeft_(){const e=this.copy(null,null,n.RED,null,this.right.left);return this.right.copy(null,null,this.color,e,null)}rotateRight_(){const e=this.copy(null,null,n.RED,this.left.right,null);return this.left.copy(null,null,this.color,null,e)}colorFlip_(){const e=this.left.copy(null,null,!this.left.color,null,null),i=this.right.copy(null,null,!this.right.color,null,null);return this.copy(null,null,!this.color,e,i)}checkMaxDepth_(){const e=this.check_();return Math.pow(2,e)<=this.count()+1}check_(){if(this.isRed_()&&this.left.isRed_())throw new Error("Red node has red child("+this.key+","+this.value+")");if(this.right.isRed_())throw new Error("Right child of ("+this.key+","+this.value+") is red");const e=this.left.check_();if(e!==this.right.check_())throw new Error("Black depths differ");return e+(this.isRed_()?0:1)}}return n.RED=!0,n.BLACK=!1,n})();class vt{constructor(t,e=vt.EMPTY_NODE){this.comparator_=t,this.root_=e}insert(t,e){return new vt(this.comparator_,this.root_.insert(t,e,this.comparator_).copy(null,null,wt.BLACK,null,null))}remove(t){return new vt(this.comparator_,this.root_.remove(t,this.comparator_).copy(null,null,wt.BLACK,null,null))}get(t){let e,i=this.root_;for(;!i.isEmpty();){if(e=this.comparator_(t,i.key),0===e)return i.value;e<0?i=i.left:e>0&&(i=i.right)}return null}getPredecessorKey(t){let e,i=this.root_,o=null;for(;!i.isEmpty();){if(e=this.comparator_(t,i.key),0===e){if(i.left.isEmpty())return o?o.key:null;for(i=i.left;!i.right.isEmpty();)i=i.right;return i.key}e<0?i=i.left:e>0&&(o=i,i=i.right)}throw new Error("Attempted to find predecessor key for a nonexistent key.  What gives?")}isEmpty(){return this.root_.isEmpty()}count(){return this.root_.count()}minKey(){return this.root_.minKey()}maxKey(){return this.root_.maxKey()}inorderTraversal(t){return this.root_.inorderTraversal(t)}reverseTraversal(t){return this.root_.reverseTraversal(t)}getIterator(t){return new ti(this.root_,null,this.comparator_,!1,t)}getIteratorFrom(t,e){return new ti(this.root_,t,this.comparator_,!1,e)}getReverseIteratorFrom(t,e){return new ti(this.root_,t,this.comparator_,!0,e)}getReverseIterator(t){return new ti(this.root_,null,this.comparator_,!0,t)}}function Xr(n,t){return N(n.name,t.name)}function _r(n,t){return N(n,t)}vt.EMPTY_NODE=new class Jr{copy(t,e,i,o,u){return this}insert(t,e,i){return new wt(t,e,null)}remove(t,e){return this}count(){return 0}isEmpty(){return!0}inorderTraversal(t){return!1}reverseTraversal(t){return!1}minKey(){return null}maxKey(){return null}check_(){return 0}isRed_(){return!1}};const mr=function(n){return"number"==typeof n?"number:"+kt(n):"string:"+n},es=function(n){if(n.isLeafNode()){const t=n.val();(0,p.hu)("string"==typeof t||"number"==typeof t||"object"==typeof t&&(0,p.r3)(t,".sv"),"Priority must be a string or number.")}else(0,p.hu)(n===Ri||n.isEmpty(),"priority of unexpected type.");(0,p.hu)(n===Ri||n.getPriority().isEmpty(),"Priority nodes can't have a priority of their own.")};let vr,yr,oo,Ln=(()=>{class n{constructor(e,i=n.__childrenNodeConstructor.EMPTY_NODE){this.value_=e,this.priorityNode_=i,this.lazyHash_=null,(0,p.hu)(null!=this.value_,"LeafNode shouldn't be created with null/undefined value."),es(this.priorityNode_)}static set __childrenNodeConstructor(e){vr=e}static get __childrenNodeConstructor(){return vr}isLeafNode(){return!0}getPriority(){return this.priorityNode_}updatePriority(e){return new n(this.value_,e)}getImmediateChild(e){return".priority"===e?this.priorityNode_:n.__childrenNodeConstructor.EMPTY_NODE}getChild(e){return re(e)?this:".priority"===$(e)?this.priorityNode_:n.__childrenNodeConstructor.EMPTY_NODE}hasChild(){return!1}getPredecessorChildName(e,i){return null}updateImmediateChild(e,i){return".priority"===e?this.updatePriority(i):i.isEmpty()&&".priority"!==e?this:n.__childrenNodeConstructor.EMPTY_NODE.updateImmediateChild(e,i).updatePriority(this.priorityNode_)}updateChild(e,i){const o=$(e);return null===o?i:i.isEmpty()&&".priority"!==o?this:((0,p.hu)(".priority"!==o||1===St(e),".priority must be the last token in a path"),this.updateImmediateChild(o,n.__childrenNodeConstructor.EMPTY_NODE.updateChild(ge(e),i)))}isEmpty(){return!1}numChildren(){return 0}forEachChild(e,i){return!1}val(e){return e&&!this.getPriority().isEmpty()?{".value":this.getValue(),".priority":this.getPriority().val()}:this.getValue()}hash(){if(null===this.lazyHash_){let e="";this.priorityNode_.isEmpty()||(e+="priority:"+mr(this.priorityNode_.val())+":");const i=typeof this.value_;e+=i+":",e+="number"===i?kt(this.value_):this.value_,this.lazyHash_=ce(e)}return this.lazyHash_}getValue(){return this.value_}compareTo(e){return e===n.__childrenNodeConstructor.EMPTY_NODE?1:e instanceof n.__childrenNodeConstructor?-1:((0,p.hu)(e.isLeafNode(),"Unknown node type"),this.compareToLeafNode_(e))}compareToLeafNode_(e){const i=typeof e.value_,o=typeof this.value_,u=n.VALUE_TYPE_ORDER.indexOf(i),c=n.VALUE_TYPE_ORDER.indexOf(o);return(0,p.hu)(u>=0,"Unknown leaf type: "+i),(0,p.hu)(c>=0,"Unknown leaf type: "+o),u===c?"object"===o?0:this.value_<e.value_?-1:this.value_===e.value_?0:1:c-u}withIndex(){return this}isIndexed(){return!0}equals(e){return e===this||!!e.isLeafNode()&&(this.value_===e.value_&&this.priorityNode_.equals(e.priorityNode_))}}return n.VALUE_TYPE_ORDER=["object","boolean","number","string"],n})();const Ce=new class ns extends wi{compare(t,e){const i=t.node.getPriority(),o=e.node.getPriority(),u=i.compareTo(o);return 0===u?N(t.name,e.name):u}isDefinedOn(t){return!t.getPriority().isEmpty()}indexedValueChanged(t,e){return!t.getPriority().equals(e.getPriority())}minPost(){return le.MIN}maxPost(){return new le(X,new Ln("[PRIORITY-POST]",oo))}makePost(t,e){const i=yr(t);return new le(e,new Ln("[PRIORITY-POST]",i))}toString(){return".priority"}},is=Math.log(2);class Ir{constructor(t){this.count=parseInt(Math.log(t+1)/is,10),this.current_=this.count-1;const o=(u=>parseInt(Array(this.count+1).join("1"),2))();this.bits_=t+1&o}nextBitIsOne(){const t=!(this.bits_&1<<this.current_);return this.current_--,t}}const Er=function(n,t,e,i){n.sort(t);const o=function(g,v){const P=v-g;let b,L;if(0===P)return null;if(1===P)return b=n[g],L=e?e(b):b,new wt(L,b.node,wt.BLACK,null,null);{const Z=parseInt(P/2,10)+g,Q=o(g,Z),Ie=o(Z+1,v);return b=n[Z],L=e?e(b):b,new wt(L,b.node,wt.BLACK,Q,Ie)}},h=function(g){let v=null,P=null,b=n.length;const L=function(Q,Ie){const ht=b-Q,Cn=b;b-=Q;const zn=o(ht+1,Cn),Kr=n[ht],gc=e?e(Kr):Kr;Z(new wt(gc,Kr.node,Ie,null,zn))},Z=function(Q){v?(v.left=Q,v=Q):(P=Q,v=Q)};for(let Q=0;Q<g.count;++Q){const Ie=g.nextBitIsOne(),ht=Math.pow(2,g.count-(Q+1));Ie?L(ht,wt.BLACK):(L(ht,wt.BLACK),L(ht,wt.RED))}return P}(new Ir(n.length));return new vt(i||t,h)};let ki;const ni={};class jt{constructor(t,e){this.indexes_=t,this.indexSet_=e}static get Default(){return(0,p.hu)(ni&&Ce,"ChildrenNode.ts has not been loaded"),ki=ki||new jt({".priority":ni},{".priority":Ce}),ki}get(t){const e=(0,p.DV)(this.indexes_,t);if(!e)throw new Error("No index defined for "+t);return e instanceof vt?e:null}hasIndex(t){return(0,p.r3)(this.indexSet_,t.toString())}addIndex(t,e){(0,p.hu)(t!==Ft,"KeyIndex always exists and isn't meant to be added to the IndexMap.");const i=[];let o=!1;const u=e.getIterator(le.Wrap);let h,c=u.getNext();for(;c;)o=o||t.isDefinedOn(c.node),i.push(c),c=u.getNext();h=o?Er(i,t.getCompare()):ni;const g=t.toString(),v=Object.assign({},this.indexSet_);v[g]=t;const P=Object.assign({},this.indexes_);return P[g]=h,new jt(P,v)}addToIndexes(t,e){const i=(0,p.UI)(this.indexes_,(o,u)=>{const c=(0,p.DV)(this.indexSet_,u);if((0,p.hu)(c,"Missing index implementation for "+u),o===ni){if(c.isDefinedOn(t.node)){const h=[],g=e.getIterator(le.Wrap);let v=g.getNext();for(;v;)v.name!==t.name&&h.push(v),v=g.getNext();return h.push(t),Er(h,c.getCompare())}return ni}{const h=e.get(t.name);let g=o;return h&&(g=g.remove(new le(t.name,h))),g.insert(t,t.node)}});return new jt(i,this.indexSet_)}removeFromIndexes(t,e){const i=(0,p.UI)(this.indexes_,o=>{if(o===ni)return o;{const u=e.get(t.name);return u?o.remove(new le(t.name,u)):o}});return new jt(i,this.indexSet_)}}let Pi,ne=(()=>{class n{constructor(e,i,o){this.children_=e,this.priorityNode_=i,this.indexMap_=o,this.lazyHash_=null,this.priorityNode_&&es(this.priorityNode_),this.children_.isEmpty()&&(0,p.hu)(!this.priorityNode_||this.priorityNode_.isEmpty(),"An empty node cannot have a priority")}static get EMPTY_NODE(){return Pi||(Pi=new n(new vt(_r),null,jt.Default))}isLeafNode(){return!1}getPriority(){return this.priorityNode_||Pi}updatePriority(e){return this.children_.isEmpty()?this:new n(this.children_,e,this.indexMap_)}getImmediateChild(e){if(".priority"===e)return this.getPriority();{const i=this.children_.get(e);return null===i?Pi:i}}getChild(e){const i=$(e);return null===i?this:this.getImmediateChild(i).getChild(ge(e))}hasChild(e){return null!==this.children_.get(e)}updateImmediateChild(e,i){if((0,p.hu)(i,"We should always be passing snapshot nodes"),".priority"===e)return this.updatePriority(i);{const o=new le(e,i);let u,c;i.isEmpty()?(u=this.children_.remove(e),c=this.indexMap_.removeFromIndexes(o,this.children_)):(u=this.children_.insert(e,i),c=this.indexMap_.addToIndexes(o,this.children_));const h=u.isEmpty()?Pi:this.priorityNode_;return new n(u,h,c)}}updateChild(e,i){const o=$(e);if(null===o)return i;{(0,p.hu)(".priority"!==$(e)||1===St(e),".priority must be the last token in a path");const u=this.getImmediateChild(o).updateChild(ge(e),i);return this.updateImmediateChild(o,u)}}isEmpty(){return this.children_.isEmpty()}numChildren(){return this.children_.count()}val(e){if(this.isEmpty())return null;const i={};let o=0,u=0,c=!0;if(this.forEachChild(Ce,(h,g)=>{i[h]=g.val(e),o++,c&&n.INTEGER_REGEXP_.test(h)?u=Math.max(u,Number(h)):c=!1}),!e&&c&&u<2*o){const h=[];for(const g in i)h[g]=i[g];return h}return e&&!this.getPriority().isEmpty()&&(i[".priority"]=this.getPriority().val()),i}hash(){if(null===this.lazyHash_){let e="";this.getPriority().isEmpty()||(e+="priority:"+mr(this.getPriority().val())+":"),this.forEachChild(Ce,(i,o)=>{const u=o.hash();""!==u&&(e+=":"+i+":"+u)}),this.lazyHash_=""===e?"":ce(e)}return this.lazyHash_}getPredecessorChildName(e,i,o){const u=this.resolveIndex_(o);if(u){const c=u.getPredecessorKey(new le(e,i));return c?c.name:null}return this.children_.getPredecessorKey(e)}getFirstChildName(e){const i=this.resolveIndex_(e);if(i){const o=i.minKey();return o&&o.name}return this.children_.minKey()}getFirstChild(e){const i=this.getFirstChildName(e);return i?new le(i,this.children_.get(i)):null}getLastChildName(e){const i=this.resolveIndex_(e);if(i){const o=i.maxKey();return o&&o.name}return this.children_.maxKey()}getLastChild(e){const i=this.getLastChildName(e);return i?new le(i,this.children_.get(i)):null}forEachChild(e,i){const o=this.resolveIndex_(e);return o?o.inorderTraversal(u=>i(u.name,u.node)):this.children_.inorderTraversal(i)}getIterator(e){return this.getIteratorFrom(e.minPost(),e)}getIteratorFrom(e,i){const o=this.resolveIndex_(i);if(o)return o.getIteratorFrom(e,u=>u);{const u=this.children_.getIteratorFrom(e.name,le.Wrap);let c=u.peek();for(;null!=c&&i.compare(c,e)<0;)u.getNext(),c=u.peek();return u}}getReverseIterator(e){return this.getReverseIteratorFrom(e.maxPost(),e)}getReverseIteratorFrom(e,i){const o=this.resolveIndex_(i);if(o)return o.getReverseIteratorFrom(e,u=>u);{const u=this.children_.getReverseIteratorFrom(e.name,le.Wrap);let c=u.peek();for(;null!=c&&i.compare(c,e)>0;)u.getNext(),c=u.peek();return u}}compareTo(e){return this.isEmpty()?e.isEmpty()?0:-1:e.isLeafNode()||e.isEmpty()?1:e===Mn?-1:0}withIndex(e){if(e===Ft||this.indexMap_.hasIndex(e))return this;{const i=this.indexMap_.addIndex(e,this.children_);return new n(this.children_,this.priorityNode_,i)}}isIndexed(e){return e===Ft||this.indexMap_.hasIndex(e)}equals(e){if(e===this)return!0;if(e.isLeafNode())return!1;{const i=e;if(this.getPriority().equals(i.getPriority())){if(this.children_.count()===i.children_.count()){const o=this.getIterator(Ce),u=i.getIterator(Ce);let c=o.getNext(),h=u.getNext();for(;c&&h;){if(c.name!==h.name||!c.node.equals(h.node))return!1;c=o.getNext(),h=u.getNext()}return null===c&&null===h}return!1}return!1}}resolveIndex_(e){return e===Ft?null:this.indexMap_.get(e.toString())}}return n.INTEGER_REGEXP_=/^(0|[1-9]\d*)$/,n})();const Mn=new class ao extends ne{constructor(){super(new vt(_r),ne.EMPTY_NODE,jt.Default)}compareTo(t){return t===this?0:1}equals(t){return t===this}getPriority(){return this}getImmediateChild(t){return ne.EMPTY_NODE}isEmpty(){return!1}};Object.defineProperties(le,{MIN:{value:new le(V,ne.EMPTY_NODE)},MAX:{value:new le(X,Mn)}}),pr.__EMPTY_NODE=ne.EMPTY_NODE,Ln.__childrenNodeConstructor=ne,function gr(n){Ri=n}(Mn),function aa(n){oo=n}(Mn);const la=!0;function Fe(n,t=null){if(null===n)return ne.EMPTY_NODE;if("object"==typeof n&&".priority"in n&&(t=n[".priority"]),(0,p.hu)(null===t||"string"==typeof t||"number"==typeof t||"object"==typeof t&&".sv"in t,"Invalid priority type found: "+typeof t),"object"==typeof n&&".value"in n&&null!==n[".value"]&&(n=n[".value"]),"object"!=typeof n||".sv"in n)return new Ln(n,Fe(t));if(n instanceof Array||!la){let e=ne.EMPTY_NODE;return Ee(n,(i,o)=>{if((0,p.r3)(n,i)&&"."!==i.substring(0,1)){const u=Fe(o);(u.isLeafNode()||!u.isEmpty())&&(e=e.updateImmediateChild(i,u))}}),e.updatePriority(Fe(t))}{const e=[];let i=!1;if(Ee(n,(c,h)=>{if("."!==c.substring(0,1)){const g=Fe(h);g.isEmpty()||(i=i||!g.getPriority().isEmpty(),e.push(new le(c,g)))}}),0===e.length)return ne.EMPTY_NODE;const u=Er(e,Xr,c=>c.name,_r);if(i){const c=Er(e,Ce.getCompare());return new ne(u,Fe(t),new jt({".priority":c},{".priority":Ce}))}return new ne(u,Fe(t),jt.Default)}}!function ts(n){yr=n}(Fe);class rs extends wi{constructor(t){super(),this.indexPath_=t,(0,p.hu)(!re(t)&&".priority"!==$(t),"Can't create PathIndex with empty path or .priority key")}extractChild(t){return t.getChild(this.indexPath_)}isDefinedOn(t){return!t.getChild(this.indexPath_).isEmpty()}compare(t,e){const i=this.extractChild(t.node),o=this.extractChild(e.node),u=i.compareTo(o);return 0===u?N(t.name,e.name):u}makePost(t,e){const i=Fe(t),o=ne.EMPTY_NODE.updateChild(this.indexPath_,i);return new le(e,o)}maxPost(){const t=ne.EMPTY_NODE.updateChild(this.indexPath_,Mn);return new le(X,t)}toString(){return Ai(this.indexPath_,0).join("/")}}const os=new class ss extends wi{compare(t,e){const i=t.node.compareTo(e.node);return 0===i?N(t.name,e.name):i}isDefinedOn(t){return!0}indexedValueChanged(t,e){return!t.equals(e)}minPost(){return le.MIN}maxPost(){return le.MAX}makePost(t,e){const i=Fe(t);return new le(e,i)}toString(){return".value"}};function lo(n){return{type:"value",snapshotNode:n}}function vn(n,t){return{type:"child_added",snapshotNode:t,childName:n}}function bi(n,t){return{type:"child_removed",snapshotNode:t,childName:n}}function Ni(n,t,e){return{type:"child_changed",snapshotNode:t,childName:n,oldSnap:e}}class ls{constructor(t){this.index_=t}updateChild(t,e,i,o,u,c){(0,p.hu)(t.isIndexed(this.index_),"A node must be indexed if only a child is updated");const h=t.getImmediateChild(e);return h.getChild(o).equals(i.getChild(o))&&h.isEmpty()===i.isEmpty()||(null!=c&&(i.isEmpty()?t.hasChild(e)?c.trackChildChange(bi(e,h)):(0,p.hu)(t.isLeafNode(),"A child remove without an old child only makes sense on a leaf node"):h.isEmpty()?c.trackChildChange(vn(e,i)):c.trackChildChange(Ni(e,i,h))),t.isLeafNode()&&i.isEmpty())?t:t.updateImmediateChild(e,i).withIndex(this.index_)}updateFullNode(t,e,i){return null!=i&&(t.isLeafNode()||t.forEachChild(Ce,(o,u)=>{e.hasChild(o)||i.trackChildChange(bi(o,u))}),e.isLeafNode()||e.forEachChild(Ce,(o,u)=>{if(t.hasChild(o)){const c=t.getImmediateChild(o);c.equals(u)||i.trackChildChange(Ni(o,u,c))}else i.trackChildChange(vn(o,u))})),e.withIndex(this.index_)}updatePriority(t,e){return t.isEmpty()?ne.EMPTY_NODE:t.updatePriority(e)}filtersNodes(){return!1}getIndexedFilter(){return this}getIndex(){return this.index_}}class Fn{constructor(t){this.indexedFilter_=new ls(t.getIndex()),this.index_=t.getIndex(),this.startPost_=Fn.getStartPost_(t),this.endPost_=Fn.getEndPost_(t),this.startIsInclusive_=!t.startAfterSet_,this.endIsInclusive_=!t.endBeforeSet_}getStartPost(){return this.startPost_}getEndPost(){return this.endPost_}matches(t){const e=this.startIsInclusive_?this.index_.compare(this.getStartPost(),t)<=0:this.index_.compare(this.getStartPost(),t)<0,i=this.endIsInclusive_?this.index_.compare(t,this.getEndPost())<=0:this.index_.compare(t,this.getEndPost())<0;return e&&i}updateChild(t,e,i,o,u,c){return this.matches(new le(e,i))||(i=ne.EMPTY_NODE),this.indexedFilter_.updateChild(t,e,i,o,u,c)}updateFullNode(t,e,i){e.isLeafNode()&&(e=ne.EMPTY_NODE);let o=e.withIndex(this.index_);o=o.updatePriority(ne.EMPTY_NODE);const u=this;return e.forEachChild(Ce,(c,h)=>{u.matches(new le(c,h))||(o=o.updateImmediateChild(c,ne.EMPTY_NODE))}),this.indexedFilter_.updateFullNode(t,o,i)}updatePriority(t,e){return t}filtersNodes(){return!0}getIndexedFilter(){return this.indexedFilter_}getIndex(){return this.index_}static getStartPost_(t){if(t.hasStart()){const e=t.getIndexStartName();return t.getIndex().makePost(t.getIndexStartValue(),e)}return t.getIndex().minPost()}static getEndPost_(t){if(t.hasEnd()){const e=t.getIndexEndName();return t.getIndex().makePost(t.getIndexEndValue(),e)}return t.getIndex().maxPost()}}class ua{constructor(t){this.withinDirectionalStart=e=>this.reverse_?this.withinEndPost(e):this.withinStartPost(e),this.withinDirectionalEnd=e=>this.reverse_?this.withinStartPost(e):this.withinEndPost(e),this.withinStartPost=e=>{const i=this.index_.compare(this.rangedFilter_.getStartPost(),e);return this.startIsInclusive_?i<=0:i<0},this.withinEndPost=e=>{const i=this.index_.compare(e,this.rangedFilter_.getEndPost());return this.endIsInclusive_?i<=0:i<0},this.rangedFilter_=new Fn(t),this.index_=t.getIndex(),this.limit_=t.getLimit(),this.reverse_=!t.isViewFromLeft(),this.startIsInclusive_=!t.startAfterSet_,this.endIsInclusive_=!t.endBeforeSet_}updateChild(t,e,i,o,u,c){return this.rangedFilter_.matches(new le(e,i))||(i=ne.EMPTY_NODE),t.getImmediateChild(e).equals(i)?t:t.numChildren()<this.limit_?this.rangedFilter_.getIndexedFilter().updateChild(t,e,i,o,u,c):this.fullLimitUpdateChild_(t,e,i,u,c)}updateFullNode(t,e,i){let o;if(e.isLeafNode()||e.isEmpty())o=ne.EMPTY_NODE.withIndex(this.index_);else if(2*this.limit_<e.numChildren()&&e.isIndexed(this.index_)){let u;o=ne.EMPTY_NODE.withIndex(this.index_),u=this.reverse_?e.getReverseIteratorFrom(this.rangedFilter_.getEndPost(),this.index_):e.getIteratorFrom(this.rangedFilter_.getStartPost(),this.index_);let c=0;for(;u.hasNext()&&c<this.limit_;){const h=u.getNext();if(this.withinDirectionalStart(h)){if(!this.withinDirectionalEnd(h))break;o=o.updateImmediateChild(h.name,h.node),c++}}}else{let u;o=e.withIndex(this.index_),o=o.updatePriority(ne.EMPTY_NODE),u=this.reverse_?o.getReverseIterator(this.index_):o.getIterator(this.index_);let c=0;for(;u.hasNext();){const h=u.getNext();c<this.limit_&&this.withinDirectionalStart(h)&&this.withinDirectionalEnd(h)?c++:o=o.updateImmediateChild(h.name,ne.EMPTY_NODE)}}return this.rangedFilter_.getIndexedFilter().updateFullNode(t,o,i)}updatePriority(t,e){return t}filtersNodes(){return!0}getIndexedFilter(){return this.rangedFilter_.getIndexedFilter()}getIndex(){return this.index_}fullLimitUpdateChild_(t,e,i,o,u){let c;if(this.reverse_){const b=this.index_.getCompare();c=(L,Z)=>b(Z,L)}else c=this.index_.getCompare();const h=t;(0,p.hu)(h.numChildren()===this.limit_,"");const g=new le(e,i),v=this.reverse_?h.getFirstChild(this.index_):h.getLastChild(this.index_),P=this.rangedFilter_.matches(g);if(h.hasChild(e)){const b=h.getImmediateChild(e);let L=o.getChildAfterChild(this.index_,v,this.reverse_);for(;null!=L&&(L.name===e||h.hasChild(L.name));)L=o.getChildAfterChild(this.index_,L,this.reverse_);const Z=null==L?1:c(L,g);if(P&&!i.isEmpty()&&Z>=0)return u?.trackChildChange(Ni(e,i,b)),h.updateImmediateChild(e,i);{u?.trackChildChange(bi(e,b));const Ie=h.updateImmediateChild(e,ne.EMPTY_NODE);return null!=L&&this.rangedFilter_.matches(L)?(u?.trackChildChange(vn(L.name,L.node)),Ie.updateImmediateChild(L.name,L.node)):Ie}}return i.isEmpty()?t:P&&c(v,g)>=0?(null!=u&&(u.trackChildChange(bi(v.name,v.node)),u.trackChildChange(vn(e,i))),h.updateImmediateChild(e,i).updateImmediateChild(v.name,ne.EMPTY_NODE)):t}}class ii{constructor(){this.limitSet_=!1,this.startSet_=!1,this.startNameSet_=!1,this.startAfterSet_=!1,this.endSet_=!1,this.endNameSet_=!1,this.endBeforeSet_=!1,this.limit_=0,this.viewFrom_="",this.indexStartValue_=null,this.indexStartName_="",this.indexEndValue_=null,this.indexEndName_="",this.index_=Ce}hasStart(){return this.startSet_}isViewFromLeft(){return""===this.viewFrom_?this.startSet_:"l"===this.viewFrom_}getIndexStartValue(){return(0,p.hu)(this.startSet_,"Only valid if start has been set"),this.indexStartValue_}getIndexStartName(){return(0,p.hu)(this.startSet_,"Only valid if start has been set"),this.startNameSet_?this.indexStartName_:V}hasEnd(){return this.endSet_}getIndexEndValue(){return(0,p.hu)(this.endSet_,"Only valid if end has been set"),this.indexEndValue_}getIndexEndName(){return(0,p.hu)(this.endSet_,"Only valid if end has been set"),this.endNameSet_?this.indexEndName_:X}hasLimit(){return this.limitSet_}hasAnchoredLimit(){return this.limitSet_&&""!==this.viewFrom_}getLimit(){return(0,p.hu)(this.limitSet_,"Only valid if limit has been set"),this.limit_}getIndex(){return this.index_}loadsAllData(){return!(this.startSet_||this.endSet_||this.limitSet_)}isDefault(){return this.loadsAllData()&&this.index_===Ce}copy(){const t=new ii;return t.limitSet_=this.limitSet_,t.limit_=this.limit_,t.startSet_=this.startSet_,t.startAfterSet_=this.startAfterSet_,t.indexStartValue_=this.indexStartValue_,t.startNameSet_=this.startNameSet_,t.indexStartName_=this.indexStartName_,t.endSet_=this.endSet_,t.endBeforeSet_=this.endBeforeSet_,t.indexEndValue_=this.indexEndValue_,t.endNameSet_=this.endNameSet_,t.indexEndName_=this.indexEndName_,t.index_=this.index_,t.viewFrom_=this.viewFrom_,t}}function Oi(n,t,e){const i=n.copy();return i.startSet_=!0,void 0===t&&(t=null),i.indexStartValue_=t,null!=e?(i.startNameSet_=!0,i.indexStartName_=e):(i.startNameSet_=!1,i.indexStartName_=""),i}function Di(n,t,e){const i=n.copy();return i.endSet_=!0,void 0===t&&(t=null),i.indexEndValue_=t,void 0!==e?(i.endNameSet_=!0,i.indexEndName_=e):(i.endNameSet_=!1,i.indexEndName_=""),i}function ri(n,t){const e=n.copy();return e.index_=t,e}function uo(n){const t={};if(n.isDefault())return t;let e;if(n.index_===Ce?e="$priority":n.index_===os?e="$value":n.index_===Ft?e="$key":((0,p.hu)(n.index_ instanceof rs,"Unrecognized index type!"),e=n.index_.toString()),t.orderBy=(0,p.Wl)(e),n.startSet_){const i=n.startAfterSet_?"startAfter":"startAt";t[i]=(0,p.Wl)(n.indexStartValue_),n.startNameSet_&&(t[i]+=","+(0,p.Wl)(n.indexStartName_))}if(n.endSet_){const i=n.endBeforeSet_?"endBefore":"endAt";t[i]=(0,p.Wl)(n.indexEndValue_),n.endNameSet_&&(t[i]+=","+(0,p.Wl)(n.indexEndName_))}return n.limitSet_&&(n.isViewFromLeft()?t.limitToFirst=n.limit_:t.limitToLast=n.limit_),t}function co(n){const t={};if(n.startSet_&&(t.sp=n.indexStartValue_,n.startNameSet_&&(t.sn=n.indexStartName_),t.sin=!n.startAfterSet_),n.endSet_&&(t.ep=n.indexEndValue_,n.endNameSet_&&(t.en=n.indexEndName_),t.ein=!n.endBeforeSet_),n.limitSet_){t.l=n.limit_;let e=n.viewFrom_;""===e&&(e=n.isViewFromLeft()?"l":"r"),t.vf=e}return n.index_!==Ce&&(t.i=n.index_.toString()),t}class xi extends I{constructor(t,e,i,o){super(),this.repoInfo_=t,this.onDataUpdate_=e,this.authTokenProvider_=i,this.appCheckTokenProvider_=o,this.log_=st("p:rest:"),this.listens_={}}reportStats(t){throw new Error("Method not implemented.")}static getListenId_(t,e){return void 0!==e?"tag$"+e:((0,p.hu)(t._queryParams.isDefault(),"should have a tag if it's not a default query."),t._path.toString())}listen(t,e,i,o){const u=t._path.toString();this.log_("Listen called for "+u+" "+t._queryIdentifier);const c=xi.getListenId_(t,i),h={};this.listens_[c]=h;const g=uo(t._queryParams);this.restRequest_(u+".json",g,(v,P)=>{let b=P;if(404===v&&(b=null,v=null),null===v&&this.onDataUpdate_(u,b,!1,i),(0,p.DV)(this.listens_,c)===h){let L;L=v?401===v?"permission_denied":"rest_error:"+v:"ok",o(L,null)}})}unlisten(t,e){const i=xi.getListenId_(t,e);delete this.listens_[i]}get(t){const e=uo(t._queryParams),i=t._path.toString(),o=new p.BH;return this.restRequest_(i+".json",e,(u,c)=>{let h=c;404===u&&(h=null,u=null),null===u?(this.onDataUpdate_(i,h,!1,null),o.resolve(h)):o.reject(new Error(h))}),o.promise}refreshAuthToken(t){}restRequest_(t,e={},i){return e.format="export",Promise.all([this.authTokenProvider_.getToken(!1),this.appCheckTokenProvider_.getToken(!1)]).then(([o,u])=>{o&&o.accessToken&&(e.auth=o.accessToken),u&&u.token&&(e.ac=u.token);const c=(this.repoInfo_.secure?"https://":"http://")+this.repoInfo_.host+t+"?ns="+this.repoInfo_.namespace+(0,p.xO)(e);this.log_("Sending REST request for "+c);const h=new XMLHttpRequest;h.onreadystatechange=()=>{if(i&&4===h.readyState){this.log_("REST Response for "+c+" received. status:",h.status,"response:",h.responseText);let g=null;if(h.status>=200&&h.status<300){try{g=(0,p.cI)(h.responseText)}catch{ee("Failed to parse JSON response for "+c+": "+h.responseText)}i(null,g)}else 401!==h.status&&404!==h.status&&ee("Got unsuccessful REST response for "+c+" Status: "+h.status),i(h.status);i=null}},h.open("GET",c,!0),h.send()})}}class cs{constructor(){this.rootNode_=ne.EMPTY_NODE}getNode(t){return this.rootNode_.getChild(t)}updateSnapshot(t,e){this.rootNode_=this.rootNode_.updateChild(t,e)}}function Tr(){return{value:null,children:new Map}}function Yt(n,t,e){if(re(t))n.value=e,n.children.clear();else if(null!==n.value)n.value=n.value.updateChild(t,e);else{const i=$(t);n.children.has(i)||n.children.set(i,Tr()),Yt(n.children.get(i),t=ge(t),e)}}function Cr(n,t){if(re(t))return n.value=null,n.children.clear(),!0;if(null!==n.value){if(n.value.isLeafNode())return!1;{const e=n.value;return n.value=null,e.forEachChild(Ce,(i,o)=>{Yt(n,new K(i),o)}),Cr(n,t)}}if(n.children.size>0){const e=$(t);return t=ge(t),n.children.has(e)&&Cr(n.children.get(e),t)&&n.children.delete(e),0===n.children.size}return!0}function ds(n,t,e){null!==n.value?e(t,n.value):function pa(n,t){n.children.forEach((e,i)=>{t(i,e)})}(n,(i,o)=>{ds(o,new K(t.toString()+"/"+i),e)})}class _a{constructor(t){this.collection_=t,this.last_=null}get(){const t=this.collection_.get(),e=Object.assign({},t);return this.last_&&Ee(this.last_,(i,o)=>{e[i]=e[i]-o}),this.last_=t,e}}class ma{constructor(t,e){this.server_=e,this.statsToReport_={},this.statsListener_=new _a(t);const i=1e4+2e4*Math.random();Tt(this.reportStats_.bind(this),Math.floor(i))}reportStats_(){const t=this.statsListener_.get(),e={};let i=!1;Ee(t,(o,u)=>{u>0&&(0,p.r3)(this.statsToReport_,o)&&(e[o]=u,i=!0)}),i&&this.server_.reportStats(e),Tt(this.reportStats_.bind(this),Math.floor(2*Math.random()*3e5))}}var Ut=(()=>{return(n=Ut||(Ut={}))[n.OVERWRITE=0]="OVERWRITE",n[n.MERGE=1]="MERGE",n[n.ACK_USER_WRITE=2]="ACK_USER_WRITE",n[n.LISTEN_COMPLETE=3]="LISTEN_COMPLETE",Ut;var n})();function _o(n){return{fromUser:!1,fromServer:!0,queryId:n,tagged:!0}}class hs{constructor(t,e,i){this.path=t,this.affectedTree=e,this.revert=i,this.type=Ut.ACK_USER_WRITE,this.source={fromUser:!0,fromServer:!1,queryId:null,tagged:!1}}operationForChild(t){if(re(this.path)){if(null!=this.affectedTree.value)return(0,p.hu)(this.affectedTree.children.isEmpty(),"affectedTree should not have overlapping affected paths."),this;{const e=this.affectedTree.subtree(new K(t));return new hs(q(),e,this.revert)}}return(0,p.hu)($(this.path)===t,"operationForChild called for unrelated child."),new hs(ge(this.path),this.affectedTree,this.revert)}}class Ar{constructor(t,e){this.source=t,this.path=e,this.type=Ut.LISTEN_COMPLETE}operationForChild(t){return re(this.path)?new Ar(this.source,q()):new Ar(this.source,ge(this.path))}}class dn{constructor(t,e,i){this.source=t,this.path=e,this.snap=i,this.type=Ut.OVERWRITE}operationForChild(t){return re(this.path)?new dn(this.source,q(),this.snap.getImmediateChild(t)):new dn(this.source,ge(this.path),this.snap)}}class Wt{constructor(t,e,i){this.source=t,this.path=e,this.children=i,this.type=Ut.MERGE}operationForChild(t){if(re(this.path)){const e=this.children.subtree(new K(t));return e.isEmpty()?null:e.value?new dn(this.source,q(),e.value):new Wt(this.source,q(),e)}return(0,p.hu)($(this.path)===t,"Can't get a merge for a child not on the path of the operation"),new Wt(this.source,ge(this.path),this.children)}toString(){return"Operation("+this.path+": "+this.source.toString()+" merge: "+this.children.toString()+")"}}class nn{constructor(t,e,i){this.node_=t,this.fullyInitialized_=e,this.filtered_=i}isFullyInitialized(){return this.fullyInitialized_}isFiltered(){return this.filtered_}isCompleteForPath(t){if(re(t))return this.isFullyInitialized()&&!this.filtered_;const e=$(t);return this.isCompleteForChild(e)}isCompleteForChild(t){return this.isFullyInitialized()&&!this.filtered_||this.node_.hasChild(t)}getNode(){return this.node_}}class va{constructor(t){this.query_=t,this.index_=this.query_._queryParams.getIndex()}}function Li(n,t,e,i,o,u){const c=i.filter(h=>h.type===e);c.sort((h,g)=>function fs(n,t,e){if(null==t.childName||null==e.childName)throw(0,p.g5)("Should only compare child_ events.");const i=new le(t.childName,t.snapshotNode),o=new le(e.childName,e.snapshotNode);return n.index_.compare(i,o)}(n,h,g)),c.forEach(h=>{const g=function Ia(n,t,e){return"value"===t.type||"child_removed"===t.type||(t.prevName=e.getPredecessorChildName(t.childName,t.snapshotNode,n.index_)),t}(n,h,u);o.forEach(v=>{v.respondsTo(h.type)&&t.push(v.createEvent(g,n.query_))})})}function si(n,t){return{eventCache:n,serverCache:t}}function Mi(n,t,e,i){return si(new nn(t,e,i),n.serverCache)}function Fi(n,t,e,i){return si(n.eventCache,new nn(t,e,i))}function Ui(n){return n.eventCache.isFullyInitialized()?n.eventCache.getNode():null}function Un(n){return n.serverCache.isFullyInitialized()?n.serverCache.getNode():null}let ps;class Ue{constructor(t,e=(()=>(ps||(ps=new vt(z)),ps))()){this.value=t,this.children=e}static fromObject(t){let e=new Ue(null);return Ee(t,(i,o)=>{e=e.set(new K(i),o)}),e}isEmpty(){return null===this.value&&this.children.isEmpty()}findRootMostMatchingPathAndValue(t,e){if(null!=this.value&&e(this.value))return{path:q(),value:this.value};if(re(t))return null;{const i=$(t),o=this.children.get(i);if(null!==o){const u=o.findRootMostMatchingPathAndValue(ge(t),e);return null!=u?{path:Ge(new K(i),u.path),value:u.value}:null}return null}}findRootMostValueAndPath(t){return this.findRootMostMatchingPathAndValue(t,()=>!0)}subtree(t){if(re(t))return this;{const e=$(t),i=this.children.get(e);return null!==i?i.subtree(ge(t)):new Ue(null)}}set(t,e){if(re(t))return new Ue(e,this.children);{const i=$(t),u=(this.children.get(i)||new Ue(null)).set(ge(t),e),c=this.children.insert(i,u);return new Ue(this.value,c)}}remove(t){if(re(t))return this.children.isEmpty()?new Ue(null):new Ue(null,this.children);{const e=$(t),i=this.children.get(e);if(i){const o=i.remove(ge(t));let u;return u=o.isEmpty()?this.children.remove(e):this.children.insert(e,o),null===this.value&&u.isEmpty()?new Ue(null):new Ue(this.value,u)}return this}}get(t){if(re(t))return this.value;{const e=$(t),i=this.children.get(e);return i?i.get(ge(t)):null}}setTree(t,e){if(re(t))return e;{const i=$(t),u=(this.children.get(i)||new Ue(null)).setTree(ge(t),e);let c;return c=u.isEmpty()?this.children.remove(i):this.children.insert(i,u),new Ue(this.value,c)}}fold(t){return this.fold_(q(),t)}fold_(t,e){const i={};return this.children.inorderTraversal((o,u)=>{i[o]=u.fold_(Ge(t,o),e)}),e(t,this.value,i)}findOnPath(t,e){return this.findOnPath_(t,q(),e)}findOnPath_(t,e,i){const o=!!this.value&&i(e,this.value);if(o)return o;if(re(t))return null;{const u=$(t),c=this.children.get(u);return c?c.findOnPath_(ge(t),Ge(e,u),i):null}}foreachOnPath(t,e){return this.foreachOnPath_(t,q(),e)}foreachOnPath_(t,e,i){if(re(t))return this;{this.value&&i(e,this.value);const o=$(t),u=this.children.get(o);return u?u.foreachOnPath_(ge(t),Ge(e,o),i):new Ue(null)}}foreach(t){this.foreach_(q(),t)}foreach_(t,e){this.children.inorderTraversal((i,o)=>{o.foreach_(Ge(t,i),e)}),this.value&&e(t,this.value)}foreachChild(t){this.children.inorderTraversal((e,i)=>{i.value&&t(e,i.value)})}}class Bt{constructor(t){this.writeTree_=t}static empty(){return new Bt(new Ue(null))}}function Sr(n,t,e){if(re(t))return new Bt(new Ue(e));{const i=n.writeTree_.findRootMostValueAndPath(t);if(null!=i){const o=i.path;let u=i.value;const c=$e(o,t);return u=u.updateChild(c,e),new Bt(n.writeTree_.set(o,u))}{const o=new Ue(e),u=n.writeTree_.setTree(t,o);return new Bt(u)}}}function Wi(n,t,e){let i=n;return Ee(e,(o,u)=>{i=Sr(i,Ge(t,o),u)}),i}function go(n,t){if(re(t))return Bt.empty();{const e=n.writeTree_.setTree(t,new Ue(null));return new Bt(e)}}function _s(n,t){return null!=Qt(n,t)}function Qt(n,t){const e=n.writeTree_.findRootMostValueAndPath(t);return null!=e?n.writeTree_.get(e.path).getChild($e(e.path,t)):null}function mo(n){const t=[],e=n.writeTree_.value;return null!=e?e.isLeafNode()||e.forEachChild(Ce,(i,o)=>{t.push(new le(i,o))}):n.writeTree_.children.inorderTraversal((i,o)=>{null!=o.value&&t.push(new le(i,o.value))}),t}function De(n,t){if(re(t))return n;{const e=Qt(n,t);return new Bt(null!=e?new Ue(e):n.writeTree_.subtree(t))}}function gs(n){return n.writeTree_.isEmpty()}function yn(n,t){return vo(q(),n.writeTree_,t)}function vo(n,t,e){if(null!=t.value)return e.updateChild(n,t.value);{let i=null;return t.children.inorderTraversal((o,u)=>{".priority"===o?((0,p.hu)(null!==u.value,"Priority writes must always be leaf nodes"),i=u.value):e=vo(Ge(n,o),u,e)}),!e.getChild(n).isEmpty()&&null!==i&&(e=e.updateChild(Ge(n,".priority"),i)),e}}function oi(n,t){return kr(t,n)}function wr(n,t){if(n.snap)return Lt(n.path,t);for(const e in n.children)if(n.children.hasOwnProperty(e)&&Lt(Ge(n.path,e),t))return!0;return!1}function Bi(n){return n.visible}function Vi(n,t,e){let i=Bt.empty();for(let o=0;o<n.length;++o){const u=n[o];if(t(u)){const c=u.path;let h;if(u.snap)Lt(e,c)?(h=$e(e,c),i=Sr(i,h,u.snap)):Lt(c,e)&&(h=$e(c,e),i=Sr(i,q(),u.snap.getChild(h)));else{if(!u.children)throw(0,p.g5)("WriteRecord should have .snap or .children");if(Lt(e,c))h=$e(e,c),i=Wi(i,h,u.children);else if(Lt(c,e))if(h=$e(c,e),re(h))i=Wi(i,q(),u.children);else{const g=(0,p.DV)(u.children,$(h));if(g){const v=g.getChild(ge(h));i=Sr(i,q(),v)}}}}}return i}function Eo(n,t,e,i,o){if(i||o){const u=De(n.visibleWrites,t);return!o&&gs(u)?e:o||null!=e||_s(u,q())?yn(Vi(n.allWrites,function(v){return(v.visible||o)&&(!i||!~i.indexOf(v.writeId))&&(Lt(v.path,t)||Lt(t,v.path))},t),e||ne.EMPTY_NODE):null}{const u=Qt(n.visibleWrites,t);if(null!=u)return u;{const c=De(n.visibleWrites,t);return gs(c)?e:null!=e||_s(c,q())?yn(c,e||ne.EMPTY_NODE):null}}}function Rr(n,t,e,i){return Eo(n.writeTree,n.treePath,t,e,i)}function Is(n,t){return function ms(n,t,e){let i=ne.EMPTY_NODE;const o=Qt(n.visibleWrites,t);if(o)return o.isLeafNode()||o.forEachChild(Ce,(u,c)=>{i=i.updateImmediateChild(u,c)}),i;if(e){const u=De(n.visibleWrites,t);return e.forEachChild(Ce,(c,h)=>{const g=yn(De(u,new K(c)),h);i=i.updateImmediateChild(c,g)}),mo(u).forEach(c=>{i=i.updateImmediateChild(c.name,c.node)}),i}return mo(De(n.visibleWrites,t)).forEach(c=>{i=i.updateImmediateChild(c.name,c.node)}),i}(n.writeTree,n.treePath,t)}function wa(n,t,e,i){return function To(n,t,e,i,o){(0,p.hu)(i||o,"Either existingEventSnap or existingServerSnap must exist");const u=Ge(t,e);if(_s(n.visibleWrites,u))return null;{const c=De(n.visibleWrites,u);return gs(c)?o.getChild(e):yn(c,o.getChild(e))}}(n.writeTree,n.treePath,t,e,i)}function Zi(n,t){return function Sa(n,t){return Qt(n.visibleWrites,t)}(n.writeTree,Ge(n.treePath,t))}function Es(n,t,e){return function vs(n,t,e,i){const o=Ge(t,e),u=Qt(n.visibleWrites,o);return null!=u?u:i.isCompleteForChild(e)?yn(De(n.visibleWrites,o),i.getNode().getImmediateChild(e)):null}(n.writeTree,n.treePath,t,e)}function Ao(n,t){return kr(Ge(n.treePath,t),n.writeTree)}function kr(n,t){return{treePath:n,writeTree:t}}class ka{constructor(){this.changeMap=new Map}trackChildChange(t){const e=t.type,i=t.childName;(0,p.hu)("child_added"===e||"child_changed"===e||"child_removed"===e,"Only child changes supported for tracking"),(0,p.hu)(".priority"!==i,"Only non-priority child changes can be tracked.");const o=this.changeMap.get(i);if(o){const u=o.type;if("child_added"===e&&"child_removed"===u)this.changeMap.set(i,Ni(i,t.snapshotNode,o.snapshotNode));else if("child_removed"===e&&"child_added"===u)this.changeMap.delete(i);else if("child_removed"===e&&"child_changed"===u)this.changeMap.set(i,bi(i,o.oldSnap));else if("child_changed"===e&&"child_added"===u)this.changeMap.set(i,vn(i,t.snapshotNode));else{if("child_changed"!==e||"child_changed"!==u)throw(0,p.g5)("Illegal combination of changes: "+t+" occurred after "+o);this.changeMap.set(i,Ni(i,t.snapshotNode,o.oldSnap))}}else this.changeMap.set(i,t)}getChanges(){return Array.from(this.changeMap.values())}}const Ts=new class So{getCompleteChild(t){return null}getChildAfterChild(t,e,i){return null}};class Cs{constructor(t,e,i=null){this.writes_=t,this.viewCache_=e,this.optCompleteServerCache_=i}getCompleteChild(t){const e=this.viewCache_.eventCache;if(e.isCompleteForChild(t))return e.getNode().getImmediateChild(t);{const i=null!=this.optCompleteServerCache_?new nn(this.optCompleteServerCache_,!0,!1):this.viewCache_.serverCache;return Es(this.writes_,t,i)}}getChildAfterChild(t,e,i){const o=null!=this.optCompleteServerCache_?this.optCompleteServerCache_:Un(this.viewCache_),u=function Ra(n,t,e,i,o,u){return function ys(n,t,e,i,o,u,c){let h;const g=De(n.visibleWrites,t),v=Qt(g,q());if(null!=v)h=v;else{if(null==e)return[];h=yn(g,e)}if(h=h.withIndex(c),h.isEmpty()||h.isLeafNode())return[];{const P=[],b=c.getCompare(),L=u?h.getReverseIteratorFrom(i,c):h.getIteratorFrom(i,c);let Z=L.getNext();for(;Z&&P.length<o;)0!==b(Z,i)&&P.push(Z),Z=L.getNext();return P}}(n.writeTree,n.treePath,t,e,i,o,u)}(this.writes_,o,e,1,i,t);return 0===u.length?null:u[0]}}function wo(n,t,e,i,o,u){const c=t.eventCache;if(null!=Zi(i,e))return t;{let h,g;if(re(e))if((0,p.hu)(t.serverCache.isFullyInitialized(),"If change path is empty, we must have complete server data"),t.serverCache.isFiltered()){const v=Un(t),b=Is(i,v instanceof ne?v:ne.EMPTY_NODE);h=n.filter.updateFullNode(t.eventCache.getNode(),b,u)}else{const v=Rr(i,Un(t));h=n.filter.updateFullNode(t.eventCache.getNode(),v,u)}else{const v=$(e);if(".priority"===v){(0,p.hu)(1===St(e),"Can't have a priority with additional path components");const P=c.getNode();g=t.serverCache.getNode();const b=wa(i,e,P,g);h=null!=b?n.filter.updatePriority(P,b):c.getNode()}else{const P=ge(e);let b;if(c.isCompleteForChild(v)){g=t.serverCache.getNode();const L=wa(i,e,c.getNode(),g);b=null!=L?c.getNode().getImmediateChild(v).updateChild(P,L):c.getNode().getImmediateChild(v)}else b=Es(i,v,t.serverCache);h=null!=b?n.filter.updateChild(c.getNode(),v,b,P,o,u):c.getNode()}}return Mi(t,h,c.isFullyInitialized()||re(e),n.filter.filtersNodes())}}function ai(n,t,e,i,o,u,c,h){const g=t.serverCache;let v;const P=c?n.filter:n.filter.getIndexedFilter();if(re(e))v=P.updateFullNode(g.getNode(),i,null);else if(P.filtersNodes()&&!g.isFiltered()){const Z=g.getNode().updateChild(e,i);v=P.updateFullNode(g.getNode(),Z,null)}else{const Z=$(e);if(!g.isCompleteForPath(e)&&St(e)>1)return t;const Q=ge(e),ht=g.getNode().getImmediateChild(Z).updateChild(Q,i);v=".priority"===Z?P.updatePriority(g.getNode(),ht):P.updateChild(g.getNode(),Z,ht,Q,Ts,null)}const b=Fi(t,v,g.isFullyInitialized()||re(e),P.filtersNodes());return wo(n,b,e,o,new Cs(o,b,u),h)}function As(n,t,e,i,o,u,c){const h=t.eventCache;let g,v;const P=new Cs(o,t,u);if(re(e))v=n.filter.updateFullNode(t.eventCache.getNode(),i,c),g=Mi(t,v,!0,n.filter.filtersNodes());else{const b=$(e);if(".priority"===b)v=n.filter.updatePriority(t.eventCache.getNode(),i),g=Mi(t,v,h.isFullyInitialized(),h.isFiltered());else{const L=ge(e),Z=h.getNode().getImmediateChild(b);let Q;if(re(L))Q=i;else{const Ie=P.getCompleteChild(b);Q=null!=Ie?".priority"===Je(L)&&Ie.getChild(Jn(L)).isEmpty()?Ie:Ie.updateChild(L,i):ne.EMPTY_NODE}g=Z.equals(Q)?t:Mi(t,n.filter.updateChild(h.getNode(),b,Q,L,P,c),h.isFullyInitialized(),n.filter.filtersNodes())}}return g}function Ro(n,t){return n.eventCache.isCompleteForChild(t)}function ko(n,t,e){return e.foreach((i,o)=>{t=t.updateChild(i,o)}),t}function Ss(n,t,e,i,o,u,c,h){if(t.serverCache.getNode().isEmpty()&&!t.serverCache.isFullyInitialized())return t;let v,g=t;v=re(e)?i:new Ue(null).setTree(e,i);const P=t.serverCache.getNode();return v.children.inorderTraversal((b,L)=>{if(P.hasChild(b)){const Q=ko(0,t.serverCache.getNode().getImmediateChild(b),L);g=ai(n,g,new K(b),Q,o,u,c,h)}}),v.children.inorderTraversal((b,L)=>{const Z=!t.serverCache.isCompleteForChild(b)&&null===L.value;if(!P.hasChild(b)&&!Z){const Ie=ko(0,t.serverCache.getNode().getImmediateChild(b),L);g=ai(n,g,new K(b),Ie,o,u,c,h)}}),g}class La{constructor(t,e){this.query_=t,this.eventRegistrations_=[];const i=this.query_._queryParams,o=new ls(i.getIndex()),u=function ca(n){return n.loadsAllData()?new ls(n.getIndex()):n.hasLimit()?new ua(n):new Fn(n)}(i);this.processor_=function Pa(n){return{filter:n}}(u);const c=e.serverCache,h=e.eventCache,g=o.updateFullNode(ne.EMPTY_NODE,c.getNode(),null),v=u.updateFullNode(ne.EMPTY_NODE,h.getNode(),null),P=new nn(g,c.isFullyInitialized(),o.filtersNodes()),b=new nn(v,h.isFullyInitialized(),u.filtersNodes());this.viewCache_=si(b,P),this.eventGenerator_=new va(this.query_)}get query(){return this.query_}}function Rs(n,t){const e=Un(n.viewCache_);return e&&(n.query._queryParams.loadsAllData()||!re(t)&&!e.getImmediateChild($(t)).isEmpty())?e.getChild(t):null}function bo(n){return 0===n.eventRegistrations_.length}function No(n,t,e){const i=[];if(e){(0,p.hu)(null==t,"A cancel should cancel all event registrations.");const o=n.query._path;n.eventRegistrations_.forEach(u=>{const c=u.createCancelEvent(e,o);c&&i.push(c)})}if(t){let o=[];for(let u=0;u<n.eventRegistrations_.length;++u){const c=n.eventRegistrations_[u];if(c.matches(t)){if(t.hasAnyCallback()){o=o.concat(n.eventRegistrations_.slice(u+1));break}}else o.push(c)}n.eventRegistrations_=o}else n.eventRegistrations_=[];return i}function br(n,t,e,i){t.type===Ut.MERGE&&null!==t.source.queryId&&((0,p.hu)(Un(n.viewCache_),"We should always have a full cache before handling merges"),(0,p.hu)(Ui(n.viewCache_),"Missing event cache, even though we have a server cache"));const o=n.viewCache_,u=function ba(n,t,e,i,o){const u=new ka;let c,h;if(e.type===Ut.OVERWRITE){const v=e;v.source.fromUser?c=As(n,t,v.path,v.snap,i,o,u):((0,p.hu)(v.source.fromServer,"Unknown source."),h=v.source.tagged||t.serverCache.isFiltered()&&!re(v.path),c=ai(n,t,v.path,v.snap,i,o,h,u))}else if(e.type===Ut.MERGE){const v=e;v.source.fromUser?c=function Oa(n,t,e,i,o,u,c){let h=t;return i.foreach((g,v)=>{const P=Ge(e,g);Ro(t,$(P))&&(h=As(n,h,P,v,o,u,c))}),i.foreach((g,v)=>{const P=Ge(e,g);Ro(t,$(P))||(h=As(n,h,P,v,o,u,c))}),h}(n,t,v.path,v.children,i,o,u):((0,p.hu)(v.source.fromServer,"Unknown source."),h=v.source.tagged||t.serverCache.isFiltered(),c=Ss(n,t,v.path,v.children,i,o,h,u))}else if(e.type===Ut.ACK_USER_WRITE){const v=e;c=v.revert?function xa(n,t,e,i,o,u){let c;if(null!=Zi(i,e))return t;{const h=new Cs(i,t,o),g=t.eventCache.getNode();let v;if(re(e)||".priority"===$(e)){let P;if(t.serverCache.isFullyInitialized())P=Rr(i,Un(t));else{const b=t.serverCache.getNode();(0,p.hu)(b instanceof ne,"serverChildren would be complete if leaf node"),P=Is(i,b)}v=n.filter.updateFullNode(g,P,u)}else{const P=$(e);let b=Es(i,P,t.serverCache);null==b&&t.serverCache.isCompleteForChild(P)&&(b=g.getImmediateChild(P)),v=null!=b?n.filter.updateChild(g,P,b,ge(e),h,u):t.eventCache.getNode().hasChild(P)?n.filter.updateChild(g,P,ne.EMPTY_NODE,ge(e),h,u):g,v.isEmpty()&&t.serverCache.isFullyInitialized()&&(c=Rr(i,Un(t)),c.isLeafNode()&&(v=n.filter.updateFullNode(v,c,u)))}return c=t.serverCache.isFullyInitialized()||null!=Zi(i,q()),Mi(t,v,c,n.filter.filtersNodes())}}(n,t,v.path,i,o,u):function Po(n,t,e,i,o,u,c){if(null!=Zi(o,e))return t;const h=t.serverCache.isFiltered(),g=t.serverCache;if(null!=i.value){if(re(e)&&g.isFullyInitialized()||g.isCompleteForPath(e))return ai(n,t,e,g.getNode().getChild(e),o,u,h,c);if(re(e)){let v=new Ue(null);return g.getNode().forEachChild(Ft,(P,b)=>{v=v.set(new K(P),b)}),Ss(n,t,e,v,o,u,h,c)}return t}{let v=new Ue(null);return i.foreach((P,b)=>{const L=Ge(e,P);g.isCompleteForPath(L)&&(v=v.set(P,g.getNode().getChild(L)))}),Ss(n,t,e,v,o,u,h,c)}}(n,t,v.path,v.affectedTree,i,o,u)}else{if(e.type!==Ut.LISTEN_COMPLETE)throw(0,p.g5)("Unknown operation type: "+e.type);c=function Da(n,t,e,i,o){const u=t.serverCache;return wo(n,Fi(t,u.getNode(),u.isFullyInitialized()||re(e),u.isFiltered()),e,i,Ts,o)}(n,t,e.path,i,u)}const g=u.getChanges();return function Na(n,t,e){const i=t.eventCache;if(i.isFullyInitialized()){const o=i.getNode().isLeafNode()||i.getNode().isEmpty(),u=Ui(n);(e.length>0||!n.eventCache.isFullyInitialized()||o&&!i.getNode().equals(u)||!i.getNode().getPriority().equals(u.getPriority()))&&e.push(lo(Ui(t)))}}(t,c,g),{viewCache:c,changes:g}}(n.processor_,o,t,e,i);return function Pr(n,t){(0,p.hu)(t.eventCache.getNode().isIndexed(n.filter.getIndex()),"Event snap not indexed"),(0,p.hu)(t.serverCache.getNode().isIndexed(n.filter.getIndex()),"Server snap not indexed")}(n.processor_,u.viewCache),(0,p.hu)(u.viewCache.serverCache.isFullyInitialized()||!o.serverCache.isFullyInitialized(),"Once a server snap is complete, it should never go back"),n.viewCache_=u.viewCache,Or(n,u.changes,u.viewCache.eventCache.getNode(),null)}function Or(n,t,e,i){return function ya(n,t,e,i){const o=[],u=[];return t.forEach(c=>{"child_changed"===c.type&&n.index_.indexedValueChanged(c.oldSnap,c.snapshotNode)&&u.push(function as(n,t){return{type:"child_moved",snapshotNode:t,childName:n}}(c.childName,c.snapshotNode))}),Li(n,o,"child_removed",t,i,e),Li(n,o,"child_added",t,i,e),Li(n,o,"child_moved",u,i,e),Li(n,o,"child_changed",t,i,e),Li(n,o,"value",t,i,e),o}(n.eventGenerator_,t,e,i?[i]:n.eventRegistrations_)}let Dr,Mr;class xr{constructor(){this.views=new Map}}function bs(n,t,e,i){const o=t.source.queryId;if(null!==o){const u=n.views.get(o);return(0,p.hu)(null!=u,"SyncTree gave us an op for an invalid query."),br(u,t,e,i)}{let u=[];for(const c of n.views.values())u=u.concat(br(c,t,e,i));return u}}function Oo(n,t,e,i,o){const c=n.views.get(t._queryIdentifier);if(!c){let h=Rr(e,o?i:null),g=!1;h?g=!0:i instanceof ne?(h=Is(e,i),g=!1):(h=ne.EMPTY_NODE,g=!1);const v=si(new nn(h,g,!1),new nn(i,o,!1));return new La(t,v)}return c}function Os(n){const t=[];for(const e of n.views.values())e.query._queryParams.loadsAllData()||t.push(e);return t}function In(n,t){let e=null;for(const i of n.views.values())e=e||Rs(i,t);return e}function Do(n,t){return t._queryParams.loadsAllData()?li(n):n.views.get(t._queryIdentifier)}function Lr(n,t){return null!=Do(n,t)}function En(n){return null!=li(n)}function li(n){for(const t of n.views.values())if(t.query._queryParams.loadsAllData())return t;return null}let Wa=1;class ui{constructor(t){this.listenProvider_=t,this.syncPointTree_=new Ue(null),this.pendingWriteTree_=function Co(){return{visibleWrites:Bt.empty(),allWrites:[],lastWriteId:-1}}(),this.tagToQueryMap=new Map,this.queryToTagMap=new Map}}function Ls(n,t,e,i,o){return function Ta(n,t,e,i,o){(0,p.hu)(i>n.lastWriteId,"Stacking an older write on top of newer ones"),void 0===o&&(o=!0),n.allWrites.push({path:t,snap:e,writeId:i,visible:o}),o&&(n.visibleWrites=Sr(n.visibleWrites,t,e)),n.lastWriteId=i}(n.pendingWriteTree_,t,e,i,o),o?di(n,new dn({fromUser:!0,fromServer:!1,queryId:null,tagged:!1},t,e)):[]}function rn(n,t,e=!1){const i=function yo(n,t){for(let e=0;e<n.allWrites.length;e++){const i=n.allWrites[e];if(i.writeId===t)return i}return null}(n.pendingWriteTree_,t);if(function Aa(n,t){const e=n.allWrites.findIndex(h=>h.writeId===t);(0,p.hu)(e>=0,"removeWrite called with nonexistent writeId.");const i=n.allWrites[e];n.allWrites.splice(e,1);let o=i.visible,u=!1,c=n.allWrites.length-1;for(;o&&c>=0;){const h=n.allWrites[c];h.visible&&(c>=e&&wr(h,i.path)?o=!1:Lt(i.path,h.path)&&(u=!0)),c--}return!!o&&(u?(function Io(n){n.visibleWrites=Vi(n.allWrites,Bi,q()),n.lastWriteId=n.allWrites.length>0?n.allWrites[n.allWrites.length-1].writeId:-1}(n),!0):(i.snap?n.visibleWrites=go(n.visibleWrites,i.path):Ee(i.children,g=>{n.visibleWrites=go(n.visibleWrites,Ge(i.path,g))}),!0))}(n.pendingWriteTree_,t)){let u=new Ue(null);return null!=i.snap?u=u.set(q(),!0):Ee(i.children,c=>{u=u.set(new K(c),!0)}),di(n,new hs(i.path,u,e))}return[]}function Bn(n,t,e){return di(n,new dn({fromUser:!1,fromServer:!0,queryId:null,tagged:!1},t,e))}function Hi(n,t,e,i,o=!1){const u=t._path,c=n.syncPointTree_.get(u);let h=[];if(c&&("default"===t._queryIdentifier||Lr(c,t))){const g=function Ns(n,t,e,i){const o=t._queryIdentifier,u=[];let c=[];const h=En(n);if("default"===o)for(const[g,v]of n.views.entries())c=c.concat(No(v,e,i)),bo(v)&&(n.views.delete(g),v.query._queryParams.loadsAllData()||u.push(v.query));else{const g=n.views.get(o);g&&(c=c.concat(No(g,e,i)),bo(g)&&(n.views.delete(o),g.query._queryParams.loadsAllData()||u.push(g.query)))}return h&&!En(n)&&u.push(new(function Wn(){return(0,p.hu)(Dr,"Reference.ts has not been loaded"),Dr}())(t._repo,t._path)),{removed:u,events:c}}(c,t,e,i);(function Ps(n){return 0===n.views.size})(c)&&(n.syncPointTree_=n.syncPointTree_.remove(u));const v=g.removed;if(h=g.events,!o){const P=-1!==v.findIndex(L=>L._queryParams.loadsAllData()),b=n.syncPointTree_.findOnPath(u,(L,Z)=>En(Z));if(P&&!b){const L=n.syncPointTree_.subtree(u);if(!L.isEmpty()){const Z=function Fo(n){return n.fold((t,e,i)=>{if(e&&En(e))return[li(e)];{let o=[];return e&&(o=Os(e)),Ee(i,(u,c)=>{o=o.concat(c)}),o}})}(L);for(let Q=0;Q<Z.length;++Q){const Ie=Z[Q],ht=Ie.query,Cn=Mo(n,Ie);n.listenProvider_.startListening(Zn(ht),Vn(n,ht),Cn.hashFn,Cn.onComplete)}}}!b&&v.length>0&&!i&&(P?n.listenProvider_.stopListening(Zn(t),null):v.forEach(L=>{const Z=n.queryToTagMap.get(Ur(L));n.listenProvider_.stopListening(Zn(L),Z)}))}!function Ga(n,t){for(let e=0;e<t.length;++e){const i=t[e];if(!i._queryParams.loadsAllData()){const o=Ur(i),u=n.queryToTagMap.get(o);n.queryToTagMap.delete(o),n.tagToQueryMap.delete(u)}}}(n,v)}return h}function Fs(n,t,e,i){const o=Gi(n,i);if(null!=o){const u=$i(o),c=u.path,h=u.queryId,g=$e(c,t);return Ki(n,c,new dn(_o(h),g,e))}return[]}function Us(n,t,e,i=!1){const o=t._path;let u=null,c=!1;n.syncPointTree_.foreachOnPath(o,(L,Z)=>{const Q=$e(L,o);u=u||In(Z,Q),c=c||En(Z)});let g,h=n.syncPointTree_.get(o);h?(c=c||En(h),u=u||In(h,q())):(h=new xr,n.syncPointTree_=n.syncPointTree_.set(o,h)),null!=u?g=!0:(g=!1,u=ne.EMPTY_NODE,n.syncPointTree_.subtree(o).foreachChild((Z,Q)=>{const Ie=In(Q,q());Ie&&(u=u.updateImmediateChild(Z,Ie))}));const v=Lr(h,t);if(!v&&!t._queryParams.loadsAllData()){const L=Ur(t);(0,p.hu)(!n.queryToTagMap.has(L),"View does not exist, but we have a tag");const Z=function Uo(){return Wa++}();n.queryToTagMap.set(L,Z),n.tagToQueryMap.set(Z,L)}let b=function Ua(n,t,e,i,o,u){const c=Oo(n,t,i,o,u);return n.views.has(t._queryIdentifier)||n.views.set(t._queryIdentifier,c),function ks(n,t){n.eventRegistrations_.push(t)}(c,e),function Nr(n,t){const e=n.viewCache_.eventCache,i=[];return e.getNode().isLeafNode()||e.getNode().forEachChild(Ce,(u,c)=>{i.push(vn(u,c))}),e.isFullyInitialized()&&i.push(lo(e.getNode())),Or(n,i,e.getNode(),t)}(c,e)}(h,t,e,oi(n.pendingWriteTree_,o),u,g);if(!v&&!c&&!i){const L=Do(h,t);b=b.concat(function Wo(n,t,e){const i=t._path,o=Vn(n,t),u=Mo(n,e),c=n.listenProvider_.startListening(Zn(t),o,u.hashFn,u.onComplete),h=n.syncPointTree_.subtree(i);if(o)(0,p.hu)(!En(h.value),"If we're adding a query, it shouldn't be shadowed");else{const g=h.fold((v,P,b)=>{if(!re(v)&&P&&En(P))return[li(P).query];{let L=[];return P&&(L=L.concat(Os(P).map(Z=>Z.query))),Ee(b,(Z,Q)=>{L=L.concat(Q)}),L}});for(let v=0;v<g.length;++v){const P=g[v];n.listenProvider_.stopListening(Zn(P),Vn(n,P))}}return c}(n,t,L))}return b}function ci(n,t,e){const o=n.pendingWriteTree_,u=n.syncPointTree_.findOnPath(t,(c,h)=>{const v=In(h,$e(c,t));if(v)return v});return Eo(o,t,u,e,!0)}function di(n,t){return Fr(t,n.syncPointTree_,null,oi(n.pendingWriteTree_,q()))}function Fr(n,t,e,i){if(re(n.path))return Lo(n,t,e,i);{const o=t.get(q());null==e&&null!=o&&(e=In(o,q()));let u=[];const c=$(n.path),h=n.operationForChild(c),g=t.children.get(c);if(g&&h){const v=e?e.getImmediateChild(c):null,P=Ao(i,c);u=u.concat(Fr(h,g,v,P))}return o&&(u=u.concat(bs(o,n,i,e))),u}}function Lo(n,t,e,i){const o=t.get(q());null==e&&null!=o&&(e=In(o,q()));let u=[];return t.children.inorderTraversal((c,h)=>{const g=e?e.getImmediateChild(c):null,v=Ao(i,c),P=n.operationForChild(c);P&&(u=u.concat(Lo(P,h,g,v)))}),o&&(u=u.concat(bs(o,n,i,e))),u}function Mo(n,t){const e=t.query,i=Vn(n,e);return{hashFn:()=>(function ws(n){return n.viewCache_.serverCache.getNode()}(t)||ne.EMPTY_NODE).hash(),onComplete:o=>{if("ok"===o)return i?function xo(n,t,e){const i=Gi(n,e);if(i){const o=$i(i),u=o.path,c=o.queryId,h=$e(u,t);return Ki(n,u,new Ar(_o(c),h))}return[]}(n,e._path,i):function Va(n,t){return di(n,new Ar({fromUser:!1,fromServer:!0,queryId:null,tagged:!1},t))}(n,e._path);{const u=function Et(n,t){let e="Unknown Error";"too_big"===n?e="The data requested exceeds the maximum size that can be accessed with a single request.":"permission_denied"===n?e="Client doesn't have permission to access the desired data.":"unavailable"===n&&(e="The service is unavailable");const i=new Error(n+" at "+t._path.toString()+": "+e);return i.code=n.toUpperCase(),i}(o,e);return Hi(n,e,null,u)}}}}function Vn(n,t){const e=Ur(t);return n.queryToTagMap.get(e)}function Ur(n){return n._path.toString()+"$"+n._queryIdentifier}function Gi(n,t){return n.tagToQueryMap.get(t)}function $i(n){const t=n.indexOf("$");return(0,p.hu)(-1!==t&&t<n.length-1,"Bad queryKey."),{queryId:n.substr(t+1),path:new K(n.substr(0,t))}}function Ki(n,t,e){const i=n.syncPointTree_.get(t);return(0,p.hu)(i,"Missing sync point for query tag that we're tracking"),bs(i,e,oi(n.pendingWriteTree_,t),null)}function Zn(n){return n._queryParams.loadsAllData()&&!n._queryParams.isDefault()?new(function xs(){return(0,p.hu)(Mr,"Reference.ts has not been loaded"),Mr}())(n._repo,n._path):n}class Wr{constructor(t){this.node_=t}getImmediateChild(t){const e=this.node_.getImmediateChild(t);return new Wr(e)}node(){return this.node_}}class Ws{constructor(t,e){this.syncTree_=t,this.path_=e}getImmediateChild(t){const e=Ge(this.path_,t);return new Ws(this.syncTree_,e)}node(){return ci(this.syncTree_,this.path_)}}const Bo=function(n){return(n=n||{}).timestamp=n.timestamp||(new Date).getTime(),n},Br=function(n,t,e){return n&&"object"==typeof n?((0,p.hu)(".sv"in n,"Unexpected leaf node or priority contents"),"string"==typeof n[".sv"]?$a(n[".sv"],t,e):"object"==typeof n[".sv"]?Ka(n[".sv"],t):void(0,p.hu)(!1,"Unexpected server value: "+JSON.stringify(n,null,2))):n},$a=function(n,t,e){if("timestamp"===n)return e.timestamp;(0,p.hu)(!1,"Unexpected server value: "+n)},Ka=function(n,t,e){n.hasOwnProperty("increment")||(0,p.hu)(!1,"Unexpected server value: "+JSON.stringify(n,null,2));const i=n.increment;"number"!=typeof i&&(0,p.hu)(!1,"Unexpected increment value: "+i);const o=t.node();if((0,p.hu)(null!==o&&typeof o<"u","Expected ChildrenNode.EMPTY_NODE for nulls"),!o.isLeafNode())return i;const c=o.getValue();return"number"!=typeof c?i:c+i},Vo=function(n,t,e,i){return Bs(t,new Ws(e,n),i)},zi=function(n,t,e){return Bs(n,new Wr(t),e)};function Bs(n,t,e){const i=n.getPriority().val(),o=Br(i,t.getImmediateChild(".priority"),e);let u;if(n.isLeafNode()){const c=n,h=Br(c.getValue(),t,e);return h!==c.getValue()||o!==c.getPriority().val()?new Ln(h,Fe(o)):n}{const c=n;return u=c,o!==c.getPriority().val()&&(u=u.updatePriority(new Ln(o))),c.forEachChild(Ce,(h,g)=>{const v=Bs(g,t.getImmediateChild(h),e);v!==g&&(u=u.updateImmediateChild(h,v))}),u}}class Vs{constructor(t="",e=null,i={children:{},childCount:0}){this.name=t,this.parent=e,this.node=i}}function ji(n,t){let e=t instanceof K?t:new K(t),i=n,o=$(e);for(;null!==o;){const u=(0,p.DV)(i.node.children,o)||{children:{},childCount:0};i=new Vs(o,i,u),e=ge(e),o=$(e)}return i}function Hn(n){return n.node.value}function hi(n,t){n.node.value=t,Zs(n)}function Zo(n){return n.node.childCount>0}function Vr(n,t){Ee(n.node.children,(e,i)=>{t(new Vs(e,n,i))})}function Ho(n,t,e,i){e&&!i&&t(n),Vr(n,o=>{Ho(o,t,!0,i)}),e&&i&&t(n)}function Yi(n){return new K(null===n.parent?n.name:Yi(n.parent)+"/"+n.name)}function Zs(n){null!==n.parent&&function Ya(n,t,e){const i=function za(n){return void 0===Hn(n)&&!Zo(n)}(e),o=(0,p.r3)(n.node.children,t);i&&o?(delete n.node.children[t],n.node.childCount--,Zs(n)):!i&&!o&&(n.node.children[t]=e.node,n.node.childCount++,Zs(n))}(n.parent,n.name,n)}const Hs=/[\[\].#$\/\u0000-\u001F\u007F]/,Qa=/[\[\].#$\u0000-\u001F\u007F]/,Gs=10485760,Zr=function(n){return"string"==typeof n&&0!==n.length&&!Hs.test(n)},Go=function(n){return"string"==typeof n&&0!==n.length&&!Qa.test(n)},fi=function(n){return null===n||"string"==typeof n||"number"==typeof n&&!We(n)||n&&"object"==typeof n&&(0,p.r3)(n,".sv")},sn=function(n,t,e,i){i&&void 0===t||Qi((0,p.gK)(n,"value"),t,e)},Qi=function(n,t,e){const i=e instanceof K?new ia(e,n):e;if(void 0===t)throw new Error(n+"contains undefined "+xn(i));if("function"==typeof t)throw new Error(n+"contains a function "+xn(i)+" with contents = "+t.toString());if(We(t))throw new Error(n+"contains "+t.toString()+" "+xn(i));if("string"==typeof t&&t.length>Gs/3&&(0,p.ug)(t)>Gs)throw new Error(n+"contains a string greater than "+Gs+" utf8 bytes "+xn(i)+" ('"+t.substring(0,50)+"...')");if(t&&"object"==typeof t){let o=!1,u=!1;if(Ee(t,(c,h)=>{if(".value"===c)o=!0;else if(".priority"!==c&&".sv"!==c&&(u=!0,!Zr(c)))throw new Error(n+" contains an invalid key ("+c+") "+xn(i)+'.  Keys must be non-empty strings and can\'t contain ".", "#", "$", "/", "[", or "]"');(function ra(n,t){n.parts_.length>0&&(n.byteLength_+=1),n.parts_.push(t),n.byteLength_+=(0,p.ug)(t),Dn(n)})(i,c),Qi(n,h,i),function sa(n){const t=n.parts_.pop();n.byteLength_-=(0,p.ug)(t),n.parts_.length>0&&(n.byteLength_-=1)}(i)}),o&&u)throw new Error(n+' contains ".value" child '+xn(i)+" in addition to actual children.")}},$o=function(n,t,e,i){if(i&&void 0===t)return;const o=(0,p.gK)(n,"values");if(!t||"object"!=typeof t||Array.isArray(t))throw new Error(o+" must be an object containing the children to replace.");const u=[];Ee(t,(c,h)=>{const g=new K(c);if(Qi(o,h,Ge(e,g)),".priority"===Je(g)&&!fi(h))throw new Error(o+"contains an invalid value for '"+g.toString()+"', which must be a valid Firebase priority (a string, finite number, server value, or null).");u.push(g)}),function(n,t){let e,i;for(e=0;e<t.length;e++){i=t[e];const u=Ai(i);for(let c=0;c<u.length;c++)if((".priority"!==u[c]||c!==u.length-1)&&!Zr(u[c]))throw new Error(n+"contains an invalid key ("+u[c]+") in path "+i.toString()+'. Keys must be non-empty strings and can\'t contain ".", "#", "$", "/", "[", or "]"')}t.sort(Xn);let o=null;for(e=0;e<t.length;e++){if(i=t[e],null!==o&&Lt(o,i))throw new Error(n+"contains a path "+o.toString()+" that is ancestor of another path "+i.toString());o=i}}(o,u)},qi=function(n,t,e){if(!e||void 0!==t){if(We(t))throw new Error((0,p.gK)(n,"priority")+"is "+t.toString()+", but must be a valid Firebase priority (a string, finite number, server value, or null).");if(!fi(t))throw new Error((0,p.gK)(n,"priority")+"must be a valid Firebase priority (a string, finite number, server value, or null).")}},Ji=function(n,t,e,i){if(!(i&&void 0===e||Zr(e)))throw new Error((0,p.gK)(n,t)+'was an invalid key = "'+e+'".  Firebase keys must be non-empty strings and can\'t contain ".", "#", "$", "/", "[", or "]").')},Gn=function(n,t,e,i){if(!(i&&void 0===e||Go(e)))throw new Error((0,p.gK)(n,t)+'was an invalid path = "'+e+'". Paths must be non-empty strings and can\'t contain ".", "#", "$", "[", or "]"')},Xa=function(n,t,e,i){e&&(e=e.replace(/^\/*\.info(\/|$)/,"/")),Gn(n,t,e,i)},Nt=function(n,t){if(".info"===$(t))throw new Error(n+" failed = Can't modify data under /.info/")},Ko=function(n,t){const e=t.path.toString();if("string"!=typeof t.repoInfo.host||0===t.repoInfo.host.length||!Zr(t.repoInfo.namespace)&&"localhost"!==t.repoInfo.host.split(":")[0]||0!==e.length&&!function(n){return n&&(n=n.replace(/^\/*\.info(\/|$)/,"/")),Go(n)}(e))throw new Error((0,p.gK)(n,"url")+'must be a valid firebase URL and the path can\'t contain ".", "#", "$", "[", or "]".')};class $s{constructor(){this.eventLists_=[],this.recursionDepth_=0}}function Hr(n,t){let e=null;for(let i=0;i<t.length;i++){const o=t[i],u=o.getPath();null!==e&&!On(u,e.path)&&(n.eventLists_.push(e),e=null),null===e&&(e={events:[],path:u}),e.events.push(o)}e&&n.eventLists_.push(e)}function Ks(n,t,e){Hr(n,e),zo(n,i=>On(i,t))}function Rt(n,t,e){Hr(n,e),zo(n,i=>Lt(i,t)||Lt(t,i))}function zo(n,t){n.recursionDepth_++;let e=!0;for(let i=0;i<n.eventLists_.length;i++){const o=n.eventLists_[i];o&&(t(o.path)?(el(n.eventLists_[i]),n.eventLists_[i]=null):e=!1)}e&&(n.eventLists_=[]),n.recursionDepth_--}function el(n){for(let t=0;t<n.events.length;t++){const e=n.events[t];if(null!==e){n.events[t]=null;const i=e.getEventRunner();Xe&&oe("event: "+e.toString()),Pe(i)}}}const jo="repo_interrupt",tl=25;class nl{constructor(t,e,i,o){this.repoInfo_=t,this.forceRestClient_=e,this.authTokenProvider_=i,this.appCheckProvider_=o,this.dataUpdateCount=0,this.statsListener_=null,this.eventQueue_=new $s,this.nextWriteId_=1,this.interceptServerDataCallback_=null,this.onDisconnect_=Tr(),this.transactionQueueTree_=new Vs,this.persistentConnection_=null,this.key=this.repoInfo_.toURLString()}toString(){return(this.repoInfo_.secure?"https://":"http://")+this.repoInfo_.host}}function Qo(n){const e=n.infoData_.getNode(new K(".info/serverTimeOffset")).val()||0;return(new Date).getTime()+e}function Xi(n){return Bo({timestamp:Qo(n)})}function a(n,t,e,i,o){n.dataUpdateCount++;const u=new K(t);e=n.interceptServerDataCallback_?n.interceptServerDataCallback_(t,e):e;let c=[];if(o)if(i){const g=(0,p.UI)(e,v=>Fe(v));c=function Za(n,t,e,i){const o=Gi(n,i);if(o){const u=$i(o),c=u.path,h=u.queryId,g=$e(c,t),v=Ue.fromObject(e);return Ki(n,c,new Wt(_o(h),g,v))}return[]}(n.serverSyncTree_,u,g,o)}else{const g=Fe(e);c=Fs(n.serverSyncTree_,u,g,o)}else if(i){const g=(0,p.UI)(e,v=>Fe(v));c=function Ms(n,t,e){const i=Ue.fromObject(e);return di(n,new Wt({fromUser:!1,fromServer:!0,queryId:null,tagged:!1},t,i))}(n.serverSyncTree_,u,g)}else{const g=Fe(e);c=Bn(n.serverSyncTree_,u,g)}let h=u;c.length>0&&(h=Kn(n,u)),Rt(n.eventQueue_,h,c)}function r(n,t){l(n,"connected",t),!1===t&&function H(n){$n(n,"onDisconnectEvents");const t=Xi(n),e=Tr();ds(n.onDisconnect_,q(),(o,u)=>{const c=Vo(o,u,n.serverSyncTree_,t);Yt(e,o,c)});let i=[];ds(e,q(),(o,u)=>{i=i.concat(Bn(n.serverSyncTree_,o,u));const c=rl(n,o);Kn(n,c)}),n.onDisconnect_=Tr(),Rt(n.eventQueue_,q(),i)}(n)}function l(n,t,e){const i=new K("/.info/"+t),o=Fe(e);n.infoData_.updateSnapshot(i,o);const u=Bn(n.infoSyncTree_,i,o);Rt(n.eventQueue_,i,u)}function d(n){return n.nextWriteId_++}function S(n,t,e,i,o){$n(n,"set",{path:t.toString(),value:e,priority:i});const u=Xi(n),c=Fe(e,i),h=ci(n.serverSyncTree_,t),g=zi(c,h,u),v=d(n),P=Ls(n.serverSyncTree_,t,g,v,!0);Hr(n.eventQueue_,P),n.server_.put(t.toString(),c.val(!0),(L,Z)=>{const Q="ok"===L;Q||ee("set at "+t+" failed: "+L);const Ie=rn(n.serverSyncTree_,v,!Q);Rt(n.eventQueue_,t,Ie),hn(0,o,L,Z)});const b=rl(n,t);Kn(n,b),Rt(n.eventQueue_,b,[])}function j(n,t,e){n.server_.onDisconnectCancel(t.toString(),(i,o)=>{"ok"===i&&Cr(n.onDisconnect_,t),hn(0,e,i,o)})}function se(n,t,e,i){const o=Fe(e);n.server_.onDisconnectPut(t.toString(),o.val(!0),(u,c)=>{"ok"===u&&Yt(n.onDisconnect_,t,o),hn(0,i,u,c)})}function pi(n,t,e){let i;i=".info"===$(t._path)?Hi(n.infoSyncTree_,t,e):Hi(n.serverSyncTree_,t,e),Ks(n.eventQueue_,t._path,i)}function zs(n){n.persistentConnection_&&n.persistentConnection_.interrupt(jo)}function $n(n,...t){let e="";n.persistentConnection_&&(e=n.persistentConnection_.id+":"),oe(e,...t)}function hn(n,t,e,i){t&&Pe(()=>{if("ok"===e)t(null);else{const o=(e||"error").toUpperCase();let u=o;i&&(u+=": "+i);const c=new Error(u);c.code=o,t(c)}})}function Gr(n,t,e){return ci(n.serverSyncTree_,t,e)||ne.EMPTY_NODE}function er(n,t=n.transactionQueueTree_){if(t||Jo(n,t),Hn(t)){const e=qo(n,t);(0,p.hu)(e.length>0,"Sending zero length transaction queue"),e.every(o=>0===o.status)&&function Qs(n,t,e){const i=e.map(v=>v.currentWriteId),o=Gr(n,t,i);let u=o;const c=o.hash();for(let v=0;v<e.length;v++){const P=e[v];(0,p.hu)(0===P.status,"tryToSendTransactionQueue_: items in queue should all be run."),P.status=1,P.retryCount++;const b=$e(t,P.path);u=u.updateChild(b,P.currentOutputSnapshotRaw)}const h=u.val(!0),g=t;n.server_.put(g.toString(),h,v=>{$n(n,"transaction put response",{path:g.toString(),status:v});let P=[];if("ok"===v){const b=[];for(let L=0;L<e.length;L++)e[L].status=2,P=P.concat(rn(n.serverSyncTree_,e[L].currentWriteId)),e[L].onComplete&&b.push(()=>e[L].onComplete(null,!0,e[L].currentOutputSnapshotResolved)),e[L].unwatcher();Jo(n,ji(n.transactionQueueTree_,t)),er(n,n.transactionQueueTree_),Rt(n.eventQueue_,t,P);for(let L=0;L<b.length;L++)Pe(b[L])}else{if("datastale"===v)for(let b=0;b<e.length;b++)e[b].status=3===e[b].status?4:0;else{ee("transaction at "+g.toString()+" failed: "+v);for(let b=0;b<e.length;b++)e[b].status=4,e[b].abortReason=v}Kn(n,t)}},c)}(n,Yi(t),e)}else Zo(t)&&Vr(t,e=>{er(n,e)})}function Kn(n,t){const e=$r(n,t),i=Yi(e);return function il(n,t,e){if(0===t.length)return;const i=[];let o=[];const c=t.filter(h=>0===h.status).map(h=>h.currentWriteId);for(let h=0;h<t.length;h++){const g=t[h],v=$e(e,g.path);let b,P=!1;if((0,p.hu)(null!==v,"rerunTransactionsUnderNode_: relativePath should not be null."),4===g.status)P=!0,b=g.abortReason,o=o.concat(rn(n.serverSyncTree_,g.currentWriteId,!0));else if(0===g.status)if(g.retryCount>=tl)P=!0,b="maxretry",o=o.concat(rn(n.serverSyncTree_,g.currentWriteId,!0));else{const L=Gr(n,g.path,c);g.currentInputSnapshot=L;const Z=t[h].update(L.val());if(void 0!==Z){Qi("transaction failed: Data returned ",Z,g.path);let Q=Fe(Z);"object"==typeof Z&&null!=Z&&(0,p.r3)(Z,".priority")||(Q=Q.updatePriority(L.getPriority()));const ht=g.currentWriteId,Cn=Xi(n),zn=zi(Q,L,Cn);g.currentOutputSnapshotRaw=Q,g.currentOutputSnapshotResolved=zn,g.currentWriteId=d(n),c.splice(c.indexOf(ht),1),o=o.concat(Ls(n.serverSyncTree_,g.path,zn,g.currentWriteId,g.applyLocally)),o=o.concat(rn(n.serverSyncTree_,ht,!0))}else P=!0,b="nodata",o=o.concat(rn(n.serverSyncTree_,g.currentWriteId,!0))}Rt(n.eventQueue_,e,o),o=[],P&&(t[h].status=2,setTimeout(t[h].unwatcher,Math.floor(0)),t[h].onComplete&&i.push("nodata"===b?()=>t[h].onComplete(null,!1,t[h].currentInputSnapshot):()=>t[h].onComplete(new Error(b),!1,null)))}Jo(n,n.transactionQueueTree_);for(let h=0;h<i.length;h++)Pe(i[h]);er(n,n.transactionQueueTree_)}(n,qo(n,e),i),i}function $r(n,t){let e,i=n.transactionQueueTree_;for(e=$(t);null!==e&&void 0===Hn(i);)i=ji(i,e),e=$(t=ge(t));return i}function qo(n,t){const e=[];return hl(n,t,e),e.sort((i,o)=>i.order-o.order),e}function hl(n,t,e){const i=Hn(t);if(i)for(let o=0;o<i.length;o++)e.push(i[o]);Vr(t,o=>{hl(n,o,e)})}function Jo(n,t){const e=Hn(t);if(e){let i=0;for(let o=0;o<e.length;o++)2!==e[o].status&&(e[i]=e[o],i++);e.length=i,hi(t,e.length>0?e:void 0)}Vr(t,i=>{Jo(n,i)})}function rl(n,t){const e=Yi($r(n,t)),i=ji(n.transactionQueueTree_,t);return function ja(n,t,e){let i=e?n:n.parent;for(;null!==i;){if(t(i))return!0;i=i.parent}}(i,o=>{sl(n,o)}),sl(n,i),Ho(i,o=>{sl(n,o)}),e}function sl(n,t){const e=Hn(t);if(e){const i=[];let o=[],u=-1;for(let c=0;c<e.length;c++)3===e[c].status||(1===e[c].status?((0,p.hu)(u===c-1,"All SENT items should be at beginning of queue."),u=c,e[c].status=3,e[c].abortReason="set"):((0,p.hu)(0===e[c].status,"Unexpected transaction status in abort"),e[c].unwatcher(),o=o.concat(rn(n.serverSyncTree_,e[c].currentWriteId,!0)),e[c].onComplete&&i.push(e[c].onComplete.bind(null,new Error("set"),!1,null))));-1===u?hi(t,void 0):e.length=u+1,Rt(n.eventQueue_,Yi(t),o);for(let c=0;c<i.length;c++)Pe(i[c])}}const ol=function(n,t){const e=Ql(n),i=e.namespace;return"firebase.com"===e.domain&&Ke(e.host+" is no longer supported. Please use <YOUR FIREBASE>.firebaseio.com instead"),(!i||"undefined"===i)&&"localhost"!==e.domain&&Ke("Cannot parse Firebase url. Please use https://<YOUR FIREBASE>.firebaseio.com"),e.secure||typeof window<"u"&&window.location&&window.location.protocol&&-1!==window.location.protocol.indexOf("https:")&&ee("Insecure Firebase access from a secure page. Please use https in calls to new Firebase()."),{repoInfo:new x(e.host,e.secure,i,"ws"===e.scheme||"wss"===e.scheme,t,"",i!==e.subdomain),path:new K(e.pathString)}},Ql=function(n){let t="",e="",i="",o="",u="",c=!0,h="https",g=443;if("string"==typeof n){let v=n.indexOf("//");v>=0&&(h=n.substring(0,v-1),n=n.substring(v+2));let P=n.indexOf("/");-1===P&&(P=n.length);let b=n.indexOf("?");-1===b&&(b=n.length),t=n.substring(0,Math.min(P,b)),P<b&&(o=function jl(n){let t="";const e=n.split("/");for(let i=0;i<e.length;i++)if(e[i].length>0){let o=e[i];try{o=decodeURIComponent(o.replace(/\+/g," "))}catch{}t+="/"+o}return t}(n.substring(P,b)));const L=function Yl(n){const t={};"?"===n.charAt(0)&&(n=n.substring(1));for(const e of n.split("&")){if(0===e.length)continue;const i=e.split("=");2===i.length?t[decodeURIComponent(i[0])]=decodeURIComponent(i[1]):ee(`Invalid query segment '${e}' in query '${n}'`)}return t}(n.substring(Math.min(n.length,b)));v=t.indexOf(":"),v>=0?(c="https"===h||"wss"===h,g=parseInt(t.substring(v+1),10)):v=t.length;const Z=t.slice(0,v);if("localhost"===Z.toLowerCase())e="localhost";else if(Z.split(".").length<=2)e=Z;else{const Q=t.indexOf(".");i=t.substring(0,Q).toLowerCase(),e=t.substring(Q+1),u=i}"ns"in L&&(u=L.ns)}return{host:t,port:g,domain:e,subdomain:i,secure:c,scheme:h,pathString:o,namespace:u}},fl="-0123456789ABCDEFGHIJKLMNOPQRSTUVWXYZ_abcdefghijklmnopqrstuvwxyz",ql=function(){let n=0;const t=[];return function(e){const i=e===n;let o;n=e;const u=new Array(8);for(o=7;o>=0;o--)u[o]=fl.charAt(e%64),e=Math.floor(e/64);(0,p.hu)(0===e,"Cannot push at time == 0");let c=u.join("");if(i){for(o=11;o>=0&&63===t[o];o--)t[o]=0;t[o]++}else for(o=0;o<12;o++)t[o]=Math.floor(64*Math.random());for(o=0;o<12;o++)c+=fl.charAt(t[o]);return(0,p.hu)(20===c.length,"nextPushId: Length should be 20."),c}}();class pl{constructor(t,e,i,o){this.eventType=t,this.eventRegistration=e,this.snapshot=i,this.prevName=o}getPath(){const t=this.snapshot.ref;return"value"===this.eventType?t._path:t.parent._path}getEventType(){return this.eventType}getEventRunner(){return this.eventRegistration.getEventRunner(this)}toString(){return this.getPath().toString()+":"+this.eventType+":"+(0,p.Wl)(this.snapshot.exportVal())}}class _l{constructor(t,e,i){this.eventRegistration=t,this.error=e,this.path=i}getPath(){return this.path}getEventType(){return"cancel"}getEventRunner(){return this.eventRegistration.getEventRunner(this)}toString(){return this.path.toString()+":cancel"}}class al{constructor(t,e){this.snapshotCallback=t,this.cancelCallback=e}onValue(t,e){this.snapshotCallback.call(null,t,e)}onCancel(t){return(0,p.hu)(this.hasCancelCallback,"Raising a cancel event on a listener with no cancel callback"),this.cancelCallback.call(null,t)}get hasCancelCallback(){return!!this.cancelCallback}matches(t){return this.snapshotCallback===t.snapshotCallback||void 0!==this.snapshotCallback.userCallback&&this.snapshotCallback.userCallback===t.snapshotCallback.userCallback&&this.snapshotCallback.context===t.snapshotCallback.context}}class gl{constructor(t,e){this._repo=t,this._path=e}cancel(){const t=new p.BH;return j(this._repo,this._path,t.wrapCallback(()=>{})),t.promise}remove(){Nt("OnDisconnect.remove",this._path);const t=new p.BH;return se(this._repo,this._path,null,t.wrapCallback(()=>{})),t.promise}set(t){Nt("OnDisconnect.set",this._path),sn("OnDisconnect.set",t,this._path,!1);const e=new p.BH;return se(this._repo,this._path,t,e.wrapCallback(()=>{})),e.promise}setWithPriority(t,e){Nt("OnDisconnect.setWithPriority",this._path),sn("OnDisconnect.setWithPriority",t,this._path,!1),qi("OnDisconnect.setWithPriority",e,!1);const i=new p.BH;return function Be(n,t,e,i,o){const u=Fe(e,i);n.server_.onDisconnectPut(t.toString(),u.val(!0),(c,h)=>{"ok"===c&&Yt(n.onDisconnect_,t,u),hn(0,o,c,h)})}(this._repo,this._path,t,e,i.wrapCallback(()=>{})),i.promise}update(t){Nt("OnDisconnect.update",this._path),$o("OnDisconnect.update",t,this._path,!1);const e=new p.BH;return function on(n,t,e,i){if((0,p.xb)(e))return oe("onDisconnect().update() called with empty data.  Don't do anything."),void hn(0,i,"ok",void 0);n.server_.onDisconnectMerge(t.toString(),e,(o,u)=>{"ok"===o&&Ee(e,(c,h)=>{const g=Fe(h);Yt(n.onDisconnect_,Ge(t,c),g)}),hn(0,i,o,u)})}(this._repo,this._path,t,e.wrapCallback(()=>{})),e.promise}}class Vt{constructor(t,e,i,o){this._repo=t,this._path=e,this._queryParams=i,this._orderByCalled=o}get key(){return re(this._path)?null:Je(this._path)}get ref(){return new an(this._repo,this._path)}get _queryIdentifier(){const t=co(this._queryParams),e=ke(t);return"{}"===e?"default":e}get _queryObject(){return co(this._queryParams)}isEqual(t){if(!((t=(0,p.m9)(t))instanceof Vt))return!1;const e=this._repo===t._repo,i=On(this._path,t._path);return e&&i&&this._queryIdentifier===t._queryIdentifier}toJSON(){return this.toString()}toString(){return this._repo.toString()+function na(n){let t="";for(let e=n.pieceNum_;e<n.pieces_.length;e++)""!==n.pieces_[e]&&(t+="/"+encodeURIComponent(String(n.pieces_[e])));return t||"/"}(this._path)}}function Xo(n,t){if(!0===n._orderByCalled)throw new Error(t+": You can't combine multiple orderBy calls.")}function _i(n){let t=null,e=null;if(n.hasStart()&&(t=n.getIndexStartValue()),n.hasEnd()&&(e=n.getIndexEndValue()),n.getIndex()===Ft){const i="Query: When ordering by key, you may only pass one argument to startAt(), endAt(), or equalTo().",o="Query: When ordering by key, the argument passed to startAt(), startAfter(), endAt(), endBefore(), or equalTo() must be a string.";if(n.hasStart()){if(n.getIndexStartName()!==V)throw new Error(i);if("string"!=typeof t)throw new Error(o)}if(n.hasEnd()){if(n.getIndexEndName()!==X)throw new Error(i);if("string"!=typeof e)throw new Error(o)}}else if(n.getIndex()===Ce){if(null!=t&&!fi(t)||null!=e&&!fi(e))throw new Error("Query: When ordering by priority, the first argument passed to startAt(), startAfter() endAt(), endBefore(), or equalTo() must be a valid priority value (null, a number, or a string).")}else if((0,p.hu)(n.getIndex()instanceof rs||n.getIndex()===os,"unknown index type."),null!=t&&"object"==typeof t||null!=e&&"object"==typeof e)throw new Error("Query: First argument passed to startAt(), startAfter(), endAt(), endBefore(), or equalTo() cannot be an object.")}function ea(n){if(n.hasStart()&&n.hasEnd()&&n.hasLimit()&&!n.hasAnchoredLimit())throw new Error("Query: Can't combine startAt(), startAfter(), endAt(), endBefore(), and limit(). Use limitToFirst() or limitToLast() instead.")}class an extends Vt{constructor(t,e){super(t,e,new ii,!1)}get parent(){const t=Jn(this._path);return null===t?null:new an(this._repo,t)}get root(){let t=this;for(;null!==t.parent;)t=t.parent;return t}}class tr{constructor(t,e,i){this._node=t,this.ref=e,this._index=i}get priority(){return this._node.getPriority().val()}get key(){return this.ref.key}get size(){return this._node.numChildren()}child(t){const e=new K(t),i=nr(this.ref,t);return new tr(this._node.getChild(e),i,Ce)}exists(){return!this._node.isEmpty()}exportVal(){return this._node.val(!0)}forEach(t){return!this._node.isLeafNode()&&!!this._node.forEachChild(this._index,(i,o)=>t(new tr(o,nr(this.ref,i),Ce)))}hasChild(t){const e=new K(t);return!this._node.getChild(e).isEmpty()}hasChildren(){return!this._node.isLeafNode()&&!this._node.isEmpty()}toJSON(){return this.exportVal()}val(){return this._node.val()}}function ml(n,t){return(n=(0,p.m9)(n))._checkNotDeleted("ref"),void 0!==t?nr(n._root,t):n._root}function vl(n,t){(n=(0,p.m9)(n))._checkNotDeleted("refFromURL");const e=ol(t,n._repo.repoInfo_.nodeAdmin);Ko("refFromURL",e);const i=e.repoInfo;return!n._repo.repoInfo_.isCustomHost()&&i.host!==n._repo.repoInfo_.host&&Ke("refFromURL: Host name does not match the current database: (found "+i.host+" but expected "+n._repo.repoInfo_.host+")"),ml(n,e.path.toString())}function nr(n,t){return null===$((n=(0,p.m9)(n))._path)?Xa("child","path",t,!1):Gn("child","path",t,!1),new an(n._repo,Ge(n._path,t))}function ll(n,t){n=(0,p.m9)(n),Nt("set",n._path),sn("set",t,n._path,!1);const e=new p.BH;return S(n._repo,n._path,t,null,e.wrapCallback(()=>{})),e.promise}function nu(n,t){$o("update",t,n._path,!1);const e=new p.BH;return function M(n,t,e,i){$n(n,"update",{path:t.toString(),value:e});let o=!0;const u=Xi(n),c={};if(Ee(e,(h,g)=>{o=!1,c[h]=Vo(Ge(t,h),Fe(g),n.serverSyncTree_,u)}),o)oe("update() called with empty data.  Don't do anything."),hn(0,i,"ok",void 0);else{const h=d(n),g=function Ba(n,t,e,i){!function Ca(n,t,e,i){(0,p.hu)(i>n.lastWriteId,"Stacking an older merge on top of newer ones"),n.allWrites.push({path:t,children:e,writeId:i,visible:!0}),n.visibleWrites=Wi(n.visibleWrites,t,e),n.lastWriteId=i}(n.pendingWriteTree_,t,e,i);const o=Ue.fromObject(e);return di(n,new Wt({fromUser:!0,fromServer:!1,queryId:null,tagged:!1},t,o))}(n.serverSyncTree_,t,c,h);Hr(n.eventQueue_,g),n.server_.merge(t.toString(),e,(v,P)=>{const b="ok"===v;b||ee("update at "+t+" failed: "+v);const L=rn(n.serverSyncTree_,h,!b),Z=L.length>0?Kn(n,t):t;Rt(n.eventQueue_,Z,L),hn(0,i,v,P)}),Ee(e,v=>{const P=rl(n,Ge(t,v));Kn(n,P)}),Rt(n.eventQueue_,t,[])}}(n._repo,n._path,t,e.wrapCallback(()=>{})),e.promise}function iu(n){n=(0,p.m9)(n);const t=new al(()=>{}),e=new qs(t);return function f(n,t,e){const i=function Ha(n,t){const e=t._path;let i=null;n.syncPointTree_.foreachOnPath(e,(v,P)=>{const b=$e(v,e);i=i||In(P,b)});let o=n.syncPointTree_.get(e);o?i=i||In(o,q()):(o=new xr,n.syncPointTree_=n.syncPointTree_.set(e,o));const u=null!=i,c=u?new nn(i,!0,!1):null;return function Ma(n){return Ui(n.viewCache_)}(Oo(o,t,oi(n.pendingWriteTree_,t._path),u?c.getNode():ne.EMPTY_NODE,u))}(n.serverSyncTree_,t);return null!=i?Promise.resolve(i):n.server_.get(t).then(o=>{const u=Fe(o).withIndex(t._queryParams.getIndex());let c;if(Us(n.serverSyncTree_,t,e,!0),t._queryParams.loadsAllData())c=Bn(n.serverSyncTree_,t._path,u);else{const h=Vn(n.serverSyncTree_,t);c=Fs(n.serverSyncTree_,t._path,u,h)}return Rt(n.eventQueue_,t._path,c),Hi(n.serverSyncTree_,t,e,null,!0),u},o=>($n(n,"get for query "+(0,p.Wl)(t)+" failed: "+o),Promise.reject(new Error(o))))}(n._repo,n,e).then(i=>new tr(i,new an(n._repo,n._path),n._queryParams.getIndex()))}class qs{constructor(t){this.callbackContext=t}respondsTo(t){return"value"===t}createEvent(t,e){const i=e._queryParams.getIndex();return new pl("value",this,new tr(t.snapshotNode,new an(e._repo,e._path),i))}getEventRunner(t){return"cancel"===t.getEventType()?()=>this.callbackContext.onCancel(t.error):()=>this.callbackContext.onValue(t.snapshot,null)}createCancelEvent(t,e){return this.callbackContext.hasCancelCallback?new _l(this,t,e):null}matches(t){return t instanceof qs&&(!t.callbackContext||!this.callbackContext||t.callbackContext.matches(this.callbackContext))}hasAnyCallback(){return null!==this.callbackContext}}class ta{constructor(t,e){this.eventType=t,this.callbackContext=e}respondsTo(t){let e="children_added"===t?"child_added":t;return e="children_removed"===e?"child_removed":e,this.eventType===e}createCancelEvent(t,e){return this.callbackContext.hasCancelCallback?new _l(this,t,e):null}createEvent(t,e){(0,p.hu)(null!=t.childName,"Child events should have a childName.");const i=nr(new an(e._repo,e._path),t.childName),o=e._queryParams.getIndex();return new pl(t.type,this,new tr(t.snapshotNode,i,o),t.prevName)}getEventRunner(t){return"cancel"===t.getEventType()?()=>this.callbackContext.onCancel(t.error):()=>this.callbackContext.onValue(t.snapshot,t.prevName)}matches(t){return t instanceof ta&&this.eventType===t.eventType&&(!this.callbackContext||!t.callbackContext||this.callbackContext.matches(t.callbackContext))}hasAnyCallback(){return!!this.callbackContext}}function Js(n,t,e,i,o){let u;if("object"==typeof i&&(u=void 0,o=i),"function"==typeof i&&(u=i),o&&o.onlyOnce){const g=e,v=(P,b)=>{pi(n._repo,n,h),g(P,b)};v.userCallback=e.userCallback,v.context=e.context,e=v}const c=new al(e,u||void 0),h="value"===t?new qs(c):new ta(t,c);return function Tn(n,t,e){let i;i=".info"===$(t._path)?Us(n.infoSyncTree_,t,e):Us(n.serverSyncTree_,t,e),Ks(n.eventQueue_,t._path,i)}(n._repo,n,h),()=>pi(n._repo,n,h)}function ul(n,t,e,i){return Js(n,"value",t,e,i)}function yl(n,t,e,i){return Js(n,"child_added",t,e,i)}function Il(n,t,e,i){return Js(n,"child_changed",t,e,i)}function El(n,t,e,i){return Js(n,"child_moved",t,e,i)}function Tl(n,t,e,i){return Js(n,"child_removed",t,e,i)}function Cl(n,t,e){let i=null;const o=e?new al(e):null;"value"===t?i=new qs(o):t&&(i=new ta(t,o)),pi(n._repo,n,i)}class fn{}class Al extends fn{constructor(t,e){super(),this._value=t,this._key=e}_apply(t){sn("endAt",this._value,t._path,!0);const e=Di(t._queryParams,this._value,this._key);if(ea(e),_i(e),t._queryParams.hasEnd())throw new Error("endAt: Starting point was already set (by another call to endAt, endBefore or equalTo).");return new Vt(t._repo,t._path,e,t._orderByCalled)}}class su extends fn{constructor(t,e){super(),this._value=t,this._key=e}_apply(t){sn("endBefore",this._value,t._path,!1);const e=function fa(n,t,e){let i;return i=Di(n,t,n.index_===Ft||e?e:V),i.endBeforeSet_=!0,i}(t._queryParams,this._value,this._key);if(ea(e),_i(e),t._queryParams.hasEnd())throw new Error("endBefore: Starting point was already set (by another call to endAt, endBefore or equalTo).");return new Vt(t._repo,t._path,e,t._orderByCalled)}}class Sl extends fn{constructor(t,e){super(),this._value=t,this._key=e}_apply(t){sn("startAt",this._value,t._path,!0);const e=Oi(t._queryParams,this._value,this._key);if(ea(e),_i(e),t._queryParams.hasStart())throw new Error("startAt: Starting point was already set (by another call to startAt, startBefore or equalTo).");return new Vt(t._repo,t._path,e,t._orderByCalled)}}class lu extends fn{constructor(t,e){super(),this._value=t,this._key=e}_apply(t){sn("startAfter",this._value,t._path,!1);const e=function ha(n,t,e){let i;return i=Oi(n,t,n.index_===Ft||e?e:X),i.startAfterSet_=!0,i}(t._queryParams,this._value,this._key);if(ea(e),_i(e),t._queryParams.hasStart())throw new Error("startAfter: Starting point was already set (by another call to startAt, startAfter, or equalTo).");return new Vt(t._repo,t._path,e,t._orderByCalled)}}class cu extends fn{constructor(t){super(),this._limit=t}_apply(t){if(t._queryParams.hasLimit())throw new Error("limitToFirst: Limit was already set (by another call to limitToFirst or limitToLast).");return new Vt(t._repo,t._path,function us(n,t){const e=n.copy();return e.limitSet_=!0,e.limit_=t,e.viewFrom_="l",e}(t._queryParams,this._limit),t._orderByCalled)}}class hu extends fn{constructor(t){super(),this._limit=t}_apply(t){if(t._queryParams.hasLimit())throw new Error("limitToLast: Limit was already set (by another call to limitToFirst or limitToLast).");return new Vt(t._repo,t._path,function da(n,t){const e=n.copy();return e.limitSet_=!0,e.limit_=t,e.viewFrom_="r",e}(t._queryParams,this._limit),t._orderByCalled)}}class pu extends fn{constructor(t){super(),this._path=t}_apply(t){Xo(t,"orderByChild");const e=new K(this._path);if(re(e))throw new Error("orderByChild: cannot pass in empty path. Use orderByValue() instead.");const i=new rs(e),o=ri(t._queryParams,i);return _i(o),new Vt(t._repo,t._path,o,!0)}}class gu extends fn{_apply(t){Xo(t,"orderByKey");const e=ri(t._queryParams,Ft);return _i(e),new Vt(t._repo,t._path,e,!0)}}class vu extends fn{_apply(t){Xo(t,"orderByPriority");const e=ri(t._queryParams,Ce);return _i(e),new Vt(t._repo,t._path,e,!0)}}class Iu extends fn{_apply(t){Xo(t,"orderByValue");const e=ri(t._queryParams,os);return _i(e),new Vt(t._repo,t._path,e,!0)}}class Tu extends fn{constructor(t,e){super(),this._value=t,this._key=e}_apply(t){if(sn("equalTo",this._value,t._path,!1),t._queryParams.hasStart())throw new Error("equalTo: Starting point was already set (by another call to startAt/startAfter or equalTo).");if(t._queryParams.hasEnd())throw new Error("equalTo: Ending point was already set (by another call to endAt/endBefore or equalTo).");return new Al(this._value,this._key)._apply(new Sl(this._value,this._key)._apply(t))}}function pn(n,...t){let e=(0,p.m9)(n);for(const i of t)e=i._apply(e);return e}(function Fa(n){(0,p.hu)(!Dr,"__referenceConstructor has already been defined"),Dr=n})(an),function Ds(n){(0,p.hu)(!Mr,"__referenceConstructor has already been defined"),Mr=n}(an);const Au="FIREBASE_DATABASE_EMULATOR_HOST",cl={};let wl=!1;function Rl(n,t,e,i,o){let u=i||n.options.databaseURL;void 0===u&&(n.options.projectId||Ke("Can't determine Firebase Database URL. Be sure to include  a Project ID when calling firebase.initializeApp()."),oe("Using default host for project ",n.options.projectId),u=`${n.options.projectId}-default-rtdb.firebaseio.com`);let g,v,c=ol(u,o),h=c.repoInfo;typeof process<"u"&&process.env&&(v=process.env[Au]),v?(g=!0,u=`http://${v}?ns=${h.namespace}`,c=ol(u,o),h=c.repoInfo):g=!c.repoInfo.secure;const P=o&&g?new bt(bt.OWNER):new Pt(n.name,n.options,t);Ko("Invalid Firebase Database URL",c),re(c.path)||Ke("Database URL must point to the root of a Firebase Database (not including a child path).");const b=function Ru(n,t,e,i){let o=cl[t.name];o||(o={},cl[t.name]=o);let u=o[n.toURLString()];return u&&Ke("Database initialized multiple times. Please make sure the format of the database URL matches with each database() call."),u=new nl(n,wl,e,i),o[n.toURLString()]=u,u}(h,n,P,new wn(n.name,e));return new Pu(b,n)}class Pu{constructor(t,e){this._repoInternal=t,this.app=e,this.type="database",this._instanceStarted=!1}get _repo(){return this._instanceStarted||(function Yo(n,t,e){if(n.stats_=ut(n.repoInfo_),n.forceRestClient_||gn())n.server_=new xi(n.repoInfo_,(i,o,u,c)=>{a(n,i,o,u,c)},n.authTokenProvider_,n.appCheckProvider_),setTimeout(()=>r(n,!0),0);else{if(typeof e<"u"&&null!==e){if("object"!=typeof e)throw new Error("Only objects are supported for option databaseAuthVariableOverride");try{(0,p.Wl)(e)}catch(i){throw new Error("Invalid authOverride provided: "+i)}}n.persistentConnection_=new tn(n.repoInfo_,t,(i,o,u,c)=>{a(n,i,o,u,c)},i=>{r(n,i)},i=>{!function s(n,t){Ee(t,(e,i)=>{l(n,e,i)})}(n,i)},n.authTokenProvider_,n.appCheckProvider_,e),n.server_=n.persistentConnection_}n.authTokenProvider_.addTokenChangeListener(i=>{n.server_.refreshAuthToken(i)}),n.appCheckProvider_.addTokenChangeListener(i=>{n.server_.refreshAppCheckToken(i.token)}),n.statsReporter_=function At(n,t){const e=n.toString();return Oe[e]||(Oe[e]=t()),Oe[e]}(n.repoInfo_,()=>new ma(n.stats_,n.server_)),n.infoData_=new cs,n.infoSyncTree_=new ui({startListening:(i,o,u,c)=>{let h=[];const g=n.infoData_.getNode(i._path);return g.isEmpty()||(h=Bn(n.infoSyncTree_,i._path,g),setTimeout(()=>{c("ok")},0)),h},stopListening:()=>{}}),l(n,"connected",!1),n.serverSyncTree_=new ui({startListening:(i,o,u,c)=>(n.server_.listen(i,u,o,(h,g)=>{const v=c(h,g);Rt(n.eventQueue_,i._path,v)}),[]),stopListening:(i,o)=>{n.server_.unlisten(i,o)}})}(this._repoInternal,this.app.options.appId,this.app.options.databaseAuthVariableOverride),this._instanceStarted=!0),this._repoInternal}get _root(){return this._rootInternal||(this._rootInternal=new an(this._repo,q())),this._rootInternal}_delete(){return null!==this._rootInternal&&(function wu(n,t){const e=cl[t];(!e||e[n.key]!==n)&&Ke(`Database ${t}(${n.repoInfo_}) has already been deleted.`),zs(n),delete e[n.key]}(this._repo,this.app.name),this._repoInternal=null,this._rootInternal=null),Promise.resolve()}_checkNotDeleted(t){null===this._rootInternal&&Ke("Cannot call "+t+" on a deleted database.")}}function kl(){Yr.IS_TRANSPORT_INITIALIZED&&ee("Transport has already been initialized. Please call this function before calling ref or setting up a listener")}function bu(){kl(),en.forceDisallow()}function Nu(){kl(),Kt.forceDisallow(),en.forceAllow()}function xu(n,t){rt(n,t)}const Mu={".sv":"timestamp"};class Wu{constructor(t,e){this.committed=t,this.snapshot=e}toJSON(){return{committed:this.committed,snapshot:this.snapshot.toJSON()}}}tn.prototype.simpleListen=function(n,t){this.sendRequest("q",{p:n},t)},tn.prototype.echo=function(n,t){this.sendRequest("echo",{d:n},t)},function Lu(n){ft(It.SDK_VERSION),(0,It._registerComponent)(new we.wA("database",(t,{instanceIdentifier:e})=>Rl(t.getProvider("app").getImmediate(),t.getProvider("auth-internal"),t.getProvider("app-check-internal"),e),"PUBLIC").setMultipleInstances(!0)),(0,It.registerVersion)(be,"0.14.4",n),(0,It.registerVersion)(be,"0.14.4","esm2017")}();const Hu=new Ot.Yd("@firebase/database-compat"),bl=function(n){Hu.warn("FIREBASE WARNING: "+n)};class Ku{constructor(t){this._delegate=t}cancel(t){(0,p.Dv)("OnDisconnect.cancel",0,1,arguments.length),(0,p.Wj)("OnDisconnect.cancel","onComplete",t,!0);const e=this._delegate.cancel();return t&&e.then(()=>t(null),i=>t(i)),e}remove(t){(0,p.Dv)("OnDisconnect.remove",0,1,arguments.length),(0,p.Wj)("OnDisconnect.remove","onComplete",t,!0);const e=this._delegate.remove();return t&&e.then(()=>t(null),i=>t(i)),e}set(t,e){(0,p.Dv)("OnDisconnect.set",1,2,arguments.length),(0,p.Wj)("OnDisconnect.set","onComplete",e,!0);const i=this._delegate.set(t);return e&&i.then(()=>e(null),o=>e(o)),i}setWithPriority(t,e,i){(0,p.Dv)("OnDisconnect.setWithPriority",2,3,arguments.length),(0,p.Wj)("OnDisconnect.setWithPriority","onComplete",i,!0);const o=this._delegate.setWithPriority(t,e);return i&&o.then(()=>i(null),u=>i(u)),o}update(t,e){if((0,p.Dv)("OnDisconnect.update",1,2,arguments.length),Array.isArray(t)){const o={};for(let u=0;u<t.length;++u)o[""+u]=t[u];t=o,bl("Passing an Array to firebase.database.onDisconnect().update() is deprecated. Use set() if you want to overwrite the existing data, or an Object with integer keys if you really do want to only update some of the children.")}(0,p.Wj)("OnDisconnect.update","onComplete",e,!0);const i=this._delegate.update(t);return e&&i.then(()=>e(null),o=>e(o)),i}}class zu{constructor(t,e){this.committed=t,this.snapshot=e}toJSON(){return(0,p.Dv)("TransactionResult.toJSON",0,1,arguments.length),{committed:this.committed,snapshot:this.snapshot.toJSON()}}}class gi{constructor(t,e){this._database=t,this._delegate=e}val(){return(0,p.Dv)("DataSnapshot.val",0,0,arguments.length),this._delegate.val()}exportVal(){return(0,p.Dv)("DataSnapshot.exportVal",0,0,arguments.length),this._delegate.exportVal()}toJSON(){return(0,p.Dv)("DataSnapshot.toJSON",0,1,arguments.length),this._delegate.toJSON()}exists(){return(0,p.Dv)("DataSnapshot.exists",0,0,arguments.length),this._delegate.exists()}child(t){return(0,p.Dv)("DataSnapshot.child",0,1,arguments.length),t=String(t),Gn("DataSnapshot.child","path",t,!1),new gi(this._database,this._delegate.child(t))}hasChild(t){return(0,p.Dv)("DataSnapshot.hasChild",1,1,arguments.length),Gn("DataSnapshot.hasChild","path",t,!1),this._delegate.hasChild(t)}getPriority(){return(0,p.Dv)("DataSnapshot.getPriority",0,0,arguments.length),this._delegate.priority}forEach(t){return(0,p.Dv)("DataSnapshot.forEach",1,1,arguments.length),(0,p.Wj)("DataSnapshot.forEach","action",t,!1),this._delegate.forEach(e=>t(new gi(this._database,e)))}hasChildren(){return(0,p.Dv)("DataSnapshot.hasChildren",0,0,arguments.length),this._delegate.hasChildren()}get key(){return this._delegate.key}numChildren(){return(0,p.Dv)("DataSnapshot.numChildren",0,0,arguments.length),this._delegate.size}getRef(){return(0,p.Dv)("DataSnapshot.ref",0,0,arguments.length),new qt(this._database,this._delegate.ref)}get ref(){return this.getRef()}}class yt{constructor(t,e){this.database=t,this._delegate=e}on(t,e,i,o){var u;(0,p.Dv)("Query.on",2,4,arguments.length),(0,p.Wj)("Query.on","callback",e,!1);const c=yt.getCancelAndContextArgs_("Query.on",i,o),h=(v,P)=>{e.call(c.context,new gi(this.database,v),P)};h.userCallback=e,h.context=c.context;const g=null===(u=c.cancel)||void 0===u?void 0:u.bind(c.context);switch(t){case"value":return ul(this._delegate,h,g),e;case"child_added":return yl(this._delegate,h,g),e;case"child_removed":return Tl(this._delegate,h,g),e;case"child_changed":return Il(this._delegate,h,g),e;case"child_moved":return El(this._delegate,h,g),e;default:throw new Error((0,p.gK)("Query.on","eventType")+'must be a valid event type = "value", "child_added", "child_removed", "child_changed", or "child_moved".')}}off(t,e,i){if((0,p.Dv)("Query.off",0,3,arguments.length),function(n,t,e){if(void 0!==t)switch(t){case"value":case"child_added":case"child_removed":case"child_changed":case"child_moved":break;default:throw new Error((0,p.gK)("Query.off","eventType")+'must be a valid event type = "value", "child_added", "child_removed", "child_changed", or "child_moved".')}}(0,t),(0,p.Wj)("Query.off","callback",e,!0),(0,p.lb)("Query.off","context",i,!0),e){const o=()=>{};o.userCallback=e,o.context=i,Cl(this._delegate,t,o)}else Cl(this._delegate,t)}get(){return iu(this._delegate).then(t=>new gi(this.database,t))}once(t,e,i,o){(0,p.Dv)("Query.once",1,4,arguments.length),(0,p.Wj)("Query.once","callback",e,!0);const u=yt.getCancelAndContextArgs_("Query.once",i,o),c=new p.BH,h=(v,P)=>{const b=new gi(this.database,v);e&&e.call(u.context,b,P),c.resolve(b)};h.userCallback=e,h.context=u.context;const g=v=>{u.cancel&&u.cancel.call(u.context,v),c.reject(v)};switch(t){case"value":ul(this._delegate,h,g,{onlyOnce:!0});break;case"child_added":yl(this._delegate,h,g,{onlyOnce:!0});break;case"child_removed":Tl(this._delegate,h,g,{onlyOnce:!0});break;case"child_changed":Il(this._delegate,h,g,{onlyOnce:!0});break;case"child_moved":El(this._delegate,h,g,{onlyOnce:!0});break;default:throw new Error((0,p.gK)("Query.once","eventType")+'must be a valid event type = "value", "child_added", "child_removed", "child_changed", or "child_moved".')}return c.promise}limitToFirst(t){return(0,p.Dv)("Query.limitToFirst",1,1,arguments.length),new yt(this.database,pn(this._delegate,function du(n){if("number"!=typeof n||Math.floor(n)!==n||n<=0)throw new Error("limitToFirst: First argument must be a positive integer.");return new cu(n)}(t)))}limitToLast(t){return(0,p.Dv)("Query.limitToLast",1,1,arguments.length),new yt(this.database,pn(this._delegate,function fu(n){if("number"!=typeof n||Math.floor(n)!==n||n<=0)throw new Error("limitToLast: First argument must be a positive integer.");return new hu(n)}(t)))}orderByChild(t){return(0,p.Dv)("Query.orderByChild",1,1,arguments.length),new yt(this.database,pn(this._delegate,function _u(n){if("$key"===n)throw new Error('orderByChild: "$key" is invalid.  Use orderByKey() instead.');if("$priority"===n)throw new Error('orderByChild: "$priority" is invalid.  Use orderByPriority() instead.');if("$value"===n)throw new Error('orderByChild: "$value" is invalid.  Use orderByValue() instead.');return Gn("orderByChild","path",n,!1),new pu(n)}(t)))}orderByKey(){return(0,p.Dv)("Query.orderByKey",0,0,arguments.length),new yt(this.database,pn(this._delegate,function mu(){return new gu}()))}orderByPriority(){return(0,p.Dv)("Query.orderByPriority",0,0,arguments.length),new yt(this.database,pn(this._delegate,function yu(){return new vu}()))}orderByValue(){return(0,p.Dv)("Query.orderByValue",0,0,arguments.length),new yt(this.database,pn(this._delegate,function Eu(){return new Iu}()))}startAt(t=null,e){return(0,p.Dv)("Query.startAt",0,2,arguments.length),new yt(this.database,pn(this._delegate,function au(n=null,t){return Ji("startAt","key",t,!0),new Sl(n,t)}(t,e)))}startAfter(t=null,e){return(0,p.Dv)("Query.startAfter",0,2,arguments.length),new yt(this.database,pn(this._delegate,function uu(n,t){return Ji("startAfter","key",t,!0),new lu(n,t)}(t,e)))}endAt(t=null,e){return(0,p.Dv)("Query.endAt",0,2,arguments.length),new yt(this.database,pn(this._delegate,function ru(n,t){return Ji("endAt","key",t,!0),new Al(n,t)}(t,e)))}endBefore(t=null,e){return(0,p.Dv)("Query.endBefore",0,2,arguments.length),new yt(this.database,pn(this._delegate,function ou(n,t){return Ji("endBefore","key",t,!0),new su(n,t)}(t,e)))}equalTo(t,e){return(0,p.Dv)("Query.equalTo",1,2,arguments.length),new yt(this.database,pn(this._delegate,function Cu(n,t){return Ji("equalTo","key",t,!0),new Tu(n,t)}(t,e)))}toString(){return(0,p.Dv)("Query.toString",0,0,arguments.length),this._delegate.toString()}toJSON(){return(0,p.Dv)("Query.toJSON",0,1,arguments.length),this._delegate.toJSON()}isEqual(t){if((0,p.Dv)("Query.isEqual",1,1,arguments.length),!(t instanceof yt))throw new Error("Query.isEqual failed: First argument must be an instance of firebase.database.Query.");return this._delegate.isEqual(t._delegate)}static getCancelAndContextArgs_(t,e,i){const o={cancel:void 0,context:void 0};if(e&&i)o.cancel=e,(0,p.Wj)(t,"cancel",o.cancel,!0),o.context=i,(0,p.lb)(t,"context",o.context,!0);else if(e)if("object"==typeof e&&null!==e)o.context=e;else{if("function"!=typeof e)throw new Error((0,p.gK)(t,"cancelOrContext")+" must either be a cancel callback or a context object.");o.cancel=e}return o}get ref(){return new qt(this.database,new an(this._delegate._repo,this._delegate._path))}}class qt extends yt{constructor(t,e){super(t,new Vt(e._repo,e._path,new ii,!1)),this.database=t,this._delegate=e}getKey(){return(0,p.Dv)("Reference.key",0,0,arguments.length),this._delegate.key}child(t){return(0,p.Dv)("Reference.child",1,1,arguments.length),"number"==typeof t&&(t=String(t)),new qt(this.database,nr(this._delegate,t))}getParent(){(0,p.Dv)("Reference.parent",0,0,arguments.length);const t=this._delegate.parent;return t?new qt(this.database,t):null}getRoot(){return(0,p.Dv)("Reference.root",0,0,arguments.length),new qt(this.database,this._delegate.root)}set(t,e){(0,p.Dv)("Reference.set",1,2,arguments.length),(0,p.Wj)("Reference.set","onComplete",e,!0);const i=ll(this._delegate,t);return e&&i.then(()=>e(null),o=>e(o)),i}update(t,e){if((0,p.Dv)("Reference.update",1,2,arguments.length),Array.isArray(t)){const o={};for(let u=0;u<t.length;++u)o[""+u]=t[u];t=o,bl("Passing an Array to Firebase.update() is deprecated. Use set() if you want to overwrite the existing data, or an Object with integer keys if you really do want to only update some of the children.")}Nt("Reference.update",this._delegate._path),(0,p.Wj)("Reference.update","onComplete",e,!0);const i=nu(this._delegate,t);return e&&i.then(()=>e(null),o=>e(o)),i}setWithPriority(t,e,i){(0,p.Dv)("Reference.setWithPriority",2,3,arguments.length),(0,p.Wj)("Reference.setWithPriority","onComplete",i,!0);const o=function tu(n,t,e){if(Nt("setWithPriority",n._path),sn("setWithPriority",t,n._path,!1),qi("setWithPriority",e,!1),".length"===n.key||".keys"===n.key)throw"setWithPriority failed: "+n.key+" is a read-only object.";const i=new p.BH;return S(n._repo,n._path,t,e,i.wrapCallback(()=>{})),i.promise}(this._delegate,t,e);return i&&o.then(()=>i(null),u=>i(u)),o}remove(t){(0,p.Dv)("Reference.remove",0,1,arguments.length),(0,p.Wj)("Reference.remove","onComplete",t,!0);const e=function Xl(n){return Nt("remove",n._path),ll(n,null)}(this._delegate);return t&&e.then(()=>t(null),i=>t(i)),e}transaction(t,e,i){(0,p.Dv)("Reference.transaction",1,3,arguments.length),(0,p.Wj)("Reference.transaction","transactionUpdate",t,!1),(0,p.Wj)("Reference.transaction","onComplete",e,!0),function(n,t,e,i){if(void 0!==e&&"boolean"!=typeof e)throw new Error((0,p.gK)("Reference.transaction","applyLocally")+"must be a boolean.")}(0,0,i);const o=function Bu(n,t,e){var i;if(n=(0,p.m9)(n),Nt("Reference.transaction",n._path),".length"===n.key||".keys"===n.key)throw"Reference.transaction failed: "+n.key+" is a read-only object.";const o=null===(i=e?.applyLocally)||void 0===i||i,u=new p.BH,h=ul(n,()=>{});return function Ys(n,t,e,i,o,u){$n(n,"transaction on "+t);const c={path:t,update:e,onComplete:i,status:null,order:Ne(),applyLocally:u,retryCount:0,unwatcher:o,abortReason:null,currentWriteId:null,currentInputSnapshot:null,currentOutputSnapshotRaw:null,currentOutputSnapshotResolved:null},h=Gr(n,t,void 0);c.currentInputSnapshot=h;const g=c.update(h.val());if(void 0===g)c.unwatcher(),c.currentOutputSnapshotRaw=null,c.currentOutputSnapshotResolved=null,c.onComplete&&c.onComplete(null,!1,c.currentInputSnapshot);else{Qi("transaction failed: Data returned ",g,c.path),c.status=0;const v=ji(n.transactionQueueTree_,t),P=Hn(v)||[];let b;P.push(c),hi(v,P),"object"==typeof g&&null!==g&&(0,p.r3)(g,".priority")?(b=(0,p.DV)(g,".priority"),(0,p.hu)(fi(b),"Invalid priority returned by transaction. Priority must be a valid string, finite number, server value, or null.")):b=(ci(n.serverSyncTree_,t)||ne.EMPTY_NODE).getPriority().val();const L=Xi(n),Z=Fe(g,b),Q=zi(Z,h,L);c.currentOutputSnapshotRaw=Z,c.currentOutputSnapshotResolved=Q,c.currentWriteId=d(n);const Ie=Ls(n.serverSyncTree_,t,Q,c.currentWriteId,c.applyLocally);Rt(n.eventQueue_,t,Ie),er(n,n.transactionQueueTree_)}}(n._repo,n._path,t,(g,v,P)=>{let b=null;g?u.reject(g):(b=new tr(P,new an(n._repo,n._path),Ce),u.resolve(new Wu(v,b)))},h,o),u.promise}(this._delegate,t,{applyLocally:i}).then(u=>new zu(u.committed,new gi(this.database,u.snapshot)));return e&&o.then(u=>e(null,u.committed,u.snapshot),u=>e(u,!1,null)),o}setPriority(t,e){(0,p.Dv)("Reference.setPriority",1,2,arguments.length),(0,p.Wj)("Reference.setPriority","onComplete",e,!0);const i=function eu(n,t){n=(0,p.m9)(n),Nt("setPriority",n._path),qi("setPriority",t,!1);const e=new p.BH;return S(n._repo,Ge(n._path,".priority"),t,null,e.wrapCallback(()=>{})),e.promise}(this._delegate,t);return e&&i.then(()=>e(null),o=>e(o)),i}push(t,e){(0,p.Dv)("Reference.push",0,2,arguments.length),(0,p.Wj)("Reference.push","onComplete",e,!0);const i=function Jl(n,t){n=(0,p.m9)(n),Nt("push",n._path),sn("push",t,n._path,!0);const e=Qo(n._repo),i=ql(e),o=nr(n,i),u=nr(n,i);let c;return c=null!=t?ll(u,t).then(()=>u):Promise.resolve(u),o.then=c.then.bind(c),o.catch=c.then.bind(c,void 0),o}(this._delegate,t),o=i.then(c=>new qt(this.database,c));e&&o.then(()=>e(null),c=>e(c));const u=new qt(this.database,i);return u.then=o.then.bind(o),u.catch=o.catch.bind(o,void 0),u}onDisconnect(){return Nt("Reference.onDisconnect",this._delegate._path),new Ku(new gl(this._delegate._repo,this._delegate._path))}get key(){return this.getKey()}get parent(){return this.getParent()}get root(){return this.getRoot()}}class Xs{constructor(t,e){this._delegate=t,this.app=e,this.INTERNAL={delete:()=>this._delegate._delete(),forceWebSockets:bu,forceLongPolling:Nu}}useEmulator(t,e,i={}){!function Pl(n,t,e,i={}){(n=(0,p.m9)(n))._checkNotDeleted("useEmulator"),n._instanceStarted&&Ke("Cannot call useEmulator() after instance has already been initialized.");const o=n._repoInternal;let u;if(o.repoInfo_.nodeAdmin)i.mockUserToken&&Ke('mockUserToken is not supported by the Admin SDK. For client access with mock users, please use the "firebase" package instead of "firebase-admin".'),u=new bt(bt.OWNER);else if(i.mockUserToken){const c="string"==typeof i.mockUserToken?i.mockUserToken:(0,p.Sg)(i.mockUserToken,n.app.options.projectId);u=new bt(c)}!function Su(n,t,e,i){n.repoInfo_=new x(`${t}:${e}`,!1,n.repoInfo_.namespace,n.repoInfo_.webSocketOnly,n.repoInfo_.nodeAdmin,n.repoInfo_.persistenceKey,n.repoInfo_.includeNamespaceInQueryParams,!0),i&&(n.authTokenProvider_=i)}(o,t,e,u)}(this._delegate,t,e,i)}ref(t){if((0,p.Dv)("database.ref",0,1,arguments.length),t instanceof qt){const e=vl(this._delegate,t.toString());return new qt(this,e)}{const e=ml(this._delegate,t);return new qt(this,e)}}refFromURL(t){(0,p.Dv)("database.refFromURL",1,1,arguments.length);const i=vl(this._delegate,t);return new qt(this,i)}goOffline(){return(0,p.Dv)("database.goOffline",0,0,arguments.length),function Ou(n){(n=(0,p.m9)(n))._checkNotDeleted("goOffline"),zs(n._repo)}(this._delegate)}goOnline(){return(0,p.Dv)("database.goOnline",0,0,arguments.length),function Du(n){(n=(0,p.m9)(n))._checkNotDeleted("goOnline"),function js(n){n.persistentConnection_&&n.persistentConnection_.resume(jo)}(n._repo)}(this._delegate)}}Xs.ServerValue={TIMESTAMP:function Fu(){return Mu}(),increment:n=>function Uu(n){return{".sv":{increment:n}}}(n)};var Yu=Object.freeze({__proto__:null,initStandalone:function ju({app:n,url:t,version:e,customAuthImpl:i,namespace:o,nodeAdmin:u=!1}){ft(e);const c=new we.zt("auth-internal",new we.H0("database-standalone"));return c.setComponent(new we.wA("auth-internal",()=>i,"PRIVATE")),{instance:new Xs(Rl(n,c,void 0,t,u),n),namespace:o}}});const Qu=Xs.ServerValue;!function qu(n){n.INTERNAL.registerComponent(new we.wA("database-compat",(t,{instanceIdentifier:e})=>{const i=t.getProvider("app-compat").getImmediate(),o=t.getProvider("database").getImmediate({identifier:e});return new Xs(o,i)},"PUBLIC").setServiceProps({Reference:qt,Query:yt,Database:Xs,DataSnapshot:gi,enableLogging:xu,INTERNAL:Yu,ServerValue:Qu}).setMultipleInstances(!0)),n.registerVersion("@firebase/database-compat","0.3.4")}(F.Z);var mi=A(3385),Ju=A(6217);function Nl(n){return null==n}function Ol(n){return"function"==typeof n.set}function Dl(n,t){return Ol(t)?t:n.ref(t)}function xl(n,t){if(function Xu(n){return"string"==typeof n}(n))return t.stringCase();if(Ol(n))return t.firebaseCase();if(function ec(n){return"function"==typeof n.exportVal}(n))return t.snapshotCase();throw new Error("Expects a string, snapshot, or reference. Got: "+typeof n)}function eo(n,t,e="on",i=W.z){return new G.y(o=>{let u=null;return u=n[e](t,(c,h)=>{i.schedule(()=>{o.next({snapshot:c,prevKey:h})}),"once"===e&&i.schedule(()=>o.complete())},c=>{i.schedule(()=>o.error(c))}),"on"===e?{unsubscribe(){null!=u&&n.off(t,u)}}:{unsubscribe(){}}}).pipe((0,w.U)(o=>{const{snapshot:u,prevKey:c}=o;let h=null;return u.exists()&&(h=u.key),{type:t,payload:u,prevKey:c,key:h}}),(0,ae.B)())}function Ll(n,t){const e=n.length;for(let i=0;i<e;i++)if(n[i].payload.key===t)return i;return-1}function ic(n,t){const{payload:e,prevKey:i,key:o}=t,u=Ll(n,o),c=function nc(n,t){if(Nl(t))return 0;{const e=Ll(n,t);return-1===e?n.length:e+1}}(n,i);switch(t.type){case"value":if(t.payload&&t.payload.exists()){let h=null;t.payload.forEach(g=>{const v={payload:g,type:"value",prevKey:h,key:g.key};return h=g.key,n=[...n,v],!1})}return n;case"child_added":if(u>-1){const h=n[u-1];(h&&h.key||null)!==i&&(n=n.filter(g=>g.payload.key!==e.key)).splice(c,0,t)}else{if(null==i)return[t,...n];(n=n.slice()).splice(c,0,t)}return n;case"child_removed":return n.filter(h=>h.payload.key!==e.key);case"child_changed":return n.map(h=>h.payload.key===o?t:h);case"child_moved":if(u>-1){const h=n.splice(u,1)[0];return(n=n.slice()).splice(c,0,h),n}return n;default:return n}}function Ml(n){return(Nl(n)||0===n.length)&&(n=["child_added","child_removed","child_changed","child_moved"]),n}function Fl(n,t,e){return function tc(n,t,e){return eo(n,"value","once",e).pipe((0,J.w)(i=>{const o=[(0,me.of)(i)];return t.forEach(u=>o.push(eo(n,u,"on",e))),(0,ct.T)(...o).pipe((0,he.R)(ic,[]))}),(0,Ae.x)())}(n,t=Ml(t),e)}function Ul(n,t,e){const i=(t=Ml(t)).map(o=>eo(n,o,"on",e));return(0,ct.T)(...i)}function Wl(n,t){return function(i,o){return xl(i,{stringCase:()=>n.child(i)[t](o),firebaseCase:()=>i[t](o),snapshotCase:()=>i.ref[t](o)})}}function ac(n){return function(e){return e?xl(e,{stringCase:()=>n.child(e).remove(),firebaseCase:()=>e.remove(),snapshotCase:()=>e.ref.remove()}):n.remove()}}function Bl(n,t){return function(){return eo(n,"value","on",t)}}A(9260);const cc=new D.OlP("angularfire2.realtimeDatabaseURL"),dc=new D.OlP("angularfire2.database.use-emulator");let hc=(()=>{class n{constructor(e,i,o,u,c,h,g,v,P,b,L,Z,Q,Ie,ht){this.schedulers=h;const Cn=g,zn=(0,je.on)(e,c,i);v&&(0,mi.nw)(zn,c,P,L,Z,Q,b,Ie),this.database=(0,je.cc)(`${zn.name}.database.${o}`,"AngularFireDatabase",zn.name,()=>{const Kr=c.runOutsideAngular(()=>zn.database(o||void 0));return Cn&&Kr.useEmulator(...Cn),Kr},[Cn])}list(e,i){const o=this.schedulers.ngZone.runOutsideAngular(()=>Dl(this.database,e));let u=o;return i&&(u=i(o)),function lc(n,t){const e=t.schedulers.outsideAngular,i=t.schedulers.ngZone.run(()=>n.ref);return{query:n,update:Wl(i,"update"),set:Wl(i,"set"),push:o=>i.push(o),remove:ac(i),snapshotChanges:o=>Fl(n,o,e).pipe(Ve.iC),stateChanges:o=>Ul(n,o,e).pipe(Ve.iC),auditTrail:o=>function rc(n,t,e){return function oc(n,t,e){return function sc(n,t){return eo(n,"value","on",t).pipe((0,w.U)(e=>{let i;return e.payload.forEach(o=>(i=o.key,!1)),{data:e,lastKeyToLoad:i}}))}(n,e).pipe(function Se(...n){const t=(0,at.jO)(n);return(0,Te.e)((e,i)=>{const o=n.length,u=new Array(o);let c=n.map(()=>!1),h=!1;for(let g=0;g<o;g++)(0,_.Xf)(n[g]).subscribe((0,Le.x)(i,v=>{u[g]=v,!h&&!c[g]&&(c[g]=!0,(h=c.every(pe.y))&&(c=null))},ze.Z));e.subscribe((0,Le.x)(i,g=>{if(h){const v=[g,...u];i.next(t?t(...v):v)}}))})}(t),(0,w.U)(([o,u])=>{const c=o.lastKeyToLoad,h=u.map(g=>g.key);return{actions:u,lastKeyToLoad:c,loadedKeys:h}}),function ve(n){return(0,Te.e)((t,e)=>{let i=!1,o=0;t.subscribe((0,Le.x)(e,u=>(i||(i=!n(u,o++)))&&e.next(u)))})}(o=>-1===o.loadedKeys.indexOf(o.lastKeyToLoad)),(0,w.U)(o=>o.actions))}(n,Ul(n,t).pipe((0,he.R)((o,u)=>[...o,u],[])),e)}(n,o,e).pipe(Ve.iC),valueChanges:(o,u)=>Fl(n,o,e).pipe((0,w.U)(h=>h.map(g=>u&&u.idField?Object.assign(Object.assign({},g.payload.val()),{[u.idField]:g.key}):g.payload.val())),Ve.iC)}}(u,this)}object(e){return function uc(n,t){return{query:n,snapshotChanges:()=>Bl(n,t.schedulers.outsideAngular)().pipe(Ve.iC),update:e=>n.ref.update(e),set:e=>n.ref.set(e),remove:()=>n.ref.remove(),valueChanges:()=>Bl(n,t.schedulers.outsideAngular)().pipe(Ve.iC,(0,w.U)(i=>i.payload.exists()?i.payload.val():null))}}(this.schedulers.ngZone.runOutsideAngular(()=>Dl(this.database,e)),this)}createPushId(){return this.schedulers.ngZone.runOutsideAngular(()=>this.database.ref()).push().key}}return n.\u0275fac=function(e){return new(e||n)(D.LFG(je.Dh),D.LFG(je.xv,8),D.LFG(cc,8),D.LFG(D.Lbi),D.LFG(D.R0b),D.LFG(Ve.HU),D.LFG(dc,8),D.LFG(mi.zQ,8),D.LFG(mi.Qv,8),D.LFG(mi.L6,8),D.LFG(mi._Q,8),D.LFG(mi.rT,8),D.LFG(mi.lh,8),D.LFG(mi.f7,8),D.LFG(Ju.nm,8))},n.\u0275prov=D.Yz7({token:n,factory:n.\u0275fac,providedIn:"any"}),n})();const Vl="/AddNewStuff.json",Zl="/AddNewCourse.json",Hl="/AddNewFullCourse.json",Gl="/AddConfirmedCourse.json",$l="/Question.json",Kl="/doctorAnswer.json",zl="/AddBlogPost.json";let _c=(()=>{class n{constructor(e,i){this.apiService=e,this.firebase=i,this.dataSubject=new m.X(null)}addNewStuff(e){return this.apiService.post(Vl,e)}addNewCourse(e){return this.apiService.post(Zl,e)}addNewFullCourse(e){return this.apiService.post(Hl,e)}addBlogPost(e){return this.apiService.post(zl,e)}askQuestion(e){return this.apiService.post($l,e)}doctorAnswer(e){return this.apiService.post(Kl,e)}getBlogPost(){return this.apiService.get(zl).pipe((0,w.U)(e=>{if(e){const i=[];for(const o in e)i.push({...e[o],key:o});return i}return[]}),(0,C.d)())}getQuestions(){return this.apiService.get($l).pipe((0,w.U)(e=>{if(e){const i=[];for(const o in e)i.push({...e[o],key:o});return i}return[]}))}getStuffs(){return this.apiService.get(Vl).pipe((0,w.U)(e=>{if(e){const i=[];for(const o in e)i.push({...e[o],key:o});return i}return[]}))}getCourses(){return this.apiService.get(Zl).pipe((0,w.U)(e=>{if(e){const i=[];for(const o in e)i.push({...e[o],key:o});return i}return[]}))}getFullCourses(){return this.apiService.get(Hl).pipe((0,w.U)(e=>{if(e){const i=[];for(const o in e)i.push({...e[o],key:o});return i}return[]}))}confirmFullCourse(e){return this.apiService.post(Gl,e)}getMyConfirmedCourses(){return this.apiService.get(Gl).pipe((0,w.U)(e=>{if(e){const i=[];for(const o in e)i.push({...e[o],key:o});return i}return[]}))}getDoctorAnswers(){return this.apiService.get(Kl).pipe((0,w.U)(e=>{if(e){const i=[];for(const o in e)i.push({...e[o],key:o});return i}return[]}))}deleteStuff(e){return this.apiService.delete("/AddNewStuff/",e).pipe((0,J.w)(()=>this.getStuffs().pipe((0,w.U)(i=>(this.dataSubject.next(i),i)))))}deleteBlogPost(e){return this.apiService.delete("/AddBlogPost/",e).pipe((0,J.w)(()=>this.getBlogPost().pipe((0,w.U)(i=>(this.dataSubject.next(i),i)))))}insertStuff(e){this.stuffList.push(e)}getStuffList(){this.stuffList=this.firebase.list("stuff")}}return n.\u0275fac=function(e){return new(e||n)(D.LFG(ie.s),D.LFG(hc))},n.\u0275prov=D.Yz7({token:n,factory:n.\u0275fac,providedIn:"root"}),n})()},3034:(Zt,xe,A)=>{A.d(xe,{e:()=>ae});var m=A(5861),w=A(1135),C=A(9646),J=(()=>((J||(J={})).admin="l.dolidze11@gmail.com",J))(),ie=A(8332),W=A(4650),G=A(3385),me=A(567),ct=A(7009);let ae=(()=>{class he{constructor(Te,Le,_){this.firebaseAuth=Te,this.alert=Le,this._snackBar=_,this.isAdminEvent$=new w.X(null)}isAdminNew(){const Te=localStorage.getItem("user");if(Te){const Le=JSON.parse(Te);return!(!Le.emailVerified||"osQEYxPug4ZekILcy7XnIYZc1VD2"!==Le.uid)}return!1}isAdmin(Te){return Te===J.admin?(this.isAdminEvent$.next(!0),localStorage.setItem("admin","1"),(0,C.of)(!0)):(this.isAdminEvent$.next(!1),(0,C.of)(!1))}signUp(Te){var Le=this;return(0,m.Z)(function*(){yield Le.firebaseAuth.createUserWithEmailAndPassword(Te.email,Te.password).then(_=>{localStorage.setItem("user",JSON.stringify(_.user))})})()}signIn(Te,Le){var _=this;return(0,m.Z)(function*(){yield _.firebaseAuth.signInWithEmailAndPassword(Te,Le).then(pe=>{pe.user.emailVerified?localStorage.setItem("user",JSON.stringify(pe.user)):(_._snackBar.openFromComponent(ie.w,{duration:2e3,data:{message:"\u10d0\u10d5\u10e2\u10dd\u10e0\u10d8\u10d6\u10d0\u10ea\u10d8\u10d0 \u10d5\u10d4\u10e0 \u10db\u10dd\u10ee\u10d3\u10d0!",type:"error"}}),console.error("error"))})})()}logOut(){var Te=this;return(0,m.Z)(function*(){Te.firebaseAuth.signOut(),localStorage.clear()})()}}return he.\u0275fac=function(Te){return new(Te||he)(W.LFG(G.zQ),W.LFG(me.c),W.LFG(ct.ux))},he.\u0275prov=W.Yz7({token:he,factory:he.\u0275fac,providedIn:"root"}),he})()},3007:(Zt,xe,A)=>{A.d(xe,{D:()=>Te});var m=A(5861),w=A(4006),C=A(5412),J=A(4128),D=A(4650),ie=A(4617),W=A(3034),G=A(567),me=A(6159),ct=A(4859),ae=A(9549),he=A(4144),Ae=A(9383);let Te=(()=>{class Le{constructor(pe,ze,at,Se,ve,Ve,je){this.dialogRef=pe,this.data=ze,this.localStorageService=at,this.authService=Se,this.alert=ve,this.fb=Ve,this.router=je}ngOnInit(){this.initForm()}initForm(){this.form=this.fb.group({userName:new w.NI(null),password:new w.NI(null)})}onSubmit(){var pe=this;return(0,m.Z)(function*(){if(!pe.form.invalid){const ze=pe.form.value;yield pe.authService.signIn(ze.userName,ze.password).then(at=>{const Se=pe.form.get("userName")?.value;(0,J.D)({token:pe.localStorageService.getToken(),isAdmin:pe.authService.isAdmin(Se)}).subscribe(ve=>{pe.dialogRef.close(),pe.router.navigate([""])})})}})()}}return Le.\u0275fac=function(pe){return new(pe||Le)(D.Y36(C.so,8),D.Y36(C.WI),D.Y36(ie.n),D.Y36(W.e),D.Y36(G.c),D.Y36(w.qu),D.Y36(me.F0))},Le.\u0275cmp=D.Xpm({type:Le,selectors:[["app-log-in"]],decls:21,vars:19,consts:[[3,"formGroup","ngSubmit"],["appearance","outline"],["matInput","","formControlName","userName",3,"placeholder"],["matInput","","formControlName","password","type","password",3,"placeholder"],["type","submit","mat-raised-button","","color","primary"]],template:function(pe,ze){1&pe&&(D.TgZ(0,"form",0),D.NdJ("ngSubmit",function(){return ze.onSubmit()}),D.TgZ(1,"h4"),D._uU(2),D.ALo(3,"translate"),D.qZA(),D.TgZ(4,"div")(5,"mat-form-field",1)(6,"mat-label"),D._uU(7),D.ALo(8,"translate"),D.qZA(),D._UZ(9,"input",2),D.ALo(10,"translate"),D.qZA()(),D.TgZ(11,"div")(12,"mat-form-field",1)(13,"mat-label"),D._uU(14),D.ALo(15,"translate"),D.qZA(),D._UZ(16,"input",3),D.ALo(17,"translate"),D.qZA()(),D.TgZ(18,"button",4),D._uU(19),D.ALo(20,"translate"),D.qZA()()),2&pe&&(D.Q6J("formGroup",ze.form),D.xp6(2),D.Oqu(D.lcZ(3,7,"logIn")),D.xp6(5),D.Oqu(D.lcZ(8,9,"user")),D.xp6(2),D.s9C("placeholder",D.lcZ(10,11,"user")),D.xp6(5),D.Oqu(D.lcZ(15,13,"password")),D.xp6(2),D.s9C("placeholder",D.lcZ(17,15,"password")),D.xp6(3),D.Oqu(D.lcZ(20,17,"logIn")))},dependencies:[ct.lW,ae.KE,ae.hX,he.Nt,w._Y,w.Fj,w.JJ,w.JL,w.sg,w.u,Ae.X$],styles:["form[_ngcontent-%COMP%]{width:100%}form[_ngcontent-%COMP%]   h4[_ngcontent-%COMP%]{margin:0 0 10px;text-align:center}form[_ngcontent-%COMP%]   div[_ngcontent-%COMP%]{width:100%}form[_ngcontent-%COMP%]   div[_ngcontent-%COMP%]   mat-form-field[_ngcontent-%COMP%]{width:100%}form[_ngcontent-%COMP%]   button[_ngcontent-%COMP%]{width:100%}"]}),Le})()},567:(Zt,xe,A)=>{A.d(xe,{c:()=>D});var m=A(7579),w=(()=>{return(ie=w||(w={}))[ie.Success=0]="Success",ie[ie.Error=1]="Error",ie[ie.Info=2]="Info",ie[ie.Warning=3]="Warning",w;var ie})();class C{constructor(W){Object.assign(this,W)}}var J=A(4650);let D=(()=>{class ie{constructor(){this.defaultId="default-alert",this.subject=new m.x}success(G,me){this.alert(new C({...me,type:w.Success,message:G}))}error(G,me){this.alert(new C({...me,type:w.Error,message:G}))}info(G,me){this.alert(new C({...me,type:w.Info,message:G}))}warn(G,me){this.alert(new C({...me,type:w.Warning,message:G}))}alert(G){G.id=G.id||this.defaultId,G.autoClose=void 0===G.autoClose||G.autoClose,this.subject.next(G)}}return ie.\u0275fac=function(G){return new(G||ie)},ie.\u0275prov=J.Yz7({token:ie,factory:ie.\u0275fac,providedIn:"root"}),ie})()},4617:(Zt,xe,A)=>{A.d(xe,{n:()=>J});var m=A(1135),w=A(9646),C=A(4650);let J=(()=>{class D{constructor(){this.isTokenEvent$=new m.X(null)}get getTokenResult(){return this.isTokenEvent$.value}getToken(){let W=localStorage.getItem("user");if(W){let G=JSON.parse(W);return G.emailVerified?(this.isTokenEvent$.next(G),(0,w.of)(G)):(this.isTokenEvent$.next(!1),(0,w.of)(!1))}return this.isTokenEvent$.next(!1),(0,w.of)(!1)}getAdmin(){const W=localStorage.getItem("admin");return(0,w.of)(W||!1)}getStuffsDetails(W){const G=localStorage.getItem("stuff");if(G){const me=JSON.parse(G);return(0,w.of)(me.find(ct=>ct.key===W))}return null}}return D.\u0275fac=function(W){return new(W||D)},D.\u0275prov=C.Yz7({token:D,factory:D.\u0275fac,providedIn:"root"}),D})()},6102:(Zt,xe,A)=>{A.d(xe,{d:()=>G});var m=A(4004),w=A(4650),C=A(4761);const ie="/CourseOrder.json",W="/StuffOrder.json";let G=(()=>{class me{constructor(ae){this.apiService=ae}getStuffs(){return this.apiService.get("/AddNewStuff.json").pipe((0,m.U)(ae=>{if(ae){const he=[];for(const Ae in ae)he.push({...ae[Ae],key:Ae});return he}return[]}))}getCourses(){return this.apiService.get("/AddNewCourse.json").pipe((0,m.U)(ae=>{if(ae){const he=[];for(const Ae in ae)he.push({...ae[Ae],key:Ae});return he}return[]}))}buyCourse(ae){return this.apiService.post(ie,ae)}buyStuff(ae){return this.apiService.post(W,ae)}getOrderedCourse(){return this.apiService.get(ie).pipe((0,m.U)(ae=>{if(ae){const he=[];for(const Ae in ae)he.push({...ae[Ae],key:Ae});return he}return[]}))}getOrderedStuff(){return this.apiService.get(W).pipe((0,m.U)(ae=>{if(ae){const he=[];for(const Ae in ae)he.push({...ae[Ae],key:Ae});return he}return[]}))}}return me.\u0275fac=function(ae){return new(ae||me)(w.LFG(C.s))},me.\u0275prov=w.Yz7({token:me,factory:me.\u0275fac,providedIn:"root"}),me})()},8332:(Zt,xe,A)=>{A.d(xe,{w:()=>J});var m=A(7009),w=A(4650),C=A(6895);let J=(()=>{class D{constructor(W){this.data=W}ngOnInit(){this.message=this.data.message}alertMode(){return"error"===this.data.type?"error":"success"}}return D.\u0275fac=function(W){return new(W||D)(w.Y36(m.qD))},D.\u0275cmp=w.Xpm({type:D,selectors:[["app-alert"]],decls:2,vars:2,consts:[[3,"ngClass"]],template:function(W,G){1&W&&(w.TgZ(0,"div",0),w._uU(1),w.qZA()),2&W&&(w.Q6J("ngClass",G.alertMode()),w.xp6(1),w.hij(" ",G.message,"\n"))},dependencies:[C.mk],styles:[".success[_ngcontent-%COMP%]{color:#99eb99}.error[_ngcontent-%COMP%]{color:#e47a7a}"]}),D})()},2124:(Zt,xe,A)=>{A.d(xe,{$:()=>Jt});var m=A(727),w=A(4128),C=A(3151),J=A(9841),D=A(3007),ie=A(5861),W=A(4006),G=A(5412),me=A(8401);A(2090),A(9681),A(1877),A(3475);const Te_email=/^(([^<>()\[\]\\.,;:\s@"]+(\.[^<>()\[\]\\.,;:\s@"]+)*)|(".+"))@((\[[0-9]{1,3}\.[0-9]{1,3}\.[0-9]{1,3}\.[0-9]{1,3}])|(([a-zA-Z\-0-9]+\.)+[a-zA-Z]{2,}))$/;var Le=A(8332),_=A(4650),pe=A(3034),ze=A(6159),at=A(7009),Se=A(6895),ve=A(4859),Ve=A(9549),je=A(4144),lt=A(9383);function F(V,X){1&V&&(_.TgZ(0,"mat-error"),_._uU(1," \u10d5\u10d4\u10da\u10d8 \u10e1\u10d0\u10d5\u10d0\u10da\u10d3\u10d4\u10d1\u10e3\u10da\u10dd\u10d0 "),_.qZA())}function we(V,X){1&V&&(_.TgZ(0,"mat-error"),_._uU(1," \u10d0\u10e0\u10d0\u10e1\u10ec\u10dd\u10e0\u10d8 \u10e4\u10dd\u10e0\u10db\u10d0\u10e2\u10d8 "),_.qZA())}function Qe(V,X){if(1&V&&(_.ynx(0),_.YNc(1,F,2,0,"mat-error",3),_.YNc(2,we,2,0,"mat-error",3),_.BQk()),2&V){const N=_.oxw();_.xp6(1),_.Q6J("ngIf",null==N.form.get("email").errors?null:N.form.get("email").errors.required),_.xp6(1),_.Q6J("ngIf",null==N.form.get("email").errors?null:N.form.get("email").errors.pattern)}}function It(V,X){1&V&&(_.TgZ(0,"mat-error"),_._uU(1," \u10d5\u10d4\u10da\u10d8 \u10e1\u10d0\u10d5\u10d0\u10da\u10d3\u10d4\u10d1\u10e3\u10da\u10dd\u10d0 "),_.qZA())}function p(V,X){1&V&&(_.TgZ(0,"mat-error"),_._uU(1," \u10de\u10d0\u10e0\u10dd\u10da\u10d8\u10e1 \u10d0\u10e0\u10d0\u10e1\u10ec\u10dd\u10e0\u10d8 \u10e4\u10dd\u10e0\u10db\u10d0\u10e2\u10d8 "),_.qZA())}function Ot(V,X){if(1&V&&(_.ynx(0),_.YNc(1,It,2,0,"mat-error",3),_.YNc(2,p,2,0,"mat-error",3),_.BQk()),2&V){const N=_.oxw();let z;_.xp6(1),_.Q6J("ngIf",null==N.form.get("password").errors?null:N.form.get("password").errors.required),_.xp6(1),_.Q6J("ngIf",null==(z=N.form.get("password"))?null:z.hasError("minLength"))}}let be=(()=>{class V{constructor(N,z,fe,ke,et,Ee){this.dialogRef=N,this.data=z,this.authservice=fe,this.fb=ke,this.router=et,this._snackBar=Ee}ngOnInit(){this.initForm()}initForm(){this.form=this.fb.group({email:[null,[W.kI.required,W.kI.pattern(Te_email)]],password:[null,[W.kI.required,W.kI.minLength(6)]]})}onSignUp(){var N=this;return(0,ie.Z)(function*(){if(!N.form.invalid){const z=N.form.value;yield N.authservice.signUp(z),N.verifyEmail(),N.dialogRef.close(),N.router.navigate([""]),N._snackBar.openFromComponent(Le.w,{duration:5e3,data:{message:"\u10d7\u10e5\u10d5\u10d4\u10dc\u10e1 \u10db\u10d4\u10d8\u10da\u10d6\u10d4 \u10d2\u10d0\u10d2\u10d6\u10d0\u10d5\u10dc\u10d8\u10da\u10d8\u10d0 \u10d5\u10d4\u10e0\u10d8\u10e4\u10d8\u10d9\u10d0\u10ea\u10d8\u10d8\u10e1 \u10da\u10d8\u10dc\u10d9\u10d8, \u10d2\u10d7\u10ee\u10dd\u10d5\u10d7 \u10d2\u10d0\u10ee\u10dc\u10d0\u10d7 \u10d2\u10d0\u10db\u10dd\u10d2\u10d6\u10d0\u10d5\u10dc\u10d8\u10da\u10d8 \u10da\u10d8\u10dc\u10d9\u10d8!",type:"error"}})}})()}verifyEmail(){const N=(0,me.n)();N.currentUser&&(0,me.ab)(N.currentUser).then(()=>{setTimeout(()=>{},3e3)})}}return V.\u0275fac=function(N){return new(N||V)(_.Y36(G.so,8),_.Y36(G.WI),_.Y36(pe.e),_.Y36(W.qu),_.Y36(ze.F0),_.Y36(at.ux))},V.\u0275cmp=_.Xpm({type:V,selectors:[["app-sign-up"]],decls:23,vars:21,consts:[[3,"formGroup","ngSubmit"],["appearance","outline"],["matInput","","value","Sushi","formControlName","email",3,"placeholder"],[4,"ngIf"],["matInput","","formControlName","password","value","Sushi",3,"placeholder"],["type","submit","mat-raised-button","","color","primary"]],template:function(N,z){if(1&N&&(_.TgZ(0,"form",0),_.NdJ("ngSubmit",function(){return z.onSignUp()}),_.TgZ(1,"h4"),_._uU(2),_.ALo(3,"translate"),_.qZA(),_.TgZ(4,"div")(5,"mat-form-field",1)(6,"mat-label"),_._uU(7),_.ALo(8,"translate"),_.qZA(),_._UZ(9,"input",2),_.ALo(10,"translate"),_.qZA(),_.YNc(11,Qe,3,2,"ng-container",3),_.qZA(),_.TgZ(12,"div")(13,"mat-form-field",1)(14,"mat-label"),_._uU(15),_.ALo(16,"translate"),_.qZA(),_._UZ(17,"input",4),_.ALo(18,"translate"),_.qZA(),_.YNc(19,Ot,3,2,"ng-container",3),_.qZA(),_.TgZ(20,"button",5),_._uU(21),_.ALo(22,"translate"),_.qZA()()),2&N){let fe,ke;_.Q6J("formGroup",z.form),_.xp6(2),_.Oqu(_.lcZ(3,9,"signUp")),_.xp6(5),_.Oqu(_.lcZ(8,11,"email")),_.xp6(2),_.s9C("placeholder",_.lcZ(10,13,"email")),_.xp6(2),_.Q6J("ngIf",null==(fe=z.form.get("email"))?null:fe.dirty),_.xp6(4),_.Oqu(_.lcZ(16,15,"password")),_.xp6(2),_.s9C("placeholder",_.lcZ(18,17,"password")),_.xp6(2),_.Q6J("ngIf",null==(ke=z.form.get("password"))?null:ke.dirty),_.xp6(2),_.Oqu(_.lcZ(22,19,"signUp"))}},dependencies:[Se.O5,ve.lW,Ve.TO,Ve.KE,Ve.hX,je.Nt,W._Y,W.Fj,W.JJ,W.JL,W.sg,W.u,lt.X$],styles:["form[_ngcontent-%COMP%]{width:100%}form[_ngcontent-%COMP%]   h4[_ngcontent-%COMP%]{margin:0 0 10px;text-align:center}form[_ngcontent-%COMP%]   div[_ngcontent-%COMP%]{width:100%}form[_ngcontent-%COMP%]   div[_ngcontent-%COMP%]   mat-form-field[_ngcontent-%COMP%]{width:100%}form[_ngcontent-%COMP%]   button[_ngcontent-%COMP%]{width:100%}"]}),V})();var Ze=A(4617),Re=A(9646);let ft=(()=>{class V{constructor(N){this.authService=N}getAuthBtnMode(N,z,fe){if(z.emailVerified&&this.authService.isAdminNew())(N=[]).push({text:"logOut",type:"logOut",icon:"update",permission:"user"},{text:"admin",type:"admin",icon:"edit",permission:"admin"},{text:"",type:"userWorld",icon:"supervised_user_circle",isIcon:!0,permission:"user"});else{if(z.emailVerified&&!this.authService.isAdminNew())return(N=[]).push({text:"logOut",type:"logOut",icon:"update",permission:"user"},{text:"",type:"userWorld",icon:"supervised_user_circle",isIcon:!0,permission:"user"}),(0,Re.of)(N);if(!z.emailVerified)return(N=[]).push({text:"logIn",type:"logIn",icon:"update",permission:"user"},{text:"signUp",type:"signUp",icon:"update",permission:"user"}),(0,Re.of)(N)}return(0,Re.of)(N).pipe((0,C.d)())}getAdminBtns(N,z,fe){return z&&fe&&this.authService.isAdminNew()?(N=[]).push({text:"ordered_courses",type:"courses",icon:"update",link:"/admin/admin-courses",permission:"user"},{text:"ordered_pregnancy_stuff",type:"items",icon:"update",link:"/admin/admin-pregnancy",permission:"user"},{text:"customer_message",type:"message",icon:"update",link:"/admin/admin-message",permission:"user"},{text:"home",type:"home",icon:"update",link:"/admin/admin-home",permission:"user"},{text:"about",type:"about",icon:"update",link:"/admin/admin-about",permission:"user"},{text:"shop",type:"shop",icon:"update",link:"/admin/admin-shop",permission:"user"},{text:"blog",type:"blog",icon:"update",link:"/admin/admin-blog",permission:"user"},{text:"contact",type:"contact",icon:"update",link:"/admin/admin-contact",permission:"user"}):N=[],(0,Re.of)(N)}getMyWorldBtns(N,z,fe){return z.emailVerified&&!this.authService.isAdminNew()?(N=[]).push({text:"user_courses",type:"userWorld",icon:"update",link:"/my-courses",permission:"user"},{text:"user_communications",type:"userWorld",icon:"update",link:"/my-communication",permission:"user"}):N=[],(0,Re.of)(N)}}return V.\u0275fac=function(N){return new(N||V)(_.LFG(pe.e))},V.\u0275prov=_.Yz7({token:V,factory:V.\u0275fac,providedIn:"root"}),V})();var Dt=A(5531),nt=A(6102),Me=A(2894),Ye=A(7392),qe=A(2673),it=A(8255);function Ne(V,X){if(1&V&&(_.ynx(0),_.TgZ(1,"mat-icon"),_._uU(2),_.qZA(),_.BQk()),2&V){const N=_.oxw().$implicit;_.xp6(2),_.Oqu(N.icon)}}function ce(V,X){if(1&V&&_._UZ(0,"span",19),2&V){const N=_.oxw(2);_.Q6J("matBadge",N.generalNotification)}}function ye(V,X){if(1&V){const N=_.EpF();_.TgZ(0,"button",16),_.NdJ("click",function(){const ke=_.CHM(N).$implicit,et=_.oxw();return _.KtG(et.initAuthActions(ke.type))}),_.YNc(1,Ne,3,1,"ng-container",17),_.YNc(2,ce,1,1,"span",18),_._uU(3),_.ALo(4,"translate"),_.qZA()}if(2&V){const N=X.$implicit,z=_.oxw(),fe=_.MAs(30),ke=_.MAs(34);_.Q6J("matMenuTriggerFor","admin"===N.type?fe:"userWorld"===N.type?ke:null),_.xp6(1),_.Q6J("ngIf",N.isIcon),_.xp6(1),_.Q6J("ngIf","admin"===N.type&&z.generalNotification),_.xp6(1),_.hij(" ",_.lcZ(4,4,N.text)," ")}}function Xe(V,X){if(1&V&&_._UZ(0,"span",19),2&V){const N=_.oxw(2);_.Q6J("matBadge",null==N.orderedCourses?null:N.orderedCourses.length)}}function pt(V,X){if(1&V&&_._UZ(0,"span",19),2&V){const N=_.oxw(2);_.Q6J("matBadge",null==N.orderedItems?null:N.orderedItems.length)}}function rt(V,X){if(1&V&&_._UZ(0,"span",19),2&V){const N=_.oxw(2);_.Q6J("matBadge",null==N.contact?null:N.contact.length)}}function oe(V,X){if(1&V&&(_.TgZ(0,"button",20)(1,"span"),_._uU(2),_.YNc(3,Xe,1,1,"span",18),_.YNc(4,pt,1,1,"span",18),_.YNc(5,rt,1,1,"span",18),_.qZA(),_._uU(6),_.ALo(7,"translate"),_.qZA()),2&V){const N=X.$implicit,z=_.oxw();_.Q6J("routerLink",N.link),_.xp6(2),_.hij(" ",N.courses," "),_.xp6(1),_.Q6J("ngIf",(null==z.orderedCourses?null:z.orderedCourses.length)&&"courses"===N.type),_.xp6(1),_.Q6J("ngIf",(null==z.orderedItems?null:z.orderedItems.length)&&"items"===N.type),_.xp6(1),_.Q6J("ngIf",(null==z.contact?null:z.contact.length)&&"contact"===N.type),_.xp6(1),_.hij(" ",_.lcZ(7,6,N.text)," ")}}function st(V,X){if(1&V&&(_.TgZ(0,"button",20),_._uU(1),_.ALo(2,"translate"),_.qZA()),2&V){const N=X.$implicit;_.Q6J("routerLink",N.link),_.xp6(1),_.hij(" ",_.lcZ(2,2,N.text)," ")}}const _t=function(){return["/lending"]},Ke=function(){return["/courses"]},ee=function(){return["/shop"]},ot=function(){return["/blog"]},We=function(){return["/contact"]};let Jt=(()=>{class V{constructor(N,z,fe,ke,et,Ee,kt,ln,He,Et){this.route=N,this.router=z,this.dialog=fe,this.localStorageService=ke,this.translate=et,this.authService=Ee,this.autBtnService=kt,this.languageService=ln,this.shopService=He,this.adminHttp=Et,this.prise=15,this.subscriobtion$=new m.w0,this.authActions=[],this.adminBtns=[],this.userWorldBtns=[],this.pageName=this.route.snapshot.data.pageName,this.localStorageService.getToken().subscribe(An=>{this.authBtnInit(An)})}ngOnInit(){this.languageService.setLanguage(),this.selectedLang=this.languageService.defaultLang,this.returnNotifications()}returnNotifications(){this.observable$=(0,w.D)({orderedCourses:this.shopService.getOrderedCourse(),orderedItems:this.shopService.getOrderedStuff(),contact:this.adminHttp.getQuestions()}).pipe((0,C.d)()),this.subscriobtion$=this.observable$.subscribe(N=>{console.log(N),this.orderedCourses=N.orderedCourses,this.orderedItems=N.orderedItems,this.contact=N.contact,this.commonNotifications(N)})}commonNotifications(N){let z=[],fe=[N.orderedCourses,N.orderedItems,N.contact];for(const ke of fe){for(const et of ke)z.push(et);this.generalNotification=z?.length}}ngOnDestroy(){this.subscriobtion$.unsubscribe()}authBtnInit(N){(0,J.a)({token:this.localStorageService.isTokenEvent$,admin:this.authService.isAdminEvent$}).subscribe(z=>{this.autBtnService.getAuthBtnMode(this.authActions,z.token,N||z.admin).subscribe(fe=>{this.authActions=fe}),this.autBtnService.getAdminBtns(this.adminBtns,z.token,N||z.admin).subscribe(fe=>{this.adminBtns=fe}),this.autBtnService.getMyWorldBtns(this.adminBtns,z.token,N||z.admin).subscribe(fe=>{this.userWorldBtns=fe})})}changeLang(N){localStorage.setItem("lang",N.value),this.translate.use(N.value)}initAuthActions(N){if("logOut"===N)return this.authService.logOut(),void this.localStorageService.getToken().subscribe(ke=>{});this.dialog.open({logIn:{component:D.D,width:"500px"},signUp:{component:be,width:"500px"}}[N].component,{width:"500px",panelClass:"border-16"})}}return V.\u0275fac=function(N){return new(N||V)(_.Y36(ze.gz),_.Y36(ze.F0),_.Y36(G.uw),_.Y36(Ze.n),_.Y36(lt.sK),_.Y36(pe.e),_.Y36(ft),_.Y36(Dt.T),_.Y36(nt.d),_.Y36(Me.r))},V.\u0275cmp=_.Xpm({type:V,selectors:[["app-layout"]],decls:41,vars:35,consts:[[1,"navbar-content"],[1,"navbar-inner"],[1,"navbar-title"],[1,"navbar-navigation"],[1,"navigation-inner"],["mat-button","",3,"routerLink"],[3,"ngModel","change","ngModelChange"],["value","ka",3,"selected"],["value","en",3,"selected"],["mat-button","",3,"matMenuTriggerFor","click",4,"ngFor","ngForOf"],["adminMenu","matMenu"],[1,"admin-menu"],["mat-menu-item","",3,"routerLink",4,"ngFor","ngForOf"],["userWorldMenu","matMenu"],[1,"page-name"],[1,"page-container"],["mat-button","",3,"matMenuTriggerFor","click"],[4,"ngIf"],["matBadgeColor","warn",3,"matBadge",4,"ngIf"],["matBadgeColor","warn",3,"matBadge"],["mat-menu-item","",3,"routerLink"]],template:function(N,z){1&N&&(_.TgZ(0,"div",0)(1,"div",1)(2,"div",2),_._uU(3),_.ALo(4,"translate"),_.qZA(),_.TgZ(5,"div",3)(6,"div",4)(7,"button",5),_._uU(8),_.ALo(9,"translate"),_.qZA(),_.TgZ(10,"button",5),_._uU(11),_.ALo(12,"translate"),_.qZA(),_.TgZ(13,"button",5),_._uU(14),_.ALo(15,"translate"),_.qZA(),_.TgZ(16,"button",5),_._uU(17),_.ALo(18,"translate"),_.qZA(),_.TgZ(19,"button",5),_._uU(20),_.ALo(21,"translate"),_.qZA(),_.TgZ(22,"span")(23,"select",6),_.NdJ("change",function(ke){return z.changeLang(ke.target)})("ngModelChange",function(ke){return z.selectedLang=ke}),_.TgZ(24,"option",7),_._uU(25,"KA"),_.qZA(),_.TgZ(26,"option",8),_._uU(27," ENG"),_.qZA()(),_.YNc(28,ye,5,6,"button",9),_.TgZ(29,"mat-menu",null,10)(31,"div",11),_.YNc(32,oe,8,8,"button",12),_.qZA()(),_.TgZ(33,"mat-menu",null,13)(35,"div",11),_.YNc(36,st,3,4,"button",12),_.qZA()()()()()(),_.TgZ(37,"div",14),_._uU(38),_.qZA(),_.TgZ(39,"div",15),_._UZ(40,"router-outlet"),_.qZA()()),2&N&&(_.xp6(3),_.hij(" ",_.lcZ(4,18,"headerTitle")," "),_.xp6(4),_.Q6J("routerLink",_.DdM(30,_t)),_.xp6(1),_.hij(" ",_.lcZ(9,20,"home"),""),_.xp6(2),_.Q6J("routerLink",_.DdM(31,Ke)),_.xp6(1),_.Oqu(_.lcZ(12,22,"courses")),_.xp6(2),_.Q6J("routerLink",_.DdM(32,ee)),_.xp6(1),_.Oqu(_.lcZ(15,24,"shop")),_.xp6(2),_.Q6J("routerLink",_.DdM(33,ot)),_.xp6(1),_.Oqu(_.lcZ(18,26,"blog")),_.xp6(2),_.Q6J("routerLink",_.DdM(34,We)),_.xp6(1),_.Oqu(_.lcZ(21,28,"contact")),_.xp6(3),_.Q6J("ngModel",z.selectedLang),_.xp6(1),_.Q6J("selected","ka"==z.lang),_.xp6(2),_.Q6J("selected","en"==z.lang),_.xp6(2),_.Q6J("ngForOf",z.authActions),_.xp6(4),_.Q6J("ngForOf",z.adminBtns),_.xp6(4),_.Q6J("ngForOf",z.userWorldBtns),_.xp6(2),_.hij(" ",z.pageName," > "))},dependencies:[Se.sg,Se.O5,ze.lC,ze.rH,W.YN,W.Kr,W.EJ,W.JJ,W.On,Ye.Hw,ve.lW,qe.k,it.VK,it.OP,it.p6,lt.X$],styles:[".navbar-content[_ngcontent-%COMP%]{height:100%;position:relative}.navbar-content[_ngcontent-%COMP%]   .page-name[_ngcontent-%COMP%]{padding:20px}.navbar-content[_ngcontent-%COMP%]   .page-container[_ngcontent-%COMP%]{width:90%;margin:0 auto}.navbar-content[_ngcontent-%COMP%]   .footer[_ngcontent-%COMP%]{position:fixed;left:0;bottom:0;width:100%;height:200px;background-color:#fff;padding:20px;border:1px solid rgb(194,228,246)}.navbar-title[_ngcontent-%COMP%]{background-color:#c2e4f6;color:#000;text-align:center;width:100%;padding:10px 0}.navbar-navigation[_ngcontent-%COMP%]{display:flex;justify-content:center;width:100%}.navbar-navigation[_ngcontent-%COMP%]   .navigation-inner[_ngcontent-%COMP%]{padding:20px;background-color:#fff;width:100%}.navbar-navigation[_ngcontent-%COMP%]   .navigation-inner[_ngcontent-%COMP%]   span[_ngcontent-%COMP%]{float:right}.navbar-navigation[_ngcontent-%COMP%]   .navigation-inner[_ngcontent-%COMP%]   button[_ngcontent-%COMP%]{margin-right:16px}"]}),V})()},4761:(Zt,xe,A)=>{A.d(xe,{s:()=>J});var m=A(529),w=A(2340),C=A(4650);let J=(()=>{class D{constructor(W){this.http=W}get(W){let G=new m.LE;return this.http.get(`${w.N.apiUrl}${W}`,{params:G})}post(W,G){return this.http.post(`${w.N.apiUrl}${W}`,G)}put(W,G){return this.http.put(`${w.N.apiUrl}${W}`,G)}delete(W,G){return this.http.delete(`${w.N.apiUrl}${W}/${G}.json`)}}return D.\u0275fac=function(W){return new(W||D)(C.LFG(m.eN))},D.\u0275prov=C.Yz7({token:D,factory:D.\u0275fac,providedIn:"root"}),D})()},5531:(Zt,xe,A)=>{A.d(xe,{T:()=>J});var m=A(1135),w=A(4650),C=A(9383);let J=(()=>{class D{constructor(W){this.translate=W,this.language=new m.X("")}get defaultLang(){return this.language.value}setLanguage(){const W=localStorage.getItem("lang");return W?(this.translate.use(W),this.language.next(W)):(this.translate.setDefaultLang("ka"),this.language.next("ka"))}}return D.\u0275fac=function(W){return new(W||D)(w.LFG(C.sK))},D.\u0275prov=w.Yz7({token:D,factory:D.\u0275fac,providedIn:"root"}),D})()},9568:(Zt,xe,A)=>{A.r(xe);var m=A(5861),w=A(3942),C=A(8401),J=A(2090),W=(A(9681),A(1877),A(3475));function G(){return window}const me=2e3;function ae(){return ae=(0,m.Z)(function*(k,E,y){var x;const{BuildInfo:B}=G();(0,C.ap)(E.sessionId,"AuthEvent did not contain a session ID");const te=yield function ze(k){return at.apply(this,arguments)}(E.sessionId),de={};return(0,C.aq)()?de.ibi=B.packageName:(0,C.ar)()?de.apn=B.packageName:(0,C.as)(k,"operation-not-supported-in-this-environment"),B.displayName&&(de.appDisplayName=B.displayName),de.sessionId=te,(0,C.at)(k,y,E.type,void 0,null!==(x=E.eventId)&&void 0!==x?x:void 0,de)}),ae.apply(this,arguments)}function Ae(){return(Ae=(0,m.Z)(function*(k){const{BuildInfo:E}=G(),y={};(0,C.aq)()?y.iosBundleId=E.packageName:(0,C.ar)()?y.androidPackageName=E.packageName:(0,C.as)(k,"operation-not-supported-in-this-environment"),yield(0,C.au)(k,y)})).apply(this,arguments)}function _(){return(_=(0,m.Z)(function*(k,E,y){const{cordova:x}=G();let B=()=>{};try{yield new Promise((te,de)=>{let _e=null;function Oe(){var ue;te();const mt=null===(ue=x.plugins.browsertab)||void 0===ue?void 0:ue.close;"function"==typeof mt&&mt(),"function"==typeof y?.close&&y.close()}function ut(){_e||(_e=window.setTimeout(()=>{de((0,C.aw)(k,"redirect-cancelled-by-user"))},me))}function At(){"visible"===document?.visibilityState&&ut()}E.addPassiveListener(Oe),document.addEventListener("resume",ut,!1),(0,C.ar)()&&document.addEventListener("visibilitychange",At,!1),B=()=>{E.removePassiveListener(Oe),document.removeEventListener("resume",ut,!1),document.removeEventListener("visibilitychange",At,!1),_e&&window.clearTimeout(_e)}})}finally{B()}})).apply(this,arguments)}function at(){return(at=(0,m.Z)(function*(k){const E=function Se(k){if((0,C.ap)(/[0-9a-zA-Z]+/.test(k),"Can only convert alpha-numeric strings"),typeof TextEncoder<"u")return(new TextEncoder).encode(k);const E=new ArrayBuffer(k.length),y=new Uint8Array(E);for(let x=0;x<k.length;x++)y[x]=k.charCodeAt(x);return y}(k),y=yield crypto.subtle.digest("SHA-256",E);return Array.from(new Uint8Array(y)).map(B=>B.toString(16).padStart(2,"0")).join("")})).apply(this,arguments)}const ve=20;class Ve extends C.ay{constructor(){super(...arguments),this.passiveListeners=new Set,this.initPromise=new Promise(E=>{this.resolveInialized=E})}addPassiveListener(E){this.passiveListeners.add(E)}removePassiveListener(E){this.passiveListeners.delete(E)}resetRedirect(){this.queuedRedirectEvent=null,this.hasHandledPotentialRedirect=!1}onEvent(E){return this.resolveInialized(),this.passiveListeners.forEach(y=>y(E)),super.onEvent(E)}initialized(){var E=this;return(0,m.Z)(function*(){yield E.initPromise})()}}function F(k){return we.apply(this,arguments)}function we(){return(we=(0,m.Z)(function*(k){const E=yield p()._get(Ot(k));return E&&(yield p()._remove(Ot(k))),E})).apply(this,arguments)}function It(){const k=[],E="1234567890abcdefghijklmnopqrstuvwxyzABCDEFGHIJKLMNOPQRSTUVWXYZ";for(let y=0;y<ve;y++){const x=Math.floor(Math.random()*E.length);k.push(E.charAt(x))}return k.join("")}function p(){return(0,C.az)(C.b)}function Ot(k){return(0,C.aA)("authEvent",k.config.apiKey,k.name)}function Re(k){if(!k?.includes("?"))return{};const[E,...y]=k.split("?");return(0,J.zd)(y.join("?"))}const nt=class Dt{constructor(){this._redirectPersistence=C.a,this._shouldInitProactively=!0,this.eventManagers=new Map,this.originValidationPromises={},this._completeRedirectFn=C.aB,this._overrideRedirectResult=C.aC}_initialize(E){var y=this;return(0,m.Z)(function*(){const x=E._key();let B=y.eventManagers.get(x);return B||(B=new Ve(E),y.eventManagers.set(x,B),y.attachCallbackListeners(E,B)),B})()}_openPopup(E){(0,C.as)(E,"operation-not-supported-in-this-environment")}_openRedirect(E,y,x,B){var te=this;return(0,m.Z)(function*(){!function pe(k){var E,y,x,B,te,de,_e,Oe,ut,At;const ue=G();(0,C.ax)("function"==typeof(null===(E=ue?.universalLinks)||void 0===E?void 0:E.subscribe),k,"invalid-cordova-configuration",{missingPlugin:"cordova-universal-links-plugin-fix"}),(0,C.ax)(typeof(null===(y=ue?.BuildInfo)||void 0===y?void 0:y.packageName)<"u",k,"invalid-cordova-configuration",{missingPlugin:"cordova-plugin-buildInfo"}),(0,C.ax)("function"==typeof(null===(te=null===(B=null===(x=ue?.cordova)||void 0===x?void 0:x.plugins)||void 0===B?void 0:B.browsertab)||void 0===te?void 0:te.openUrl),k,"invalid-cordova-configuration",{missingPlugin:"cordova-plugin-browsertab"}),(0,C.ax)("function"==typeof(null===(Oe=null===(_e=null===(de=ue?.cordova)||void 0===de?void 0:de.plugins)||void 0===_e?void 0:_e.browsertab)||void 0===Oe?void 0:Oe.isAvailable),k,"invalid-cordova-configuration",{missingPlugin:"cordova-plugin-browsertab"}),(0,C.ax)("function"==typeof(null===(At=null===(ut=ue?.cordova)||void 0===ut?void 0:ut.InAppBrowser)||void 0===At?void 0:At.open),k,"invalid-cordova-configuration",{missingPlugin:"cordova-plugin-inappbrowser"})}(E);const de=yield te._initialize(E);yield de.initialized(),de.resetRedirect(),(0,C.aD)(),yield te._originValidation(E);const _e=function je(k,E,y=null){return{type:E,eventId:y,urlResponse:null,sessionId:It(),postBody:null,tenantId:k.tenantId,error:(0,C.aw)(k,"no-auth-event")}}(E,x,B);yield function lt(k,E){return p()._set(Ot(k),E)}(E,_e);const Oe=yield function ct(k,E,y){return ae.apply(this,arguments)}(E,_e,y),ut=yield function Te(k){const{cordova:E}=G();return new Promise(y=>{E.plugins.browsertab.isAvailable(x=>{let B=null;x?E.plugins.browsertab.openUrl(k):B=E.InAppBrowser.open(k,(0,C.av)()?"_blank":"_system","location=yes"),y(B)})})}(Oe);return function Le(k,E,y){return _.apply(this,arguments)}(E,de,ut)})()}_isIframeWebStorageSupported(E,y){throw new Error("Method not implemented.")}_originValidation(E){const y=E._key();return this.originValidationPromises[y]||(this.originValidationPromises[y]=function he(k){return Ae.apply(this,arguments)}(E)),this.originValidationPromises[y]}attachCallbackListeners(E,y){const{universalLinks:x,handleOpenURL:B,BuildInfo:te}=G(),de=setTimeout((0,m.Z)(function*(){yield F(E),y.onEvent(Me())}),500),_e=function(){var At=(0,m.Z)(function*(ue){clearTimeout(de);const mt=yield F(E);let kn=null;mt&&ue?.url&&(kn=function Qe(k,E){var y,x;const B=function Ze(k){const E=Re(k),y=E.link?decodeURIComponent(E.link):void 0,x=Re(y).link,B=E.deep_link_id?decodeURIComponent(E.deep_link_id):void 0;return Re(B).link||B||x||y||k}(E);if(B.includes("/__/auth/callback")){const te=Re(B),de=te.firebaseError?function be(k){try{return JSON.parse(k)}catch{return null}}(decodeURIComponent(te.firebaseError)):null,_e=null===(x=null===(y=de?.code)||void 0===y?void 0:y.split("auth/"))||void 0===x?void 0:x[1],Oe=_e?(0,C.aw)(_e):null;return Oe?{type:k.type,eventId:k.eventId,tenantId:k.tenantId,error:Oe,urlResponse:null,sessionId:null,postBody:null}:{type:k.type,eventId:k.eventId,tenantId:k.tenantId,sessionId:k.sessionId,urlResponse:B,postBody:null}}return null}(mt,ue.url)),y.onEvent(kn||Me())});return function(mt){return At.apply(this,arguments)}}();typeof x<"u"&&"function"==typeof x.subscribe&&x.subscribe(null,_e);const Oe=B,ut=`${te.packageName.toLowerCase()}://`;G().handleOpenURL=function(){var At=(0,m.Z)(function*(ue){if(ue.toLowerCase().startsWith(ut)&&_e({url:ue}),"function"==typeof Oe)try{Oe(ue)}catch(mt){console.error(mt)}});return function(ue){return At.apply(this,arguments)}}()}};function Me(){return{type:"unknown",eventId:null,sessionId:null,urlResponse:null,postBody:null,tenantId:null,error:(0,C.aw)("no-auth-event")}}const Ne=1e3;function ce(){var k;return(null===(k=self?.location)||void 0===k?void 0:k.protocol)||null}function Xe(k=(0,J.z$)()){return!("file:"!==ce()&&"ionic:"!==ce()&&"capacitor:"!==ce()||!k.toLowerCase().match(/iphone|ipad|ipod|android/))}function _t(){try{const k=self.localStorage,E=C.aI();if(k)return k.setItem(E,"1"),k.removeItem(E),!function st(k=(0,J.z$)()){return function rt(){return(0,J.w1)()&&11===document?.documentMode}()||function oe(k=(0,J.z$)()){return/Edge\/\d+/.test(k)}(k)}()||(0,J.hl)()}catch{return Ke()&&(0,J.hl)()}return!1}function Ke(){return typeof global<"u"&&"WorkerGlobalScope"in global&&"importScripts"in global}function ee(){return(function ye(){return"http:"===ce()||"https:"===ce()}()||(0,J.ru)()||Xe())&&!function pt(){return(0,J.b$)()||(0,J.UG)()}()&&_t()&&!Ke()}function ot(){return Xe()&&typeof document<"u"}function Jt(){return(Jt=(0,m.Z)(function*(){return!!ot()&&new Promise(k=>{const E=setTimeout(()=>{k(!1)},Ne);document.addEventListener("deviceready",()=>{clearTimeout(E),k(!0)})})})).apply(this,arguments)}const X={LOCAL:"local",NONE:"none",SESSION:"session"},N=C.ax,z="persistence";function ke(k){return et.apply(this,arguments)}function et(){return(et=(0,m.Z)(function*(k){yield k._initializationPromise;const E=kt(),y=C.aA(z,k.config.apiKey,k.name);E&&E.setItem(y,k._getPersistence())})).apply(this,arguments)}function kt(){var k;try{return(null===(k=function V(){return typeof window<"u"?window:null}())||void 0===k?void 0:k.sessionStorage)||null}catch{return null}}const ln=C.ax;class He{constructor(){this.browserResolver=C.az(C.k),this.cordovaResolver=C.az(nt),this.underlyingResolver=null,this._redirectPersistence=C.a,this._completeRedirectFn=C.aB,this._overrideRedirectResult=C.aC}_initialize(E){var y=this;return(0,m.Z)(function*(){return yield y.selectUnderlyingResolver(),y.assertedUnderlyingResolver._initialize(E)})()}_openPopup(E,y,x,B){var te=this;return(0,m.Z)(function*(){return yield te.selectUnderlyingResolver(),te.assertedUnderlyingResolver._openPopup(E,y,x,B)})()}_openRedirect(E,y,x,B){var te=this;return(0,m.Z)(function*(){return yield te.selectUnderlyingResolver(),te.assertedUnderlyingResolver._openRedirect(E,y,x,B)})()}_isIframeWebStorageSupported(E,y){this.assertedUnderlyingResolver._isIframeWebStorageSupported(E,y)}_originValidation(E){return this.assertedUnderlyingResolver._originValidation(E)}get _shouldInitProactively(){return ot()||this.browserResolver._shouldInitProactively}get assertedUnderlyingResolver(){return ln(this.underlyingResolver,"internal-error"),this.underlyingResolver}selectUnderlyingResolver(){var E=this;return(0,m.Z)(function*(){if(E.underlyingResolver)return;const y=yield function We(){return Jt.apply(this,arguments)}();E.underlyingResolver=y?E.cordovaResolver:E.browserResolver})()}}function Et(k){return k.unwrap()}function Sn(k){return Ht(k)}function Ht(k){const{_tokenResponse:E}=k instanceof J.ZR?k.customData:k;if(!E)return null;if(!(k instanceof J.ZR)&&"temporaryProof"in E&&"phoneNumber"in E)return C.P.credentialFromResult(k);const y=E.providerId;if(!y||y===C.o.PASSWORD)return null;let x;switch(y){case C.o.GOOGLE:x=C.Q;break;case C.o.FACEBOOK:x=C.N;break;case C.o.GITHUB:x=C.T;break;case C.o.TWITTER:x=C.W;break;default:const{oauthIdToken:B,oauthAccessToken:te,oauthTokenSecret:de,pendingToken:_e,nonce:Oe}=E;return te||de||B||_e?_e?y.startsWith("saml.")?C.aL._create(y,_e):C.J._fromParams({providerId:y,signInMethod:y,pendingToken:_e,idToken:B,accessToken:te}):new C.U(y).credential({idToken:B,accessToken:te,rawNonce:Oe}):null}return k instanceof J.ZR?x.credentialFromError(k):x.credentialFromResult(k)}function Pe(k,E){return E.catch(y=>{throw y instanceof J.ZR&&function _n(k,E){var y;const x=null===(y=E.customData)||void 0===y?void 0:y._tokenResponse;if("auth/multi-factor-auth-required"===E?.code)E.resolver=new wn(k,C.an(k,E));else if(x){const B=Ht(E),te=E;B&&(te.credential=B,te.tenantId=x.tenantId||void 0,te.email=x.email||void 0,te.phoneNumber=x.phoneNumber||void 0)}}(k,y),y}).then(y=>{const B=y.user;return{operationType:y.operationType,credential:Sn(y),additionalUserInfo:C.al(y),user:Pt.getOrCreate(B)}})}function gn(k,E){return Tt.apply(this,arguments)}function Tt(){return(Tt=(0,m.Z)(function*(k,E){const y=yield E;return{verificationId:y.verificationId,confirm:x=>Pe(k,y.confirm(x))}})).apply(this,arguments)}class wn{constructor(E,y){this.resolver=y,this.auth=function An(k){return k.wrapped()}(E)}get session(){return this.resolver.session}get hints(){return this.resolver.hints}resolveSignIn(E){return Pe(Et(this.auth),this.resolver.resolveSignIn(E))}}class Pt{constructor(E){this._delegate=E,this.multiFactor=C.ao(E)}static getOrCreate(E){return Pt.USER_MAP.has(E)||Pt.USER_MAP.set(E,new Pt(E)),Pt.USER_MAP.get(E)}delete(){return this._delegate.delete()}reload(){return this._delegate.reload()}toJSON(){return this._delegate.toJSON()}getIdTokenResult(E){return this._delegate.getIdTokenResult(E)}getIdToken(E){return this._delegate.getIdToken(E)}linkAndRetrieveDataWithCredential(E){return this.linkWithCredential(E)}linkWithCredential(E){var y=this;return(0,m.Z)(function*(){return Pe(y.auth,C.Z(y._delegate,E))})()}linkWithPhoneNumber(E,y){var x=this;return(0,m.Z)(function*(){return gn(x.auth,C.l(x._delegate,E,y))})()}linkWithPopup(E){var y=this;return(0,m.Z)(function*(){return Pe(y.auth,C.d(y._delegate,E,He))})()}linkWithRedirect(E){var y=this;return(0,m.Z)(function*(){return yield ke(C.aE(y.auth)),C.g(y._delegate,E,He)})()}reauthenticateAndRetrieveDataWithCredential(E){return this.reauthenticateWithCredential(E)}reauthenticateWithCredential(E){var y=this;return(0,m.Z)(function*(){return Pe(y.auth,C._(y._delegate,E))})()}reauthenticateWithPhoneNumber(E,y){return gn(this.auth,C.r(this._delegate,E,y))}reauthenticateWithPopup(E){return Pe(this.auth,C.e(this._delegate,E,He))}reauthenticateWithRedirect(E){var y=this;return(0,m.Z)(function*(){return yield ke(C.aE(y.auth)),C.h(y._delegate,E,He)})()}sendEmailVerification(E){return C.ab(this._delegate,E)}unlink(E){var y=this;return(0,m.Z)(function*(){return yield C.ak(y._delegate,E),y})()}updateEmail(E){return C.ag(this._delegate,E)}updatePassword(E){return C.ah(this._delegate,E)}updatePhoneNumber(E){return C.u(this._delegate,E)}updateProfile(E){return C.af(this._delegate,E)}verifyBeforeUpdateEmail(E,y){return C.ac(this._delegate,E,y)}get emailVerified(){return this._delegate.emailVerified}get isAnonymous(){return this._delegate.isAnonymous}get metadata(){return this._delegate.metadata}get phoneNumber(){return this._delegate.phoneNumber}get providerData(){return this._delegate.providerData}get refreshToken(){return this._delegate.refreshToken}get tenantId(){return this._delegate.tenantId}get displayName(){return this._delegate.displayName}get email(){return this._delegate.email}get photoURL(){return this._delegate.photoURL}get providerId(){return this._delegate.providerId}get uid(){return this._delegate.uid}get auth(){return this._delegate.auth}}Pt.USER_MAP=new WeakMap;const bt=C.ax;let Gt=(()=>{class k{constructor(y,x){if(this.app=y,x.isInitialized())return this._delegate=x.getImmediate(),void this.linkUnderlyingAuth();const{apiKey:B}=y.options;bt(B,"invalid-api-key",{appName:y.name}),bt(B,"invalid-api-key",{appName:y.name});const te=typeof window<"u"?He:void 0;this._delegate=x.initialize({options:{persistence:gt(B,y.name),popupRedirectResolver:te}}),this._delegate._updateErrorMap(C.B),this.linkUnderlyingAuth()}get emulatorConfig(){return this._delegate.emulatorConfig}get currentUser(){return this._delegate.currentUser?Pt.getOrCreate(this._delegate.currentUser):null}get languageCode(){return this._delegate.languageCode}set languageCode(y){this._delegate.languageCode=y}get settings(){return this._delegate.settings}get tenantId(){return this._delegate.tenantId}set tenantId(y){this._delegate.tenantId=y}useDeviceLanguage(){this._delegate.useDeviceLanguage()}signOut(){return this._delegate.signOut()}useEmulator(y,x){C.G(this._delegate,y,x)}applyActionCode(y){return C.a2(this._delegate,y)}checkActionCode(y){return C.a3(this._delegate,y)}confirmPasswordReset(y,x){return C.a1(this._delegate,y,x)}createUserWithEmailAndPassword(y,x){var B=this;return(0,m.Z)(function*(){return Pe(B._delegate,C.a5(B._delegate,y,x))})()}fetchProvidersForEmail(y){return this.fetchSignInMethodsForEmail(y)}fetchSignInMethodsForEmail(y){return C.aa(this._delegate,y)}isSignInWithEmailLink(y){return C.a8(this._delegate,y)}getRedirectResult(){var y=this;return(0,m.Z)(function*(){bt(ee(),y._delegate,"operation-not-supported-in-this-environment");const x=yield C.j(y._delegate,He);return x?Pe(y._delegate,Promise.resolve(x)):{credential:null,user:null}})()}addFrameworkForLogging(y){!function Ye(k,E){(0,C.aE)(k)._logFramework(E)}(this._delegate,y)}onAuthStateChanged(y,x,B){const{next:te,error:de,complete:_e}=Ct(y,x,B);return this._delegate.onAuthStateChanged(te,de,_e)}onIdTokenChanged(y,x,B){const{next:te,error:de,complete:_e}=Ct(y,x,B);return this._delegate.onIdTokenChanged(te,de,_e)}sendSignInLinkToEmail(y,x){return C.a7(this._delegate,y,x)}sendPasswordResetEmail(y,x){return C.a0(this._delegate,y,x||void 0)}setPersistence(y){var x=this;return(0,m.Z)(function*(){let B;switch(function fe(k,E){N(Object.values(X).includes(E),k,"invalid-persistence-type"),(0,J.b$)()?N(E!==X.SESSION,k,"unsupported-persistence-type"):(0,J.UG)()?N(E===X.NONE,k,"unsupported-persistence-type"):Ke()?N(E===X.NONE||E===X.LOCAL&&(0,J.hl)(),k,"unsupported-persistence-type"):N(E===X.NONE||_t(),k,"unsupported-persistence-type")}(x._delegate,y),y){case X.SESSION:B=C.a;break;case X.LOCAL:B=(yield C.az(C.i)._isAvailable())?C.i:C.b;break;case X.NONE:B=C.L;break;default:return C.as("argument-error",{appName:x._delegate.name})}return x._delegate.setPersistence(B)})()}signInAndRetrieveDataWithCredential(y){return this.signInWithCredential(y)}signInAnonymously(){return Pe(this._delegate,C.X(this._delegate))}signInWithCredential(y){return Pe(this._delegate,C.Y(this._delegate,y))}signInWithCustomToken(y){return Pe(this._delegate,C.$(this._delegate,y))}signInWithEmailAndPassword(y,x){return Pe(this._delegate,C.a6(this._delegate,y,x))}signInWithEmailLink(y,x){return Pe(this._delegate,C.a9(this._delegate,y,x))}signInWithPhoneNumber(y,x){return gn(this._delegate,C.s(this._delegate,y,x))}signInWithPopup(y){var x=this;return(0,m.Z)(function*(){return bt(ee(),x._delegate,"operation-not-supported-in-this-environment"),Pe(x._delegate,C.c(x._delegate,y,He))})()}signInWithRedirect(y){var x=this;return(0,m.Z)(function*(){return bt(ee(),x._delegate,"operation-not-supported-in-this-environment"),yield ke(x._delegate),C.f(x._delegate,y,He)})()}updateCurrentUser(y){return this._delegate.updateCurrentUser(y)}verifyPasswordResetCode(y){return C.a4(this._delegate,y)}unwrap(){return this._delegate}_delete(){return this._delegate._delete()}linkUnderlyingAuth(){this._delegate.wrapped=()=>this}}return k.Persistence=X,k})();function Ct(k,E,y){let x=k;"function"!=typeof k&&({next:x,error:E,complete:y}=k);const B=x;return{next:de=>B(de&&Pt.getOrCreate(de)),error:E,complete:y}}function gt(k,E){const y=function Ee(k,E){const y=kt();if(!y)return[];const x=C.aA(z,k,E);switch(y.getItem(x)){case X.NONE:return[C.L];case X.LOCAL:return[C.i,C.a];case X.SESSION:return[C.a];default:return[]}}(k,E);if(typeof self<"u"&&!y.includes(C.i)&&y.push(C.i),typeof window<"u")for(const x of[C.b,C.a])y.includes(x)||y.push(x);return y.includes(C.L)||y.push(C.L),y}class dt{constructor(){this.providerId="phone",this._delegate=new C.P(Et(w.Z.auth()))}static credential(E,y){return C.P.credential(E,y)}verifyPhoneNumber(E,y){return this._delegate.verifyPhoneNumber(E,y)}unwrap(){return this._delegate}}dt.PHONE_SIGN_IN_METHOD=C.P.PHONE_SIGN_IN_METHOD,dt.PROVIDER_ID=C.P.PROVIDER_ID;const Rn=C.ax;class un{constructor(E,y,x=w.Z.app()){var B;Rn(null===(B=x.options)||void 0===B?void 0:B.apiKey,"invalid-api-key",{appName:x.name}),this._delegate=new C.R(E,y,x.auth()),this.type=this._delegate.type}clear(){this._delegate.clear()}render(){return this._delegate.render()}verify(){return this._delegate.verify()}}!function xt(k){k.INTERNAL.registerComponent(new W.wA("auth-compat",E=>{const y=E.getProvider("app-compat").getImmediate(),x=E.getProvider("auth");return new Gt(y,x)},"PUBLIC").setServiceProps({ActionCodeInfo:{Operation:{EMAIL_SIGNIN:C.A.EMAIL_SIGNIN,PASSWORD_RESET:C.A.PASSWORD_RESET,RECOVER_EMAIL:C.A.RECOVER_EMAIL,REVERT_SECOND_FACTOR_ADDITION:C.A.REVERT_SECOND_FACTOR_ADDITION,VERIFY_AND_CHANGE_EMAIL:C.A.VERIFY_AND_CHANGE_EMAIL,VERIFY_EMAIL:C.A.VERIFY_EMAIL}},EmailAuthProvider:C.M,FacebookAuthProvider:C.N,GithubAuthProvider:C.T,GoogleAuthProvider:C.Q,OAuthProvider:C.U,SAMLAuthProvider:C.V,PhoneAuthProvider:dt,PhoneMultiFactorGenerator:C.m,RecaptchaVerifier:un,TwitterAuthProvider:C.W,Auth:Gt,AuthCredential:C.H,Error:J.ZR}).setInstantiationMode("LAZY").setMultipleInstances(!1)),k.registerVersion("@firebase/auth-compat","0.3.4")}(w.Z)}}]);