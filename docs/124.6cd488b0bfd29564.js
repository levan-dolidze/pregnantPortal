"use strict";(self.webpackChunkpregnantPortal=self.webpackChunkpregnantPortal||[]).push([[124],{6217:(Ht,Fe,A)=>{A.d(Fe,{nm:()=>Ln});var m=A(2122);A(4650),A(259);var ue=A(5861),Je=A(9681),rt=A(3475),tt=A(2090),M=A(1877);const Be=new Map,Ze={activated:!1,tokenObservers:[]},g={initialized:!1,enabled:!1};function se(T){return Be.get(T)||Object.assign({},Ze)}function Ne(){return g}const Ue="https://content-firebaseappcheck.googleapis.com/v1",Dt="exchangeDebugToken",Xe={OFFSET_DURATION:3e5,RETRIAL_MIN_WAIT:3e4,RETRIAL_MAX_WAIT:96e4};class st{constructor(I,w,O,U,W){if(this.operation=I,this.retryPolicy=w,this.getWaitDuration=O,this.lowerBound=U,this.upperBound=W,this.pending=null,this.nextErrorWaitInterval=U,U>W)throw new Error("Proactive refresh lower bound greater than upper bound!")}start(){this.nextErrorWaitInterval=this.lowerBound,this.process(!0).catch(()=>{})}stop(){this.pending&&(this.pending.reject("cancelled"),this.pending=null)}isRunning(){return!!this.pending}process(I){var w=this;return(0,ue.Z)(function*(){w.stop();try{w.pending=new tt.BH,yield function He(T){return new Promise(I=>{setTimeout(I,T)})}(w.getNextRun(I)),w.pending.resolve(),yield w.pending.promise,w.pending=new tt.BH,yield w.operation(),w.pending.resolve(),yield w.pending.promise,w.process(!0).catch(()=>{})}catch(O){w.retryPolicy(O)?w.process(!1).catch(()=>{}):w.stop()}})()}getNextRun(I){if(I)return this.nextErrorWaitInterval=this.lowerBound,this.getWaitDuration();{const w=this.nextErrorWaitInterval;return this.nextErrorWaitInterval*=2,this.nextErrorWaitInterval>this.upperBound&&(this.nextErrorWaitInterval=this.upperBound),w}}}const De=new tt.LL("appCheck","AppCheck",{"already-initialized":"You have already called initializeAppCheck() for FirebaseApp {$appName} with different options. To avoid this error, call initializeAppCheck() with the same options as when it was originally called. This will return the already initialized instance.","use-before-activation":"App Check is being used before initializeAppCheck() is called for FirebaseApp {$appName}. Call initializeAppCheck() before instantiating other Firebase services.","fetch-network-error":"Fetch failed to connect to a network. Check Internet connection. Original error: {$originalErrorMessage}.","fetch-parse-error":"Fetch client could not parse response. Original error: {$originalErrorMessage}.","fetch-status-error":"Fetch server returned an HTTP error status. HTTP status: {$httpStatus}.","storage-open":"Error thrown when opening storage. Original error: {$originalErrorMessage}.","storage-get":"Error thrown when reading from storage. Original error: {$originalErrorMessage}.","storage-set":"Error thrown when writing to storage. Original error: {$originalErrorMessage}.","recaptcha-error":"ReCAPTCHA error.",throttled:"Requests throttled due to {$httpStatus} error. Attempts allowed again after {$time}"});function fe(T,I){return be.apply(this,arguments)}function be(){return(be=(0,ue.Z)(function*({url:T,body:I},w){const O={"Content-Type":"application/json"},U=w.getImmediate({optional:!0});if(U){const nt=yield U.getHeartbeatsHeader();nt&&(O["X-Firebase-Client"]=nt)}const W={method:"POST",body:JSON.stringify(I),headers:O};let z,Y;try{z=yield fetch(T,W)}catch(nt){throw De.create("fetch-network-error",{originalErrorMessage:nt?.message})}if(200!==z.status)throw De.create("fetch-status-error",{httpStatus:z.status});try{Y=yield z.json()}catch(nt){throw De.create("fetch-parse-error",{originalErrorMessage:nt?.message})}const de=Y.ttl.match(/^([\d.]+)(s)$/);if(!de||!de[2]||isNaN(Number(de[1])))throw De.create("fetch-parse-error",{originalErrorMessage:`ttl field (timeToLive) is not in standard Protobuf Duration format: ${Y.ttl}`});const ve=1e3*Number(de[1]),gn=Date.now();return{token:Y.token,expireTimeMillis:gn+ve,issuedAtTimeMillis:gn}})).apply(this,arguments)}const Ie="firebase-app-check-database",Ye=1,Qe="firebase-app-check-store";let Z=null;function he(T,I){return Ct.apply(this,arguments)}function Ct(){return(Ct=(0,ue.Z)(function*(T,I){const O=(yield function J(){return Z||(Z=new Promise((T,I)=>{try{const w=indexedDB.open(Ie,Ye);w.onsuccess=O=>{T(O.target.result)},w.onerror=O=>{var U;I(De.create("storage-open",{originalErrorMessage:null===(U=O.target.error)||void 0===U?void 0:U.message}))},w.onupgradeneeded=O=>{0===O.oldVersion&&O.target.result.createObjectStore(Qe,{keyPath:"compositeKey"})}}catch(w){I(De.create("storage-open",{originalErrorMessage:w?.message}))}}),Z)}()).transaction(Qe,"readwrite"),W=O.objectStore(Qe).put({compositeKey:T,value:I});return new Promise((z,Y)=>{W.onsuccess=de=>{z()},O.onerror=de=>{var ve;Y(De.create("storage-set",{originalErrorMessage:null===(ve=de.target.error)||void 0===ve?void 0:ve.message}))}})})).apply(this,arguments)}const At=new M.Yd("@firebase/app-check");function rn(T,I){return(0,tt.hl)()?function $(T,I){return he(function Ge(T){return`${T.options.appId}-${T.name}`}(T),I)}(T,I).catch(w=>{At.warn(`Failed to write token to IndexedDB. Error: ${w}`)}):Promise.resolve()}function jt(){return On.apply(this,arguments)}function On(){return(On=(0,ue.Z)(function*(){const T=Ne();if(T.enabled&&T.token)return T.token.promise;throw Error("\n            Can't get debug token in production mode.\n        ")})).apply(this,arguments)}const Mt={error:"UNKNOWN_ERROR"};function sn(T){return tt.US.encodeString(JSON.stringify(T),!1)}function St(T){return mt.apply(this,arguments)}function mt(){return(mt=(0,ue.Z)(function*(T,I=!1){const w=T.app;!function ge(T){if(!se(T).activated)throw De.create("use-before-activation",{appName:T.name})}(w);const O=se(w);let W,U=O.token;if(U&&!k(U)&&(O.token=void 0,U=void 0),!U){const de=yield O.cachedTokenPromise;de&&(k(de)?U=de:yield rn(w,void 0))}if(!I&&U&&k(U))return{token:U.token};let Y,z=!1;if(function Lt(){return Ne().enabled}()){O.exchangeTokenPromise||(O.exchangeTokenPromise=fe(function we(T,I){const{projectId:w,appId:O,apiKey:U}=T.options;return{url:`${Ue}/projects/${w}/apps/${O}:${Dt}?key=${U}`,body:{debug_token:I}}}(w,yield jt()),T.heartbeatServiceProvider).finally(()=>{O.exchangeTokenPromise=void 0}),z=!0);const de=yield O.exchangeTokenPromise;return yield rn(w,de),O.token=de,{token:de.token}}try{O.exchangeTokenPromise||(O.exchangeTokenPromise=O.provider.getToken().finally(()=>{O.exchangeTokenPromise=void 0}),z=!0),U=yield se(w).exchangeTokenPromise}catch(de){"appCheck/throttled"===de.code?At.warn(de.message):At.error(de),W=de}return U?W?Y=k(U)?{token:U.token,internalError:W}:E(W):(Y={token:U.token},O.token=U,yield rn(w,U)):Y=E(W),z&&function bt(T,I){const w=se(T).tokenObservers;for(const O of w)try{"EXTERNAL"===O.type&&null!=I.error?O.error(I.error):O.next(I)}catch{}}(w,Y),Y})).apply(this,arguments)}function Dn(T,I){const w=se(T),O=w.tokenObservers.filter(U=>U.next!==I);0===O.length&&w.tokenRefresher&&w.tokenRefresher.isRunning()&&w.tokenRefresher.stop(),w.tokenObservers=O}function on(T){const{app:I}=T,w=se(I);let O=w.tokenRefresher;O||(O=function Yt(T){const{app:I}=T;return new st((0,ue.Z)(function*(){let O;if(O=se(I).token?yield St(T,!0):yield St(T),O.error)throw O.error;if(O.internalError)throw O.internalError}),()=>!0,()=>{const w=se(I);if(w.token){let O=w.token.issuedAtTimeMillis+.5*(w.token.expireTimeMillis-w.token.issuedAtTimeMillis)+3e5;return O=Math.min(O,w.token.expireTimeMillis-3e5),Math.max(0,O-Date.now())}return 0},Xe.RETRIAL_MIN_WAIT,Xe.RETRIAL_MAX_WAIT)}(T),w.tokenRefresher=O),!O.isRunning()&&w.isTokenAutoRefreshEnabled&&O.start()}function k(T){return T.expireTimeMillis-Date.now()>0}function E(T){return{token:sn(Mt),error:T}}class y{constructor(I,w){this.app=I,this.heartbeatServiceProvider=w}_delete(){const{tokenObservers:I}=se(this.app);for(const w of I)Dn(this.app,w.next);return Promise.resolve()}}const qn="app-check-internal";!function $r(){(0,Je._registerComponent)(new rt.wA("app-check",T=>function x(T,I){return new y(T,I)}(T.getProvider("app").getImmediate(),T.getProvider("heartbeat")),"PUBLIC").setInstantiationMode("EXPLICIT").setInstanceCreatedCallback((T,I,w)=>{T.getProvider(qn).initialize()})),(0,Je._registerComponent)(new rt.wA(qn,T=>function B(T){return{getToken:I=>St(T,I),addTokenListener:I=>function ct(T,I,w,O){const{app:U}=T,W=se(U);if(W.tokenObservers=[...W.tokenObservers,{next:w,error:O,type:I}],W.token&&k(W.token)){const Y=W.token;Promise.resolve().then(()=>{w({token:Y.token}),on(T)}).catch(()=>{})}W.cachedTokenPromise.then(()=>on(T))}(T,"INTERNAL",I),removeTokenListener:I=>Dn(T.app,I)}}(T.getProvider("app-check").getImmediate()),"PUBLIC").setInstantiationMode("EXPLICIT")),(0,Je.registerVersion)("@firebase/app-check","0.6.4")}();class Ln{constructor(){return(0,m.vb)("app-check")}}typeof window<"u"&&window},3385:(Ht,Fe,A)=>{A.d(Fe,{zQ:()=>se,rT:()=>M,f7:()=>Ze,L6:()=>rt,_Q:()=>tt,lh:()=>Be,Qv:()=>Je,nw:()=>g});var m=A(4650),R=A(7579),C=A(9646),H=A(9751),F=A(8996),te=A(6451),V=A(5363),j=A(3900),ye=A(4004),pt=A(3151),ie=A(590),pe=A(576);function Se(Ne,Ue){return(0,pe.m)(Ue)?(0,j.w)(()=>Ne,Ue):(0,j.w)(()=>Ne)}var Ce=A(9468),Ve=A(9300),p=A(2122),_e=A(2011),je=A(6895),it=A(6217);A(9260);const Je=new m.OlP("angularfire2.auth.use-emulator"),rt=new m.OlP("angularfire2.auth.settings"),tt=new m.OlP("angularfire2.auth.tenant-id"),M=new m.OlP("angularfire2.auth.langugage-code"),Be=new m.OlP("angularfire2.auth.use-device-language"),Ze=new m.OlP("angularfire.auth.persistence"),g=(Ne,Ue,Oe,It,Dt,Xe,Ae,st)=>(0,_e.cc)(`${Ne.name}.auth`,"AngularFireAuth",Ne.name,()=>{const He=Ue.runOutsideAngular(()=>Ne.auth());if(Oe&&He.useEmulator(...Oe),It&&(He.tenantId=It),He.languageCode=Dt,Xe&&He.useDeviceLanguage(),Ae)for(const[Et,De]of Object.entries(Ae))He.settings[Et]=De;return st&&He.setPersistence(st),He},[Oe,It,Dt,Xe,Ae,st]);let se=(()=>{class Ne{constructor(Oe,It,Dt,Xe,Ae,st,He,Et,De,oe,ge,Tt){const _t=new R.x,fe=(0,C.of)(void 0).pipe((0,V.Q)(Ae.outsideAngular),(0,j.w)(()=>Xe.runOutsideAngular(()=>Promise.resolve().then(A.bind(A,9568)))),(0,ye.U)(()=>(0,_e.on)(Oe,Xe,It)),(0,ye.U)(be=>g(be,Xe,st,Et,De,oe,He,ge)),(0,pt.d)({bufferSize:1,refCount:!1}));if((0,je.PM)(Dt))this.authState=this.user=this.idToken=this.idTokenResult=this.credential=(0,C.of)(null);else{fe.pipe((0,ie.P)()).subscribe();const ut=fe.pipe((0,j.w)(Ie=>Ie.getRedirectResult().then(Ye=>Ye,()=>null)),p.iC,(0,pt.d)({bufferSize:1,refCount:!1})),Ke=fe.pipe((0,j.w)(Ie=>new H.y(Ye=>({unsubscribe:Xe.runOutsideAngular(()=>Ie.onAuthStateChanged(Qe=>Ye.next(Qe),Qe=>Ye.error(Qe),()=>Ye.complete()))})))),we=fe.pipe((0,j.w)(Ie=>new H.y(Ye=>({unsubscribe:Xe.runOutsideAngular(()=>Ie.onIdTokenChanged(Qe=>Ye.next(Qe),Qe=>Ye.error(Qe),()=>Ye.complete()))}))));this.authState=ut.pipe(Se(Ke),(0,Ce.R)(Ae.outsideAngular),(0,V.Q)(Ae.insideAngular)),this.user=ut.pipe(Se(we),(0,Ce.R)(Ae.outsideAngular),(0,V.Q)(Ae.insideAngular)),this.idToken=this.user.pipe((0,j.w)(Ie=>Ie?(0,F.D)(Ie.getIdToken()):(0,C.of)(null))),this.idTokenResult=this.user.pipe((0,j.w)(Ie=>Ie?(0,F.D)(Ie.getIdTokenResult()):(0,C.of)(null))),this.credential=(0,te.T)(ut,_t,this.authState.pipe((0,Ve.h)(Ie=>!Ie))).pipe((0,ye.U)(Ie=>Ie?.user?Ie:null),(0,Ce.R)(Ae.outsideAngular),(0,V.Q)(Ae.insideAngular))}return(0,_e.pX)(this,fe,Xe,{spy:{apply:(be,ut,Ke)=>{(be.startsWith("signIn")||be.startsWith("createUser"))&&Ke.then(we=>_t.next(we))}}})}}return Ne.\u0275fac=function(Oe){return new(Oe||Ne)(m.LFG(_e.Dh),m.LFG(_e.xv,8),m.LFG(m.Lbi),m.LFG(m.R0b),m.LFG(p.HU),m.LFG(Je,8),m.LFG(rt,8),m.LFG(tt,8),m.LFG(M,8),m.LFG(Be,8),m.LFG(Ze,8),m.LFG(it.nm,8))},Ne.\u0275prov=m.Yz7({token:Ne,factory:Ne.\u0275fac,providedIn:"any"}),Ne})()},8401:(Ht,Fe,A)=>{A.d(Fe,{$:()=>ca,A:()=>ie,B:()=>Ce,G:()=>Ei,H:()=>an,J:()=>I,L:()=>on,M:()=>lt,N:()=>sa,P:()=>Ua,Q:()=>oa,R:()=>xa,T:()=>aa,U:()=>dt,V:()=>vn,W:()=>la,X:()=>uo,Y:()=>Di,Z:()=>Jr,_:()=>Xr,a:()=>Cr,a0:()=>ns,a1:()=>dn,a2:()=>ee,a3:()=>ti,a4:()=>$e,a5:()=>da,a6:()=>fo,a7:()=>ni,a8:()=>Mi,a9:()=>ha,aA:()=>Yt,aB:()=>ji,aC:()=>$i,aD:()=>Ha,aE:()=>et,aI:()=>li,aL:()=>Ft,aa:()=>mr,ab:()=>fa,ac:()=>ls,af:()=>vr,ag:()=>po,ah:()=>Ir,ak:()=>co,al:()=>ma,an:()=>va,ao:()=>yo,ap:()=>Ze,aq:()=>Le,ar:()=>X,as:()=>Pe,at:()=>zn,au:()=>Vs,av:()=>vt,aw:()=>ue,ax:()=>M,ay:()=>Bo,az:()=>se,b:()=>ai,c:()=>Mo,d:()=>Ba,e:()=>Dr,f:()=>Ls,g:()=>Vo,h:()=>fi,i:()=>So,j:()=>Fs,k:()=>Qs,l:()=>Fa,m:()=>Ko,n:()=>jo,o:()=>j,r:()=>Oo,s:()=>Ma,u:()=>Do});var m=A(5861),R=A(2090),C=A(9681),H=A(1877),F=A(655),te=A(3475);const j={FACEBOOK:"facebook.com",GITHUB:"github.com",GOOGLE:"google.com",PASSWORD:"password",PHONE:"phone",TWITTER:"twitter.com"},ie={EMAIL_SIGNIN:"EMAIL_SIGNIN",PASSWORD_RESET:"PASSWORD_RESET",RECOVER_EMAIL:"RECOVER_EMAIL",REVERT_SECOND_FACTOR_ADDITION:"REVERT_SECOND_FACTOR_ADDITION",VERIFY_AND_CHANGE_EMAIL:"VERIFY_AND_CHANGE_EMAIL",VERIFY_EMAIL:"VERIFY_EMAIL"};const Ce=function pe(){return{"admin-restricted-operation":"This operation is restricted to administrators only.","argument-error":"","app-not-authorized":"This app, identified by the domain where it's hosted, is not authorized to use Firebase Authentication with the provided API key. Review your key configuration in the Google API console.","app-not-installed":"The requested mobile application corresponding to the identifier (Android package name or iOS bundle ID) provided is not installed on this device.","captcha-check-failed":"The reCAPTCHA response token provided is either invalid, expired, already used or the domain associated with it does not match the list of whitelisted domains.","code-expired":"The SMS code has expired. Please re-send the verification code to try again.","cordova-not-ready":"Cordova framework is not ready.","cors-unsupported":"This browser is not supported.","credential-already-in-use":"This credential is already associated with a different user account.","custom-token-mismatch":"The custom token corresponds to a different audience.","requires-recent-login":"This operation is sensitive and requires recent authentication. Log in again before retrying this request.","dependent-sdk-initialized-before-auth":"Another Firebase SDK was initialized and is trying to use Auth before Auth is initialized. Please be sure to call `initializeAuth` or `getAuth` before starting any other Firebase SDK.","dynamic-link-not-activated":"Please activate Dynamic Links in the Firebase Console and agree to the terms and conditions.","email-change-needs-verification":"Multi-factor users must always have a verified email.","email-already-in-use":"The email address is already in use by another account.","emulator-config-failed":'Auth instance has already been used to make a network call. Auth can no longer be configured to use the emulator. Try calling "connectAuthEmulator()" sooner.',"expired-action-code":"The action code has expired.","cancelled-popup-request":"This operation has been cancelled due to another conflicting popup being opened.","internal-error":"An internal AuthError has occurred.","invalid-app-credential":"The phone verification request contains an invalid application verifier. The reCAPTCHA token response is either invalid or expired.","invalid-app-id":"The mobile app identifier is not registed for the current project.","invalid-user-token":"This user's credential isn't valid for this project. This can happen if the user's token has been tampered with, or if the user isn't for the project associated with this API key.","invalid-auth-event":"An internal AuthError has occurred.","invalid-verification-code":"The SMS verification code used to create the phone auth credential is invalid. Please resend the verification code sms and be sure to use the verification code provided by the user.","invalid-continue-uri":"The continue URL provided in the request is invalid.","invalid-cordova-configuration":"The following Cordova plugins must be installed to enable OAuth sign-in: cordova-plugin-buildinfo, cordova-universal-links-plugin, cordova-plugin-browsertab, cordova-plugin-inappbrowser and cordova-plugin-customurlscheme.","invalid-custom-token":"The custom token format is incorrect. Please check the documentation.","invalid-dynamic-link-domain":"The provided dynamic link domain is not configured or authorized for the current project.","invalid-email":"The email address is badly formatted.","invalid-emulator-scheme":"Emulator URL must start with a valid scheme (http:// or https://).","invalid-api-key":"Your API key is invalid, please check you have copied it correctly.","invalid-cert-hash":"The SHA-1 certificate hash provided is invalid.","invalid-credential":"The supplied auth credential is malformed or has expired.","invalid-message-payload":"The email template corresponding to this action contains invalid characters in its message. Please fix by going to the Auth email templates section in the Firebase Console.","invalid-multi-factor-session":"The request does not contain a valid proof of first factor successful sign-in.","invalid-oauth-provider":"EmailAuthProvider is not supported for this operation. This operation only supports OAuth providers.","invalid-oauth-client-id":"The OAuth client ID provided is either invalid or does not match the specified API key.","unauthorized-domain":"This domain is not authorized for OAuth operations for your Firebase project. Edit the list of authorized domains from the Firebase console.","invalid-action-code":"The action code is invalid. This can happen if the code is malformed, expired, or has already been used.","wrong-password":"The password is invalid or the user does not have a password.","invalid-persistence-type":"The specified persistence type is invalid. It can only be local, session or none.","invalid-phone-number":"The format of the phone number provided is incorrect. Please enter the phone number in a format that can be parsed into E.164 format. E.164 phone numbers are written in the format [+][country code][subscriber number including area code].","invalid-provider-id":"The specified provider ID is invalid.","invalid-recipient-email":"The email corresponding to this action failed to send as the provided recipient email address is invalid.","invalid-sender":"The email template corresponding to this action contains an invalid sender email or name. Please fix by going to the Auth email templates section in the Firebase Console.","invalid-verification-id":"The verification ID used to create the phone auth credential is invalid.","invalid-tenant-id":"The Auth instance's tenant ID is invalid.","login-blocked":"Login blocked by user-provided method: {$originalMessage}","missing-android-pkg-name":"An Android Package Name must be provided if the Android App is required to be installed.","auth-domain-config-required":"Be sure to include authDomain when calling firebase.initializeApp(), by following the instructions in the Firebase console.","missing-app-credential":"The phone verification request is missing an application verifier assertion. A reCAPTCHA response token needs to be provided.","missing-verification-code":"The phone auth credential was created with an empty SMS verification code.","missing-continue-uri":"A continue URL must be provided in the request.","missing-iframe-start":"An internal AuthError has occurred.","missing-ios-bundle-id":"An iOS Bundle ID must be provided if an App Store ID is provided.","missing-or-invalid-nonce":"The request does not contain a valid nonce. This can occur if the SHA-256 hash of the provided raw nonce does not match the hashed nonce in the ID token payload.","missing-multi-factor-info":"No second factor identifier is provided.","missing-multi-factor-session":"The request is missing proof of first factor successful sign-in.","missing-phone-number":"To send verification codes, provide a phone number for the recipient.","missing-verification-id":"The phone auth credential was created with an empty verification ID.","app-deleted":"This instance of FirebaseApp has been deleted.","multi-factor-info-not-found":"The user does not have a second factor matching the identifier provided.","multi-factor-auth-required":"Proof of ownership of a second factor is required to complete sign-in.","account-exists-with-different-credential":"An account already exists with the same email address but different sign-in credentials. Sign in using a provider associated with this email address.","network-request-failed":"A network AuthError (such as timeout, interrupted connection or unreachable host) has occurred.","no-auth-event":"An internal AuthError has occurred.","no-such-provider":"User was not linked to an account with the given provider.","null-user":"A null user object was provided as the argument for an operation which requires a non-null user object.","operation-not-allowed":"The given sign-in provider is disabled for this Firebase project. Enable it in the Firebase console, under the sign-in method tab of the Auth section.","operation-not-supported-in-this-environment":'This operation is not supported in the environment this application is running on. "location.protocol" must be http, https or chrome-extension and web storage must be enabled.',"popup-blocked":"Unable to establish a connection with the popup. It may have been blocked by the browser.","popup-closed-by-user":"The popup has been closed by the user before finalizing the operation.","provider-already-linked":"User can only be linked to one identity for the given provider.","quota-exceeded":"The project's quota for this operation has been exceeded.","redirect-cancelled-by-user":"The redirect operation has been cancelled by the user before finalizing.","redirect-operation-pending":"A redirect sign-in operation is already pending.","rejected-credential":"The request contains malformed or mismatching credentials.","second-factor-already-in-use":"The second factor is already enrolled on this account.","maximum-second-factor-count-exceeded":"The maximum allowed number of second factors on a user has been exceeded.","tenant-id-mismatch":"The provided tenant ID does not match the Auth instance's tenant ID",timeout:"The operation has timed out.","user-token-expired":"The user's credential is no longer valid. The user must sign in again.","too-many-requests":"We have blocked all requests from this device due to unusual activity. Try again later.","unauthorized-continue-uri":"The domain of the continue URL is not whitelisted.  Please whitelist the domain in the Firebase console.","unsupported-first-factor":"Enrolling a second factor or signing in with a multi-factor account requires sign-in with a supported first factor.","unsupported-persistence-type":"The current environment does not support the specified persistence type.","unsupported-tenant-operation":"This operation is not supported in a multi-tenant context.","unverified-email":"The operation requires a verified email.","user-cancelled":"The user did not grant your application the permissions it requested.","user-not-found":"There is no user record corresponding to this identifier. The user may have been deleted.","user-disabled":"The user account has been disabled by an administrator.","user-mismatch":"The supplied credentials do not correspond to the previously signed in user.","user-signed-out":"","weak-password":"The password must be 6 characters long or more.","web-storage-unsupported":"This browser is not supported or 3rd party cookies and data may be disabled.","already-initialized":"initializeAuth() has already been called with different options. To avoid this error, call initializeAuth() with the same options as when it was originally called, or call getAuth() to return the already initialized instance."}},Ve=function Se(){return{"dependent-sdk-initialized-before-auth":"Another Firebase SDK was initialized and is trying to use Auth before Auth is initialized. Please be sure to call `initializeAuth` or `getAuth` before starting any other Firebase SDK."}},p=new R.LL("auth","Firebase",{"dependent-sdk-initialized-before-auth":"Another Firebase SDK was initialized and is trying to use Auth before Auth is initialized. Please be sure to call `initializeAuth` or `getAuth` before starting any other Firebase SDK."}),je=new H.Yd("@firebase/auth");function it(a,...r){je.logLevel<=H.in.ERROR&&je.error(`Auth (${C.SDK_VERSION}): ${a}`,...r)}function Pe(a,...r){throw tt(a,...r)}function ue(a,...r){return tt(a,...r)}function Je(a,r,s){const l=Object.assign(Object.assign({},Ve()),{[r]:s});return new R.LL("auth","Firebase",l).create(r,{appName:a.name})}function rt(a,r,s){if(!(r instanceof s))throw s.name!==r.constructor.name&&Pe(a,"argument-error"),Je(a,"argument-error",`Type of ${r.constructor.name} does not match expected instance.Did you pass a reference from a different Auth SDK?`)}function tt(a,...r){if("string"!=typeof a){const s=r[0],l=[...r.slice(1)];return l[0]&&(l[0].appName=a.name),a._errorFactory.create(s,...l)}return p.create(a,...r)}function M(a,r,...s){if(!a)throw tt(r,...s)}function Be(a){const r="INTERNAL ASSERTION FAILED: "+a;throw it(r),new Error(r)}function Ze(a,r){a||Be(r)}const g=new Map;function se(a){Ze(a instanceof Function,"Expected a class definition");let r=g.get(a);return r?(Ze(r instanceof a,"Instance stored in cache mismatched with class"),r):(r=new a,g.set(a,r),r)}function Ue(){var a;return typeof self<"u"&&(null===(a=self.location)||void 0===a?void 0:a.href)||""}function Oe(){return"http:"===It()||"https:"===It()}function It(){var a;return typeof self<"u"&&(null===(a=self.location)||void 0===a?void 0:a.protocol)||null}class Ae{constructor(r,s){this.shortDelay=r,this.longDelay=s,Ze(s>r,"Short delay should be less than long delay!"),this.isMobile=(0,R.uI)()||(0,R.b$)()}get(){return function Dt(){return!(typeof navigator<"u"&&navigator&&"onLine"in navigator&&"boolean"==typeof navigator.onLine&&(Oe()||(0,R.ru)()||"connection"in navigator))||navigator.onLine}()?this.isMobile?this.longDelay:this.shortDelay:Math.min(5e3,this.shortDelay)}}function st(a,r){Ze(a.emulator,"Emulator should always be set here");const{url:s}=a.emulator;return r?`${s}${r.startsWith("/")?r.slice(1):r}`:s}class He{static initialize(r,s,l){this.fetchImpl=r,s&&(this.headersImpl=s),l&&(this.responseImpl=l)}static fetch(){return this.fetchImpl?this.fetchImpl:typeof self<"u"&&"fetch"in self?self.fetch:void Be("Could not find fetch implementation, make sure you call FetchProvider.initialize() with an appropriate polyfill")}static headers(){return this.headersImpl?this.headersImpl:typeof self<"u"&&"Headers"in self?self.Headers:void Be("Could not find Headers implementation, make sure you call FetchProvider.initialize() with an appropriate polyfill")}static response(){return this.responseImpl?this.responseImpl:typeof self<"u"&&"Response"in self?self.Response:void Be("Could not find Response implementation, make sure you call FetchProvider.initialize() with an appropriate polyfill")}}const Et={CREDENTIAL_MISMATCH:"custom-token-mismatch",MISSING_CUSTOM_TOKEN:"internal-error",INVALID_IDENTIFIER:"invalid-email",MISSING_CONTINUE_URI:"internal-error",INVALID_PASSWORD:"wrong-password",MISSING_PASSWORD:"internal-error",EMAIL_EXISTS:"email-already-in-use",PASSWORD_LOGIN_DISABLED:"operation-not-allowed",INVALID_IDP_RESPONSE:"invalid-credential",INVALID_PENDING_TOKEN:"invalid-credential",FEDERATED_USER_ID_ALREADY_LINKED:"credential-already-in-use",MISSING_REQ_TYPE:"internal-error",EMAIL_NOT_FOUND:"user-not-found",RESET_PASSWORD_EXCEED_LIMIT:"too-many-requests",EXPIRED_OOB_CODE:"expired-action-code",INVALID_OOB_CODE:"invalid-action-code",MISSING_OOB_CODE:"internal-error",CREDENTIAL_TOO_OLD_LOGIN_AGAIN:"requires-recent-login",INVALID_ID_TOKEN:"invalid-user-token",TOKEN_EXPIRED:"user-token-expired",USER_NOT_FOUND:"user-token-expired",TOO_MANY_ATTEMPTS_TRY_LATER:"too-many-requests",INVALID_CODE:"invalid-verification-code",INVALID_SESSION_INFO:"invalid-verification-id",INVALID_TEMPORARY_PROOF:"invalid-credential",MISSING_SESSION_INFO:"missing-verification-id",SESSION_EXPIRED:"code-expired",MISSING_ANDROID_PACKAGE_NAME:"missing-android-pkg-name",UNAUTHORIZED_DOMAIN:"unauthorized-continue-uri",INVALID_OAUTH_CLIENT_ID:"invalid-oauth-client-id",ADMIN_ONLY_OPERATION:"admin-restricted-operation",INVALID_MFA_PENDING_CREDENTIAL:"invalid-multi-factor-session",MFA_ENROLLMENT_NOT_FOUND:"multi-factor-info-not-found",MISSING_MFA_ENROLLMENT_ID:"missing-multi-factor-info",MISSING_MFA_PENDING_CREDENTIAL:"missing-multi-factor-session",SECOND_FACTOR_EXISTS:"second-factor-already-in-use",SECOND_FACTOR_LIMIT_EXCEEDED:"maximum-second-factor-count-exceeded",BLOCKING_FUNCTION_ERROR_RESPONSE:"internal-error"},De=new Ae(3e4,6e4);function oe(a,r){return a.tenantId&&!r.tenantId?Object.assign(Object.assign({},r),{tenantId:a.tenantId}):r}function ge(a,r,s,l){return Tt.apply(this,arguments)}function Tt(){return(Tt=(0,m.Z)(function*(a,r,s,l,d={}){return _t(a,d,(0,m.Z)(function*(){let f={},S={};l&&("GET"===r?S=l:f={body:JSON.stringify(l)});const L=(0,R.xO)(Object.assign({key:a.config.apiKey},S)).slice(1),K=yield a._getAdditionalHeaders();return K["Content-Type"]="application/json",a.languageCode&&(K["X-Firebase-Locale"]=a.languageCode),He.fetch()(Ke(a,a.config.apiHost,s,L),Object.assign({method:r,headers:K,referrerPolicy:"no-referrer"},f))}))})).apply(this,arguments)}function _t(a,r,s){return fe.apply(this,arguments)}function fe(){return(fe=(0,m.Z)(function*(a,r,s){a._canInitEmulator=!1;const l=Object.assign(Object.assign({},Et),r);try{const d=new we(a),f=yield Promise.race([s(),d.promise]);d.clearNetworkTimeout();const S=yield f.json();if("needConfirmation"in S)throw Ie(a,"account-exists-with-different-credential",S);if(f.ok&&!("errorMessage"in S))return S;{const L=f.ok?S.errorMessage:S.error.message,[K,Q]=L.split(" : ");if("FEDERATED_USER_ID_ALREADY_LINKED"===K)throw Ie(a,"credential-already-in-use",S);if("EMAIL_EXISTS"===K)throw Ie(a,"email-already-in-use",S);if("USER_DISABLED"===K)throw Ie(a,"user-disabled",S);const re=l[K]||K.toLowerCase().replace(/[_\s]+/g,"-");if(Q)throw Je(a,re,Q);Pe(a,re)}}catch(d){if(d instanceof R.ZR)throw d;Pe(a,"internal-error",{message:String(d)})}})).apply(this,arguments)}function be(a,r,s,l){return ut.apply(this,arguments)}function ut(){return(ut=(0,m.Z)(function*(a,r,s,l,d={}){const f=yield ge(a,r,s,l,d);return"mfaPendingCredential"in f&&Pe(a,"multi-factor-auth-required",{_serverResponse:f}),f})).apply(this,arguments)}function Ke(a,r,s,l){const d=`${r}${s}?${l}`;return a.config.emulator?st(a.config,d):`${a.config.apiScheme}://${d}`}class we{constructor(r){this.auth=r,this.timer=null,this.promise=new Promise((s,l)=>{this.timer=setTimeout(()=>l(ue(this.auth,"network-request-failed")),De.get())})}clearNetworkTimeout(){clearTimeout(this.timer)}}function Ie(a,r,s){const l={appName:a.name};s.email&&(l.email=s.email),s.phoneNumber&&(l.phoneNumber=s.phoneNumber);const d=ue(a,r,l);return d.customData._tokenResponse=s,d}function Qe(){return(Qe=(0,m.Z)(function*(a,r){return ge(a,"POST","/v1/accounts:delete",r)})).apply(this,arguments)}function Z(){return(Z=(0,m.Z)(function*(a,r){return ge(a,"POST","/v1/accounts:update",r)})).apply(this,arguments)}function N(){return(N=(0,m.Z)(function*(a,r){return ge(a,"POST","/v1/accounts:lookup",r)})).apply(this,arguments)}function $(a){if(a)try{const r=new Date(Number(a));if(!isNaN(r.getTime()))return r.toUTCString()}catch{}}function he(){return(he=(0,m.Z)(function*(a,r=!1){const s=(0,R.m9)(a),l=yield s.getIdToken(r),d=xt(l);M(d&&d.exp&&d.auth_time&&d.iat,s.auth,"internal-error");const f="object"==typeof d.firebase?d.firebase:void 0,S=f?.sign_in_provider;return{claims:d,token:l,authTime:$(Ct(d.auth_time)),issuedAtTime:$(Ct(d.iat)),expirationTime:$(Ct(d.exp)),signInProvider:S||null,signInSecondFactor:f?.sign_in_second_factor||null}})).apply(this,arguments)}function Ct(a){return 1e3*Number(a)}function xt(a){const[r,s,l]=a.split(".");if(void 0===r||void 0===s||void 0===l)return it("JWT malformed, contained fewer than 3 sections"),null;try{const d=(0,R.tV)(s);return d?JSON.parse(d):(it("Failed to decode base64 JWT payload"),null)}catch(d){return it("Caught error parsing JWT payload as JSON",d?.toString()),null}}function Ge(a,r){return At.apply(this,arguments)}function At(){return(At=(0,m.Z)(function*(a,r,s=!1){if(s)return r;try{return yield r}catch(l){throw l instanceof R.ZR&&function bn({code:a}){return"auth/user-disabled"===a||"auth/user-token-expired"===a}(l)&&a.auth.currentUser===a&&(yield a.auth.signOut()),l}})).apply(this,arguments)}class Nn{constructor(r){this.user=r,this.isRunning=!1,this.timerId=null,this.errorBackoff=3e4}_start(){this.isRunning||(this.isRunning=!0,this.schedule())}_stop(){this.isRunning&&(this.isRunning=!1,null!==this.timerId&&clearTimeout(this.timerId))}getInterval(r){var s;if(r){const l=this.errorBackoff;return this.errorBackoff=Math.min(2*this.errorBackoff,96e4),l}{this.errorBackoff=3e4;const d=(null!==(s=this.user.stsTokenManager.expirationTime)&&void 0!==s?s:0)-Date.now()-3e5;return Math.max(0,d)}}schedule(r=!1){var s=this;if(!this.isRunning)return;const l=this.getInterval(r);this.timerId=setTimeout((0,m.Z)(function*(){yield s.iteration()}),l)}iteration(){var r=this;return(0,m.Z)(function*(){try{yield r.user.getIdToken(!0)}catch(s){return void("auth/network-request-failed"===s?.code&&r.schedule(!0))}r.schedule()})()}}class rn{constructor(r,s){this.createdAt=r,this.lastLoginAt=s,this._initializeTime()}_initializeTime(){this.lastSignInTime=$(this.lastLoginAt),this.creationTime=$(this.createdAt)}_copy(r){this.createdAt=r.createdAt,this.lastLoginAt=r.lastLoginAt,this._initializeTime()}toJSON(){return{createdAt:this.createdAt,lastLoginAt:this.lastLoginAt}}}function gt(a){return ze.apply(this,arguments)}function ze(){return ze=(0,m.Z)(function*(a){var r;const s=a.auth,l=yield a.getIdToken(),d=yield Ge(a,function J(a,r){return N.apply(this,arguments)}(s,{idToken:l}));M(d?.users.length,s,"internal-error");const f=d.users[0];a._notifyReloadListener(f);const S=null!==(r=f.providerUserInfo)&&void 0!==r&&r.length?function at(a){return a.map(r=>{var{providerId:s}=r,l=(0,F._T)(r,["providerId"]);return{providerId:s,uid:l.rawId||"",displayName:l.displayName||null,email:l.email||null,phoneNumber:l.phoneNumber||null,photoURL:l.photoUrl||null}})}(f.providerUserInfo):[],L=function On(a,r){return[...a.filter(l=>!r.some(d=>d.providerId===l.providerId)),...r]}(a.providerData,S),re=!!a.isAnonymous&&!(a.email&&f.passwordHash||L?.length),We={uid:f.localId,displayName:f.displayName||null,photoURL:f.photoUrl||null,email:f.email||null,emailVerified:f.emailVerified||!1,phoneNumber:f.phoneNumber||null,tenantId:f.tenantId||null,providerData:L,metadata:new rn(f.createdAt,f.lastLoginAt),isAnonymous:re};Object.assign(a,We)}),ze.apply(this,arguments)}function jt(){return(jt=(0,m.Z)(function*(a){const r=(0,R.m9)(a);yield gt(r),yield r.auth._persistUserIfCurrent(r),r.auth._notifyListenersIfCurrent(r)})).apply(this,arguments)}function sn(){return(sn=(0,m.Z)(function*(a,r){const s=yield _t(a,{},(0,m.Z)(function*(){const l=(0,R.xO)({grant_type:"refresh_token",refresh_token:r}).slice(1),{tokenApiHost:d,apiKey:f}=a.config,S=Ke(a,d,"/v1/token",`key=${f}`),L=yield a._getAdditionalHeaders();return L["Content-Type"]="application/x-www-form-urlencoded",He.fetch()(S,{method:"POST",headers:L,body:l})}));return{accessToken:s.access_token,expiresIn:s.expires_in,refreshToken:s.refresh_token}})).apply(this,arguments)}class St{constructor(){this.refreshToken=null,this.accessToken=null,this.expirationTime=null}get isExpired(){return!this.expirationTime||Date.now()>this.expirationTime-3e4}updateFromServerResponse(r){M(r.idToken,"internal-error"),M(typeof r.idToken<"u","internal-error"),M(typeof r.refreshToken<"u","internal-error");const s="expiresIn"in r&&typeof r.expiresIn<"u"?Number(r.expiresIn):function nn(a){const r=xt(a);return M(r,"internal-error"),M(typeof r.exp<"u","internal-error"),M(typeof r.iat<"u","internal-error"),Number(r.exp)-Number(r.iat)}(r.idToken);this.updateTokensAndExpiration(r.idToken,r.refreshToken,s)}getToken(r,s=!1){var l=this;return(0,m.Z)(function*(){return M(!l.accessToken||l.refreshToken,r,"user-token-expired"),s||!l.accessToken||l.isExpired?l.refreshToken?(yield l.refresh(r,l.refreshToken),l.accessToken):null:l.accessToken})()}clearRefreshToken(){this.refreshToken=null}refresh(r,s){var l=this;return(0,m.Z)(function*(){const{accessToken:d,refreshToken:f,expiresIn:S}=yield function Mt(a,r){return sn.apply(this,arguments)}(r,s);l.updateTokensAndExpiration(d,f,Number(S))})()}updateTokensAndExpiration(r,s,l){this.refreshToken=s||null,this.accessToken=r||null,this.expirationTime=Date.now()+1e3*l}static fromJSON(r,s){const{refreshToken:l,accessToken:d,expirationTime:f}=s,S=new St;return l&&(M("string"==typeof l,"internal-error",{appName:r}),S.refreshToken=l),d&&(M("string"==typeof d,"internal-error",{appName:r}),S.accessToken=d),f&&(M("number"==typeof f,"internal-error",{appName:r}),S.expirationTime=f),S}toJSON(){return{refreshToken:this.refreshToken,accessToken:this.accessToken,expirationTime:this.expirationTime}}_assign(r){this.accessToken=r.accessToken,this.refreshToken=r.refreshToken,this.expirationTime=r.expirationTime}_clone(){return Object.assign(new St,this.toJSON())}_performRefresh(){return Be("not implemented")}}function mt(a,r){M("string"==typeof a||typeof a>"u","internal-error",{appName:r})}class ct{constructor(r){var{uid:s,auth:l,stsTokenManager:d}=r,f=(0,F._T)(r,["uid","auth","stsTokenManager"]);this.providerId="firebase",this.proactiveRefresh=new Nn(this),this.reloadUserInfo=null,this.reloadListener=null,this.uid=s,this.auth=l,this.stsTokenManager=d,this.accessToken=d.accessToken,this.displayName=f.displayName||null,this.email=f.email||null,this.emailVerified=f.emailVerified||!1,this.phoneNumber=f.phoneNumber||null,this.photoURL=f.photoURL||null,this.isAnonymous=f.isAnonymous||!1,this.tenantId=f.tenantId||null,this.providerData=f.providerData?[...f.providerData]:[],this.metadata=new rn(f.createdAt||void 0,f.lastLoginAt||void 0)}getIdToken(r){var s=this;return(0,m.Z)(function*(){const l=yield Ge(s,s.stsTokenManager.getToken(s.auth,r));return M(l,s.auth,"internal-error"),s.accessToken!==l&&(s.accessToken=l,yield s.auth._persistUserIfCurrent(s),s.auth._notifyListenersIfCurrent(s)),l})()}getIdTokenResult(r){return function xe(a){return he.apply(this,arguments)}(this,r)}reload(){return function Lt(a){return jt.apply(this,arguments)}(this)}_assign(r){this!==r&&(M(this.uid===r.uid,this.auth,"internal-error"),this.displayName=r.displayName,this.photoURL=r.photoURL,this.email=r.email,this.emailVerified=r.emailVerified,this.phoneNumber=r.phoneNumber,this.isAnonymous=r.isAnonymous,this.tenantId=r.tenantId,this.providerData=r.providerData.map(s=>Object.assign({},s)),this.metadata._copy(r.metadata),this.stsTokenManager._assign(r.stsTokenManager))}_clone(r){return new ct(Object.assign(Object.assign({},this),{auth:r,stsTokenManager:this.stsTokenManager._clone()}))}_onReload(r){M(!this.reloadListener,this.auth,"internal-error"),this.reloadListener=r,this.reloadUserInfo&&(this._notifyReloadListener(this.reloadUserInfo),this.reloadUserInfo=null)}_notifyReloadListener(r){this.reloadListener?this.reloadListener(r):this.reloadUserInfo=r}_startProactiveRefresh(){this.proactiveRefresh._start()}_stopProactiveRefresh(){this.proactiveRefresh._stop()}_updateTokensIfNecessary(r,s=!1){var l=this;return(0,m.Z)(function*(){let d=!1;r.idToken&&r.idToken!==l.stsTokenManager.accessToken&&(l.stsTokenManager.updateFromServerResponse(r),d=!0),s&&(yield gt(l)),yield l.auth._persistUserIfCurrent(l),d&&l.auth._notifyListenersIfCurrent(l)})()}delete(){var r=this;return(0,m.Z)(function*(){const s=yield r.getIdToken();return yield Ge(r,function Ye(a,r){return Qe.apply(this,arguments)}(r.auth,{idToken:s})),r.stsTokenManager.clearRefreshToken(),r.auth.signOut()})()}toJSON(){return Object.assign(Object.assign({uid:this.uid,email:this.email||void 0,emailVerified:this.emailVerified,displayName:this.displayName||void 0,isAnonymous:this.isAnonymous,photoURL:this.photoURL||void 0,phoneNumber:this.phoneNumber||void 0,tenantId:this.tenantId||void 0,providerData:this.providerData.map(r=>Object.assign({},r)),stsTokenManager:this.stsTokenManager.toJSON(),_redirectEventId:this._redirectEventId},this.metadata.toJSON()),{apiKey:this.auth.config.apiKey,appName:this.auth.name})}get refreshToken(){return this.stsTokenManager.refreshToken||""}static _fromJSON(r,s){var l,d,f,S,L,K,Q,re;const We=null!==(l=s.displayName)&&void 0!==l?l:void 0,Xt=null!==(d=s.email)&&void 0!==d?d:void 0,en=null!==(f=s.phoneNumber)&&void 0!==f?f:void 0,nr=null!==(S=s.photoURL)&&void 0!==S?S:void 0,Yo=null!==(L=s.tenantId)&&void 0!==L?L:void 0,Rn=null!==(K=s._redirectEventId)&&void 0!==K?K:void 0,fn=null!==(Q=s.createdAt)&&void 0!==Q?Q:void 0,Qo=null!==(re=s.lastLoginAt)&&void 0!==re?re:void 0,{uid:ir,emailVerified:rr,isAnonymous:qo,providerData:kn,stsTokenManager:Jo}=s;M(ir&&Jo,r,"internal-error");const Xo=St.fromJSON(this.name,Jo);M("string"==typeof ir,r,"internal-error"),mt(We,r.name),mt(Xt,r.name),M("boolean"==typeof rr,r,"internal-error"),M("boolean"==typeof qo,r,"internal-error"),mt(en,r.name),mt(nr,r.name),mt(Yo,r.name),mt(Rn,r.name),mt(fn,r.name),mt(Qo,r.name);const Br=new ct({uid:ir,auth:r,email:Xt,emailVerified:rr,displayName:We,isAnonymous:qo,photoURL:nr,phoneNumber:en,tenantId:Yo,stsTokenManager:Xo,createdAt:fn,lastLoginAt:Qo});return kn&&Array.isArray(kn)&&(Br.providerData=kn.map(ea=>Object.assign({},ea))),Rn&&(Br._redirectEventId=Rn),Br}static _fromIdTokenResponse(r,s,l=!1){return(0,m.Z)(function*(){const d=new St;d.updateFromServerResponse(s);const f=new ct({uid:s.localId,auth:r,stsTokenManager:d,isAnonymous:l});return yield gt(f),f})()}}const on=(()=>{class a{constructor(){this.type="NONE",this.storage={}}_isAvailable(){return(0,m.Z)(function*(){return!0})()}_set(s,l){var d=this;return(0,m.Z)(function*(){d.storage[s]=l})()}_get(s){var l=this;return(0,m.Z)(function*(){const d=l.storage[s];return void 0===d?null:d})()}_remove(s){var l=this;return(0,m.Z)(function*(){delete l.storage[s]})()}_addListener(s,l){}_removeListener(s,l){}}return a.type="NONE",a})();function Yt(a,r,s){return`firebase:${a}:${r}:${s}`}class bt{constructor(r,s,l){this.persistence=r,this.auth=s,this.userKey=l;const{config:d,name:f}=this.auth;this.fullUserKey=Yt(this.userKey,d.apiKey,f),this.fullPersistenceKey=Yt("persistence",d.apiKey,f),this.boundEventHandler=s._onStorageEvent.bind(s),this.persistence._addListener(this.fullUserKey,this.boundEventHandler)}setCurrentUser(r){return this.persistence._set(this.fullUserKey,r.toJSON())}getCurrentUser(){var r=this;return(0,m.Z)(function*(){const s=yield r.persistence._get(r.fullUserKey);return s?ct._fromJSON(r.auth,s):null})()}removeCurrentUser(){return this.persistence._remove(this.fullUserKey)}savePersistenceForRedirect(){return this.persistence._set(this.fullPersistenceKey,this.persistence.type)}setPersistence(r){var s=this;return(0,m.Z)(function*(){if(s.persistence===r)return;const l=yield s.getCurrentUser();return yield s.removeCurrentUser(),s.persistence=r,l?s.setCurrentUser(l):void 0})()}delete(){this.persistence._removeListener(this.fullUserKey,this.boundEventHandler)}static create(r,s,l="authUser"){return(0,m.Z)(function*(){if(!s.length)return new bt(se(on),r,l);const d=(yield Promise.all(s.map(function(){var Q=(0,m.Z)(function*(re){if(yield re._isAvailable())return re});return function(re){return Q.apply(this,arguments)}}()))).filter(Q=>Q);let f=d[0]||se(on);const S=Yt(l,r.config.apiKey,r.name);let L=null;for(const Q of s)try{const re=yield Q._get(S);if(re){const We=ct._fromJSON(r,re);Q!==f&&(L=We),f=Q;break}}catch{}const K=d.filter(Q=>Q._shouldAllowMigration);return f._shouldAllowMigration&&K.length?(f=K[0],L&&(yield f._set(S,L.toJSON())),yield Promise.all(s.map(function(){var Q=(0,m.Z)(function*(re){if(re!==f)try{yield re._remove(S)}catch{}});return function(re){return Q.apply(this,arguments)}}())),new bt(f,r,l)):new bt(f,r,l)})()}}function k(a){const r=a.toLowerCase();if(r.includes("opera/")||r.includes("opr/")||r.includes("opios/"))return"Opera";if(B(r))return"IEMobile";if(r.includes("msie")||r.includes("trident/"))return"IE";if(r.includes("edge/"))return"Edge";if(E(r))return"Firefox";if(r.includes("silk/"))return"Silk";if(ce(r))return"Blackberry";if(me(r))return"Webos";if(y(r))return"Safari";if((r.includes("chrome/")||x(r))&&!r.includes("edge/"))return"Chrome";if(X(r))return"Android";{const l=a.match(/([a-zA-Z\d\.]+)\/[a-zA-Z\d\.]*$/);if(2===l?.length)return l[1]}return"Other"}function E(a=(0,R.z$)()){return/firefox\//i.test(a)}function y(a=(0,R.z$)()){const r=a.toLowerCase();return r.includes("safari/")&&!r.includes("chrome/")&&!r.includes("crios/")&&!r.includes("android")}function x(a=(0,R.z$)()){return/crios\//i.test(a)}function B(a=(0,R.z$)()){return/iemobile/i.test(a)}function X(a=(0,R.z$)()){return/android/i.test(a)}function ce(a=(0,R.z$)()){return/blackberry/i.test(a)}function me(a=(0,R.z$)()){return/webos/i.test(a)}function Le(a=(0,R.z$)()){return/iphone|ipad|ipod/i.test(a)||/macintosh/i.test(a)&&/mobile/i.test(a)}function vt(a=(0,R.z$)()){return/(iPad|iPhone|iPod).*OS 7_\d/i.test(a)||/(iPad|iPhone|iPod).*OS 8_\d/i.test(a)}function Rt(a=(0,R.z$)()){return Le(a)||X(a)||me(a)||ce(a)||/windows phone/i.test(a)||B(a)}function Yn(a,r=[]){let s;switch(a){case"Browser":s=k((0,R.z$)());break;case"Worker":s=`${k((0,R.z$)())}-${a}`;break;default:s=a}const l=r.length?r.join(","):"FirebaseCore-web";return`${s}/JsCore/${C.SDK_VERSION}/${l}`}class ar{constructor(r){this.auth=r,this.queue=[]}pushCallback(r,s){const l=f=>new Promise((S,L)=>{try{S(r(f))}catch(K){L(K)}});l.onAbort=s,this.queue.push(l);const d=this.queue.length-1;return()=>{this.queue[d]=()=>Promise.resolve()}}runMiddleware(r){var s=this;return(0,m.Z)(function*(){if(s.auth.currentUser===r)return;const l=[];try{for(const d of s.queue)yield d(r),d.onAbort&&l.push(d.onAbort)}catch(d){l.reverse();for(const f of l)try{f()}catch{}throw s.auth._errorFactory.create("login-blocked",{originalMessage:d?.message})}})()}}class lr{constructor(r,s,l){this.app=r,this.heartbeatServiceProvider=s,this.config=l,this.currentUser=null,this.emulatorConfig=null,this.operations=Promise.resolve(),this.authStateSubscription=new Ii(this),this.idTokenSubscription=new Ii(this),this.beforeStateQueue=new ar(this),this.redirectUser=null,this.isProactiveRefreshEnabled=!1,this._canInitEmulator=!0,this._isInitialized=!1,this._deleted=!1,this._initializationPromise=null,this._popupRedirectResolver=null,this._errorFactory=p,this.lastNotifiedUid=void 0,this.languageCode=null,this.tenantId=null,this.settings={appVerificationDisabledForTesting:!1},this.frameworks=[],this.name=r.name,this.clientVersion=l.sdkClientVersion}_initializeWithPersistence(r,s){var l=this;return s&&(this._popupRedirectResolver=se(s)),this._initializationPromise=this.queue((0,m.Z)(function*(){var d,f;if(!l._deleted&&(l.persistenceManager=yield bt.create(l,r),!l._deleted)){if(null!==(d=l._popupRedirectResolver)&&void 0!==d&&d._shouldInitProactively)try{yield l._popupRedirectResolver._initialize(l)}catch{}yield l.initializeCurrentUser(s),l.lastNotifiedUid=(null===(f=l.currentUser)||void 0===f?void 0:f.uid)||null,!l._deleted&&(l._isInitialized=!0)}})),this._initializationPromise}_onStorageEvent(){var r=this;return(0,m.Z)(function*(){if(r._deleted)return;const s=yield r.assertedPersistence.getCurrentUser();if(r.currentUser||s){if(r.currentUser&&s&&r.currentUser.uid===s.uid)return r._currentUser._assign(s),void(yield r.currentUser.getIdToken());yield r._updateCurrentUser(s,!0)}})()}initializeCurrentUser(r){var s=this;return(0,m.Z)(function*(){var l;const d=yield s.assertedPersistence.getCurrentUser();let f=d,S=!1;if(r&&s.config.authDomain){yield s.getOrInitRedirectPersistenceManager();const L=null===(l=s.redirectUser)||void 0===l?void 0:l._redirectEventId,K=f?._redirectEventId,Q=yield s.tryRedirectSignIn(r);(!L||L===K)&&Q?.user&&(f=Q.user,S=!0)}if(!f)return s.directlySetCurrentUser(null);if(!f._redirectEventId){if(S)try{yield s.beforeStateQueue.runMiddleware(f)}catch(L){f=d,s._popupRedirectResolver._overrideRedirectResult(s,()=>Promise.reject(L))}return f?s.reloadAndSetCurrentUserOrClear(f):s.directlySetCurrentUser(null)}return M(s._popupRedirectResolver,s,"argument-error"),yield s.getOrInitRedirectPersistenceManager(),s.redirectUser&&s.redirectUser._redirectEventId===f._redirectEventId?s.directlySetCurrentUser(f):s.reloadAndSetCurrentUserOrClear(f)})()}tryRedirectSignIn(r){var s=this;return(0,m.Z)(function*(){let l=null;try{l=yield s._popupRedirectResolver._completeRedirectFn(s,r,!0)}catch{yield s._setRedirectUser(null)}return l})()}reloadAndSetCurrentUserOrClear(r){var s=this;return(0,m.Z)(function*(){try{yield gt(r)}catch(l){if("auth/network-request-failed"!==l?.code)return s.directlySetCurrentUser(null)}return s.directlySetCurrentUser(r)})()}useDeviceLanguage(){this.languageCode=function Xe(){if(typeof navigator>"u")return null;const a=navigator;return a.languages&&a.languages[0]||a.language||null}()}_delete(){var r=this;return(0,m.Z)(function*(){r._deleted=!0})()}updateCurrentUser(r){var s=this;return(0,m.Z)(function*(){const l=r?(0,R.m9)(r):null;return l&&M(l.auth.config.apiKey===s.config.apiKey,s,"invalid-user-token"),s._updateCurrentUser(l&&l._clone(s))})()}_updateCurrentUser(r,s=!1){var l=this;return(0,m.Z)(function*(){if(!l._deleted)return r&&M(l.tenantId===r.tenantId,l,"tenant-id-mismatch"),s||(yield l.beforeStateQueue.runMiddleware(r)),l.queue((0,m.Z)(function*(){yield l.directlySetCurrentUser(r),l.notifyAuthListeners()}))})()}signOut(){var r=this;return(0,m.Z)(function*(){return yield r.beforeStateQueue.runMiddleware(null),(r.redirectPersistenceManager||r._popupRedirectResolver)&&(yield r._setRedirectUser(null)),r._updateCurrentUser(null,!0)})()}setPersistence(r){var s=this;return this.queue((0,m.Z)(function*(){yield s.assertedPersistence.setPersistence(se(r))}))}_getPersistence(){return this.assertedPersistence.persistence.type}_updateErrorMap(r){this._errorFactory=new R.LL("auth","Firebase",r())}onAuthStateChanged(r,s,l){return this.registerStateListener(this.authStateSubscription,r,s,l)}beforeAuthStateChanged(r,s){return this.beforeStateQueue.pushCallback(r,s)}onIdTokenChanged(r,s,l){return this.registerStateListener(this.idTokenSubscription,r,s,l)}toJSON(){var r;return{apiKey:this.config.apiKey,authDomain:this.config.authDomain,appName:this.name,currentUser:null===(r=this._currentUser)||void 0===r?void 0:r.toJSON()}}_setRedirectUser(r,s){var l=this;return(0,m.Z)(function*(){const d=yield l.getOrInitRedirectPersistenceManager(s);return null===r?d.removeCurrentUser():d.setCurrentUser(r)})()}getOrInitRedirectPersistenceManager(r){var s=this;return(0,m.Z)(function*(){if(!s.redirectPersistenceManager){const l=r&&se(r)||s._popupRedirectResolver;M(l,s,"argument-error"),s.redirectPersistenceManager=yield bt.create(s,[se(l._redirectPersistence)],"redirectUser"),s.redirectUser=yield s.redirectPersistenceManager.getCurrentUser()}return s.redirectPersistenceManager})()}_redirectUserForId(r){var s=this;return(0,m.Z)(function*(){var l,d;return s._isInitialized&&(yield s.queue((0,m.Z)(function*(){}))),(null===(l=s._currentUser)||void 0===l?void 0:l._redirectEventId)===r?s._currentUser:(null===(d=s.redirectUser)||void 0===d?void 0:d._redirectEventId)===r?s.redirectUser:null})()}_persistUserIfCurrent(r){var s=this;return(0,m.Z)(function*(){if(r===s.currentUser)return s.queue((0,m.Z)(function*(){return s.directlySetCurrentUser(r)}))})()}_notifyListenersIfCurrent(r){r===this.currentUser&&this.notifyAuthListeners()}_key(){return`${this.config.authDomain}:${this.config.apiKey}:${this.name}`}_startProactiveRefresh(){this.isProactiveRefreshEnabled=!0,this.currentUser&&this._currentUser._startProactiveRefresh()}_stopProactiveRefresh(){this.isProactiveRefreshEnabled=!1,this.currentUser&&this._currentUser._stopProactiveRefresh()}get _currentUser(){return this.currentUser}notifyAuthListeners(){var r,s;if(!this._isInitialized)return;this.idTokenSubscription.next(this.currentUser);const l=null!==(s=null===(r=this.currentUser)||void 0===r?void 0:r.uid)&&void 0!==s?s:null;this.lastNotifiedUid!==l&&(this.lastNotifiedUid=l,this.authStateSubscription.next(this.currentUser))}registerStateListener(r,s,l,d){if(this._deleted)return()=>{};const f="function"==typeof s?s:s.next.bind(s),S=this._isInitialized?Promise.resolve():this._initializationPromise;return M(S,this,"internal-error"),S.then(()=>f(this.currentUser)),"function"==typeof s?r.addObserver(s,l,d):r.addObserver(s)}directlySetCurrentUser(r){var s=this;return(0,m.Z)(function*(){s.currentUser&&s.currentUser!==r&&s._currentUser._stopProactiveRefresh(),r&&s.isProactiveRefreshEnabled&&r._startProactiveRefresh(),s.currentUser=r,r?yield s.assertedPersistence.setCurrentUser(r):yield s.assertedPersistence.removeCurrentUser()})()}queue(r){return this.operations=this.operations.then(r,r),this.operations}get assertedPersistence(){return M(this.persistenceManager,this,"internal-error"),this.persistenceManager}_logFramework(r){!r||this.frameworks.includes(r)||(this.frameworks.push(r),this.frameworks.sort(),this.clientVersion=Yn(this.config.clientPlatform,this._getFrameworks()))}_getFrameworks(){return this.frameworks}_getAdditionalHeaders(){var r=this;return(0,m.Z)(function*(){var s;const l={"X-Client-Version":r.clientVersion};r.app.options.appId&&(l["X-Firebase-gmpid"]=r.app.options.appId);const d=yield null===(s=r.heartbeatServiceProvider.getImmediate({optional:!0}))||void 0===s?void 0:s.getHeartbeatsHeader();return d&&(l["X-Firebase-Client"]=d),l})()}}function et(a){return(0,R.m9)(a)}class Ii{constructor(r){this.auth=r,this.observer=null,this.addObserver=(0,R.ne)(s=>this.observer=s)}get next(){return M(this.observer,this.auth,"internal-error"),this.observer.next.bind(this.observer)}}function Ei(a,r,s){const l=et(a);M(l._canInitEmulator,l,"emulator-config-failed"),M(/^https?:\/\//.test(r),l,"invalid-emulator-scheme");const d=!!s?.disableWarnings,f=Ti(r),{host:S,port:L}=function ur(a){const r=Ti(a),s=/(\/\/)?([^?#/]+)/.exec(a.substr(r.length));if(!s)return{host:"",port:null};const l=s[2].split("@").pop()||"",d=/^(\[[^\]]+\])(:|$)/.exec(l);if(d){const f=d[1];return{host:f,port:Ci(l.substr(f.length+1))}}{const[f,S]=l.split(":");return{host:f,port:Ci(S)}}}(r);l.config.emulator={url:`${f}//${S}${null===L?"":`:${L}`}/`},l.settings.appVerificationDisabledForTesting=!0,l.emulatorConfig=Object.freeze({host:S,port:L,protocol:f.replace(":",""),options:Object.freeze({disableWarnings:d})}),d||function Hr(){function a(){const r=document.createElement("p"),s=r.style;r.innerText="Running in emulator mode. Do not use with production credentials.",s.position="fixed",s.width="100%",s.backgroundColor="#ffffff",s.border=".1em solid #000000",s.color="#b50000",s.bottom="0px",s.left="0px",s.margin="0px",s.zIndex="10000",s.textAlign="center",r.classList.add("firebase-emulator-warning"),document.body.appendChild(r)}typeof console<"u"&&"function"==typeof console.info&&console.info("WARNING: You are using the Auth Emulator, which is intended for local testing only.  Do not use with production credentials."),typeof window<"u"&&typeof document<"u"&&("loading"===document.readyState?window.addEventListener("DOMContentLoaded",a):a())}()}function Ti(a){const r=a.indexOf(":");return r<0?"":a.substr(0,r+1)}function Ci(a){if(!a)return null;const r=Number(a);return isNaN(r)?null:r}class an{constructor(r,s){this.providerId=r,this.signInMethod=s}toJSON(){return Be("not implemented")}_getIdTokenResponse(r){return Be("not implemented")}_linkToIdToken(r,s){return Be("not implemented")}_getReauthenticationResolver(r){return Be("not implemented")}}function Gr(a,r){return cr.apply(this,arguments)}function cr(){return(cr=(0,m.Z)(function*(a,r){return ge(a,"POST","/v1/accounts:resetPassword",oe(a,r))})).apply(this,arguments)}function Qn(a,r){return $t.apply(this,arguments)}function $t(){return($t=(0,m.Z)(function*(a,r){return ge(a,"POST","/v1/accounts:update",r)})).apply(this,arguments)}function qn(){return(qn=(0,m.Z)(function*(a,r){return ge(a,"POST","/v1/accounts:update",oe(a,r))})).apply(this,arguments)}function ln(){return(ln=(0,m.Z)(function*(a,r){return be(a,"POST","/v1/accounts:signInWithPassword",oe(a,r))})).apply(this,arguments)}function Nt(a,r){return Ln.apply(this,arguments)}function Ln(){return(Ln=(0,m.Z)(function*(a,r){return ge(a,"POST","/v1/accounts:sendOobCode",oe(a,r))})).apply(this,arguments)}function Mn(){return(Mn=(0,m.Z)(function*(a,r){return Nt(a,r)})).apply(this,arguments)}function Si(){return(Si=(0,m.Z)(function*(a,r){return Nt(a,r)})).apply(this,arguments)}function Jn(){return(Jn=(0,m.Z)(function*(a,r){return Nt(a,r)})).apply(this,arguments)}function wi(){return(wi=(0,m.Z)(function*(a,r){return Nt(a,r)})).apply(this,arguments)}function Xn(){return(Xn=(0,m.Z)(function*(a,r){return be(a,"POST","/v1/accounts:signInWithEmailLink",oe(a,r))})).apply(this,arguments)}function Ri(){return(Ri=(0,m.Z)(function*(a,r){return be(a,"POST","/v1/accounts:signInWithEmailLink",oe(a,r))})).apply(this,arguments)}class Fn extends an{constructor(r,s,l,d=null){super("password",l),this._email=r,this._password=s,this._tenantId=d}static _fromEmailAndPassword(r,s){return new Fn(r,s,"password")}static _fromEmailAndCode(r,s,l=null){return new Fn(r,s,"emailLink",l)}toJSON(){return{email:this._email,password:this._password,signInMethod:this.signInMethod,tenantId:this._tenantId}}static fromJSON(r){const s="string"==typeof r?JSON.parse(r):r;if(s?.email&&s?.password){if("password"===s.signInMethod)return this._fromEmailAndPassword(s.email,s.password);if("emailLink"===s.signInMethod)return this._fromEmailAndCode(s.email,s.password,s.tenantId)}return null}_getIdTokenResponse(r){var s=this;return(0,m.Z)(function*(){switch(s.signInMethod){case"password":return function $r(a,r){return ln.apply(this,arguments)}(r,{returnSecureToken:!0,email:s._email,password:s._password});case"emailLink":return function so(a,r){return Xn.apply(this,arguments)}(r,{email:s._email,oobCode:s._password});default:Pe(r,"internal-error")}})()}_linkToIdToken(r,s){var l=this;return(0,m.Z)(function*(){switch(l.signInMethod){case"password":return Qn(r,{idToken:s,returnSecureToken:!0,email:l._email,password:l._password});case"emailLink":return function zr(a,r){return Ri.apply(this,arguments)}(r,{idToken:s,email:l._email,oobCode:l._password});default:Pe(r,"internal-error")}})()}_getReauthenticationResolver(r){return this._getIdTokenResponse(r)}}function Qt(a,r){return ki.apply(this,arguments)}function ki(){return(ki=(0,m.Z)(function*(a,r){return be(a,"POST","/v1/accounts:signInWithIdp",oe(a,r))})).apply(this,arguments)}class I extends an{constructor(){super(...arguments),this.pendingToken=null}static _fromParams(r){const s=new I(r.providerId,r.signInMethod);return r.idToken||r.accessToken?(r.idToken&&(s.idToken=r.idToken),r.accessToken&&(s.accessToken=r.accessToken),r.nonce&&!r.pendingToken&&(s.nonce=r.nonce),r.pendingToken&&(s.pendingToken=r.pendingToken)):r.oauthToken&&r.oauthTokenSecret?(s.accessToken=r.oauthToken,s.secret=r.oauthTokenSecret):Pe("argument-error"),s}toJSON(){return{idToken:this.idToken,accessToken:this.accessToken,secret:this.secret,nonce:this.nonce,pendingToken:this.pendingToken,providerId:this.providerId,signInMethod:this.signInMethod}}static fromJSON(r){const s="string"==typeof r?JSON.parse(r):r,{providerId:l,signInMethod:d}=s,f=(0,F._T)(s,["providerId","signInMethod"]);if(!l||!d)return null;const S=new I(l,d);return S.idToken=f.idToken||void 0,S.accessToken=f.accessToken||void 0,S.secret=f.secret,S.nonce=f.nonce,S.pendingToken=f.pendingToken||null,S}_getIdTokenResponse(r){return Qt(r,this.buildRequest())}_linkToIdToken(r,s){const l=this.buildRequest();return l.idToken=s,Qt(r,l)}_getReauthenticationResolver(r){const s=this.buildRequest();return s.autoCreate=!1,Qt(r,s)}buildRequest(){const r={requestUri:"http://localhost",returnSecureToken:!0};if(this.pendingToken)r.pendingToken=this.pendingToken;else{const s={};this.idToken&&(s.id_token=this.idToken),this.accessToken&&(s.access_token=this.accessToken),this.secret&&(s.oauth_token_secret=this.secret),s.providerId=this.providerId,this.nonce&&!this.pendingToken&&(s.nonce=this.nonce),r.postBody=(0,R.xO)(s)}return r}}function O(){return(O=(0,m.Z)(function*(a,r){return ge(a,"POST","/v1/accounts:sendVerificationCode",oe(a,r))})).apply(this,arguments)}function W(){return(W=(0,m.Z)(function*(a,r){return be(a,"POST","/v1/accounts:signInWithPhoneNumber",oe(a,r))})).apply(this,arguments)}function Y(){return(Y=(0,m.Z)(function*(a,r){const s=yield be(a,"POST","/v1/accounts:signInWithPhoneNumber",oe(a,r));if(s.temporaryProof)throw Ie(a,"account-exists-with-different-credential",s);return s})).apply(this,arguments)}const de={USER_NOT_FOUND:"user-not-found"};function gn(){return(gn=(0,m.Z)(function*(a,r){return be(a,"POST","/v1/accounts:signInWithPhoneNumber",oe(a,Object.assign(Object.assign({},r),{operation:"REAUTH"})),de)})).apply(this,arguments)}class nt extends an{constructor(r){super("phone","phone"),this.params=r}static _fromVerification(r,s){return new nt({verificationId:r,verificationCode:s})}static _fromTokenResponse(r,s){return new nt({phoneNumber:r,temporaryProof:s})}_getIdTokenResponse(r){return function U(a,r){return W.apply(this,arguments)}(r,this._makeVerificationRequest())}_linkToIdToken(r,s){return function z(a,r){return Y.apply(this,arguments)}(r,Object.assign({idToken:s},this._makeVerificationRequest()))}_getReauthenticationResolver(r){return function ve(a,r){return gn.apply(this,arguments)}(r,this._makeVerificationRequest())}_makeVerificationRequest(){const{temporaryProof:r,phoneNumber:s,verificationId:l,verificationCode:d}=this.params;return r&&s?{temporaryProof:r,phoneNumber:s}:{sessionInfo:l,code:d}}toJSON(){const r={providerId:this.providerId};return this.params.phoneNumber&&(r.phoneNumber=this.params.phoneNumber),this.params.temporaryProof&&(r.temporaryProof=this.params.temporaryProof),this.params.verificationCode&&(r.verificationCode=this.params.verificationCode),this.params.verificationId&&(r.verificationId=this.params.verificationId),r}static fromJSON(r){"string"==typeof r&&(r=JSON.parse(r));const{verificationId:s,verificationCode:l,phoneNumber:d,temporaryProof:f}=r;return l||s||d||f?new nt({verificationId:s,verificationCode:l,phoneNumber:d,temporaryProof:f}):null}}class Re{constructor(r){var s,l,d,f,S,L;const K=(0,R.zd)((0,R.pd)(r)),Q=null!==(s=K.apiKey)&&void 0!==s?s:null,re=null!==(l=K.oobCode)&&void 0!==l?l:null,We=function Pi(a){switch(a){case"recoverEmail":return"RECOVER_EMAIL";case"resetPassword":return"PASSWORD_RESET";case"signIn":return"EMAIL_SIGNIN";case"verifyEmail":return"VERIFY_EMAIL";case"verifyAndChangeEmail":return"VERIFY_AND_CHANGE_EMAIL";case"revertSecondFactorAddition":return"REVERT_SECOND_FACTOR_ADDITION";default:return null}}(null!==(d=K.mode)&&void 0!==d?d:null);M(Q&&re&&We,"argument-error"),this.apiKey=Q,this.operation=We,this.code=re,this.continueUrl=null!==(f=K.continueUrl)&&void 0!==f?f:null,this.languageCode=null!==(S=K.languageCode)&&void 0!==S?S:null,this.tenantId=null!==(L=K.tenantId)&&void 0!==L?L:null}static parseLink(r){const s=function oo(a){const r=(0,R.zd)((0,R.pd)(a)).link,s=r?(0,R.zd)((0,R.pd)(r)).deep_link_id:null,l=(0,R.zd)((0,R.pd)(a)).deep_link_id;return(l?(0,R.zd)((0,R.pd)(l)).link:null)||l||s||r||a}(r);try{return new Re(s)}catch{return null}}}let lt=(()=>{class a{constructor(){this.providerId=a.PROVIDER_ID}static credential(s,l){return Fn._fromEmailAndPassword(s,l)}static credentialWithLink(s,l){const d=Re.parseLink(l);return M(d,"argument-error"),Fn._fromEmailAndCode(s,d.code,d.tenantId)}}return a.PROVIDER_ID="password",a.EMAIL_PASSWORD_SIGN_IN_METHOD="password",a.EMAIL_LINK_SIGN_IN_METHOD="emailLink",a})();class un{constructor(r){this.providerId=r,this.defaultLanguageCode=null,this.customParameters={}}setDefaultLanguage(r){this.defaultLanguageCode=r}setCustomParameters(r){return this.customParameters=r,this}getCustomParameters(){return this.customParameters}}class mn extends un{constructor(){super(...arguments),this.scopes=[]}addScope(r){return this.scopes.includes(r)||this.scopes.push(r),this}getScopes(){return[...this.scopes]}}class dt extends mn{static credentialFromJSON(r){const s="string"==typeof r?JSON.parse(r):r;return M("providerId"in s&&"signInMethod"in s,"argument-error"),I._fromParams(s)}credential(r){return this._credential(Object.assign(Object.assign({},r),{nonce:r.rawNonce}))}_credential(r){return M(r.idToken||r.accessToken,"argument-error"),I._fromParams(Object.assign(Object.assign({},r),{providerId:this.providerId,signInMethod:this.providerId}))}static credentialFromResult(r){return dt.oauthCredentialFromTaggedObject(r)}static credentialFromError(r){return dt.oauthCredentialFromTaggedObject(r.customData||{})}static oauthCredentialFromTaggedObject({_tokenResponse:r}){if(!r)return null;const{oauthIdToken:s,oauthAccessToken:l,oauthTokenSecret:d,pendingToken:f,nonce:S,providerId:L}=r;if(!l&&!d&&!s&&!f||!L)return null;try{return new dt(L)._credential({idToken:s,accessToken:l,nonce:S,pendingToken:f})}catch{return null}}}let sa=(()=>{class a extends mn{constructor(){super("facebook.com")}static credential(s){return I._fromParams({providerId:a.PROVIDER_ID,signInMethod:a.FACEBOOK_SIGN_IN_METHOD,accessToken:s})}static credentialFromResult(s){return a.credentialFromTaggedObject(s)}static credentialFromError(s){return a.credentialFromTaggedObject(s.customData||{})}static credentialFromTaggedObject({_tokenResponse:s}){if(!s||!("oauthAccessToken"in s)||!s.oauthAccessToken)return null;try{return a.credential(s.oauthAccessToken)}catch{return null}}}return a.FACEBOOK_SIGN_IN_METHOD="facebook.com",a.PROVIDER_ID="facebook.com",a})(),oa=(()=>{class a extends mn{constructor(){super("google.com"),this.addScope("profile")}static credential(s,l){return I._fromParams({providerId:a.PROVIDER_ID,signInMethod:a.GOOGLE_SIGN_IN_METHOD,idToken:s,accessToken:l})}static credentialFromResult(s){return a.credentialFromTaggedObject(s)}static credentialFromError(s){return a.credentialFromTaggedObject(s.customData||{})}static credentialFromTaggedObject({_tokenResponse:s}){if(!s)return null;const{oauthIdToken:l,oauthAccessToken:d}=s;if(!l&&!d)return null;try{return a.credential(l,d)}catch{return null}}}return a.GOOGLE_SIGN_IN_METHOD="google.com",a.PROVIDER_ID="google.com",a})(),aa=(()=>{class a extends mn{constructor(){super("github.com")}static credential(s){return I._fromParams({providerId:a.PROVIDER_ID,signInMethod:a.GITHUB_SIGN_IN_METHOD,accessToken:s})}static credentialFromResult(s){return a.credentialFromTaggedObject(s)}static credentialFromError(s){return a.credentialFromTaggedObject(s.customData||{})}static credentialFromTaggedObject({_tokenResponse:s}){if(!s||!("oauthAccessToken"in s)||!s.oauthAccessToken)return null;try{return a.credential(s.oauthAccessToken)}catch{return null}}}return a.GITHUB_SIGN_IN_METHOD="github.com",a.PROVIDER_ID="github.com",a})();class Ft extends an{constructor(r,s){super(r,r),this.pendingToken=s}_getIdTokenResponse(r){return Qt(r,this.buildRequest())}_linkToIdToken(r,s){const l=this.buildRequest();return l.idToken=s,Qt(r,l)}_getReauthenticationResolver(r){const s=this.buildRequest();return s.autoCreate=!1,Qt(r,s)}toJSON(){return{signInMethod:this.signInMethod,providerId:this.providerId,pendingToken:this.pendingToken}}static fromJSON(r){const s="string"==typeof r?JSON.parse(r):r,{providerId:l,signInMethod:d,pendingToken:f}=s;return l&&d&&f&&l===d?new Ft(l,f):null}static _create(r,s){return new Ft(r,s)}buildRequest(){return{requestUri:"http://localhost",returnSecureToken:!0,pendingToken:this.pendingToken}}}class vn extends un{constructor(r){M(r.startsWith("saml."),"argument-error"),super(r)}static credentialFromResult(r){return vn.samlCredentialFromTaggedObject(r)}static credentialFromError(r){return vn.samlCredentialFromTaggedObject(r.customData||{})}static credentialFromJSON(r){const s=Ft.fromJSON(r);return M(s,"argument-error"),s}static samlCredentialFromTaggedObject({_tokenResponse:r}){if(!r)return null;const{pendingToken:s,providerId:l}=r;if(!s||!l)return null;try{return Ft._create(l,s)}catch{return null}}}let la=(()=>{class a extends mn{constructor(){super("twitter.com")}static credential(s,l){return I._fromParams({providerId:a.PROVIDER_ID,signInMethod:a.TWITTER_SIGN_IN_METHOD,oauthToken:s,oauthTokenSecret:l})}static credentialFromResult(s){return a.credentialFromTaggedObject(s)}static credentialFromError(s){return a.credentialFromTaggedObject(s.customData||{})}static credentialFromTaggedObject({_tokenResponse:s}){if(!s)return null;const{oauthAccessToken:l,oauthTokenSecret:d}=s;if(!l||!d)return null;try{return a.credential(l,d)}catch{return null}}}return a.TWITTER_SIGN_IN_METHOD="twitter.com",a.PROVIDER_ID="twitter.com",a})();function Yr(a,r){return Qr.apply(this,arguments)}function Qr(){return(Qr=(0,m.Z)(function*(a,r){return be(a,"POST","/v1/accounts:signUp",oe(a,r))})).apply(this,arguments)}class Ut{constructor(r){this.user=r.user,this.providerId=r.providerId,this._tokenResponse=r._tokenResponse,this.operationType=r.operationType}static _fromIdTokenResponse(r,s,l,d=!1){return(0,m.Z)(function*(){const f=yield ct._fromIdTokenResponse(r,l,d),S=lo(l);return new Ut({user:f,providerId:S,_tokenResponse:l,operationType:s})})()}static _forOperation(r,s,l){return(0,m.Z)(function*(){yield r._updateTokensIfNecessary(l,!0);const d=lo(l);return new Ut({user:r,providerId:d,_tokenResponse:l,operationType:s})})()}}function lo(a){return a.providerId?a.providerId:"phoneNumber"in a?"phone":null}function uo(a){return cn.apply(this,arguments)}function cn(){return(cn=(0,m.Z)(function*(a){var r;const s=et(a);if(yield s._initializationPromise,null!==(r=s.currentUser)&&void 0!==r&&r.isAnonymous)return new Ut({user:s.currentUser,providerId:null,operationType:"signIn"});const l=yield Yr(s,{returnSecureToken:!0}),d=yield Ut._fromIdTokenResponse(s,"signIn",l,!0);return yield s._updateCurrentUser(d.user),d})).apply(this,arguments)}class ne extends R.ZR{constructor(r,s,l,d){var f;super(s.code,s.message),this.operationType=l,this.user=d,Object.setPrototypeOf(this,ne.prototype),this.customData={appName:r.name,tenantId:null!==(f=r.tenantId)&&void 0!==f?f:void 0,_serverResponse:s.customData._serverResponse,operationType:l}}static _fromErrorAndOperation(r,s,l,d){return new ne(r,s,l,d)}}function bi(a,r,s,l){return("reauthenticate"===r?s._getReauthenticationResolver(a):s._getIdTokenResponse(a)).catch(f=>{throw"auth/multi-factor-auth-required"===f.code?ne._fromErrorAndOperation(a,f,r,l):f})}function Ni(a){return new Set(a.map(({providerId:r})=>r).filter(r=>!!r))}function co(a,r){return Wt.apply(this,arguments)}function Wt(){return Wt=(0,m.Z)(function*(a,r){const s=(0,R.m9)(a);yield hr(!0,s,r);const{providerUserInfo:l}=yield function ot(a,r){return Z.apply(this,arguments)}(s.auth,{idToken:yield s.getIdToken(),deleteProvider:[r]}),d=Ni(l||[]);return s.providerData=s.providerData.filter(f=>d.has(f.providerId)),d.has("phone")||(s.phoneNumber=null),yield s.auth._persistUserIfCurrent(s),s}),Wt.apply(this,arguments)}function ei(a,r){return Ot.apply(this,arguments)}function Ot(){return(Ot=(0,m.Z)(function*(a,r,s=!1){const l=yield Ge(a,r._linkToIdToken(a.auth,yield a.getIdToken()),s);return Ut._forOperation(a,"link",l)})).apply(this,arguments)}function hr(a,r,s){return ht.apply(this,arguments)}function ht(){return(ht=(0,m.Z)(function*(a,r,s){yield gt(r);const d=!1===a?"provider-already-linked":"no-such-provider";M(Ni(r.providerData).has(s)===a,r.auth,d)})).apply(this,arguments)}function ho(a,r){return Oi.apply(this,arguments)}function Oi(){return(Oi=(0,m.Z)(function*(a,r,s=!1){const{auth:l}=a,d="reauthenticate";try{const f=yield Ge(a,bi(l,d,r,a),s);M(f.idToken,l,"internal-error");const S=xt(f.idToken);M(S,l,"internal-error");const{sub:L}=S;return M(a.uid===L,l,"user-mismatch"),Ut._forOperation(a,d,f)}catch(f){throw"auth/user-not-found"===f?.code&&Pe(l,"user-mismatch"),f}})).apply(this,arguments)}function fr(a,r){return qr.apply(this,arguments)}function qr(){return(qr=(0,m.Z)(function*(a,r,s=!1){const l="signIn",d=yield bi(a,l,r),f=yield Ut._fromIdTokenResponse(a,l,d);return s||(yield a._updateCurrentUser(f.user)),f})).apply(this,arguments)}function Di(a,r){return pr.apply(this,arguments)}function pr(){return(pr=(0,m.Z)(function*(a,r){return fr(et(a),r)})).apply(this,arguments)}function Jr(a,r){return yn.apply(this,arguments)}function yn(){return(yn=(0,m.Z)(function*(a,r){const s=(0,R.m9)(a);return yield hr(!1,s,r.providerId),ei(s,r)})).apply(this,arguments)}function Xr(a,r){return _r.apply(this,arguments)}function _r(){return(_r=(0,m.Z)(function*(a,r){return ho((0,R.m9)(a),r)})).apply(this,arguments)}function es(){return(es=(0,m.Z)(function*(a,r){return be(a,"POST","/v1/accounts:signInWithCustomToken",oe(a,r))})).apply(this,arguments)}function ca(a,r){return ke.apply(this,arguments)}function ke(){return ke=(0,m.Z)(function*(a,r){const s=et(a),l=yield function ua(a,r){return es.apply(this,arguments)}(s,{token:r,returnSecureToken:!0}),d=yield Ut._fromIdTokenResponse(s,"signIn",l);return yield s._updateCurrentUser(d.user),d}),ke.apply(this,arguments)}class gr{constructor(r,s){this.factorId=r,this.uid=s.mfaEnrollmentId,this.enrollmentTime=new Date(s.enrolledAt).toUTCString(),this.displayName=s.displayName}static _fromServerResponse(r,s){return"phoneInfo"in s?ts._fromServerResponse(r,s):Pe(r,"internal-error")}}class ts extends gr{constructor(r){super("phone",r),this.phoneNumber=r.phoneInfo}static _fromServerResponse(r,s){return new ts(s)}}function Un(a,r,s){var l;M((null===(l=s.url)||void 0===l?void 0:l.length)>0,a,"invalid-continue-uri"),M(typeof s.dynamicLinkDomain>"u"||s.dynamicLinkDomain.length>0,a,"invalid-dynamic-link-domain"),r.continueUrl=s.url,r.dynamicLinkDomain=s.dynamicLinkDomain,r.canHandleCodeInApp=s.handleCodeInApp,s.iOS&&(M(s.iOS.bundleId.length>0,a,"missing-ios-bundle-id"),r.iOSBundleId=s.iOS.bundleId),s.android&&(M(s.android.packageName.length>0,a,"missing-android-pkg-name"),r.androidInstallApp=s.android.installApp,r.androidMinimumVersionCode=s.android.minimumVersion,r.androidPackageName=s.android.packageName)}function ns(a,r,s){return In.apply(this,arguments)}function In(){return In=(0,m.Z)(function*(a,r,s){const l=(0,R.m9)(a),d={requestType:"PASSWORD_RESET",email:r};s&&Un(l,d,s),yield function ro(a,r){return Si.apply(this,arguments)}(l,d)}),In.apply(this,arguments)}function dn(a,r,s){return Wn.apply(this,arguments)}function Wn(){return(Wn=(0,m.Z)(function*(a,r,s){yield Gr((0,R.m9)(a),{oobCode:r,newPassword:s})})).apply(this,arguments)}function ee(a,r){return is.apply(this,arguments)}function is(){return is=(0,m.Z)(function*(a,r){yield function Ai(a,r){return qn.apply(this,arguments)}((0,R.m9)(a),{oobCode:r})}),is.apply(this,arguments)}function ti(a,r){return rs.apply(this,arguments)}function rs(){return(rs=(0,m.Z)(function*(a,r){const s=(0,R.m9)(a),l=yield Gr(s,{oobCode:r}),d=l.requestType;switch(M(d,s,"internal-error"),d){case"EMAIL_SIGNIN":break;case"VERIFY_AND_CHANGE_EMAIL":M(l.newEmail,s,"internal-error");break;case"REVERT_SECOND_FACTOR_ADDITION":M(l.mfaInfo,s,"internal-error");default:M(l.email,s,"internal-error")}let f=null;return l.mfaInfo&&(f=gr._fromServerResponse(et(s),l.mfaInfo)),{data:{email:("VERIFY_AND_CHANGE_EMAIL"===l.requestType?l.newEmail:l.email)||null,previousEmail:("VERIFY_AND_CHANGE_EMAIL"===l.requestType?l.email:l.newEmail)||null,multiFactorInfo:f},operation:d}})).apply(this,arguments)}function $e(a,r){return xi.apply(this,arguments)}function xi(){return(xi=(0,m.Z)(function*(a,r){const{data:s}=yield ti((0,R.m9)(a),r);return s.email})).apply(this,arguments)}function da(a,r,s){return Li.apply(this,arguments)}function Li(){return(Li=(0,m.Z)(function*(a,r,s){const l=et(a),d=yield Yr(l,{returnSecureToken:!0,email:r,password:s}),f=yield Ut._fromIdTokenResponse(l,"signIn",d);return yield l._updateCurrentUser(f.user),f})).apply(this,arguments)}function fo(a,r,s){return Di((0,R.m9)(a),lt.credential(r,s))}function ni(a,r,s){return Vn.apply(this,arguments)}function Vn(){return Vn=(0,m.Z)(function*(a,r,s){const l=(0,R.m9)(a),d={requestType:"EMAIL_SIGNIN",email:r};M(s.handleCodeInApp,l,"argument-error"),s&&Un(l,d,s),yield function dr(a,r){return Jn.apply(this,arguments)}(l,d)}),Vn.apply(this,arguments)}function Mi(a,r){return"EMAIL_SIGNIN"===Re.parseLink(r)?.operation}function ha(a,r,s){return Fi.apply(this,arguments)}function Fi(){return(Fi=(0,m.Z)(function*(a,r,s){const l=(0,R.m9)(a),d=lt.credentialWithLink(r,s||Ue());return M(d._tenantId===(l.tenantId||null),l,"tenant-id-mismatch"),Di(l,d)})).apply(this,arguments)}function ss(){return(ss=(0,m.Z)(function*(a,r){return ge(a,"POST","/v1/accounts:createAuthUri",oe(a,r))})).apply(this,arguments)}function mr(a,r){return os.apply(this,arguments)}function os(){return os=(0,m.Z)(function*(a,r){const l={identifier:r,continueUri:Oe()?Ue():"http://localhost"},{signinMethods:d}=yield function Ui(a,r){return ss.apply(this,arguments)}((0,R.m9)(a),l);return d||[]}),os.apply(this,arguments)}function fa(a,r){return as.apply(this,arguments)}function as(){return as=(0,m.Z)(function*(a,r){const s=(0,R.m9)(a),d={requestType:"VERIFY_EMAIL",idToken:yield a.getIdToken()};r&&Un(s.auth,d,r);const{email:f}=yield function io(a,r){return Mn.apply(this,arguments)}(s.auth,d);f!==a.email&&(yield a.reload())}),as.apply(this,arguments)}function ls(a,r,s){return us.apply(this,arguments)}function us(){return us=(0,m.Z)(function*(a,r,s){const l=(0,R.m9)(a),f={requestType:"VERIFY_AND_CHANGE_EMAIL",idToken:yield a.getIdToken(),newEmail:r};s&&Un(l.auth,f,s);const{email:S}=yield function Kr(a,r){return wi.apply(this,arguments)}(l.auth,f);S!==a.email&&(yield a.reload())}),us.apply(this,arguments)}function ds(){return(ds=(0,m.Z)(function*(a,r){return ge(a,"POST","/v1/accounts:update",r)})).apply(this,arguments)}function vr(a,r){return yr.apply(this,arguments)}function yr(){return yr=(0,m.Z)(function*(a,{displayName:r,photoURL:s}){if(void 0===r&&void 0===s)return;const l=(0,R.m9)(a),f={idToken:yield l.getIdToken(),displayName:r,photoUrl:s,returnSecureToken:!0},S=yield Ge(l,function cs(a,r){return ds.apply(this,arguments)}(l.auth,f));l.displayName=S.displayName||null,l.photoURL=S.photoUrl||null;const L=l.providerData.find(({providerId:K})=>"password"===K);L&&(L.displayName=l.displayName,L.photoURL=l.photoURL),yield l._updateTokensIfNecessary(S)}),yr.apply(this,arguments)}function po(a,r){return _o((0,R.m9)(a),r,null)}function Ir(a,r){return _o((0,R.m9)(a),null,r)}function _o(a,r,s){return ii.apply(this,arguments)}function ii(){return(ii=(0,m.Z)(function*(a,r,s){const{auth:l}=a,f={idToken:yield a.getIdToken(),returnSecureToken:!0};r&&(f.email=r),s&&(f.password=s);const S=yield Ge(a,Qn(l,f));yield a._updateTokensIfNecessary(S,!0)})).apply(this,arguments)}class En{constructor(r,s,l={}){this.isNewUser=r,this.providerId=s,this.profile=l}}class Er extends En{constructor(r,s,l,d){super(r,s,l),this.username=d}}class pa extends En{constructor(r,s){super(r,"facebook.com",s)}}class _a extends Er{constructor(r,s){super(r,"github.com",s,"string"==typeof s?.login?s?.login:null)}}class go extends En{constructor(r,s){super(r,"google.com",s)}}class ga extends Er{constructor(r,s,l){super(r,"twitter.com",s,l)}}function ma(a){const{user:r,_tokenResponse:s}=a;return r.isAnonymous&&!s?{providerId:null,isNewUser:!1,profile:null}:function ri(a){var r,s;if(!a)return null;const{providerId:l}=a,d=a.rawUserInfo?JSON.parse(a.rawUserInfo):{},f=a.isNewUser||"identitytoolkit#SignupNewUserResponse"===a.kind;if(!l&&a?.idToken){const S=null===(s=null===(r=xt(a.idToken))||void 0===r?void 0:r.firebase)||void 0===s?void 0:s.sign_in_provider;if(S)return new En(f,"anonymous"!==S&&"custom"!==S?S:null)}if(!l)return null;switch(l){case"facebook.com":return new pa(f,d);case"github.com":return new _a(f,d);case"google.com":return new go(f,d);case"twitter.com":return new ga(f,d,a.screenName||null);case"custom":case"anonymous":return new En(f,null);default:return new En(f,l,d)}}(s)}class kt{constructor(r,s,l){this.type=r,this.credential=s,this.auth=l}static _fromIdtoken(r,s){return new kt("enroll",r,s)}static _fromMfaPendingCredential(r){return new kt("signin",r)}toJSON(){return{multiFactorSession:{["enroll"===this.type?"idToken":"pendingCredential"]:this.credential}}}static fromJSON(r){var s,l;if(r?.multiFactorSession){if(null!==(s=r.multiFactorSession)&&void 0!==s&&s.pendingCredential)return kt._fromMfaPendingCredential(r.multiFactorSession.pendingCredential);if(null!==(l=r.multiFactorSession)&&void 0!==l&&l.idToken)return kt._fromIdtoken(r.multiFactorSession.idToken)}return null}}class ps{constructor(r,s,l){this.session=r,this.hints=s,this.signInResolver=l}static _fromError(r,s){const l=et(r),d=s.customData._serverResponse,f=(d.mfaInfo||[]).map(L=>gr._fromServerResponse(l,L));M(d.mfaPendingCredential,l,"internal-error");const S=kt._fromMfaPendingCredential(d.mfaPendingCredential);return new ps(S,f,function(){var L=(0,m.Z)(function*(K){const Q=yield K._process(l,S);delete d.mfaInfo,delete d.mfaPendingCredential;const re=Object.assign(Object.assign({},d),{idToken:Q.idToken,refreshToken:Q.refreshToken});switch(s.operationType){case"signIn":const We=yield Ut._fromIdTokenResponse(l,s.operationType,re);return yield l._updateCurrentUser(We.user),We;case"reauthenticate":return M(s.user,l,"internal-error"),Ut._forOperation(s.user,s.operationType,re);default:Pe(l,"internal-error")}});return function(K){return L.apply(this,arguments)}}())}resolveSignIn(r){var s=this;return(0,m.Z)(function*(){return s.signInResolver(r)})()}}function va(a,r){var s;const l=(0,R.m9)(a),d=r;return M(r.customData.operationType,l,"argument-error"),M(null===(s=d.customData._serverResponse)||void 0===s?void 0:s.mfaPendingCredential,l,"argument-error"),ps._fromError(l,d)}class oi{constructor(r){this.user=r,this.enrolledFactors=[],r._onReload(s=>{s.mfaInfo&&(this.enrolledFactors=s.mfaInfo.map(l=>gr._fromServerResponse(r.auth,l)))})}static _fromUser(r){return new oi(r)}getSession(){var r=this;return(0,m.Z)(function*(){return kt._fromIdtoken(yield r.user.getIdToken(),r.user.auth)})()}enroll(r,s){var l=this;return(0,m.Z)(function*(){const d=r,f=yield l.getSession(),S=yield Ge(l.user,d._process(l.user.auth,f,s));return yield l.user._updateTokensIfNecessary(S),l.user.reload()})()}unenroll(r){var s=this;return(0,m.Z)(function*(){const l="string"==typeof r?r:r.uid,d=yield s.user.getIdToken();try{const f=yield Ge(s.user,function Ia(a,r){return ge(a,"POST","/v2/accounts/mfaEnrollment:withdraw",oe(a,r))}(s.user.auth,{idToken:d,mfaEnrollmentId:l}));s.enrolledFactors=s.enrolledFactors.filter(({uid:S})=>S!==l),yield s.user._updateTokensIfNecessary(f),yield s.user.reload()}catch(f){throw f}})()}}const Bn=new WeakMap;function yo(a){const r=(0,R.m9)(a);return Bn.has(r)||Bn.set(r,oi._fromUser(r)),Bn.get(r)}const Zn="__sak";class Cn{constructor(r,s){this.storageRetriever=r,this.type=s}_isAvailable(){try{return this.storage?(this.storage.setItem(Zn,"1"),this.storage.removeItem(Zn),Promise.resolve(!0)):Promise.resolve(!1)}catch{return Promise.resolve(!1)}}_set(r,s){return this.storage.setItem(r,JSON.stringify(s)),Promise.resolve()}_get(r){const s=this.storage.getItem(r);return Promise.resolve(s?JSON.parse(s):null)}_remove(r){return this.storage.removeItem(r),Promise.resolve()}get storage(){return this.storageRetriever()}}const ai=(()=>{class a extends Cn{constructor(){super(()=>window.localStorage,"LOCAL"),this.boundEventHandler=(s,l)=>this.onStorageEvent(s,l),this.listeners={},this.localCache={},this.pollTimer=null,this.safariLocalStorageNotSynced=function _s(){const a=(0,R.z$)();return y(a)||Le(a)}()&&function xn(){try{return!(!window||window===window.top)}catch{return!1}}(),this.fallbackToPolling=Rt(),this._shouldAllowMigration=!0}forAllChangedKeys(s){for(const l of Object.keys(this.listeners)){const d=this.storage.getItem(l),f=this.localCache[l];d!==f&&s(l,f,d)}}onStorageEvent(s,l=!1){if(!s.key)return void this.forAllChangedKeys((L,K,Q)=>{this.notifyListeners(L,Q)});const d=s.key;if(l?this.detachListener():this.stopPolling(),this.safariLocalStorageNotSynced){const L=this.storage.getItem(d);if(s.newValue!==L)null!==s.newValue?this.storage.setItem(d,s.newValue):this.storage.removeItem(d);else if(this.localCache[d]===s.newValue&&!l)return}const f=()=>{const L=this.storage.getItem(d);!l&&this.localCache[d]===L||this.notifyListeners(d,L)},S=this.storage.getItem(d);!function ae(){return(0,R.w1)()&&10===document.documentMode}()||S===s.newValue||s.newValue===s.oldValue?f():setTimeout(f,10)}notifyListeners(s,l){this.localCache[s]=l;const d=this.listeners[s];if(d)for(const f of Array.from(d))f(l&&JSON.parse(l))}startPolling(){this.stopPolling(),this.pollTimer=setInterval(()=>{this.forAllChangedKeys((s,l,d)=>{this.onStorageEvent(new StorageEvent("storage",{key:s,oldValue:l,newValue:d}),!0)})},1e3)}stopPolling(){this.pollTimer&&(clearInterval(this.pollTimer),this.pollTimer=null)}attachListener(){window.addEventListener("storage",this.boundEventHandler)}detachListener(){window.removeEventListener("storage",this.boundEventHandler)}_addListener(s,l){0===Object.keys(this.listeners).length&&(this.fallbackToPolling?this.startPolling():this.attachListener()),this.listeners[s]||(this.listeners[s]=new Set,this.localCache[s]=this.storage.getItem(s)),this.listeners[s].add(l)}_removeListener(s,l){this.listeners[s]&&(this.listeners[s].delete(l),0===this.listeners[s].size&&delete this.listeners[s]),0===Object.keys(this.listeners).length&&(this.detachListener(),this.stopPolling())}_set(s,l){var d=()=>super._set,f=this;return(0,m.Z)(function*(){yield d().call(f,s,l),f.localCache[s]=JSON.stringify(l)})()}_get(s){var l=()=>super._get,d=this;return(0,m.Z)(function*(){const f=yield l().call(d,s);return d.localCache[s]=JSON.stringify(f),f})()}_remove(s){var l=()=>super._remove,d=this;return(0,m.Z)(function*(){yield l().call(d,s),delete d.localCache[s]})()}}return a.type="LOCAL",a})(),Cr=(()=>{class a extends Cn{constructor(){super(()=>window.sessionStorage,"SESSION")}_addListener(s,l){}_removeListener(s,l){}}return a.type="SESSION",a})();let Hn=(()=>{class a{constructor(s){this.eventTarget=s,this.handlersMap={},this.boundEventHandler=this.handleEvent.bind(this)}static _getInstance(s){const l=this.receivers.find(f=>f.isListeningto(s));if(l)return l;const d=new a(s);return this.receivers.push(d),d}isListeningto(s){return this.eventTarget===s}handleEvent(s){var l=this;return(0,m.Z)(function*(){const d=s,{eventId:f,eventType:S,data:L}=d.data,K=l.handlersMap[S];if(!K?.size)return;d.ports[0].postMessage({status:"ack",eventId:f,eventType:S});const Q=Array.from(K).map(function(){var We=(0,m.Z)(function*(Xt){return Xt(d.origin,L)});return function(Xt){return We.apply(this,arguments)}}()),re=yield function gs(a){return Promise.all(a.map(function(){var r=(0,m.Z)(function*(s){try{return{fulfilled:!0,value:yield s}}catch(l){return{fulfilled:!1,reason:l}}});return function(s){return r.apply(this,arguments)}}()))}(Q);d.ports[0].postMessage({status:"done",eventId:f,eventType:S,response:re})})()}_subscribe(s,l){0===Object.keys(this.handlersMap).length&&this.eventTarget.addEventListener("message",this.boundEventHandler),this.handlersMap[s]||(this.handlersMap[s]=new Set),this.handlersMap[s].add(l)}_unsubscribe(s,l){this.handlersMap[s]&&l&&this.handlersMap[s].delete(l),(!l||0===this.handlersMap[s].size)&&delete this.handlersMap[s],0===Object.keys(this.handlersMap).length&&this.eventTarget.removeEventListener("message",this.boundEventHandler)}}return a.receivers=[],a})();function li(a="",r=10){let s="";for(let l=0;l<r;l++)s+=Math.floor(10*Math.random());return a+s}class An{constructor(r){this.target=r,this.handlers=new Set}removeMessageHandler(r){r.messageChannel&&(r.messageChannel.port1.removeEventListener("message",r.onMessage),r.messageChannel.port1.close()),this.handlers.delete(r)}_send(r,s,l=50){var d=this;return(0,m.Z)(function*(){const f=typeof MessageChannel<"u"?new MessageChannel:null;if(!f)throw new Error("connection_unavailable");let S,L;return new Promise((K,Q)=>{const re=li("",20);f.port1.start();const We=setTimeout(()=>{Q(new Error("unsupported_event"))},l);L={messageChannel:f,onMessage(Xt){const en=Xt;if(en.data.eventId===re)switch(en.data.status){case"ack":clearTimeout(We),S=setTimeout(()=>{Q(new Error("timeout"))},3e3);break;case"done":clearTimeout(S),K(en.data.response);break;default:clearTimeout(We),clearTimeout(S),Q(new Error("invalid_response"))}}},d.handlers.add(L),f.port1.addEventListener("message",L.onMessage),d.target.postMessage({eventType:r,eventId:re,data:s},[f.port2])}).finally(()=>{L&&d.removeMessageHandler(L)})})()}}function qe(){return window}function Ar(){return typeof qe().WorkerGlobalScope<"u"&&"function"==typeof qe().importScripts}function ms(){return(ms=(0,m.Z)(function*(){if(!navigator?.serviceWorker)return null;try{return(yield navigator.serviceWorker.ready).active}catch{return null}})).apply(this,arguments)}const Eo="firebaseLocalStorageDb",Aa=1,wr="firebaseLocalStorage",To="fbase_key";class ci{constructor(r){this.request=r}toPromise(){return new Promise((r,s)=>{this.request.addEventListener("success",()=>{r(this.request.result)}),this.request.addEventListener("error",()=>{s(this.request.error)})})}}function Vi(a,r){return a.transaction([wr],r?"readwrite":"readonly").objectStore(wr)}function vs(){const a=indexedDB.open(Eo,Aa);return new Promise((r,s)=>{a.addEventListener("error",()=>{s(a.error)}),a.addEventListener("upgradeneeded",()=>{const l=a.result;try{l.createObjectStore(wr,{keyPath:To})}catch(d){s(d)}}),a.addEventListener("success",(0,m.Z)(function*(){const l=a.result;l.objectStoreNames.contains(wr)?r(l):(l.close(),yield function Sa(){const a=indexedDB.deleteDatabase(Eo);return new ci(a).toPromise()}(),r(yield vs()))}))})}function Co(a,r,s){return ys.apply(this,arguments)}function ys(){return(ys=(0,m.Z)(function*(a,r,s){const l=Vi(a,!0).put({[To]:r,value:s});return new ci(l).toPromise()})).apply(this,arguments)}function Is(){return(Is=(0,m.Z)(function*(a,r){const s=Vi(a,!1).get(r),l=yield new ci(s).toPromise();return void 0===l?null:l.value})).apply(this,arguments)}function Bi(a,r){const s=Vi(a,!0).delete(r);return new ci(s).toPromise()}const So=(()=>{class a{constructor(){this.type="LOCAL",this._shouldAllowMigration=!0,this.listeners={},this.localCache={},this.pollTimer=null,this.pendingWrites=0,this.receiver=null,this.sender=null,this.serviceWorkerReceiverAvailable=!1,this.activeServiceWorker=null,this._workerInitializationPromise=this.initializeServiceWorkerMessaging().then(()=>{},()=>{})}_openDb(){var s=this;return(0,m.Z)(function*(){return s.db||(s.db=yield vs()),s.db})()}_withRetries(s){var l=this;return(0,m.Z)(function*(){let d=0;for(;;)try{const f=yield l._openDb();return yield s(f)}catch(f){if(d++>3)throw f;l.db&&(l.db.close(),l.db=void 0)}})()}initializeServiceWorkerMessaging(){var s=this;return(0,m.Z)(function*(){return Ar()?s.initializeReceiver():s.initializeSender()})()}initializeReceiver(){var s=this;return(0,m.Z)(function*(){s.receiver=Hn._getInstance(function Ca(){return Ar()?self:null}()),s.receiver._subscribe("keyChanged",function(){var l=(0,m.Z)(function*(d,f){return{keyProcessed:(yield s._poll()).includes(f.key)}});return function(d,f){return l.apply(this,arguments)}}()),s.receiver._subscribe("ping",function(){var l=(0,m.Z)(function*(d,f){return["keyChanged"]});return function(d,f){return l.apply(this,arguments)}}())})()}initializeSender(){var s=this;return(0,m.Z)(function*(){var l,d;if(s.activeServiceWorker=yield function Sr(){return ms.apply(this,arguments)}(),!s.activeServiceWorker)return;s.sender=new An(s.activeServiceWorker);const f=yield s.sender._send("ping",{},800);f&&null!==(l=f[0])&&void 0!==l&&l.fulfilled&&null!==(d=f[0])&&void 0!==d&&d.value.includes("keyChanged")&&(s.serviceWorkerReceiverAvailable=!0)})()}notifyServiceWorker(s){var l=this;return(0,m.Z)(function*(){if(l.sender&&l.activeServiceWorker&&function Ta(){var a;return(null===(a=navigator?.serviceWorker)||void 0===a?void 0:a.controller)||null}()===l.activeServiceWorker)try{yield l.sender._send("keyChanged",{key:s},l.serviceWorkerReceiverAvailable?800:50)}catch{}})()}_isAvailable(){return(0,m.Z)(function*(){try{if(!indexedDB)return!1;const s=yield vs();return yield Co(s,Zn,"1"),yield Bi(s,Zn),!0}catch{}return!1})()}_withPendingWrite(s){var l=this;return(0,m.Z)(function*(){l.pendingWrites++;try{yield s()}finally{l.pendingWrites--}})()}_set(s,l){var d=this;return(0,m.Z)(function*(){return d._withPendingWrite((0,m.Z)(function*(){return yield d._withRetries(f=>Co(f,s,l)),d.localCache[s]=l,d.notifyServiceWorker(s)}))})()}_get(s){var l=this;return(0,m.Z)(function*(){const d=yield l._withRetries(f=>function wa(a,r){return Is.apply(this,arguments)}(f,s));return l.localCache[s]=d,d})()}_remove(s){var l=this;return(0,m.Z)(function*(){return l._withPendingWrite((0,m.Z)(function*(){return yield l._withRetries(d=>Bi(d,s)),delete l.localCache[s],l.notifyServiceWorker(s)}))})()}_poll(){var s=this;return(0,m.Z)(function*(){const l=yield s._withRetries(S=>{const L=Vi(S,!1).getAll();return new ci(L).toPromise()});if(!l)return[];if(0!==s.pendingWrites)return[];const d=[],f=new Set;for(const{fbase_key:S,value:L}of l)f.add(S),JSON.stringify(s.localCache[S])!==JSON.stringify(L)&&(s.notifyListeners(S,L),d.push(S));for(const S of Object.keys(s.localCache))s.localCache[S]&&!f.has(S)&&(s.notifyListeners(S,null),d.push(S));return d})()}notifyListeners(s,l){this.localCache[s]=l;const d=this.listeners[s];if(d)for(const f of Array.from(d))f(l)}startPolling(){var s=this;this.stopPolling(),this.pollTimer=setInterval((0,m.Z)(function*(){return s._poll()}),800)}stopPolling(){this.pollTimer&&(clearInterval(this.pollTimer),this.pollTimer=null)}_addListener(s,l){0===Object.keys(this.listeners).length&&this.startPolling(),this.listeners[s]||(this.listeners[s]=new Set,this._get(s)),this.listeners[s].add(l)}_removeListener(s,l){this.listeners[s]&&(this.listeners[s].delete(l),0===this.listeners[s].size&&delete this.listeners[s]),0===Object.keys(this.listeners).length&&this.stopPolling()}}return a.type="LOCAL",a})();function As(){return(As=(0,m.Z)(function*(a){return(yield ge(a,"GET","/v1/recaptchaParams")).recaptchaSiteKey||""})).apply(this,arguments)}function Ss(a){return new Promise((r,s)=>{const l=document.createElement("script");l.setAttribute("src",a),l.onload=r,l.onerror=d=>{const f=ue("internal-error");f.customData=d,s(f)},l.type="text/javascript",l.charset="UTF-8",function Ra(){var a,r;return null!==(r=null===(a=document.getElementsByTagName("head"))||void 0===a?void 0:a[0])&&void 0!==r?r:document}().appendChild(l)})}function Rr(a){return`__${a}${Math.floor(1e6*Math.random())}`}const kr=1e12;class ba{constructor(r){this.auth=r,this.counter=kr,this._widgets=new Map}render(r,s){const l=this.counter;return this._widgets.set(l,new ko(r,this.auth.name,s||{})),this.counter++,l}reset(r){var s;const l=r||kr;null===(s=this._widgets.get(l))||void 0===s||s.delete(),this._widgets.delete(l)}getResponse(r){var s;return(null===(s=this._widgets.get(r||kr))||void 0===s?void 0:s.getResponse())||""}execute(r){var s=this;return(0,m.Z)(function*(){var l;return null===(l=s._widgets.get(r||kr))||void 0===l||l.execute(),""})()}}class ko{constructor(r,s,l){this.params=l,this.timerId=null,this.deleted=!1,this.responseToken=null,this.clickHandler=()=>{this.execute()};const d="string"==typeof r?document.getElementById(r):r;M(d,"argument-error",{appName:s}),this.container=d,this.isVisible="invisible"!==this.params.size,this.isVisible?this.execute():this.container.addEventListener("click",this.clickHandler)}getResponse(){return this.checkIfDeleted(),this.responseToken}delete(){this.checkIfDeleted(),this.deleted=!0,this.timerId&&(clearTimeout(this.timerId),this.timerId=null),this.container.removeEventListener("click",this.clickHandler)}execute(){this.checkIfDeleted(),!this.timerId&&(this.timerId=window.setTimeout(()=>{this.responseToken=function Pr(a){const r=[],s="1234567890abcdefghijklmnopqrstuvwxyzABCDEFGHIJKLMNOPQRSTUVWXYZ";for(let l=0;l<a;l++)r.push(s.charAt(Math.floor(Math.random()*s.length)));return r.join("")}(50);const{callback:r,"expired-callback":s}=this.params;if(r)try{r(this.responseToken)}catch{}this.timerId=window.setTimeout(()=>{if(this.timerId=null,this.responseToken=null,s)try{s()}catch{}this.isVisible&&this.execute()},6e4)},500))}checkIfDeleted(){if(this.deleted)throw new Error("reCAPTCHA mock was already deleted!")}}const Zi=Rr("rcb"),Po=new Ae(3e4,6e4);class bo{constructor(){var r;this.hostLanguage="",this.counter=0,this.librarySeparatelyLoaded=!(null===(r=qe().grecaptcha)||void 0===r||!r.render)}load(r,s=""){return M(function ws(a){return a.length<=6&&/^\s*[a-zA-Z0-9\-]*\s*$/.test(a)}(s),r,"argument-error"),this.shouldResolveImmediately(s)?Promise.resolve(qe().grecaptcha):new Promise((l,d)=>{const f=qe().setTimeout(()=>{d(ue(r,"network-request-failed"))},Po.get());qe()[Zi]=()=>{qe().clearTimeout(f),delete qe()[Zi];const L=qe().grecaptcha;if(!L)return void d(ue(r,"internal-error"));const K=L.render;L.render=(Q,re)=>{const We=K(Q,re);return this.counter++,We},this.hostLanguage=s,l(L)},Ss(`https://www.google.com/recaptcha/api.js??${(0,R.xO)({onload:Zi,render:"explicit",hl:s})}`).catch(()=>{clearTimeout(f),d(ue(r,"internal-error"))})})}clearedOneInstance(){this.counter--}shouldResolveImmediately(r){var s;return!(null===(s=qe().grecaptcha)||void 0===s||!s.render)&&(r===this.hostLanguage||this.counter>0||this.librarySeparatelyLoaded)}}class Oa{load(r){return(0,m.Z)(function*(){return new ba(r)})()}clearedOneInstance(){}}const No="recaptcha",Da={theme:"light",type:"image"};class xa{constructor(r,s=Object.assign({},Da),l){this.parameters=s,this.type=No,this.destroyed=!1,this.widgetId=null,this.tokenChangeListeners=new Set,this.renderPromise=null,this.recaptcha=null,this.auth=et(l),this.isInvisible="invisible"===this.parameters.size,M(typeof document<"u",this.auth,"operation-not-supported-in-this-environment");const d="string"==typeof r?document.getElementById(r):r;M(d,this.auth,"argument-error"),this.container=d,this.parameters.callback=this.makeTokenCallback(this.parameters.callback),this._recaptchaLoader=this.auth.settings.appVerificationDisabledForTesting?new Oa:new bo,this.validateStartingState()}verify(){var r=this;return(0,m.Z)(function*(){r.assertNotDestroyed();const s=yield r.render(),l=r.getAssertedRecaptcha();return l.getResponse(s)||new Promise(f=>{const S=L=>{L&&(r.tokenChangeListeners.delete(S),f(L))};r.tokenChangeListeners.add(S),r.isInvisible&&l.execute(s)})})()}render(){try{this.assertNotDestroyed()}catch(r){return Promise.reject(r)}return this.renderPromise||(this.renderPromise=this.makeRenderPromise().catch(r=>{throw this.renderPromise=null,r})),this.renderPromise}_reset(){this.assertNotDestroyed(),null!==this.widgetId&&this.getAssertedRecaptcha().reset(this.widgetId)}clear(){this.assertNotDestroyed(),this.destroyed=!0,this._recaptchaLoader.clearedOneInstance(),this.isInvisible||this.container.childNodes.forEach(r=>{this.container.removeChild(r)})}validateStartingState(){M(!this.parameters.sitekey,this.auth,"argument-error"),M(this.isInvisible||!this.container.hasChildNodes(),this.auth,"argument-error"),M(typeof document<"u",this.auth,"operation-not-supported-in-this-environment")}makeTokenCallback(r){return s=>{if(this.tokenChangeListeners.forEach(l=>l(s)),"function"==typeof r)r(s);else if("string"==typeof r){const l=qe()[r];"function"==typeof l&&l(s)}}}assertNotDestroyed(){M(!this.destroyed,this.auth,"internal-error")}makeRenderPromise(){var r=this;return(0,m.Z)(function*(){if(yield r.init(),!r.widgetId){let s=r.container;if(!r.isInvisible){const l=document.createElement("div");s.appendChild(l),s=l}r.widgetId=r.getAssertedRecaptcha().render(s,r.parameters)}return r.widgetId})()}init(){var r=this;return(0,m.Z)(function*(){M(Oe()&&!Ar(),r.auth,"internal-error"),yield function La(){let a=null;return new Promise(r=>{"complete"!==document.readyState?(a=()=>r(),window.addEventListener("load",a)):r()}).catch(r=>{throw a&&window.removeEventListener("load",a),r})}(),r.recaptcha=yield r._recaptchaLoader.load(r.auth,r.auth.languageCode||void 0);const s=yield function Ro(a){return As.apply(this,arguments)}(r.auth);M(s,r.auth,"internal-error"),r.parameters.sitekey=s})()}getAssertedRecaptcha(){return M(this.recaptcha,this.auth,"internal-error"),this.recaptcha}}class Rs{constructor(r,s){this.verificationId=r,this.onConfirmation=s}confirm(r){const s=nt._fromVerification(this.verificationId,r);return this.onConfirmation(s)}}function Ma(a,r,s){return br.apply(this,arguments)}function br(){return(br=(0,m.Z)(function*(a,r,s){const l=et(a),d=yield Hi(l,r,(0,R.m9)(s));return new Rs(d,f=>Di(l,f))})).apply(this,arguments)}function Fa(a,r,s){return Nr.apply(this,arguments)}function Nr(){return(Nr=(0,m.Z)(function*(a,r,s){const l=(0,R.m9)(a);yield hr(!1,l,"phone");const d=yield Hi(l.auth,r,(0,R.m9)(s));return new Rs(d,f=>Jr(l,f))})).apply(this,arguments)}function Oo(a,r,s){return ks.apply(this,arguments)}function ks(){return(ks=(0,m.Z)(function*(a,r,s){const l=(0,R.m9)(a),d=yield Hi(l.auth,r,(0,R.m9)(s));return new Rs(d,f=>Xr(l,f))})).apply(this,arguments)}function Hi(a,r,s){return di.apply(this,arguments)}function di(){return di=(0,m.Z)(function*(a,r,s){var l;const d=yield s.verify();try{let f;if(M("string"==typeof d,a,"argument-error"),M(s.type===No,a,"argument-error"),f="string"==typeof r?{phoneNumber:r}:r,"session"in f){const S=f.session;if("phoneNumber"in f)return M("enroll"===S.type,a,"internal-error"),(yield function Wi(a,r){return ge(a,"POST","/v2/accounts/mfaEnrollment:start",oe(a,r))}(a,{idToken:S.credential,phoneEnrollmentInfo:{phoneNumber:f.phoneNumber,recaptchaToken:d}})).phoneSessionInfo.sessionInfo;{M("signin"===S.type,a,"internal-error");const L=(null===(l=f.multiFactorHint)||void 0===l?void 0:l.uid)||f.multiFactorUid;return M(L,a,"missing-multi-factor-info"),(yield function Cs(a,r){return ge(a,"POST","/v2/accounts/mfaSignIn:start",oe(a,r))}(a,{mfaPendingCredential:S.credential,mfaEnrollmentId:L,phoneSignInInfo:{recaptchaToken:d}})).phoneResponseInfo.sessionInfo}}{const{sessionInfo:S}=yield function w(a,r){return O.apply(this,arguments)}(a,{phoneNumber:f.phoneNumber,recaptchaToken:d});return S}}finally{s._reset()}}),di.apply(this,arguments)}function Do(a,r){return Ps.apply(this,arguments)}function Ps(){return(Ps=(0,m.Z)(function*(a,r){yield ei((0,R.m9)(a),r)})).apply(this,arguments)}let Ua=(()=>{class a{constructor(s){this.providerId=a.PROVIDER_ID,this.auth=et(s)}verifyPhoneNumber(s,l){return Hi(this.auth,s,(0,R.m9)(l))}static credential(s,l){return nt._fromVerification(s,l)}static credentialFromResult(s){return a.credentialFromTaggedObject(s)}static credentialFromError(s){return a.credentialFromTaggedObject(s.customData||{})}static credentialFromTaggedObject({_tokenResponse:s}){if(!s)return null;const{phoneNumber:l,temporaryProof:d}=s;return l&&d?nt._fromTokenResponse(l,d):null}}return a.PROVIDER_ID="phone",a.PHONE_SIGN_IN_METHOD="phone",a})();function Gn(a,r){return r?se(r):(M(a._popupRedirectResolver,a,"argument-error"),a._popupRedirectResolver)}class Gi extends an{constructor(r){super("custom","custom"),this.params=r}_getIdTokenResponse(r){return Qt(r,this._buildIdpRequest())}_linkToIdToken(r,s){return Qt(r,this._buildIdpRequest(s))}_getReauthenticationResolver(r){return Qt(r,this._buildIdpRequest())}_buildIdpRequest(r){const s={requestUri:this.params.requestUri,sessionId:this.params.sessionId,postBody:this.params.postBody,tenantId:this.params.tenantId,pendingToken:this.params.pendingToken,returnSecureToken:!0,returnIdpCredential:!0};return r&&(s.idToken=r),s}}function xo(a){return fr(a.auth,new Gi(a),a.bypassAuthState)}function Wa(a){const{auth:r,user:s}=a;return M(s,r,"internal-error"),ho(s,new Gi(a),a.bypassAuthState)}function Va(a){return Or.apply(this,arguments)}function Or(){return(Or=(0,m.Z)(function*(a){const{auth:r,user:s}=a;return M(s,r,"internal-error"),ei(s,new Gi(a),a.bypassAuthState)})).apply(this,arguments)}class hn{constructor(r,s,l,d,f=!1){this.auth=r,this.resolver=l,this.user=d,this.bypassAuthState=f,this.pendingPromise=null,this.eventManager=null,this.filter=Array.isArray(s)?s:[s]}execute(){var r=this;return new Promise(function(){var s=(0,m.Z)(function*(l,d){r.pendingPromise={resolve:l,reject:d};try{r.eventManager=yield r.resolver._initialize(r.auth),yield r.onExecution(),r.eventManager.registerConsumer(r)}catch(f){r.reject(f)}});return function(l,d){return s.apply(this,arguments)}}())}onAuthEvent(r){var s=this;return(0,m.Z)(function*(){const{urlResponse:l,sessionId:d,postBody:f,tenantId:S,error:L,type:K}=r;if(L)return void s.reject(L);const Q={auth:s.auth,requestUri:l,sessionId:d,tenantId:S||void 0,postBody:f||void 0,user:s.user,bypassAuthState:s.bypassAuthState};try{s.resolve(yield s.getIdpTask(K)(Q))}catch(re){s.reject(re)}})()}onError(r){this.reject(r)}getIdpTask(r){switch(r){case"signInViaPopup":case"signInViaRedirect":return xo;case"linkViaPopup":case"linkViaRedirect":return Va;case"reauthViaPopup":case"reauthViaRedirect":return Wa;default:Pe(this.auth,"internal-error")}}resolve(r){Ze(this.pendingPromise,"Pending promise was never set"),this.pendingPromise.resolve(r),this.unregisterAndCleanUp()}reject(r){Ze(this.pendingPromise,"Pending promise was never set"),this.pendingPromise.reject(r),this.unregisterAndCleanUp()}unregisterAndCleanUp(){this.eventManager&&this.eventManager.unregisterConsumer(this),this.pendingPromise=null,this.cleanUp()}}const Lo=new Ae(2e3,1e4);function Mo(a,r,s){return Jt.apply(this,arguments)}function Jt(){return(Jt=(0,m.Z)(function*(a,r,s){const l=et(a);rt(a,r,un);const d=Gn(l,s);return new Ns(l,"signInViaPopup",r,d).executeNotNull()})).apply(this,arguments)}function Dr(a,r,s){return hi.apply(this,arguments)}function hi(){return(hi=(0,m.Z)(function*(a,r,s){const l=(0,R.m9)(a);rt(l.auth,r,un);const d=Gn(l.auth,s);return new Ns(l.auth,"reauthViaPopup",r,d,l).executeNotNull()})).apply(this,arguments)}function Ba(a,r,s){return bs.apply(this,arguments)}function bs(){return(bs=(0,m.Z)(function*(a,r,s){const l=(0,R.m9)(a);rt(l.auth,r,un);const d=Gn(l.auth,s);return new Ns(l.auth,"linkViaPopup",r,d,l).executeNotNull()})).apply(this,arguments)}let Ns=(()=>{class a extends hn{constructor(s,l,d,f,S){super(s,l,f,S),this.provider=d,this.authWindow=null,this.pollId=null,a.currentPopupAction&&a.currentPopupAction.cancel(),a.currentPopupAction=this}executeNotNull(){var s=this;return(0,m.Z)(function*(){const l=yield s.execute();return M(l,s.auth,"internal-error"),l})()}onExecution(){var s=this;return(0,m.Z)(function*(){Ze(1===s.filter.length,"Popup operations only handle one event");const l=li();s.authWindow=yield s.resolver._openPopup(s.auth,s.provider,s.filter[0],l),s.authWindow.associatedEvent=l,s.resolver._originValidation(s.auth).catch(d=>{s.reject(d)}),s.resolver._isIframeWebStorageSupported(s.auth,d=>{d||s.reject(ue(s.auth,"web-storage-unsupported"))}),s.pollUserCancellation()})()}get eventId(){var s;return(null===(s=this.authWindow)||void 0===s?void 0:s.associatedEvent)||null}cancel(){this.reject(ue(this.auth,"cancelled-popup-request"))}cleanUp(){this.authWindow&&this.authWindow.close(),this.pollId&&window.clearTimeout(this.pollId),this.authWindow=null,this.pollId=null,a.currentPopupAction=null}pollUserCancellation(){const s=()=>{var l,d;this.pollId=null!==(d=null===(l=this.authWindow)||void 0===l?void 0:l.window)&&void 0!==d&&d.closed?window.setTimeout(()=>{this.pollId=null,this.reject(ue(this.auth,"popup-closed-by-user"))},2e3):window.setTimeout(s,Lo.get())};s()}}return a.currentPopupAction=null,a})();const Fo="pendingRedirect",$n=new Map;class Za extends hn{constructor(r,s,l=!1){super(r,["signInViaRedirect","linkViaRedirect","reauthViaRedirect","unknown"],s,void 0,l),this.eventId=null}execute(){var r=()=>super.execute,s=this;return(0,m.Z)(function*(){let l=$n.get(s.auth._key());if(!l){try{const f=(yield function Sn(a,r){return Kn.apply(this,arguments)}(s.resolver,s.auth))?yield r().call(s):null;l=()=>Promise.resolve(f)}catch(d){l=()=>Promise.reject(d)}$n.set(s.auth._key(),l)}return s.bypassAuthState||$n.set(s.auth._key(),()=>Promise.resolve(null)),l()})()}onAuthEvent(r){var s=()=>super.onAuthEvent,l=this;return(0,m.Z)(function*(){if("signInViaRedirect"===r.type)return s().call(l,r);if("unknown"!==r.type){if(r.eventId){const d=yield l.auth._redirectUserForId(r.eventId);if(d)return l.user=d,s().call(l,r);l.resolve(null)}}else l.resolve(null)})()}onExecution(){return(0,m.Z)(function*(){})()}cleanUp(){}}function Kn(){return(Kn=(0,m.Z)(function*(a,r){const s=Uo(r),l=xs(a);if(!(yield l._isAvailable()))return!1;const d="true"===(yield l._get(s));return yield l._remove(s),d})).apply(this,arguments)}function Os(a,r){return Ds.apply(this,arguments)}function Ds(){return(Ds=(0,m.Z)(function*(a,r){return xs(a)._set(Uo(r),"true")})).apply(this,arguments)}function Ha(){$n.clear()}function $i(a,r){$n.set(a._key(),r)}function xs(a){return se(a._redirectPersistence)}function Uo(a){return Yt(Fo,a.config.apiKey,a.name)}function Ls(a,r,s){return function xr(a,r,s){return Ms.apply(this,arguments)}(a,r,s)}function Ms(){return(Ms=(0,m.Z)(function*(a,r,s){const l=et(a);rt(a,r,un),yield l._initializationPromise;const d=Gn(l,s);return yield Os(d,l),d._openRedirect(l,r,"signInViaRedirect")})).apply(this,arguments)}function fi(a,r,s){return function Wo(a,r,s){return Lr.apply(this,arguments)}(a,r,s)}function Lr(){return(Lr=(0,m.Z)(function*(a,r,s){const l=(0,R.m9)(a);rt(l.auth,r,un),yield l.auth._initializationPromise;const d=Gn(l.auth,s);yield Os(d,l.auth);const f=yield _i(l);return d._openRedirect(l.auth,r,"reauthViaRedirect",f)})).apply(this,arguments)}function Vo(a,r,s){return function Ki(a,r,s){return pi.apply(this,arguments)}(a,r,s)}function pi(){return(pi=(0,m.Z)(function*(a,r,s){const l=(0,R.m9)(a);rt(l.auth,r,un),yield l.auth._initializationPromise;const d=Gn(l.auth,s);yield hr(!1,l,r.providerId),yield Os(d,l.auth);const f=yield _i(l);return d._openRedirect(l.auth,r,"linkViaRedirect",f)})).apply(this,arguments)}function Fs(a,r){return zi.apply(this,arguments)}function zi(){return(zi=(0,m.Z)(function*(a,r){return yield et(a)._initializationPromise,ji(a,r,!1)})).apply(this,arguments)}function ji(a,r){return Us.apply(this,arguments)}function Us(){return(Us=(0,m.Z)(function*(a,r,s=!1){const l=et(a),d=Gn(l,r),S=yield new Za(l,d,s).execute();return S&&!s&&(delete S.user._redirectEventId,yield l._persistUserIfCurrent(S.user),yield l._setRedirectUser(null,r)),S})).apply(this,arguments)}function _i(a){return Ws.apply(this,arguments)}function Ws(){return(Ws=(0,m.Z)(function*(a){const r=li(`${a.uid}:::`);return a._redirectEventId=r,yield a.auth._setRedirectUser(a),yield a.auth._persistUserIfCurrent(a),r})).apply(this,arguments)}class Bo{constructor(r){this.auth=r,this.cachedEventUids=new Set,this.consumers=new Set,this.queuedRedirectEvent=null,this.hasHandledPotentialRedirect=!1,this.lastProcessedEventTime=Date.now()}registerConsumer(r){this.consumers.add(r),this.queuedRedirectEvent&&this.isEventForConsumer(this.queuedRedirectEvent,r)&&(this.sendToConsumer(this.queuedRedirectEvent,r),this.saveEventToCache(this.queuedRedirectEvent),this.queuedRedirectEvent=null)}unregisterConsumer(r){this.consumers.delete(r)}onEvent(r){if(this.hasEventBeenHandled(r))return!1;let s=!1;return this.consumers.forEach(l=>{this.isEventForConsumer(r,l)&&(s=!0,this.sendToConsumer(r,l),this.saveEventToCache(r))}),this.hasHandledPotentialRedirect||!function $a(a){switch(a.type){case"signInViaRedirect":case"linkViaRedirect":case"reauthViaRedirect":return!0;case"unknown":return Fr(a);default:return!1}}(r)||(this.hasHandledPotentialRedirect=!0,s||(this.queuedRedirectEvent=r,s=!0)),s}sendToConsumer(r,s){var l;if(r.error&&!Fr(r)){const d=(null===(l=r.error.code)||void 0===l?void 0:l.split("auth/")[1])||"internal-error";s.onError(ue(this.auth,d))}else s.onAuthEvent(r)}isEventForConsumer(r,s){const l=null===s.eventId||!!r.eventId&&r.eventId===s.eventId;return s.filter.includes(r.type)&&l}hasEventBeenHandled(r){return Date.now()-this.lastProcessedEventTime>=6e5&&this.cachedEventUids.clear(),this.cachedEventUids.has(Mr(r))}saveEventToCache(r){this.cachedEventUids.add(Mr(r)),this.lastProcessedEventTime=Date.now()}}function Mr(a){return[a.type,a.eventId,a.sessionId,a.tenantId].filter(r=>r).join("-")}function Fr({type:a,error:r}){return"unknown"===a&&"auth/no-auth-event"===r?.code}function Vs(a){return Bs.apply(this,arguments)}function Bs(){return(Bs=(0,m.Z)(function*(a,r={}){return ge(a,"GET","/v1/projects",r)})).apply(this,arguments)}const Ka=/^\d{1,3}\.\d{1,3}\.\d{1,3}\.\d{1,3}$/,Zo=/^https?/;function Yi(){return(Yi=(0,m.Z)(function*(a){if(a.config.emulator)return;const{authorizedDomains:r}=yield Vs(a);for(const s of r)try{if(Hs(s))return}catch{}Pe(a,"unauthorized-domain")})).apply(this,arguments)}function Hs(a){const r=Ue(),{protocol:s,hostname:l}=new URL(r);if(a.startsWith("chrome-extension://")){const S=new URL(a);return""===S.hostname&&""===l?"chrome-extension:"===s&&a.replace("chrome-extension://","")===r.replace("chrome-extension://",""):"chrome-extension:"===s&&S.hostname===l}if(!Zo.test(s))return!1;if(Ka.test(a))return l===a;const d=a.replace(/\./g,"\\.");return new RegExp("^(.+\\."+d+"|"+d+")$","i").test(l)}const Ur=new Ae(3e4,6e4);function wn(){const a=qe().___jsl;if(a?.H)for(const r of Object.keys(a.H))if(a.H[r].r=a.H[r].r||[],a.H[r].L=a.H[r].L||[],a.H[r].r=[...a.H[r].L],a.CP)for(let s=0;s<a.CP.length;s++)a.CP[s]=null}let Qi=null;const Wr=new Ae(5e3,15e3),Ho="__/auth/iframe",ja="emulator/auth/iframe",qi={style:{position:"absolute",top:"-100px",width:"1px",height:"1px"},"aria-hidden":"true",tabindex:"-1"},$s=new Map([["identitytoolkit.googleapis.com","p"],["staging-identitytoolkit.sandbox.googleapis.com","s"],["test-identitytoolkit.sandbox.googleapis.com","t"]]);function Ya(a){const r=a.config;M(r.authDomain,a,"auth-domain-config-required");const s=r.emulator?st(r,ja):`https://${a.config.authDomain}/${Ho}`,l={apiKey:r.apiKey,appName:a.name,v:C.SDK_VERSION},d=$s.get(a.config.apiHost);d&&(l.eid=d);const f=a._getFrameworks();return f.length&&(l.fw=f.join(",")),`${s}?${(0,R.xO)(l).slice(1)}`}function Ks(){return Ks=(0,m.Z)(function*(a){const r=yield function za(a){return Qi=Qi||function Gs(a){return new Promise((r,s)=>{var l,d,f;function S(){wn(),gapi.load("gapi.iframes",{callback:()=>{r(gapi.iframes.getContext())},ontimeout:()=>{wn(),s(ue(a,"network-request-failed"))},timeout:Ur.get()})}if(null!==(d=null===(l=qe().gapi)||void 0===l?void 0:l.iframes)&&void 0!==d&&d.Iframe)r(gapi.iframes.getContext());else{if(null===(f=qe().gapi)||void 0===f||!f.load){const L=Rr("iframefcb");return qe()[L]=()=>{gapi.load?S():s(ue(a,"network-request-failed"))},Ss(`https://apis.google.com/js/api.js?onload=${L}`).catch(K=>s(K))}S()}}).catch(r=>{throw Qi=null,r})}(a),Qi}(a),s=qe().gapi;return M(s,a,"internal-error"),r.open({where:document.body,url:Ya(a),messageHandlersFilter:s.iframes.CROSS_ORIGIN_IFRAMES_FILTER,attributes:qi,dontclear:!0},l=>new Promise(function(){var d=(0,m.Z)(function*(f,S){yield l.restyle({setHideOnLeave:!1});const L=ue(a,"network-request-failed"),K=qe().setTimeout(()=>{S(L)},Wr.get());function Q(){qe().clearTimeout(K),f(l)}l.ping(Q).then(Q,()=>{S(L)})});return function(f,S){return d.apply(this,arguments)}}()))}),Ks.apply(this,arguments)}const zs={location:"yes",resizable:"yes",statusbar:"yes",toolbar:"no"},Vr=500,Go=600,qa="_blank",Ji="http://localhost";class Kt{constructor(r){this.window=r,this.associatedEvent=null}close(){if(this.window)try{this.window.close()}catch{}}}const $o="__/auth/handler",js="emulator/auth/handler";function zn(a,r,s,l,d,f){M(a.config.authDomain,a,"auth-domain-config-required"),M(a.config.apiKey,a,"invalid-api-key");const S={apiKey:a.config.apiKey,appName:a.name,authType:s,redirectUrl:l,v:C.SDK_VERSION,eventId:d};if(r instanceof un){r.setDefaultLanguage(a.languageCode),S.providerId=r.providerId||"",(0,R.xb)(r.getCustomParameters())||(S.customParameters=JSON.stringify(r.getCustomParameters()));for(const[K,Q]of Object.entries(f||{}))S[K]=Q}if(r instanceof mn){const K=r.getScopes().filter(Q=>""!==Q);K.length>0&&(S.scopes=K.join(","))}a.tenantId&&(S.tid=a.tenantId);const L=S;for(const K of Object.keys(L))void 0===L[K]&&delete L[K];return`${function er({config:a}){return a.emulator?st(a,js):`https://${a.authDomain}/${$o}`}(a)}?${(0,R.xO)(L).slice(1)}`}const Ys="webStorageSupport",Qs=class Bt{constructor(){this.eventManagers={},this.iframes={},this.originValidationPromises={},this._redirectPersistence=Cr,this._completeRedirectFn=ji,this._overrideRedirectResult=$i}_openPopup(r,s,l,d){var f=this;return(0,m.Z)(function*(){var S;Ze(null===(S=f.eventManagers[r._key()])||void 0===S?void 0:S.manager,"_initialize() not called before _openPopup()");const L=zn(r,s,l,Ue(),d);return function Xi(a,r,s,l=Vr,d=Go){const f=Math.max((window.screen.availHeight-d)/2,0).toString(),S=Math.max((window.screen.availWidth-l)/2,0).toString();let L="";const K=Object.assign(Object.assign({},zs),{width:l.toString(),height:d.toString(),top:f,left:S}),Q=(0,R.z$)().toLowerCase();s&&(L=x(Q)?qa:s),E(Q)&&(r=r||Ji,K.scrollbars="yes");const re=Object.entries(K).reduce((Xt,[en,nr])=>`${Xt}${en}=${nr},`,"");if(function wt(a=(0,R.z$)()){var r;return Le(a)&&!(null===(r=window.navigator)||void 0===r||!r.standalone)}(Q)&&"_self"!==L)return function Ja(a,r){const s=document.createElement("a");s.href=a,s.target=r;const l=document.createEvent("MouseEvent");l.initMouseEvent("click",!0,!0,window,1,0,0,0,0,!1,!1,!1,!1,1,null),s.dispatchEvent(l)}(r||"",L),new Kt(null);const We=window.open(r||"",L,re);M(We,a,"popup-blocked");try{We.focus()}catch{}return new Kt(We)}(r,L,li())})()}_openRedirect(r,s,l,d){var f=this;return(0,m.Z)(function*(){return yield f._originValidation(r),function ui(a){qe().location.href=a}(zn(r,s,l,Ue(),d)),new Promise(()=>{})})()}_initialize(r){const s=r._key();if(this.eventManagers[s]){const{manager:d,promise:f}=this.eventManagers[s];return d?Promise.resolve(d):(Ze(f,"If manager is not set, promise should be"),f)}const l=this.initAndGetManager(r);return this.eventManagers[s]={promise:l},l.catch(()=>{delete this.eventManagers[s]}),l}initAndGetManager(r){var s=this;return(0,m.Z)(function*(){const l=yield function Qa(a){return Ks.apply(this,arguments)}(r),d=new Bo(r);return l.register("authEvent",f=>(M(f?.authEvent,r,"invalid-auth-event"),{status:d.onEvent(f.authEvent)?"ACK":"ERROR"}),gapi.iframes.CROSS_ORIGIN_IFRAMES_FILTER),s.eventManagers[r._key()]={manager:d},s.iframes[r._key()]=l,d})()}_isIframeWebStorageSupported(r,s){this.iframes[r._key()].send(Ys,{type:Ys},d=>{var f;const S=null===(f=d?.[0])||void 0===f?void 0:f[Ys];void 0!==S&&s(!!S),Pe(r,"internal-error")},gapi.iframes.CROSS_ORIGIN_IFRAMES_FILTER)}_originValidation(r){const s=r._key();return this.originValidationPromises[s]||(this.originValidationPromises[s]=function Zs(a){return Yi.apply(this,arguments)}(r)),this.originValidationPromises[s]}get _shouldInitProactively(){return Rt()||y()||Le()}};class Xa{constructor(r){this.factorId=r}_process(r,s,l){switch(s.type){case"enroll":return this._finalizeEnroll(r,s.credential,l);case"signin":return this._finalizeSignIn(r,s.credential);default:return Be("unexpected MultiFactorSessionType")}}}class gi extends Xa{constructor(r){super("phone"),this.credential=r}static _fromCredential(r){return new gi(r)}_finalizeEnroll(r,s,l){return function ya(a,r){return ge(a,"POST","/v2/accounts/mfaEnrollment:finalize",oe(a,r))}(r,{idToken:s,displayName:l,phoneVerificationInfo:this.credential._makeVerificationRequest()})}_finalizeSignIn(r,s){return function wo(a,r){return ge(a,"POST","/v2/accounts/mfaSignIn:finalize",oe(a,r))}(r,{mfaPendingCredential:s,phoneVerificationInfo:this.credential._makeVerificationRequest()})}}let Ko=(()=>{class a{constructor(){}static assertion(s){return gi._fromCredential(s)}}return a.FACTOR_ID="phone",a})();var Pt="@firebase/auth";class el{constructor(r){this.auth=r,this.internalListeners=new Map}getUid(){var r;return this.assertAuthConfigured(),(null===(r=this.auth.currentUser)||void 0===r?void 0:r.uid)||null}getToken(r){var s=this;return(0,m.Z)(function*(){return s.assertAuthConfigured(),yield s.auth._initializationPromise,s.auth.currentUser?{accessToken:yield s.auth.currentUser.getIdToken(r)}:null})()}addAuthTokenListener(r){if(this.assertAuthConfigured(),this.internalListeners.has(r))return;const s=this.auth.onIdTokenChanged(l=>{r(l?.stsTokenManager.accessToken||null)});this.internalListeners.set(r,s),this.updateProactiveRefresh()}removeAuthTokenListener(r){this.assertAuthConfigured();const s=this.internalListeners.get(r);s&&(this.internalListeners.delete(r),s(),this.updateProactiveRefresh())}assertAuthConfigured(){M(this.auth._initializationPromise,"dependent-sdk-initialized-before-auth")}updateProactiveRefresh(){this.internalListeners.size>0?this.auth._startProactiveRefresh():this.auth._stopProactiveRefresh()}}const il=(0,R.Pz)("authIdTokenMaxAge")||300;let Js=null;const tr=a=>function(){var r=(0,m.Z)(function*(s){const l=s&&(yield s.getIdTokenResult()),d=l&&((new Date).getTime()-Date.parse(l.issuedAtTime))/1e3;if(d&&d>il)return;const f=l?.token;Js!==f&&(Js=f,yield fetch(a,{method:f?"POST":"DELETE",headers:f?{Authorization:`Bearer ${f}`}:{}}))});return function(s){return r.apply(this,arguments)}}();function jo(a=(0,C.getApp)()){const r=(0,C._getProvider)(a,"auth");if(r.isInitialized())return r.getImmediate();const s=function Gt(a,r){const s=(0,C._getProvider)(a,"auth");if(s.isInitialized()){const d=s.getImmediate(),f=s.getOptions();if((0,R.vZ)(f,r??{}))return d;Pe(d,"already-initialized")}return s.initialize({options:r})}(a,{popupRedirectResolver:Qs,persistence:[So,ai,Cr]}),l=(0,R.Pz)("authTokenSyncURL");if(l){const f=tr(l);(function hs(a,r,s){(0,R.m9)(a).beforeAuthStateChanged(r,s)})(s,f,()=>f(s.currentUser)),function Vt(a,r,s,l){(0,R.m9)(a).onIdTokenChanged(r,s,l)}(s,S=>f(S))}const d=(0,R.q4)("auth");return d&&Ei(s,`http://${d}`),s}!function tl(a){(0,C._registerComponent)(new te.wA("auth",(r,{options:s})=>{const l=r.getProvider("app").getImmediate(),d=r.getProvider("heartbeat"),{apiKey:f,authDomain:S}=l.options;return((L,K)=>{M(f&&!f.includes(":"),"invalid-api-key",{appName:L.name}),M(!S?.includes(":"),"argument-error",{appName:L.name});const Q={apiKey:f,authDomain:S,clientPlatform:a,apiHost:"identitytoolkit.googleapis.com",tokenApiHost:"securetoken.googleapis.com",apiScheme:"https",sdkClientVersion:Yn(a)},re=new lr(L,K,Q);return function Ne(a,r){const s=r?.persistence||[],l=(Array.isArray(s)?s:[s]).map(se);r?.errorMap&&a._updateErrorMap(r.errorMap),a._initializeWithPersistence(l,r?.popupRedirectResolver)}(re,s),re})(l,d)},"PUBLIC").setInstantiationMode("EXPLICIT").setInstanceCreatedCallback((r,s,l)=>{r.getProvider("auth-internal").initialize()})),(0,C._registerComponent)(new te.wA("auth-internal",r=>{const s=et(r.getProvider("auth").getImmediate());return new el(s)},"PRIVATE").setInstantiationMode("EXPLICIT")),(0,C.registerVersion)(Pt,"0.21.4",function zo(a){switch(a){case"Node":return"node";case"ReactNative":return"rn";case"Worker":return"webworker";case"Cordova":return"cordova";default:return}}(a)),(0,C.registerVersion)(Pt,"0.21.4","esm2017")}("Browser")},2894:(Ht,Fe,A)=>{A.d(Fe,{r:()=>hc});var m=A(1135),R=A(4004),C=A(3900),H=A(4650),F=A(4761),te=A(4986),V=A(9751),j=A(9646),ye=A(6451),pt=A(3099),ie=A(5026),pe=A(1884),Se=A(4482),Ce=A(5403),Ve=A(8421),p=A(4671),_e=A(5032),je=A(3269),ue=A(2122),Je=A(2011),tt=(A(9568),A(3942)),M=A(3475),Be=A(5861),Ze=A(9681),g=A(2090),se=A(1877);const Gt="@firebase/database";let Ue="";function Oe(n){Ue=n}class It{constructor(t){this.domStorage_=t,this.prefix_="firebase:"}set(t,e){null==e?this.domStorage_.removeItem(this.prefixedName_(t)):this.domStorage_.setItem(this.prefixedName_(t),(0,g.Wl)(e))}get(t){const e=this.domStorage_.getItem(this.prefixedName_(t));return null==e?null:(0,g.cI)(e)}remove(t){this.domStorage_.removeItem(this.prefixedName_(t))}prefixedName_(t){return this.prefix_+t}toString(){return this.domStorage_.toString()}}class Dt{constructor(){this.cache_={},this.isInMemoryStorage=!0}set(t,e){null==e?delete this.cache_[t]:this.cache_[t]=e}get(t){return(0,g.r3)(this.cache_,t)?this.cache_[t]:null}remove(t){delete this.cache_[t]}}const Xe=function(n){try{if(typeof window<"u"&&typeof window[n]<"u"){const t=window[n];return t.setItem("firebase:sentinel","cache"),t.removeItem("firebase:sentinel"),new It(t)}}catch{}return new Dt},Ae=Xe("localStorage"),st=Xe("sessionStorage"),He=new se.Yd("@firebase/database"),Et=function(){let n=1;return function(){return n++}}(),De=function(n){const t=(0,g.dS)(n),e=new g.gQ;e.update(t);const i=e.digest();return g.US.encodeByteArray(i)},oe=function(...n){let t="";for(let e=0;e<n.length;e++){const i=n[e];Array.isArray(i)||i&&"object"==typeof i&&"number"==typeof i.length?t+=oe.apply(null,i):t+="object"==typeof i?(0,g.Wl)(i):i,t+=" "}return t};let ge=null,Tt=!0;const _t=function(n,t){(0,g.hu)(!t||!0===n||!1===n,"Can't turn on custom loggers persistently."),!0===n?(He.logLevel=se.in.VERBOSE,ge=He.log.bind(He),t&&st.set("logging_enabled",!0)):"function"==typeof n?ge=n:(ge=null,st.remove("logging_enabled"))},fe=function(...n){if(!0===Tt&&(Tt=!1,null===ge&&!0===st.get("logging_enabled")&&_t(!0)),ge){const t=oe.apply(null,n);ge(t)}},be=function(n){return function(...t){fe(n,...t)}},ut=function(...n){const t="FIREBASE INTERNAL ERROR: "+oe(...n);He.error(t)},Ke=function(...n){const t=`FIREBASE FATAL ERROR: ${oe(...n)}`;throw He.error(t),new Error(t)},we=function(...n){const t="FIREBASE WARNING: "+oe(...n);He.warn(t)},Ye=function(n){return"number"==typeof n&&(n!=n||n===Number.POSITIVE_INFINITY||n===Number.NEGATIVE_INFINITY)},ot="[MIN_NAME]",Z="[MAX_NAME]",J=function(n,t){if(n===t)return 0;if(n===ot||t===Z)return-1;if(t===ot||n===Z)return 1;{const e=rn(n),i=rn(t);return null!==e?null!==i?e-i==0?n.length-t.length:e-i:-1:null!==i?1:n<t?-1:1}},N=function(n,t){return n===t?0:n<t?-1:1},$=function(n,t){if(t&&n in t)return t[n];throw new Error("Missing required key ("+n+") in object: "+(0,g.Wl)(t))},Ee=function(n){if("object"!=typeof n||null===n)return(0,g.Wl)(n);const t=[];for(const i in n)t.push(i);t.sort();let e="{";for(let i=0;i<t.length;i++)0!==i&&(e+=","),e+=(0,g.Wl)(t[i]),e+=":",e+=Ee(n[t[i]]);return e+="}",e},xe=function(n,t){const e=n.length;if(e<=t)return[n];const i=[];for(let o=0;o<e;o+=t)i.push(n.substring(o,o+t>e?e:o+t));return i};function he(n,t){for(const e in n)n.hasOwnProperty(e)&&t(e,n[e])}const Ct=function(n){(0,g.hu)(!Ye(n),"Invalid JSON number");const i=1023;let o,u,c,h,_;0===n?(u=0,c=0,o=1/n==-1/0?1:0):(o=n<0,(n=Math.abs(n))>=Math.pow(2,1-i)?(h=Math.min(Math.floor(Math.log(n)/Math.LN2),i),u=h+i,c=Math.round(n*Math.pow(2,52-h)-Math.pow(2,52))):(u=0,c=Math.round(n/Math.pow(2,-1074))));const v=[];for(_=52;_;_-=1)v.push(c%2?1:0),c=Math.floor(c/2);for(_=11;_;_-=1)v.push(u%2?1:0),u=Math.floor(u/2);v.push(o?1:0),v.reverse();const P=v.join("");let b="";for(_=0;_<64;_+=8){let D=parseInt(P.substr(_,8),2).toString(16);1===D.length&&(D="0"+D),b+=D}return b.toLowerCase()},At=new RegExp("^-?(0*)\\d{1,10}$"),rn=function(n){if(At.test(n)){const t=Number(n);if(t>=-2147483648&&t<=2147483647)return t}return null},gt=function(n){try{n()}catch(t){setTimeout(()=>{throw we("Exception was thrown by user callback.",t.stack||""),t},Math.floor(0))}},ze=function(){return("object"==typeof window&&window.navigator&&window.navigator.userAgent||"").search(/googlebot|google webmaster tools|bingbot|yahoo! slurp|baiduspider|yandexbot|duckduckbot/i)>=0},Lt=function(n,t){const e=setTimeout(n,t);return"number"==typeof e&&typeof Deno<"u"&&Deno.unrefTimer?Deno.unrefTimer(e):"object"==typeof e&&e.unref&&e.unref(),e};class jt{constructor(t,e){this.appName_=t,this.appCheckProvider=e,this.appCheck=e?.getImmediate({optional:!0}),this.appCheck||e?.get().then(i=>this.appCheck=i)}getToken(t){return this.appCheck?this.appCheck.getToken(t):new Promise((e,i)=>{setTimeout(()=>{this.appCheck?this.getToken(t).then(e,i):e(null)},0)})}addTokenChangeListener(t){var e;null===(e=this.appCheckProvider)||void 0===e||e.get().then(i=>i.addTokenListener(t))}notifyForInvalidToken(){we(`Provided AppCheck credentials for the app named "${this.appName_}" are invalid. This usually indicates your app was not initialized correctly.`)}}class On{constructor(t,e,i){this.appName_=t,this.firebaseOptions_=e,this.authProvider_=i,this.auth_=null,this.auth_=i.getImmediate({optional:!0}),this.auth_||i.onInit(o=>this.auth_=o)}getToken(t){return this.auth_?this.auth_.getToken(t).catch(e=>e&&"auth/token-not-initialized"===e.code?(fe("Got auth/token-not-initialized error.  Treating as null token."),null):Promise.reject(e)):new Promise((e,i)=>{setTimeout(()=>{this.auth_?this.getToken(t).then(e,i):e(null)},0)})}addTokenChangeListener(t){this.auth_?this.auth_.addAuthTokenListener(t):this.authProvider_.get().then(e=>e.addAuthTokenListener(t))}removeTokenChangeListener(t){this.authProvider_.get().then(e=>e.removeAuthTokenListener(t))}notifyForInvalidToken(){let t='Provided authentication credentials for the app named "'+this.appName_+'" are invalid. This usually indicates your app was not initialized correctly. ';t+="credential"in this.firebaseOptions_?'Make sure the "credential" property provided to initializeApp() is authorized to access the specified "databaseURL" and is from the correct project.':"serviceAccount"in this.firebaseOptions_?'Make sure the "serviceAccount" property provided to initializeApp() is authorized to access the specified "databaseURL" and is from the correct project.':'Make sure the "apiKey" and "databaseURL" properties provided to initializeApp() match the values provided for your app at https://console.firebase.google.com/.',we(t)}}let at=(()=>{class n{constructor(e){this.accessToken=e}getToken(e){return Promise.resolve({accessToken:this.accessToken})}addTokenChangeListener(e){e(this.accessToken)}removeTokenChangeListener(e){}notifyForInvalidToken(){}}return n.OWNER="owner",n})();const Dn=/(console\.firebase|firebase-console-\w+\.corp|firebase\.corp)\.google\.com/,k="websocket",E="long_polling";class y{constructor(t,e,i,o,u=!1,c="",h=!1,_=!1){this.secure=e,this.namespace=i,this.webSocketOnly=o,this.nodeAdmin=u,this.persistenceKey=c,this.includeNamespaceInQueryParams=h,this.isUsingEmulator=_,this._host=t.toLowerCase(),this._domain=this._host.substr(this._host.indexOf(".")+1),this.internalHost=Ae.get("host:"+t)||this._host}isCacheableHost(){return"s-"===this.internalHost.substr(0,2)}isCustomHost(){return"firebaseio.com"!==this._domain&&"firebaseio-demo.com"!==this._domain}get host(){return this._host}set host(t){t!==this.internalHost&&(this.internalHost=t,this.isCacheableHost()&&Ae.set("host:"+this._host,this.internalHost))}toString(){let t=this.toURLString();return this.persistenceKey&&(t+="<"+this.persistenceKey+">"),t}toURLString(){return`${this.secure?"https://":"http://"}${this.host}/${this.includeNamespaceInQueryParams?`?ns=${this.namespace}`:""}`}}function B(n,t,e){let i;if((0,g.hu)("string"==typeof t,"typeof type must == string"),(0,g.hu)("object"==typeof e,"typeof params must == object"),t===k)i=(n.secure?"wss://":"ws://")+n.internalHost+"/.ws?";else{if(t!==E)throw new Error("Unknown connection type: "+t);i=(n.secure?"https://":"http://")+n.internalHost+"/.lp?"}(function x(n){return n.host!==n.internalHost||n.isCustomHost()||n.includeNamespaceInQueryParams})(n)&&(e.ns=n.namespace);const o=[];return he(e,(u,c)=>{o.push(u+"="+c)}),i+o.join("&")}class X{constructor(){this.counters_={}}incrementCounter(t,e=1){(0,g.r3)(this.counters_,t)||(this.counters_[t]=0),this.counters_[t]+=e}get(){return(0,g.p$)(this.counters_)}}const ce={},me={};function Le(n){const t=n.toString();return ce[t]||(ce[t]=new X),ce[t]}class wt{constructor(t){this.onMessage_=t,this.pendingResponses=[],this.currentResponseNum=0,this.closeAfterResponse=-1,this.onClose=null}closeAfter(t,e){this.closeAfterResponse=t,this.onClose=e,this.closeAfterResponse<this.currentResponseNum&&(this.onClose(),this.onClose=null)}handleResponse(t,e){for(this.pendingResponses[t]=e;this.pendingResponses[this.currentResponseNum];){const i=this.pendingResponses[this.currentResponseNum];delete this.pendingResponses[this.currentResponseNum];for(let o=0;o<i.length;++o)i[o]&&gt(()=>{this.onMessage_(i[o])});if(this.currentResponseNum===this.closeAfterResponse){this.onClose&&(this.onClose(),this.onClose=null);break}this.currentResponseNum++}}}class $t{constructor(t,e,i,o,u,c,h){this.connId=t,this.repoInfo=e,this.applicationId=i,this.appCheckToken=o,this.authToken=u,this.transportSessionId=c,this.lastSessionId=h,this.bytesSent=0,this.bytesReceived=0,this.everConnected_=!1,this.log_=be(t),this.stats_=Le(e),this.urlFn=_=>(this.appCheckToken&&(_.ac=this.appCheckToken),B(e,E,_))}open(t,e){this.curSegmentNum=0,this.onDisconnect_=e,this.myPacketOrderer=new wt(t),this.isClosed_=!1,this.connectTimeoutTimer_=setTimeout(()=>{this.log_("Timed out trying to connect."),this.onClosed_(),this.connectTimeoutTimer_=null},Math.floor(3e4)),function(n){if((0,g.Yr)()||"complete"===document.readyState)n();else{let t=!1;const e=function(){document.body?t||(t=!0,n()):setTimeout(e,Math.floor(10))};document.addEventListener?(document.addEventListener("DOMContentLoaded",e,!1),window.addEventListener("load",e,!1)):document.attachEvent&&(document.attachEvent("onreadystatechange",()=>{"complete"===document.readyState&&e()}),window.attachEvent("onload",e))}}(()=>{if(this.isClosed_)return;this.scriptTagHolder=new Ai((...u)=>{const[c,h,_,v,P]=u;if(this.incrementIncomingBytes_(u),this.scriptTagHolder)if(this.connectTimeoutTimer_&&(clearTimeout(this.connectTimeoutTimer_),this.connectTimeoutTimer_=null),this.everConnected_=!0,"start"===c)this.id=h,this.password=_;else{if("close"!==c)throw new Error("Unrecognized command received: "+c);h?(this.scriptTagHolder.sendNewPolls=!1,this.myPacketOrderer.closeAfter(h,()=>{this.onClosed_()})):this.onClosed_()}},(...u)=>{const[c,h]=u;this.incrementIncomingBytes_(u),this.myPacketOrderer.handleResponse(c,h)},()=>{this.onClosed_()},this.urlFn);const i={start:"t"};i.ser=Math.floor(1e8*Math.random()),this.scriptTagHolder.uniqueCallbackIdentifier&&(i.cb=this.scriptTagHolder.uniqueCallbackIdentifier),i.v="5",this.transportSessionId&&(i.s=this.transportSessionId),this.lastSessionId&&(i.ls=this.lastSessionId),this.applicationId&&(i.p=this.applicationId),this.appCheckToken&&(i.ac=this.appCheckToken),typeof location<"u"&&location.hostname&&Dn.test(location.hostname)&&(i.r="f");const o=this.urlFn(i);this.log_("Connecting via long-poll to "+o),this.scriptTagHolder.addTag(o,()=>{})})}start(){this.scriptTagHolder.startLongPoll(this.id,this.password),this.addDisconnectPingFrame(this.id,this.password)}static forceAllow(){$t.forceAllow_=!0}static forceDisallow(){$t.forceDisallow_=!0}static isAvailable(){return!((0,g.Yr)()||!$t.forceAllow_&&($t.forceDisallow_||!(typeof document<"u")||null==document.createElement||"object"==typeof window&&window.chrome&&window.chrome.extension&&!/^chrome/.test(window.location.href)||"object"==typeof Windows&&"object"==typeof Windows.UI))}markConnectionHealthy(){}shutdown_(){this.isClosed_=!0,this.scriptTagHolder&&(this.scriptTagHolder.close(),this.scriptTagHolder=null),this.myDisconnFrame&&(document.body.removeChild(this.myDisconnFrame),this.myDisconnFrame=null),this.connectTimeoutTimer_&&(clearTimeout(this.connectTimeoutTimer_),this.connectTimeoutTimer_=null)}onClosed_(){this.isClosed_||(this.log_("Longpoll is closing itself"),this.shutdown_(),this.onDisconnect_&&(this.onDisconnect_(this.everConnected_),this.onDisconnect_=null))}close(){this.isClosed_||(this.log_("Longpoll is being closed."),this.shutdown_())}send(t){const e=(0,g.Wl)(t);this.bytesSent+=e.length,this.stats_.incrementCounter("bytes_sent",e.length);const i=(0,g.h$)(e),o=xe(i,1840);for(let u=0;u<o.length;u++)this.scriptTagHolder.enqueueSegment(this.curSegmentNum,o.length,o[u]),this.curSegmentNum++}addDisconnectPingFrame(t,e){if((0,g.Yr)())return;this.myDisconnFrame=document.createElement("iframe");const i={dframe:"t"};i.id=t,i.pw=e,this.myDisconnFrame.src=this.urlFn(i),this.myDisconnFrame.style.display="none",document.body.appendChild(this.myDisconnFrame)}incrementIncomingBytes_(t){const e=(0,g.Wl)(t).length;this.bytesReceived+=e,this.stats_.incrementCounter("bytes_received",e)}}class Ai{constructor(t,e,i,o){if(this.onDisconnect=i,this.urlFn=o,this.outstandingRequests=new Set,this.pendingSegs=[],this.currentSerial=Math.floor(1e8*Math.random()),this.sendNewPolls=!0,(0,g.Yr)())this.commandCB=t,this.onMessageCB=e;else{this.uniqueCallbackIdentifier=Et(),window["pLPCommand"+this.uniqueCallbackIdentifier]=t,window["pRTLPCB"+this.uniqueCallbackIdentifier]=e,this.myIFrame=Ai.createIFrame_();let u="";this.myIFrame.src&&"javascript:"===this.myIFrame.src.substr(0,11)&&(u='<script>document.domain="'+document.domain+'";<\/script>');const c="<html><body>"+u+"</body></html>";try{this.myIFrame.doc.open(),this.myIFrame.doc.write(c),this.myIFrame.doc.close()}catch(h){fe("frame writing exception"),h.stack&&fe(h.stack),fe(h)}}}static createIFrame_(){const t=document.createElement("iframe");if(t.style.display="none",!document.body)throw"Document body has not initialized. Wait to initialize Firebase until after the document is ready.";document.body.appendChild(t);try{t.contentWindow.document||fe("No IE domain setting required")}catch{const i=document.domain;t.src="javascript:void((function(){document.open();document.domain='"+i+"';document.close();})())"}return t.contentDocument?t.doc=t.contentDocument:t.contentWindow?t.doc=t.contentWindow.document:t.document&&(t.doc=t.document),t}close(){this.alive=!1,this.myIFrame&&(this.myIFrame.doc.body.textContent="",setTimeout(()=>{null!==this.myIFrame&&(document.body.removeChild(this.myIFrame),this.myIFrame=null)},Math.floor(0)));const t=this.onDisconnect;t&&(this.onDisconnect=null,t())}startLongPoll(t,e){for(this.myID=t,this.myPW=e,this.alive=!0;this.newRequest_(););}newRequest_(){if(this.alive&&this.sendNewPolls&&this.outstandingRequests.size<(this.pendingSegs.length>0?2:1)){this.currentSerial++;const t={};t.id=this.myID,t.pw=this.myPW,t.ser=this.currentSerial;let e=this.urlFn(t),i="",o=0;for(;this.pendingSegs.length>0&&this.pendingSegs[0].d.length+30+i.length<=1870;){const c=this.pendingSegs.shift();i=i+"&seg"+o+"="+c.seg+"&ts"+o+"="+c.ts+"&d"+o+"="+c.d,o++}return e+=i,this.addLongPollTag_(e,this.currentSerial),!0}return!1}enqueueSegment(t,e,i){this.pendingSegs.push({seg:t,ts:e,d:i}),this.alive&&this.newRequest_()}addLongPollTag_(t,e){this.outstandingRequests.add(e);const i=()=>{this.outstandingRequests.delete(e),this.newRequest_()},o=setTimeout(i,Math.floor(25e3));this.addTag(t,()=>{clearTimeout(o),i()})}addTag(t,e){(0,g.Yr)()?this.doNodeLongPoll(t,e):setTimeout(()=>{try{if(!this.sendNewPolls)return;const i=this.myIFrame.doc.createElement("script");i.type="text/javascript",i.async=!0,i.src=t,i.onload=i.onreadystatechange=function(){const o=i.readyState;(!o||"loaded"===o||"complete"===o)&&(i.onload=i.onreadystatechange=null,i.parentNode&&i.parentNode.removeChild(i),e())},i.onerror=()=>{fe("Long-poll script failed to load: "+t),this.sendNewPolls=!1,this.close()},this.myIFrame.doc.body.appendChild(i)}catch{}},Math.floor(1))}}let ln=null;typeof MozWebSocket<"u"?ln=MozWebSocket:typeof WebSocket<"u"&&(ln=WebSocket);let Nt=(()=>{class n{constructor(e,i,o,u,c,h,_){this.connId=e,this.applicationId=o,this.appCheckToken=u,this.authToken=c,this.keepaliveTimer=null,this.frames=null,this.totalFrames=0,this.bytesSent=0,this.bytesReceived=0,this.log_=be(this.connId),this.stats_=Le(i),this.connURL=n.connectionURL_(i,h,_,u,o),this.nodeAdmin=i.nodeAdmin}static connectionURL_(e,i,o,u,c){const h={v:"5"};return!(0,g.Yr)()&&typeof location<"u"&&location.hostname&&Dn.test(location.hostname)&&(h.r="f"),i&&(h.s=i),o&&(h.ls=o),u&&(h.ac=u),c&&(h.p=c),B(e,k,h)}open(e,i){this.onDisconnect=i,this.onMessage=e,this.log_("Websocket connecting to "+this.connURL),this.everConnected_=!1,Ae.set("previous_websocket_failure",!0);try{let o;if((0,g.Yr)()){o={headers:{"User-Agent":`Firebase/5/${Ue}/${process.platform}/${this.nodeAdmin?"AdminNode":"Node"}`,"X-Firebase-GMPID":this.applicationId||""}},this.authToken&&(o.headers.Authorization=`Bearer ${this.authToken}`),this.appCheckToken&&(o.headers["X-Firebase-AppCheck"]=this.appCheckToken);const c=process.env,h=0===this.connURL.indexOf("wss://")?c.HTTPS_PROXY||c.https_proxy:c.HTTP_PROXY||c.http_proxy;h&&(o.proxy={origin:h})}this.mySock=new ln(this.connURL,[],o)}catch(o){this.log_("Error instantiating WebSocket.");const u=o.message||o.data;return u&&this.log_(u),void this.onClosed_()}this.mySock.onopen=()=>{this.log_("Websocket connected."),this.everConnected_=!0},this.mySock.onclose=()=>{this.log_("Websocket connection was disconnected."),this.mySock=null,this.onClosed_()},this.mySock.onmessage=o=>{this.handleIncomingFrame(o)},this.mySock.onerror=o=>{this.log_("WebSocket error.  Closing connection.");const u=o.message||o.data;u&&this.log_(u),this.onClosed_()}}start(){}static forceDisallow(){n.forceDisallow_=!0}static isAvailable(){let e=!1;if(typeof navigator<"u"&&navigator.userAgent){const o=navigator.userAgent.match(/Android ([0-9]{0,}\.[0-9]{0,})/);o&&o.length>1&&parseFloat(o[1])<4.4&&(e=!0)}return!e&&null!==ln&&!n.forceDisallow_}static previouslyFailed(){return Ae.isInMemoryStorage||!0===Ae.get("previous_websocket_failure")}markConnectionHealthy(){Ae.remove("previous_websocket_failure")}appendFrame_(e){if(this.frames.push(e),this.frames.length===this.totalFrames){const i=this.frames.join("");this.frames=null;const o=(0,g.cI)(i);this.onMessage(o)}}handleNewFrameCount_(e){this.totalFrames=e,this.frames=[]}extractFrameCount_(e){if((0,g.hu)(null===this.frames,"We already have a frame buffer"),e.length<=6){const i=Number(e);if(!isNaN(i))return this.handleNewFrameCount_(i),null}return this.handleNewFrameCount_(1),e}handleIncomingFrame(e){if(null===this.mySock)return;const i=e.data;if(this.bytesReceived+=i.length,this.stats_.incrementCounter("bytes_received",i.length),this.resetKeepAlive(),null!==this.frames)this.appendFrame_(i);else{const o=this.extractFrameCount_(i);null!==o&&this.appendFrame_(o)}}send(e){this.resetKeepAlive();const i=(0,g.Wl)(e);this.bytesSent+=i.length,this.stats_.incrementCounter("bytes_sent",i.length);const o=xe(i,16384);o.length>1&&this.sendString_(String(o.length));for(let u=0;u<o.length;u++)this.sendString_(o[u])}shutdown_(){this.isClosed_=!0,this.keepaliveTimer&&(clearInterval(this.keepaliveTimer),this.keepaliveTimer=null),this.mySock&&(this.mySock.close(),this.mySock=null)}onClosed_(){this.isClosed_||(this.log_("WebSocket is closing itself"),this.shutdown_(),this.onDisconnect&&(this.onDisconnect(this.everConnected_),this.onDisconnect=null))}close(){this.isClosed_||(this.log_("WebSocket is being closed"),this.shutdown_())}resetKeepAlive(){clearInterval(this.keepaliveTimer),this.keepaliveTimer=setInterval(()=>{this.mySock&&this.sendString_("0"),this.resetKeepAlive()},Math.floor(45e3))}sendString_(e){try{this.mySock.send(e)}catch(i){this.log_("Exception thrown from WebSocket.send():",i.message||i.data,"Closing connection."),setTimeout(this.onClosed_.bind(this),0)}}}return n.responsesRequiredToBeHealthy=2,n.healthyTimeout=3e4,n})(),Ln=(()=>{class n{constructor(e){this.initTransports_(e)}static get ALL_TRANSPORTS(){return[$t,Nt]}static get IS_TRANSPORT_INITIALIZED(){return this.globalTransportInitialized_}initTransports_(e){const i=Nt&&Nt.isAvailable();let o=i&&!Nt.previouslyFailed();if(e.webSocketOnly&&(i||we("wss:// URL used, but browser isn't known to support websockets.  Trying anyway."),o=!0),o)this.transports_=[Nt];else{const u=this.transports_=[];for(const c of n.ALL_TRANSPORTS)c&&c.isAvailable()&&u.push(c);n.globalTransportInitialized_=!0}}initialTransport(){if(this.transports_.length>0)return this.transports_[0];throw new Error("No transports available")}upgradeTransport(){return this.transports_.length>1?this.transports_[1]:null}}return n.globalTransportInitialized_=!1,n})();class ki{constructor(t,e,i,o,u,c,h,_,v,P){this.id=t,this.repoInfo_=e,this.applicationId_=i,this.appCheckToken_=o,this.authToken_=u,this.onMessage_=c,this.onReady_=h,this.onDisconnect_=_,this.onKill_=v,this.lastSessionId=P,this.connectionCount=0,this.pendingDataMessages=[],this.state_=0,this.log_=be("c:"+this.id+":"),this.transportManager_=new Ln(e),this.log_("Connection created"),this.start_()}start_(){const t=this.transportManager_.initialTransport();this.conn_=new t(this.nextTransportId_(),this.repoInfo_,this.applicationId_,this.appCheckToken_,this.authToken_,null,this.lastSessionId),this.primaryResponsesRequired_=t.responsesRequiredToBeHealthy||0;const e=this.connReceiver_(this.conn_),i=this.disconnReceiver_(this.conn_);this.tx_=this.conn_,this.rx_=this.conn_,this.secondaryConn_=null,this.isHealthy_=!1,setTimeout(()=>{this.conn_&&this.conn_.open(e,i)},Math.floor(0));const o=t.healthyTimeout||0;o>0&&(this.healthyTimeout_=Lt(()=>{this.healthyTimeout_=null,this.isHealthy_||(this.conn_&&this.conn_.bytesReceived>102400?(this.log_("Connection exceeded healthy timeout but has received "+this.conn_.bytesReceived+" bytes.  Marking connection healthy."),this.isHealthy_=!0,this.conn_.markConnectionHealthy()):this.conn_&&this.conn_.bytesSent>10240?this.log_("Connection exceeded healthy timeout but has sent "+this.conn_.bytesSent+" bytes.  Leaving connection alive."):(this.log_("Closing unhealthy connection after timeout."),this.close()))},Math.floor(o)))}nextTransportId_(){return"c:"+this.id+":"+this.connectionCount++}disconnReceiver_(t){return e=>{t===this.conn_?this.onConnectionLost_(e):t===this.secondaryConn_?(this.log_("Secondary connection lost."),this.onSecondaryConnectionLost_()):this.log_("closing an old connection")}}connReceiver_(t){return e=>{2!==this.state_&&(t===this.rx_?this.onPrimaryMessageReceived_(e):t===this.secondaryConn_?this.onSecondaryMessageReceived_(e):this.log_("message on old connection"))}}sendRequest(t){this.sendData_({t:"d",d:t})}tryCleanupConnection(){this.tx_===this.secondaryConn_&&this.rx_===this.secondaryConn_&&(this.log_("cleaning up and promoting a connection: "+this.secondaryConn_.connId),this.conn_=this.secondaryConn_,this.secondaryConn_=null)}onSecondaryControl_(t){if("t"in t){const e=t.t;"a"===e?this.upgradeIfSecondaryHealthy_():"r"===e?(this.log_("Got a reset on secondary, closing it"),this.secondaryConn_.close(),(this.tx_===this.secondaryConn_||this.rx_===this.secondaryConn_)&&this.close()):"o"===e&&(this.log_("got pong on secondary."),this.secondaryResponsesRequired_--,this.upgradeIfSecondaryHealthy_())}}onSecondaryMessageReceived_(t){const e=$("t",t),i=$("d",t);if("c"===e)this.onSecondaryControl_(i);else{if("d"!==e)throw new Error("Unknown protocol layer: "+e);this.pendingDataMessages.push(i)}}upgradeIfSecondaryHealthy_(){this.secondaryResponsesRequired_<=0?(this.log_("Secondary connection is healthy."),this.isHealthy_=!0,this.secondaryConn_.markConnectionHealthy(),this.proceedWithUpgrade_()):(this.log_("sending ping on secondary."),this.secondaryConn_.send({t:"c",d:{t:"p",d:{}}}))}proceedWithUpgrade_(){this.secondaryConn_.start(),this.log_("sending client ack on secondary"),this.secondaryConn_.send({t:"c",d:{t:"a",d:{}}}),this.log_("Ending transmission on primary"),this.conn_.send({t:"c",d:{t:"n",d:{}}}),this.tx_=this.secondaryConn_,this.tryCleanupConnection()}onPrimaryMessageReceived_(t){const e=$("t",t),i=$("d",t);"c"===e?this.onControl_(i):"d"===e&&this.onDataMessage_(i)}onDataMessage_(t){this.onPrimaryResponse_(),this.onMessage_(t)}onPrimaryResponse_(){this.isHealthy_||(this.primaryResponsesRequired_--,this.primaryResponsesRequired_<=0&&(this.log_("Primary connection is healthy."),this.isHealthy_=!0,this.conn_.markConnectionHealthy()))}onControl_(t){const e=$("t",t);if("d"in t){const i=t.d;if("h"===e){const o=Object.assign({},i);this.repoInfo_.isUsingEmulator&&(o.h=this.repoInfo_.host),this.onHandshake_(o)}else if("n"===e){this.log_("recvd end transmission on primary"),this.rx_=this.secondaryConn_;for(let o=0;o<this.pendingDataMessages.length;++o)this.onDataMessage_(this.pendingDataMessages[o]);this.pendingDataMessages=[],this.tryCleanupConnection()}else"s"===e?this.onConnectionShutdown_(i):"r"===e?this.onReset_(i):"e"===e?ut("Server Error: "+i):"o"===e?(this.log_("got pong on primary."),this.onPrimaryResponse_(),this.sendPingOnPrimaryIfNecessary_()):ut("Unknown control packet command: "+e)}}onHandshake_(t){const e=t.ts,i=t.v,o=t.h;this.sessionId=t.s,this.repoInfo_.host=o,0===this.state_&&(this.conn_.start(),this.onConnectionEstablished_(this.conn_,e),"5"!==i&&we("Protocol version mismatch detected"),this.tryStartUpgrade_())}tryStartUpgrade_(){const t=this.transportManager_.upgradeTransport();t&&this.startUpgrade_(t)}startUpgrade_(t){this.secondaryConn_=new t(this.nextTransportId_(),this.repoInfo_,this.applicationId_,this.appCheckToken_,this.authToken_,this.sessionId),this.secondaryResponsesRequired_=t.responsesRequiredToBeHealthy||0;const e=this.connReceiver_(this.secondaryConn_),i=this.disconnReceiver_(this.secondaryConn_);this.secondaryConn_.open(e,i),Lt(()=>{this.secondaryConn_&&(this.log_("Timed out trying to upgrade."),this.secondaryConn_.close())},Math.floor(6e4))}onReset_(t){this.log_("Reset packet received.  New host: "+t),this.repoInfo_.host=t,1===this.state_?this.close():(this.closeConnections_(),this.start_())}onConnectionEstablished_(t,e){this.log_("Realtime connection established."),this.conn_=t,this.state_=1,this.onReady_&&(this.onReady_(e,this.sessionId),this.onReady_=null),0===this.primaryResponsesRequired_?(this.log_("Primary connection is healthy."),this.isHealthy_=!0):Lt(()=>{this.sendPingOnPrimaryIfNecessary_()},Math.floor(5e3))}sendPingOnPrimaryIfNecessary_(){!this.isHealthy_&&1===this.state_&&(this.log_("sending ping on primary."),this.sendData_({t:"c",d:{t:"p",d:{}}}))}onSecondaryConnectionLost_(){const t=this.secondaryConn_;this.secondaryConn_=null,(this.tx_===t||this.rx_===t)&&this.close()}onConnectionLost_(t){this.conn_=null,t||0!==this.state_?1===this.state_&&this.log_("Realtime connection lost."):(this.log_("Realtime connection failed."),this.repoInfo_.isCacheableHost()&&(Ae.remove("host:"+this.repoInfo_.host),this.repoInfo_.internalHost=this.repoInfo_.host)),this.close()}onConnectionShutdown_(t){this.log_("Connection shutdown command received. Shutting down..."),this.onKill_&&(this.onKill_(t),this.onKill_=null),this.onDisconnect_=null,this.close()}sendData_(t){if(1!==this.state_)throw"Connection is not connected";this.tx_.send(t)}close(){2!==this.state_&&(this.log_("Closing realtime connection."),this.state_=2,this.closeConnections_(),this.onDisconnect_&&(this.onDisconnect_(),this.onDisconnect_=null))}closeConnections_(){this.log_("Shutting down all connections"),this.conn_&&(this.conn_.close(),this.conn_=null),this.secondaryConn_&&(this.secondaryConn_.close(),this.secondaryConn_=null),this.healthyTimeout_&&(clearTimeout(this.healthyTimeout_),this.healthyTimeout_=null)}}class T{put(t,e,i,o){}merge(t,e,i,o){}refreshAuthToken(t){}refreshAppCheckToken(t){}onDisconnectPut(t,e,i){}onDisconnectMerge(t,e,i){}onDisconnectCancel(t,e){}reportStats(t){}}class I{constructor(t){this.allowedEvents_=t,this.listeners_={},(0,g.hu)(Array.isArray(t)&&t.length>0,"Requires a non-empty array")}trigger(t,...e){if(Array.isArray(this.listeners_[t])){const i=[...this.listeners_[t]];for(let o=0;o<i.length;o++)i[o].callback.apply(i[o].context,e)}}on(t,e,i){this.validateEventType_(t),this.listeners_[t]=this.listeners_[t]||[],this.listeners_[t].push({callback:e,context:i});const o=this.getInitialEvent(t);o&&e.apply(i,o)}off(t,e,i){this.validateEventType_(t);const o=this.listeners_[t]||[];for(let u=0;u<o.length;u++)if(o[u].callback===e&&(!i||i===o[u].context))return void o.splice(u,1)}validateEventType_(t){(0,g.hu)(this.allowedEvents_.find(e=>e===t),"Unknown event: "+t)}}class w extends I{constructor(){super(["online"]),this.online_=!0,typeof window<"u"&&typeof window.addEventListener<"u"&&!(0,g.uI)()&&(window.addEventListener("online",()=>{this.online_||(this.online_=!0,this.trigger("online",!0))},!1),window.addEventListener("offline",()=>{this.online_&&(this.online_=!1,this.trigger("online",!1))},!1))}static getInstance(){return new w}getInitialEvent(t){return(0,g.hu)("online"===t,"Unknown event type: "+t),[this.online_]}currentlyOnline(){return this.online_}}const O=32,U=768;class W{constructor(t,e){if(void 0===e){this.pieces_=t.split("/");let i=0;for(let o=0;o<this.pieces_.length;o++)this.pieces_[o].length>0&&(this.pieces_[i]=this.pieces_[o],i++);this.pieces_.length=i,this.pieceNum_=0}else this.pieces_=t,this.pieceNum_=e}toString(){let t="";for(let e=this.pieceNum_;e<this.pieces_.length;e++)""!==this.pieces_[e]&&(t+="/"+this.pieces_[e]);return t||"/"}}function z(){return new W("")}function Y(n){return n.pieceNum_>=n.pieces_.length?null:n.pieces_[n.pieceNum_]}function de(n){return n.pieces_.length-n.pieceNum_}function ve(n){let t=n.pieceNum_;return t<n.pieces_.length&&t++,new W(n.pieces_,t)}function gn(n){return n.pieceNum_<n.pieces_.length?n.pieces_[n.pieces_.length-1]:null}function Pi(n,t=0){return n.pieces_.slice(n.pieceNum_+t)}function oo(n){if(n.pieceNum_>=n.pieces_.length)return null;const t=[];for(let e=n.pieceNum_;e<n.pieces_.length-1;e++)t.push(n.pieces_[e]);return new W(t,0)}function Re(n,t){const e=[];for(let i=n.pieceNum_;i<n.pieces_.length;i++)e.push(n.pieces_[i]);if(t instanceof W)for(let i=t.pieceNum_;i<t.pieces_.length;i++)e.push(t.pieces_[i]);else{const i=t.split("/");for(let o=0;o<i.length;o++)i[o].length>0&&e.push(i[o])}return new W(e,0)}function le(n){return n.pieceNum_>=n.pieces_.length}function lt(n,t){const e=Y(n),i=Y(t);if(null===e)return t;if(e===i)return lt(ve(n),ve(t));throw new Error("INTERNAL ERROR: innerPath ("+t+") is not within outerPath ("+n+")")}function un(n,t){const e=Pi(n,0),i=Pi(t,0);for(let o=0;o<e.length&&o<i.length;o++){const u=J(e[o],i[o]);if(0!==u)return u}return e.length===i.length?0:e.length<i.length?-1:1}function mn(n,t){if(de(n)!==de(t))return!1;for(let e=n.pieceNum_,i=t.pieceNum_;e<=n.pieces_.length;e++,i++)if(n.pieces_[e]!==t.pieces_[i])return!1;return!0}function dt(n,t){let e=n.pieceNum_,i=t.pieceNum_;if(de(n)>de(t))return!1;for(;e<n.pieces_.length;){if(n.pieces_[e]!==t.pieces_[i])return!1;++e,++i}return!0}class sa{constructor(t,e){this.errorPrefix_=e,this.parts_=Pi(t,0),this.byteLength_=Math.max(1,this.parts_.length);for(let i=0;i<this.parts_.length;i++)this.byteLength_+=(0,g.ug)(this.parts_[i]);ao(this)}}function ao(n){if(n.byteLength_>U)throw new Error(n.errorPrefix_+"has a key path longer than "+U+" bytes ("+n.byteLength_+").");if(n.parts_.length>O)throw new Error(n.errorPrefix_+"path specified exceeds the maximum depth that can be written ("+O+") or object contains a cycle "+Ft(n))}function Ft(n){return 0===n.parts_.length?"":"in property '"+n.parts_.join(".")+"'"}class jr extends I{constructor(){let t,e;super(["visible"]),typeof document<"u"&&typeof document.addEventListener<"u"&&(typeof document.hidden<"u"?(e="visibilitychange",t="hidden"):typeof document.mozHidden<"u"?(e="mozvisibilitychange",t="mozHidden"):typeof document.msHidden<"u"?(e="msvisibilitychange",t="msHidden"):typeof document.webkitHidden<"u"&&(e="webkitvisibilitychange",t="webkitHidden")),this.visible_=!0,e&&document.addEventListener(e,()=>{const i=!document[t];i!==this.visible_&&(this.visible_=i,this.trigger("visible",i))},!1)}static getInstance(){return new jr}getInitialEvent(t){return(0,g.hu)("visible"===t,"Unknown event type: "+t),[this.visible_]}}const vn=1e3;let Ni,cn=(()=>{class n extends T{constructor(e,i,o,u,c,h,_,v){if(super(),this.repoInfo_=e,this.applicationId_=i,this.onDataUpdate_=o,this.onConnectStatus_=u,this.onServerInfoUpdate_=c,this.authTokenProvider_=h,this.appCheckTokenProvider_=_,this.authOverride_=v,this.id=n.nextPersistentConnectionId_++,this.log_=be("p:"+this.id+":"),this.interruptReasons_={},this.listens=new Map,this.outstandingPuts_=[],this.outstandingGets_=[],this.outstandingPutCount_=0,this.outstandingGetCount_=0,this.onDisconnectRequestQueue_=[],this.connected_=!1,this.reconnectDelay_=vn,this.maxReconnectDelay_=3e5,this.securityDebugCallback_=null,this.lastSessionId=null,this.establishConnectionTimer_=null,this.visible_=!1,this.requestCBHash_={},this.requestNumber_=0,this.realtime_=null,this.authToken_=null,this.appCheckToken_=null,this.forceTokenRefresh_=!1,this.invalidAuthTokenCount_=0,this.invalidAppCheckTokenCount_=0,this.firstConnection_=!0,this.lastConnectionAttemptTime_=null,this.lastConnectionEstablishedTime_=null,v&&!(0,g.Yr)())throw new Error("Auth override specified in options, but not supported on non Node.js platforms");jr.getInstance().on("visible",this.onVisible_,this),-1===e.host.indexOf("fblocal")&&w.getInstance().on("online",this.onOnline_,this)}sendRequest(e,i,o){const u=++this.requestNumber_,c={r:u,a:e,b:i};this.log_((0,g.Wl)(c)),(0,g.hu)(this.connected_,"sendRequest call when we're not connected not allowed."),this.realtime_.sendRequest(c),o&&(this.requestCBHash_[u]=o)}get(e){this.initConnection_();const i=new g.BH,u={action:"g",request:{p:e._path.toString(),q:e._queryObject},onComplete:h=>{const _=h.d;"ok"===h.s?i.resolve(_):i.reject(_)}};return this.outstandingGets_.push(u),this.outstandingGetCount_++,this.connected_&&this.sendGet_(this.outstandingGets_.length-1),i.promise}listen(e,i,o,u){this.initConnection_();const c=e._queryIdentifier,h=e._path.toString();this.log_("Listen called for "+h+" "+c),this.listens.has(h)||this.listens.set(h,new Map),(0,g.hu)(e._queryParams.isDefault()||!e._queryParams.loadsAllData(),"listen() called for non-default but complete query"),(0,g.hu)(!this.listens.get(h).has(c),"listen() called twice for same path/queryId.");const _={onComplete:u,hashFn:i,query:e,tag:o};this.listens.get(h).set(c,_),this.connected_&&this.sendListen_(_)}sendGet_(e){const i=this.outstandingGets_[e];this.sendRequest("g",i.request,o=>{delete this.outstandingGets_[e],this.outstandingGetCount_--,0===this.outstandingGetCount_&&(this.outstandingGets_=[]),i.onComplete&&i.onComplete(o)})}sendListen_(e){const i=e.query,o=i._path.toString(),u=i._queryIdentifier;this.log_("Listen on "+o+" for "+u);const c={p:o};e.tag&&(c.q=i._queryObject,c.t=e.tag),c.h=e.hashFn(),this.sendRequest("q",c,_=>{const v=_.d,P=_.s;n.warnOnListenWarnings_(v,i),(this.listens.get(o)&&this.listens.get(o).get(u))===e&&(this.log_("listen response",_),"ok"!==P&&this.removeListen_(o,u),e.onComplete&&e.onComplete(P,v))})}static warnOnListenWarnings_(e,i){if(e&&"object"==typeof e&&(0,g.r3)(e,"w")){const o=(0,g.DV)(e,"w");if(Array.isArray(o)&&~o.indexOf("no_index")){const u='".indexOn": "'+i._queryParams.getIndex().toString()+'"',c=i._path.toString();we(`Using an unspecified index. Your data will be downloaded and filtered on the client. Consider adding ${u} at ${c} to your security rules for better performance.`)}}}refreshAuthToken(e){this.authToken_=e,this.log_("Auth token refreshed"),this.authToken_?this.tryAuth():this.connected_&&this.sendRequest("unauth",{},()=>{}),this.reduceReconnectDelayIfAdminCredential_(e)}reduceReconnectDelayIfAdminCredential_(e){(e&&40===e.length||(0,g.GJ)(e))&&(this.log_("Admin auth credential detected.  Reducing max reconnect time."),this.maxReconnectDelay_=3e4)}refreshAppCheckToken(e){this.appCheckToken_=e,this.log_("App check token refreshed"),this.appCheckToken_?this.tryAppCheck():this.connected_&&this.sendRequest("unappeck",{},()=>{})}tryAuth(){if(this.connected_&&this.authToken_){const e=this.authToken_,i=(0,g.w9)(e)?"auth":"gauth",o={cred:e};null===this.authOverride_?o.noauth=!0:"object"==typeof this.authOverride_&&(o.authvar=this.authOverride_),this.sendRequest(i,o,u=>{const c=u.s,h=u.d||"error";this.authToken_===e&&("ok"===c?this.invalidAuthTokenCount_=0:this.onAuthRevoked_(c,h))})}}tryAppCheck(){this.connected_&&this.appCheckToken_&&this.sendRequest("appcheck",{token:this.appCheckToken_},e=>{const i=e.s,o=e.d||"error";"ok"===i?this.invalidAppCheckTokenCount_=0:this.onAppCheckRevoked_(i,o)})}unlisten(e,i){const o=e._path.toString(),u=e._queryIdentifier;this.log_("Unlisten called for "+o+" "+u),(0,g.hu)(e._queryParams.isDefault()||!e._queryParams.loadsAllData(),"unlisten() called for non-default but complete query"),this.removeListen_(o,u)&&this.connected_&&this.sendUnlisten_(o,u,e._queryObject,i)}sendUnlisten_(e,i,o,u){this.log_("Unlisten on "+e+" for "+i);const c={p:e};u&&(c.q=o,c.t=u),this.sendRequest("n",c)}onDisconnectPut(e,i,o){this.initConnection_(),this.connected_?this.sendOnDisconnect_("o",e,i,o):this.onDisconnectRequestQueue_.push({pathString:e,action:"o",data:i,onComplete:o})}onDisconnectMerge(e,i,o){this.initConnection_(),this.connected_?this.sendOnDisconnect_("om",e,i,o):this.onDisconnectRequestQueue_.push({pathString:e,action:"om",data:i,onComplete:o})}onDisconnectCancel(e,i){this.initConnection_(),this.connected_?this.sendOnDisconnect_("oc",e,null,i):this.onDisconnectRequestQueue_.push({pathString:e,action:"oc",data:null,onComplete:i})}sendOnDisconnect_(e,i,o,u){const c={p:i,d:o};this.log_("onDisconnect "+e,c),this.sendRequest(e,c,h=>{u&&setTimeout(()=>{u(h.s,h.d)},Math.floor(0))})}put(e,i,o,u){this.putInternal("p",e,i,o,u)}merge(e,i,o,u){this.putInternal("m",e,i,o,u)}putInternal(e,i,o,u,c){this.initConnection_();const h={p:i,d:o};void 0!==c&&(h.h=c),this.outstandingPuts_.push({action:e,request:h,onComplete:u}),this.outstandingPutCount_++,this.connected_?this.sendPut_(this.outstandingPuts_.length-1):this.log_("Buffering put: "+i)}sendPut_(e){const i=this.outstandingPuts_[e].action,o=this.outstandingPuts_[e].request,u=this.outstandingPuts_[e].onComplete;this.outstandingPuts_[e].queued=this.connected_,this.sendRequest(i,o,c=>{this.log_(i+" response",c),delete this.outstandingPuts_[e],this.outstandingPutCount_--,0===this.outstandingPutCount_&&(this.outstandingPuts_=[]),u&&u(c.s,c.d)})}reportStats(e){if(this.connected_){const i={c:e};this.log_("reportStats",i),this.sendRequest("s",i,o=>{"ok"!==o.s&&this.log_("reportStats","Error sending stats: "+o.d)})}}onDataMessage_(e){if("r"in e){this.log_("from server: "+(0,g.Wl)(e));const i=e.r,o=this.requestCBHash_[i];o&&(delete this.requestCBHash_[i],o(e.b))}else{if("error"in e)throw"A server-side error has occurred: "+e.error;"a"in e&&this.onDataPush_(e.a,e.b)}}onDataPush_(e,i){this.log_("handleServerMessage",e,i),"d"===e?this.onDataUpdate_(i.p,i.d,!1,i.t):"m"===e?this.onDataUpdate_(i.p,i.d,!0,i.t):"c"===e?this.onListenRevoked_(i.p,i.q):"ac"===e?this.onAuthRevoked_(i.s,i.d):"apc"===e?this.onAppCheckRevoked_(i.s,i.d):"sd"===e?this.onSecurityDebugPacket_(i):ut("Unrecognized action received from server: "+(0,g.Wl)(e)+"\nAre you using the latest client?")}onReady_(e,i){this.log_("connection ready"),this.connected_=!0,this.lastConnectionEstablishedTime_=(new Date).getTime(),this.handleTimestamp_(e),this.lastSessionId=i,this.firstConnection_&&this.sendConnectStats_(),this.restoreState_(),this.firstConnection_=!1,this.onConnectStatus_(!0)}scheduleConnect_(e){(0,g.hu)(!this.realtime_,"Scheduling a connect when we're already connected/ing?"),this.establishConnectionTimer_&&clearTimeout(this.establishConnectionTimer_),this.establishConnectionTimer_=setTimeout(()=>{this.establishConnectionTimer_=null,this.establishConnection_()},Math.floor(e))}initConnection_(){!this.realtime_&&this.firstConnection_&&this.scheduleConnect_(0)}onVisible_(e){e&&!this.visible_&&this.reconnectDelay_===this.maxReconnectDelay_&&(this.log_("Window became visible.  Reducing delay."),this.reconnectDelay_=vn,this.realtime_||this.scheduleConnect_(0)),this.visible_=e}onOnline_(e){e?(this.log_("Browser went online."),this.reconnectDelay_=vn,this.realtime_||this.scheduleConnect_(0)):(this.log_("Browser went offline.  Killing connection."),this.realtime_&&this.realtime_.close())}onRealtimeDisconnect_(){if(this.log_("data client disconnected"),this.connected_=!1,this.realtime_=null,this.cancelSentTransactions_(),this.requestCBHash_={},this.shouldReconnect_()){this.visible_?this.lastConnectionEstablishedTime_&&((new Date).getTime()-this.lastConnectionEstablishedTime_>3e4&&(this.reconnectDelay_=vn),this.lastConnectionEstablishedTime_=null):(this.log_("Window isn't visible.  Delaying reconnect."),this.reconnectDelay_=this.maxReconnectDelay_,this.lastConnectionAttemptTime_=(new Date).getTime());const e=(new Date).getTime()-this.lastConnectionAttemptTime_;let i=Math.max(0,this.reconnectDelay_-e);i=Math.random()*i,this.log_("Trying to reconnect in "+i+"ms"),this.scheduleConnect_(i),this.reconnectDelay_=Math.min(this.maxReconnectDelay_,1.3*this.reconnectDelay_)}this.onConnectStatus_(!1)}establishConnection_(){var e=this;return(0,Be.Z)(function*(){if(e.shouldReconnect_()){e.log_("Making a connection attempt"),e.lastConnectionAttemptTime_=(new Date).getTime(),e.lastConnectionEstablishedTime_=null;const i=e.onDataMessage_.bind(e),o=e.onReady_.bind(e),u=e.onRealtimeDisconnect_.bind(e),c=e.id+":"+n.nextConnectionId_++,h=e.lastSessionId;let _=!1,v=null;const P=function(){v?v.close():(_=!0,u())};e.realtime_={close:P,sendRequest:function(G){(0,g.hu)(v,"sendRequest call when we're not connected not allowed."),v.sendRequest(G)}};const D=e.forceTokenRefresh_;e.forceTokenRefresh_=!1;try{const[G,q]=yield Promise.all([e.authTokenProvider_.getToken(D),e.appCheckTokenProvider_.getToken(D)]);_?fe("getToken() completed but was canceled"):(fe("getToken() completed. Creating connection."),e.authToken_=G&&G.accessToken,e.appCheckToken_=q&&q.token,v=new ki(c,e.repoInfo_,e.applicationId_,e.appCheckToken_,e.authToken_,i,o,u,Te=>{we(Te+" ("+e.repoInfo_.toString()+")"),e.interrupt("server_kill")},h))}catch(G){e.log_("Failed to get token: "+G),_||(e.repoInfo_.nodeAdmin&&we(G),P())}}})()}interrupt(e){fe("Interrupting connection for reason: "+e),this.interruptReasons_[e]=!0,this.realtime_?this.realtime_.close():(this.establishConnectionTimer_&&(clearTimeout(this.establishConnectionTimer_),this.establishConnectionTimer_=null),this.connected_&&this.onRealtimeDisconnect_())}resume(e){fe("Resuming connection for reason: "+e),delete this.interruptReasons_[e],(0,g.xb)(this.interruptReasons_)&&(this.reconnectDelay_=vn,this.realtime_||this.scheduleConnect_(0))}handleTimestamp_(e){const i=e-(new Date).getTime();this.onServerInfoUpdate_({serverTimeOffset:i})}cancelSentTransactions_(){for(let e=0;e<this.outstandingPuts_.length;e++){const i=this.outstandingPuts_[e];i&&"h"in i.request&&i.queued&&(i.onComplete&&i.onComplete("disconnect"),delete this.outstandingPuts_[e],this.outstandingPutCount_--)}0===this.outstandingPutCount_&&(this.outstandingPuts_=[])}onListenRevoked_(e,i){let o;o=i?i.map(c=>Ee(c)).join("$"):"default";const u=this.removeListen_(e,o);u&&u.onComplete&&u.onComplete("permission_denied")}removeListen_(e,i){const o=new W(e).toString();let u;if(this.listens.has(o)){const c=this.listens.get(o);u=c.get(i),c.delete(i),0===c.size&&this.listens.delete(o)}else u=void 0;return u}onAuthRevoked_(e,i){fe("Auth token revoked: "+e+"/"+i),this.authToken_=null,this.forceTokenRefresh_=!0,this.realtime_.close(),("invalid_token"===e||"permission_denied"===e)&&(this.invalidAuthTokenCount_++,this.invalidAuthTokenCount_>=3&&(this.reconnectDelay_=3e4,this.authTokenProvider_.notifyForInvalidToken()))}onAppCheckRevoked_(e,i){fe("App check token revoked: "+e+"/"+i),this.appCheckToken_=null,this.forceTokenRefresh_=!0,("invalid_token"===e||"permission_denied"===e)&&(this.invalidAppCheckTokenCount_++,this.invalidAppCheckTokenCount_>=3&&this.appCheckTokenProvider_.notifyForInvalidToken())}onSecurityDebugPacket_(e){this.securityDebugCallback_?this.securityDebugCallback_(e):"msg"in e&&console.log("FIREBASE: "+e.msg.replace("\n","\nFIREBASE: "))}restoreState_(){this.tryAuth(),this.tryAppCheck();for(const e of this.listens.values())for(const i of e.values())this.sendListen_(i);for(let e=0;e<this.outstandingPuts_.length;e++)this.outstandingPuts_[e]&&this.sendPut_(e);for(;this.onDisconnectRequestQueue_.length;){const e=this.onDisconnectRequestQueue_.shift();this.sendOnDisconnect_(e.action,e.pathString,e.data,e.onComplete)}for(let e=0;e<this.outstandingGets_.length;e++)this.outstandingGets_[e]&&this.sendGet_(e)}sendConnectStats_(){const e={};let i="js";(0,g.Yr)()&&(i=this.repoInfo_.nodeAdmin?"admin_node":"node"),e["sdk."+i+"."+Ue.replace(/\./g,"-")]=1,(0,g.uI)()?e["framework.cordova"]=1:(0,g.b$)()&&(e["framework.reactnative"]=1),this.reportStats(e)}shouldReconnect_(){const e=w.getInstance().currentlyOnline();return(0,g.xb)(this.interruptReasons_)&&e}}return n.nextPersistentConnectionId_=0,n.nextConnectionId_=0,n})();class ne{constructor(t,e){this.name=t,this.node=e}static Wrap(t,e){return new ne(t,e)}}class bi{getCompare(){return this.compare.bind(this)}indexedValueChanged(t,e){const i=new ne(ot,t),o=new ne(ot,e);return 0!==this.compare(i,o)}minPost(){return ne.MIN}}class co extends bi{static get __EMPTY_NODE(){return Ni}static set __EMPTY_NODE(t){Ni=t}compare(t,e){return J(t.name,e.name)}isDefinedOn(t){throw(0,g.g5)("KeyIndex.isDefinedOn not expected to be called.")}indexedValueChanged(t,e){return!1}minPost(){return ne.MIN}maxPost(){return new ne(Z,Ni)}makePost(t,e){return(0,g.hu)("string"==typeof t,"KeyIndex indexValue must always be a string."),new ne(t,Ni)}toString(){return".key"}}const Wt=new co;class ei{constructor(t,e,i,o,u=null){this.isReverse_=o,this.resultGenerator_=u,this.nodeStack_=[];let c=1;for(;!t.isEmpty();)if(c=e?i(t.key,e):1,o&&(c*=-1),c<0)t=this.isReverse_?t.left:t.right;else{if(0===c){this.nodeStack_.push(t);break}this.nodeStack_.push(t),t=this.isReverse_?t.right:t.left}}getNext(){if(0===this.nodeStack_.length)return null;let e,t=this.nodeStack_.pop();if(e=this.resultGenerator_?this.resultGenerator_(t.key,t.value):{key:t.key,value:t.value},this.isReverse_)for(t=t.left;!t.isEmpty();)this.nodeStack_.push(t),t=t.right;else for(t=t.right;!t.isEmpty();)this.nodeStack_.push(t),t=t.left;return e}hasNext(){return this.nodeStack_.length>0}peek(){if(0===this.nodeStack_.length)return null;const t=this.nodeStack_[this.nodeStack_.length-1];return this.resultGenerator_?this.resultGenerator_(t.key,t.value):{key:t.key,value:t.value}}}let fr,Ot=(()=>{class n{constructor(e,i,o,u,c){this.key=e,this.value=i,this.color=o??n.RED,this.left=u??ht.EMPTY_NODE,this.right=c??ht.EMPTY_NODE}copy(e,i,o,u,c){return new n(e??this.key,i??this.value,o??this.color,u??this.left,c??this.right)}count(){return this.left.count()+1+this.right.count()}isEmpty(){return!1}inorderTraversal(e){return this.left.inorderTraversal(e)||!!e(this.key,this.value)||this.right.inorderTraversal(e)}reverseTraversal(e){return this.right.reverseTraversal(e)||e(this.key,this.value)||this.left.reverseTraversal(e)}min_(){return this.left.isEmpty()?this:this.left.min_()}minKey(){return this.min_().key}maxKey(){return this.right.isEmpty()?this.key:this.right.maxKey()}insert(e,i,o){let u=this;const c=o(e,u.key);return u=c<0?u.copy(null,null,null,u.left.insert(e,i,o),null):0===c?u.copy(null,i,null,null,null):u.copy(null,null,null,null,u.right.insert(e,i,o)),u.fixUp_()}removeMin_(){if(this.left.isEmpty())return ht.EMPTY_NODE;let e=this;return!e.left.isRed_()&&!e.left.left.isRed_()&&(e=e.moveRedLeft_()),e=e.copy(null,null,null,e.left.removeMin_(),null),e.fixUp_()}remove(e,i){let o,u;if(o=this,i(e,o.key)<0)!o.left.isEmpty()&&!o.left.isRed_()&&!o.left.left.isRed_()&&(o=o.moveRedLeft_()),o=o.copy(null,null,null,o.left.remove(e,i),null);else{if(o.left.isRed_()&&(o=o.rotateRight_()),!o.right.isEmpty()&&!o.right.isRed_()&&!o.right.left.isRed_()&&(o=o.moveRedRight_()),0===i(e,o.key)){if(o.right.isEmpty())return ht.EMPTY_NODE;u=o.right.min_(),o=o.copy(u.key,u.value,null,null,o.right.removeMin_())}o=o.copy(null,null,null,null,o.right.remove(e,i))}return o.fixUp_()}isRed_(){return this.color}fixUp_(){let e=this;return e.right.isRed_()&&!e.left.isRed_()&&(e=e.rotateLeft_()),e.left.isRed_()&&e.left.left.isRed_()&&(e=e.rotateRight_()),e.left.isRed_()&&e.right.isRed_()&&(e=e.colorFlip_()),e}moveRedLeft_(){let e=this.colorFlip_();return e.right.left.isRed_()&&(e=e.copy(null,null,null,null,e.right.rotateRight_()),e=e.rotateLeft_(),e=e.colorFlip_()),e}moveRedRight_(){let e=this.colorFlip_();return e.left.left.isRed_()&&(e=e.rotateRight_(),e=e.colorFlip_()),e}rotateLeft_(){const e=this.copy(null,null,n.RED,null,this.right.left);return this.right.copy(null,null,this.color,e,null)}rotateRight_(){const e=this.copy(null,null,n.RED,this.left.right,null);return this.left.copy(null,null,this.color,null,e)}colorFlip_(){const e=this.left.copy(null,null,!this.left.color,null,null),i=this.right.copy(null,null,!this.right.color,null,null);return this.copy(null,null,!this.color,e,i)}checkMaxDepth_(){const e=this.check_();return Math.pow(2,e)<=this.count()+1}check_(){if(this.isRed_()&&this.left.isRed_())throw new Error("Red node has red child("+this.key+","+this.value+")");if(this.right.isRed_())throw new Error("Right child of ("+this.key+","+this.value+") is red");const e=this.left.check_();if(e!==this.right.check_())throw new Error("Black depths differ");return e+(this.isRed_()?0:1)}}return n.RED=!0,n.BLACK=!1,n})();class ht{constructor(t,e=ht.EMPTY_NODE){this.comparator_=t,this.root_=e}insert(t,e){return new ht(this.comparator_,this.root_.insert(t,e,this.comparator_).copy(null,null,Ot.BLACK,null,null))}remove(t){return new ht(this.comparator_,this.root_.remove(t,this.comparator_).copy(null,null,Ot.BLACK,null,null))}get(t){let e,i=this.root_;for(;!i.isEmpty();){if(e=this.comparator_(t,i.key),0===e)return i.value;e<0?i=i.left:e>0&&(i=i.right)}return null}getPredecessorKey(t){let e,i=this.root_,o=null;for(;!i.isEmpty();){if(e=this.comparator_(t,i.key),0===e){if(i.left.isEmpty())return o?o.key:null;for(i=i.left;!i.right.isEmpty();)i=i.right;return i.key}e<0?i=i.left:e>0&&(o=i,i=i.right)}throw new Error("Attempted to find predecessor key for a nonexistent key.  What gives?")}isEmpty(){return this.root_.isEmpty()}count(){return this.root_.count()}minKey(){return this.root_.minKey()}maxKey(){return this.root_.maxKey()}inorderTraversal(t){return this.root_.inorderTraversal(t)}reverseTraversal(t){return this.root_.reverseTraversal(t)}getIterator(t){return new ei(this.root_,null,this.comparator_,!1,t)}getIteratorFrom(t,e){return new ei(this.root_,t,this.comparator_,!1,e)}getReverseIteratorFrom(t,e){return new ei(this.root_,t,this.comparator_,!0,e)}getReverseIterator(t){return new ei(this.root_,null,this.comparator_,!0,t)}}function ho(n,t){return J(n.name,t.name)}function Oi(n,t){return J(n,t)}ht.EMPTY_NODE=new class hr{copy(t,e,i,o,u){return this}insert(t,e,i){return new Ot(t,e,null)}remove(t,e){return this}count(){return 0}isEmpty(){return!0}inorderTraversal(t){return!1}reverseTraversal(t){return!1}minKey(){return null}maxKey(){return null}check_(){return 0}isRed_(){return!1}};const Di=function(n){return"number"==typeof n?"number:"+Ct(n):"string:"+n},pr=function(n){if(n.isLeafNode()){const t=n.val();(0,g.hu)("string"==typeof t||"number"==typeof t||"object"==typeof t&&(0,g.r3)(t,".sv"),"Priority must be a string or number.")}else(0,g.hu)(n===fr||n.isEmpty(),"priority of unexpected type.");(0,g.hu)(n===fr||n.getPriority().isEmpty(),"Priority nodes can't have a priority of their own.")};let Jr,Xr,_r,yn=(()=>{class n{constructor(e,i=n.__childrenNodeConstructor.EMPTY_NODE){this.value_=e,this.priorityNode_=i,this.lazyHash_=null,(0,g.hu)(null!=this.value_,"LeafNode shouldn't be created with null/undefined value."),pr(this.priorityNode_)}static set __childrenNodeConstructor(e){Jr=e}static get __childrenNodeConstructor(){return Jr}isLeafNode(){return!0}getPriority(){return this.priorityNode_}updatePriority(e){return new n(this.value_,e)}getImmediateChild(e){return".priority"===e?this.priorityNode_:n.__childrenNodeConstructor.EMPTY_NODE}getChild(e){return le(e)?this:".priority"===Y(e)?this.priorityNode_:n.__childrenNodeConstructor.EMPTY_NODE}hasChild(){return!1}getPredecessorChildName(e,i){return null}updateImmediateChild(e,i){return".priority"===e?this.updatePriority(i):i.isEmpty()&&".priority"!==e?this:n.__childrenNodeConstructor.EMPTY_NODE.updateImmediateChild(e,i).updatePriority(this.priorityNode_)}updateChild(e,i){const o=Y(e);return null===o?i:i.isEmpty()&&".priority"!==o?this:((0,g.hu)(".priority"!==o||1===de(e),".priority must be the last token in a path"),this.updateImmediateChild(o,n.__childrenNodeConstructor.EMPTY_NODE.updateChild(ve(e),i)))}isEmpty(){return!1}numChildren(){return 0}forEachChild(e,i){return!1}val(e){return e&&!this.getPriority().isEmpty()?{".value":this.getValue(),".priority":this.getPriority().val()}:this.getValue()}hash(){if(null===this.lazyHash_){let e="";this.priorityNode_.isEmpty()||(e+="priority:"+Di(this.priorityNode_.val())+":");const i=typeof this.value_;e+=i+":",e+="number"===i?Ct(this.value_):this.value_,this.lazyHash_=De(e)}return this.lazyHash_}getValue(){return this.value_}compareTo(e){return e===n.__childrenNodeConstructor.EMPTY_NODE?1:e instanceof n.__childrenNodeConstructor?-1:((0,g.hu)(e.isLeafNode(),"Unknown node type"),this.compareToLeafNode_(e))}compareToLeafNode_(e){const i=typeof e.value_,o=typeof this.value_,u=n.VALUE_TYPE_ORDER.indexOf(i),c=n.VALUE_TYPE_ORDER.indexOf(o);return(0,g.hu)(u>=0,"Unknown leaf type: "+i),(0,g.hu)(c>=0,"Unknown leaf type: "+o),u===c?"object"===o?0:this.value_<e.value_?-1:this.value_===e.value_?0:1:c-u}withIndex(){return this}isIndexed(){return!0}equals(e){return e===this||!!e.isLeafNode()&&(this.value_===e.value_&&this.priorityNode_.equals(e.priorityNode_))}}return n.VALUE_TYPE_ORDER=["object","boolean","number","string"],n})();const ke=new class ca extends bi{compare(t,e){const i=t.node.getPriority(),o=e.node.getPriority(),u=i.compareTo(o);return 0===u?J(t.name,e.name):u}isDefinedOn(t){return!t.getPriority().isEmpty()}indexedValueChanged(t,e){return!t.getPriority().equals(e.getPriority())}minPost(){return ne.MIN}maxPost(){return new ne(Z,new yn("[PRIORITY-POST]",_r))}makePost(t,e){const i=Xr(t);return new ne(e,new yn("[PRIORITY-POST]",i))}toString(){return".priority"}},gr=Math.log(2);class ts{constructor(t){this.count=parseInt(Math.log(t+1)/gr,10),this.current_=this.count-1;const o=(u=>parseInt(Array(this.count+1).join("1"),2))();this.bits_=t+1&o}nextBitIsOne(){const t=!(this.bits_&1<<this.current_);return this.current_--,t}}const Un=function(n,t,e,i){n.sort(t);const o=function(_,v){const P=v-_;let b,D;if(0===P)return null;if(1===P)return b=n[_],D=e?e(b):b,new Ot(D,b.node,Ot.BLACK,null,null);{const G=parseInt(P/2,10)+_,q=o(_,G),Te=o(G+1,v);return b=n[G],D=e?e(b):b,new Ot(D,b.node,Ot.BLACK,q,Te)}},h=function(_){let v=null,P=null,b=n.length;const D=function(q,Te){const ft=b-q,Pn=b;b-=q;const jn=o(ft+1,Pn),Zr=n[ft],fc=e?e(Zr):Zr;G(new Ot(fc,Zr.node,Te,null,jn))},G=function(q){v?(v.left=q,v=q):(P=q,v=q)};for(let q=0;q<_.count;++q){const Te=_.nextBitIsOne(),ft=Math.pow(2,_.count-(q+1));Te?D(ft,Ot.BLACK):(D(ft,Ot.BLACK),D(ft,Ot.RED))}return P}(new ts(n.length));return new ht(i||t,h)};let ns;const In={};class dn{constructor(t,e){this.indexes_=t,this.indexSet_=e}static get Default(){return(0,g.hu)(In&&ke,"ChildrenNode.ts has not been loaded"),ns=ns||new dn({".priority":In},{".priority":ke}),ns}get(t){const e=(0,g.DV)(this.indexes_,t);if(!e)throw new Error("No index defined for "+t);return e instanceof ht?e:null}hasIndex(t){return(0,g.r3)(this.indexSet_,t.toString())}addIndex(t,e){(0,g.hu)(t!==Wt,"KeyIndex always exists and isn't meant to be added to the IndexMap.");const i=[];let o=!1;const u=e.getIterator(ne.Wrap);let h,c=u.getNext();for(;c;)o=o||t.isDefinedOn(c.node),i.push(c),c=u.getNext();h=o?Un(i,t.getCompare()):In;const _=t.toString(),v=Object.assign({},this.indexSet_);v[_]=t;const P=Object.assign({},this.indexes_);return P[_]=h,new dn(P,v)}addToIndexes(t,e){const i=(0,g.UI)(this.indexes_,(o,u)=>{const c=(0,g.DV)(this.indexSet_,u);if((0,g.hu)(c,"Missing index implementation for "+u),o===In){if(c.isDefinedOn(t.node)){const h=[],_=e.getIterator(ne.Wrap);let v=_.getNext();for(;v;)v.name!==t.name&&h.push(v),v=_.getNext();return h.push(t),Un(h,c.getCompare())}return In}{const h=e.get(t.name);let _=o;return h&&(_=_.remove(new ne(t.name,h))),_.insert(t,t.node)}});return new dn(i,this.indexSet_)}removeFromIndexes(t,e){const i=(0,g.UI)(this.indexes_,o=>{if(o===In)return o;{const u=e.get(t.name);return u?o.remove(new ne(t.name,u)):o}});return new dn(i,this.indexSet_)}}let Wn,ee=(()=>{class n{constructor(e,i,o){this.children_=e,this.priorityNode_=i,this.indexMap_=o,this.lazyHash_=null,this.priorityNode_&&pr(this.priorityNode_),this.children_.isEmpty()&&(0,g.hu)(!this.priorityNode_||this.priorityNode_.isEmpty(),"An empty node cannot have a priority")}static get EMPTY_NODE(){return Wn||(Wn=new n(new ht(Oi),null,dn.Default))}isLeafNode(){return!1}getPriority(){return this.priorityNode_||Wn}updatePriority(e){return this.children_.isEmpty()?this:new n(this.children_,e,this.indexMap_)}getImmediateChild(e){if(".priority"===e)return this.getPriority();{const i=this.children_.get(e);return null===i?Wn:i}}getChild(e){const i=Y(e);return null===i?this:this.getImmediateChild(i).getChild(ve(e))}hasChild(e){return null!==this.children_.get(e)}updateImmediateChild(e,i){if((0,g.hu)(i,"We should always be passing snapshot nodes"),".priority"===e)return this.updatePriority(i);{const o=new ne(e,i);let u,c;i.isEmpty()?(u=this.children_.remove(e),c=this.indexMap_.removeFromIndexes(o,this.children_)):(u=this.children_.insert(e,i),c=this.indexMap_.addToIndexes(o,this.children_));const h=u.isEmpty()?Wn:this.priorityNode_;return new n(u,h,c)}}updateChild(e,i){const o=Y(e);if(null===o)return i;{(0,g.hu)(".priority"!==Y(e)||1===de(e),".priority must be the last token in a path");const u=this.getImmediateChild(o).updateChild(ve(e),i);return this.updateImmediateChild(o,u)}}isEmpty(){return this.children_.isEmpty()}numChildren(){return this.children_.count()}val(e){if(this.isEmpty())return null;const i={};let o=0,u=0,c=!0;if(this.forEachChild(ke,(h,_)=>{i[h]=_.val(e),o++,c&&n.INTEGER_REGEXP_.test(h)?u=Math.max(u,Number(h)):c=!1}),!e&&c&&u<2*o){const h=[];for(const _ in i)h[_]=i[_];return h}return e&&!this.getPriority().isEmpty()&&(i[".priority"]=this.getPriority().val()),i}hash(){if(null===this.lazyHash_){let e="";this.getPriority().isEmpty()||(e+="priority:"+Di(this.getPriority().val())+":"),this.forEachChild(ke,(i,o)=>{const u=o.hash();""!==u&&(e+=":"+i+":"+u)}),this.lazyHash_=""===e?"":De(e)}return this.lazyHash_}getPredecessorChildName(e,i,o){const u=this.resolveIndex_(o);if(u){const c=u.getPredecessorKey(new ne(e,i));return c?c.name:null}return this.children_.getPredecessorKey(e)}getFirstChildName(e){const i=this.resolveIndex_(e);if(i){const o=i.minKey();return o&&o.name}return this.children_.minKey()}getFirstChild(e){const i=this.getFirstChildName(e);return i?new ne(i,this.children_.get(i)):null}getLastChildName(e){const i=this.resolveIndex_(e);if(i){const o=i.maxKey();return o&&o.name}return this.children_.maxKey()}getLastChild(e){const i=this.getLastChildName(e);return i?new ne(i,this.children_.get(i)):null}forEachChild(e,i){const o=this.resolveIndex_(e);return o?o.inorderTraversal(u=>i(u.name,u.node)):this.children_.inorderTraversal(i)}getIterator(e){return this.getIteratorFrom(e.minPost(),e)}getIteratorFrom(e,i){const o=this.resolveIndex_(i);if(o)return o.getIteratorFrom(e,u=>u);{const u=this.children_.getIteratorFrom(e.name,ne.Wrap);let c=u.peek();for(;null!=c&&i.compare(c,e)<0;)u.getNext(),c=u.peek();return u}}getReverseIterator(e){return this.getReverseIteratorFrom(e.maxPost(),e)}getReverseIteratorFrom(e,i){const o=this.resolveIndex_(i);if(o)return o.getReverseIteratorFrom(e,u=>u);{const u=this.children_.getReverseIteratorFrom(e.name,ne.Wrap);let c=u.peek();for(;null!=c&&i.compare(c,e)>0;)u.getNext(),c=u.peek();return u}}compareTo(e){return this.isEmpty()?e.isEmpty()?0:-1:e.isLeafNode()||e.isEmpty()?1:e===ti?-1:0}withIndex(e){if(e===Wt||this.indexMap_.hasIndex(e))return this;{const i=this.indexMap_.addIndex(e,this.children_);return new n(this.children_,this.priorityNode_,i)}}isIndexed(e){return e===Wt||this.indexMap_.hasIndex(e)}equals(e){if(e===this)return!0;if(e.isLeafNode())return!1;{const i=e;if(this.getPriority().equals(i.getPriority())){if(this.children_.count()===i.children_.count()){const o=this.getIterator(ke),u=i.getIterator(ke);let c=o.getNext(),h=u.getNext();for(;c&&h;){if(c.name!==h.name||!c.node.equals(h.node))return!1;c=o.getNext(),h=u.getNext()}return null===c&&null===h}return!1}return!1}}resolveIndex_(e){return e===Wt?null:this.indexMap_.get(e.toString())}}return n.INTEGER_REGEXP_=/^(0|[1-9]\d*)$/,n})();const ti=new class is extends ee{constructor(){super(new ht(Oi),ee.EMPTY_NODE,dn.Default)}compareTo(t){return t===this?0:1}equals(t){return t===this}getPriority(){return this}getImmediateChild(t){return ee.EMPTY_NODE}isEmpty(){return!1}};Object.defineProperties(ne,{MIN:{value:new ne(ot,ee.EMPTY_NODE)},MAX:{value:new ne(Z,ti)}}),co.__EMPTY_NODE=ee.EMPTY_NODE,yn.__childrenNodeConstructor=ee,function qr(n){fr=n}(ti),function es(n){_r=n}(ti);const rs=!0;function $e(n,t=null){if(null===n)return ee.EMPTY_NODE;if("object"==typeof n&&".priority"in n&&(t=n[".priority"]),(0,g.hu)(null===t||"string"==typeof t||"number"==typeof t||"object"==typeof t&&".sv"in t,"Invalid priority type found: "+typeof t),"object"==typeof n&&".value"in n&&null!==n[".value"]&&(n=n[".value"]),"object"!=typeof n||".sv"in n)return new yn(n,$e(t));if(n instanceof Array||!rs){let e=ee.EMPTY_NODE;return he(n,(i,o)=>{if((0,g.r3)(n,i)&&"."!==i.substring(0,1)){const u=$e(o);(u.isLeafNode()||!u.isEmpty())&&(e=e.updateImmediateChild(i,u))}}),e.updatePriority($e(t))}{const e=[];let i=!1;if(he(n,(c,h)=>{if("."!==c.substring(0,1)){const _=$e(h);_.isEmpty()||(i=i||!_.getPriority().isEmpty(),e.push(new ne(c,_)))}}),0===e.length)return ee.EMPTY_NODE;const u=Un(e,ho,c=>c.name,Oi);if(i){const c=Un(e,ke.getCompare());return new ee(u,$e(t),new dn({".priority":c},{".priority":ke}))}return new ee(u,$e(t),dn.Default)}}!function ua(n){Xr=n}($e);class xi extends bi{constructor(t){super(),this.indexPath_=t,(0,g.hu)(!le(t)&&".priority"!==Y(t),"Can't create PathIndex with empty path or .priority key")}extractChild(t){return t.getChild(this.indexPath_)}isDefinedOn(t){return!t.getChild(this.indexPath_).isEmpty()}compare(t,e){const i=this.extractChild(t.node),o=this.extractChild(e.node),u=i.compareTo(o);return 0===u?J(t.name,e.name):u}makePost(t,e){const i=$e(t),o=ee.EMPTY_NODE.updateChild(this.indexPath_,i);return new ne(e,o)}maxPost(){const t=ee.EMPTY_NODE.updateChild(this.indexPath_,ti);return new ne(Z,t)}toString(){return Pi(this.indexPath_,0).join("/")}}const Li=new class da extends bi{compare(t,e){const i=t.node.compareTo(e.node);return 0===i?J(t.name,e.name):i}isDefinedOn(t){return!0}indexedValueChanged(t,e){return!t.equals(e)}minPost(){return ne.MIN}maxPost(){return ne.MAX}makePost(t,e){const i=$e(t);return new ne(e,i)}toString(){return".value"}};function fo(n){return{type:"value",snapshotNode:n}}function ni(n,t){return{type:"child_added",snapshotNode:t,childName:n}}function Vn(n,t){return{type:"child_removed",snapshotNode:t,childName:n}}function Mi(n,t,e){return{type:"child_changed",snapshotNode:t,childName:n,oldSnap:e}}class Fi{constructor(t){this.index_=t}updateChild(t,e,i,o,u,c){(0,g.hu)(t.isIndexed(this.index_),"A node must be indexed if only a child is updated");const h=t.getImmediateChild(e);return h.getChild(o).equals(i.getChild(o))&&h.isEmpty()===i.isEmpty()||(null!=c&&(i.isEmpty()?t.hasChild(e)?c.trackChildChange(Vn(e,h)):(0,g.hu)(t.isLeafNode(),"A child remove without an old child only makes sense on a leaf node"):h.isEmpty()?c.trackChildChange(ni(e,i)):c.trackChildChange(Mi(e,i,h))),t.isLeafNode()&&i.isEmpty())?t:t.updateImmediateChild(e,i).withIndex(this.index_)}updateFullNode(t,e,i){return null!=i&&(t.isLeafNode()||t.forEachChild(ke,(o,u)=>{e.hasChild(o)||i.trackChildChange(Vn(o,u))}),e.isLeafNode()||e.forEachChild(ke,(o,u)=>{if(t.hasChild(o)){const c=t.getImmediateChild(o);c.equals(u)||i.trackChildChange(Mi(o,u,c))}else i.trackChildChange(ni(o,u))})),e.withIndex(this.index_)}updatePriority(t,e){return t.isEmpty()?ee.EMPTY_NODE:t.updatePriority(e)}filtersNodes(){return!1}getIndexedFilter(){return this}getIndex(){return this.index_}}class Ui{constructor(t){this.indexedFilter_=new Fi(t.getIndex()),this.index_=t.getIndex(),this.startPost_=Ui.getStartPost_(t),this.endPost_=Ui.getEndPost_(t),this.startIsInclusive_=!t.startAfterSet_,this.endIsInclusive_=!t.endBeforeSet_}getStartPost(){return this.startPost_}getEndPost(){return this.endPost_}matches(t){const e=this.startIsInclusive_?this.index_.compare(this.getStartPost(),t)<=0:this.index_.compare(this.getStartPost(),t)<0,i=this.endIsInclusive_?this.index_.compare(t,this.getEndPost())<=0:this.index_.compare(t,this.getEndPost())<0;return e&&i}updateChild(t,e,i,o,u,c){return this.matches(new ne(e,i))||(i=ee.EMPTY_NODE),this.indexedFilter_.updateChild(t,e,i,o,u,c)}updateFullNode(t,e,i){e.isLeafNode()&&(e=ee.EMPTY_NODE);let o=e.withIndex(this.index_);o=o.updatePriority(ee.EMPTY_NODE);const u=this;return e.forEachChild(ke,(c,h)=>{u.matches(new ne(c,h))||(o=o.updateImmediateChild(c,ee.EMPTY_NODE))}),this.indexedFilter_.updateFullNode(t,o,i)}updatePriority(t,e){return t}filtersNodes(){return!0}getIndexedFilter(){return this.indexedFilter_}getIndex(){return this.index_}static getStartPost_(t){if(t.hasStart()){const e=t.getIndexStartName();return t.getIndex().makePost(t.getIndexStartValue(),e)}return t.getIndex().minPost()}static getEndPost_(t){if(t.hasEnd()){const e=t.getIndexEndName();return t.getIndex().makePost(t.getIndexEndValue(),e)}return t.getIndex().maxPost()}}class ss{constructor(t){this.withinDirectionalStart=e=>this.reverse_?this.withinEndPost(e):this.withinStartPost(e),this.withinDirectionalEnd=e=>this.reverse_?this.withinStartPost(e):this.withinEndPost(e),this.withinStartPost=e=>{const i=this.index_.compare(this.rangedFilter_.getStartPost(),e);return this.startIsInclusive_?i<=0:i<0},this.withinEndPost=e=>{const i=this.index_.compare(e,this.rangedFilter_.getEndPost());return this.endIsInclusive_?i<=0:i<0},this.rangedFilter_=new Ui(t),this.index_=t.getIndex(),this.limit_=t.getLimit(),this.reverse_=!t.isViewFromLeft(),this.startIsInclusive_=!t.startAfterSet_,this.endIsInclusive_=!t.endBeforeSet_}updateChild(t,e,i,o,u,c){return this.rangedFilter_.matches(new ne(e,i))||(i=ee.EMPTY_NODE),t.getImmediateChild(e).equals(i)?t:t.numChildren()<this.limit_?this.rangedFilter_.getIndexedFilter().updateChild(t,e,i,o,u,c):this.fullLimitUpdateChild_(t,e,i,u,c)}updateFullNode(t,e,i){let o;if(e.isLeafNode()||e.isEmpty())o=ee.EMPTY_NODE.withIndex(this.index_);else if(2*this.limit_<e.numChildren()&&e.isIndexed(this.index_)){let u;o=ee.EMPTY_NODE.withIndex(this.index_),u=this.reverse_?e.getReverseIteratorFrom(this.rangedFilter_.getEndPost(),this.index_):e.getIteratorFrom(this.rangedFilter_.getStartPost(),this.index_);let c=0;for(;u.hasNext()&&c<this.limit_;){const h=u.getNext();if(this.withinDirectionalStart(h)){if(!this.withinDirectionalEnd(h))break;o=o.updateImmediateChild(h.name,h.node),c++}}}else{let u;o=e.withIndex(this.index_),o=o.updatePriority(ee.EMPTY_NODE),u=this.reverse_?o.getReverseIterator(this.index_):o.getIterator(this.index_);let c=0;for(;u.hasNext();){const h=u.getNext();c<this.limit_&&this.withinDirectionalStart(h)&&this.withinDirectionalEnd(h)?c++:o=o.updateImmediateChild(h.name,ee.EMPTY_NODE)}}return this.rangedFilter_.getIndexedFilter().updateFullNode(t,o,i)}updatePriority(t,e){return t}filtersNodes(){return!0}getIndexedFilter(){return this.rangedFilter_.getIndexedFilter()}getIndex(){return this.index_}fullLimitUpdateChild_(t,e,i,o,u){let c;if(this.reverse_){const b=this.index_.getCompare();c=(D,G)=>b(G,D)}else c=this.index_.getCompare();const h=t;(0,g.hu)(h.numChildren()===this.limit_,"");const _=new ne(e,i),v=this.reverse_?h.getFirstChild(this.index_):h.getLastChild(this.index_),P=this.rangedFilter_.matches(_);if(h.hasChild(e)){const b=h.getImmediateChild(e);let D=o.getChildAfterChild(this.index_,v,this.reverse_);for(;null!=D&&(D.name===e||h.hasChild(D.name));)D=o.getChildAfterChild(this.index_,D,this.reverse_);const G=null==D?1:c(D,_);if(P&&!i.isEmpty()&&G>=0)return u?.trackChildChange(Mi(e,i,b)),h.updateImmediateChild(e,i);{u?.trackChildChange(Vn(e,b));const Te=h.updateImmediateChild(e,ee.EMPTY_NODE);return null!=D&&this.rangedFilter_.matches(D)?(u?.trackChildChange(ni(D.name,D.node)),Te.updateImmediateChild(D.name,D.node)):Te}}return i.isEmpty()?t:P&&c(v,_)>=0?(null!=u&&(u.trackChildChange(Vn(v.name,v.node)),u.trackChildChange(ni(e,i))),h.updateImmediateChild(e,i).updateImmediateChild(v.name,ee.EMPTY_NODE)):t}}class mr{constructor(){this.limitSet_=!1,this.startSet_=!1,this.startNameSet_=!1,this.startAfterSet_=!1,this.endSet_=!1,this.endNameSet_=!1,this.endBeforeSet_=!1,this.limit_=0,this.viewFrom_="",this.indexStartValue_=null,this.indexStartName_="",this.indexEndValue_=null,this.indexEndName_="",this.index_=ke}hasStart(){return this.startSet_}isViewFromLeft(){return""===this.viewFrom_?this.startSet_:"l"===this.viewFrom_}getIndexStartValue(){return(0,g.hu)(this.startSet_,"Only valid if start has been set"),this.indexStartValue_}getIndexStartName(){return(0,g.hu)(this.startSet_,"Only valid if start has been set"),this.startNameSet_?this.indexStartName_:ot}hasEnd(){return this.endSet_}getIndexEndValue(){return(0,g.hu)(this.endSet_,"Only valid if end has been set"),this.indexEndValue_}getIndexEndName(){return(0,g.hu)(this.endSet_,"Only valid if end has been set"),this.endNameSet_?this.indexEndName_:Z}hasLimit(){return this.limitSet_}hasAnchoredLimit(){return this.limitSet_&&""!==this.viewFrom_}getLimit(){return(0,g.hu)(this.limitSet_,"Only valid if limit has been set"),this.limit_}getIndex(){return this.index_}loadsAllData(){return!(this.startSet_||this.endSet_||this.limitSet_)}isDefault(){return this.loadsAllData()&&this.index_===ke}copy(){const t=new mr;return t.limitSet_=this.limitSet_,t.limit_=this.limit_,t.startSet_=this.startSet_,t.startAfterSet_=this.startAfterSet_,t.indexStartValue_=this.indexStartValue_,t.startNameSet_=this.startNameSet_,t.indexStartName_=this.indexStartName_,t.endSet_=this.endSet_,t.endBeforeSet_=this.endBeforeSet_,t.indexEndValue_=this.indexEndValue_,t.endNameSet_=this.endNameSet_,t.indexEndName_=this.indexEndName_,t.index_=this.index_,t.viewFrom_=this.viewFrom_,t}}function ls(n,t,e){const i=n.copy();return i.startSet_=!0,void 0===t&&(t=null),i.indexStartValue_=t,null!=e?(i.startNameSet_=!0,i.indexStartName_=e):(i.startNameSet_=!1,i.indexStartName_=""),i}function cs(n,t,e){const i=n.copy();return i.endSet_=!0,void 0===t&&(t=null),i.indexEndValue_=t,void 0!==e?(i.endNameSet_=!0,i.indexEndName_=e):(i.endNameSet_=!1,i.indexEndName_=""),i}function vr(n,t){const e=n.copy();return e.index_=t,e}function yr(n){const t={};if(n.isDefault())return t;let e;if(n.index_===ke?e="$priority":n.index_===Li?e="$value":n.index_===Wt?e="$key":((0,g.hu)(n.index_ instanceof xi,"Unrecognized index type!"),e=n.index_.toString()),t.orderBy=(0,g.Wl)(e),n.startSet_){const i=n.startAfterSet_?"startAfter":"startAt";t[i]=(0,g.Wl)(n.indexStartValue_),n.startNameSet_&&(t[i]+=","+(0,g.Wl)(n.indexStartName_))}if(n.endSet_){const i=n.endBeforeSet_?"endBefore":"endAt";t[i]=(0,g.Wl)(n.indexEndValue_),n.endNameSet_&&(t[i]+=","+(0,g.Wl)(n.indexEndName_))}return n.limitSet_&&(n.isViewFromLeft()?t.limitToFirst=n.limit_:t.limitToLast=n.limit_),t}function po(n){const t={};if(n.startSet_&&(t.sp=n.indexStartValue_,n.startNameSet_&&(t.sn=n.indexStartName_),t.sin=!n.startAfterSet_),n.endSet_&&(t.ep=n.indexEndValue_,n.endNameSet_&&(t.en=n.indexEndName_),t.ein=!n.endBeforeSet_),n.limitSet_){t.l=n.limit_;let e=n.viewFrom_;""===e&&(e=n.isViewFromLeft()?"l":"r"),t.vf=e}return n.index_!==ke&&(t.i=n.index_.toString()),t}class Ir extends T{constructor(t,e,i,o){super(),this.repoInfo_=t,this.onDataUpdate_=e,this.authTokenProvider_=i,this.appCheckTokenProvider_=o,this.log_=be("p:rest:"),this.listens_={}}reportStats(t){throw new Error("Method not implemented.")}static getListenId_(t,e){return void 0!==e?"tag$"+e:((0,g.hu)(t._queryParams.isDefault(),"should have a tag if it's not a default query."),t._path.toString())}listen(t,e,i,o){const u=t._path.toString();this.log_("Listen called for "+u+" "+t._queryIdentifier);const c=Ir.getListenId_(t,i),h={};this.listens_[c]=h;const _=yr(t._queryParams);this.restRequest_(u+".json",_,(v,P)=>{let b=P;if(404===v&&(b=null,v=null),null===v&&this.onDataUpdate_(u,b,!1,i),(0,g.DV)(this.listens_,c)===h){let D;D=v?401===v?"permission_denied":"rest_error:"+v:"ok",o(D,null)}})}unlisten(t,e){const i=Ir.getListenId_(t,e);delete this.listens_[i]}get(t){const e=yr(t._queryParams),i=t._path.toString(),o=new g.BH;return this.restRequest_(i+".json",e,(u,c)=>{let h=c;404===u&&(h=null,u=null),null===u?(this.onDataUpdate_(i,h,!1,null),o.resolve(h)):o.reject(new Error(h))}),o.promise}refreshAuthToken(t){}restRequest_(t,e={},i){return e.format="export",Promise.all([this.authTokenProvider_.getToken(!1),this.appCheckTokenProvider_.getToken(!1)]).then(([o,u])=>{o&&o.accessToken&&(e.auth=o.accessToken),u&&u.token&&(e.ac=u.token);const c=(this.repoInfo_.secure?"https://":"http://")+this.repoInfo_.host+t+"?ns="+this.repoInfo_.namespace+(0,g.xO)(e);this.log_("Sending REST request for "+c);const h=new XMLHttpRequest;h.onreadystatechange=()=>{if(i&&4===h.readyState){this.log_("REST Response for "+c+" received. status:",h.status,"response:",h.responseText);let _=null;if(h.status>=200&&h.status<300){try{_=(0,g.cI)(h.responseText)}catch{we("Failed to parse JSON response for "+c+": "+h.responseText)}i(null,_)}else 401!==h.status&&404!==h.status&&we("Got unsuccessful REST response for "+c+" Status: "+h.status),i(h.status);i=null}},h.open("GET",c,!0),h.send()})}}class _o{constructor(){this.rootNode_=ee.EMPTY_NODE}getNode(t){return this.rootNode_.getChild(t)}updateSnapshot(t,e){this.rootNode_=this.rootNode_.updateChild(t,e)}}function ii(){return{value:null,children:new Map}}function ri(n,t,e){if(le(t))n.value=e,n.children.clear();else if(null!==n.value)n.value=n.value.updateChild(t,e);else{const i=Y(t);n.children.has(i)||n.children.set(i,ii()),ri(n.children.get(i),t=ve(t),e)}}function En(n,t){if(le(t))return n.value=null,n.children.clear(),!0;if(null!==n.value){if(n.value.isLeafNode())return!1;{const e=n.value;return n.value=null,e.forEachChild(ke,(i,o)=>{ri(n,new W(i),o)}),En(n,t)}}if(n.children.size>0){const e=Y(t);return t=ve(t),n.children.has(e)&&En(n.children.get(e),t)&&n.children.delete(e),0===n.children.size}return!0}function Er(n,t,e){null!==n.value?e(t,n.value):function pa(n,t){n.children.forEach((e,i)=>{t(i,e)})}(n,(i,o)=>{Er(o,new W(t.toString()+"/"+i),e)})}class _a{constructor(t){this.collection_=t,this.last_=null}get(){const t=this.collection_.get(),e=Object.assign({},t);return this.last_&&he(this.last_,(i,o)=>{e[i]=e[i]-o}),this.last_=t,e}}class dl{constructor(t,e){this.server_=e,this.statsToReport_={},this.statsListener_=new _a(t);const i=1e4+2e4*Math.random();Lt(this.reportStats_.bind(this),Math.floor(i))}reportStats_(){const t=this.statsListener_.get(),e={};let i=!1;he(t,(o,u)=>{u>0&&(0,g.r3)(this.statsToReport_,o)&&(e[o]=u,i=!0)}),i&&this.server_.reportStats(e),Lt(this.reportStats_.bind(this),Math.floor(2*Math.random()*3e5))}}var Vt=(()=>{return(n=Vt||(Vt={}))[n.OVERWRITE=0]="OVERWRITE",n[n.MERGE=1]="MERGE",n[n.ACK_USER_WRITE=2]="ACK_USER_WRITE",n[n.LISTEN_COMPLETE=3]="LISTEN_COMPLETE",Vt;var n})();function vo(n){return{fromUser:!1,fromServer:!0,queryId:n,tagged:!0}}class fs{constructor(t,e,i){this.path=t,this.affectedTree=e,this.revert=i,this.type=Vt.ACK_USER_WRITE,this.source={fromUser:!0,fromServer:!1,queryId:null,tagged:!1}}operationForChild(t){if(le(this.path)){if(null!=this.affectedTree.value)return(0,g.hu)(this.affectedTree.children.isEmpty(),"affectedTree should not have overlapping affected paths."),this;{const e=this.affectedTree.subtree(new W(t));return new fs(z(),e,this.revert)}}return(0,g.hu)(Y(this.path)===t,"operationForChild called for unrelated child."),new fs(ve(this.path),this.affectedTree,this.revert)}}class Tr{constructor(t,e){this.source=t,this.path=e,this.type=Vt.LISTEN_COMPLETE}operationForChild(t){return le(this.path)?new Tr(this.source,z()):new Tr(this.source,ve(this.path))}}class si{constructor(t,e,i){this.source=t,this.path=e,this.snap=i,this.type=Vt.OVERWRITE}operationForChild(t){return le(this.path)?new si(this.source,z(),this.snap.getImmediateChild(t)):new si(this.source,ve(this.path),this.snap)}}class Tn{constructor(t,e,i){this.source=t,this.path=e,this.children=i,this.type=Vt.MERGE}operationForChild(t){if(le(this.path)){const e=this.children.subtree(new W(t));return e.isEmpty()?null:e.value?new si(this.source,z(),e.value):new Tn(this.source,z(),e)}return(0,g.hu)(Y(this.path)===t,"Can't get a merge for a child not on the path of the operation"),new Tn(this.source,ve(this.path),this.children)}toString(){return"Operation("+this.path+": "+this.source.toString()+" merge: "+this.children.toString()+")"}}class kt{constructor(t,e,i){this.node_=t,this.fullyInitialized_=e,this.filtered_=i}isFullyInitialized(){return this.fullyInitialized_}isFiltered(){return this.filtered_}isCompleteForPath(t){if(le(t))return this.isFullyInitialized()&&!this.filtered_;const e=Y(t);return this.isCompleteForChild(e)}isCompleteForChild(t){return this.isFullyInitialized()&&!this.filtered_||this.node_.hasChild(t)}getNode(){return this.node_}}class ps{constructor(t){this.query_=t,this.index_=this.query_._queryParams.getIndex()}}function Wi(n,t,e,i,o,u){const c=i.filter(h=>h.type===e);c.sort((h,_)=>function Ia(n,t,e){if(null==t.childName||null==e.childName)throw(0,g.g5)("Should only compare child_ events.");const i=new ne(t.childName,t.snapshotNode),o=new ne(e.childName,e.snapshotNode);return n.index_.compare(i,o)}(n,h,_)),c.forEach(h=>{const _=function ya(n,t,e){return"value"===t.type||"child_removed"===t.type||(t.prevName=e.getPredecessorChildName(t.childName,t.snapshotNode,n.index_)),t}(n,h,u);o.forEach(v=>{v.respondsTo(h.type)&&t.push(v.createEvent(_,n.query_))})})}function oi(n,t){return{eventCache:n,serverCache:t}}function Bn(n,t,e,i){return oi(new kt(t,e,i),n.serverCache)}function yo(n,t,e,i){return oi(n.eventCache,new kt(t,e,i))}function Zn(n){return n.eventCache.isFullyInitialized()?n.eventCache.getNode():null}function Cn(n){return n.serverCache.isFullyInitialized()?n.serverCache.getNode():null}let _s;class Me{constructor(t,e=(()=>(_s||(_s=new ht(N)),_s))()){this.value=t,this.children=e}static fromObject(t){let e=new Me(null);return he(t,(i,o)=>{e=e.set(new W(i),o)}),e}isEmpty(){return null===this.value&&this.children.isEmpty()}findRootMostMatchingPathAndValue(t,e){if(null!=this.value&&e(this.value))return{path:z(),value:this.value};if(le(t))return null;{const i=Y(t),o=this.children.get(i);if(null!==o){const u=o.findRootMostMatchingPathAndValue(ve(t),e);return null!=u?{path:Re(new W(i),u.path),value:u.value}:null}return null}}findRootMostValueAndPath(t){return this.findRootMostMatchingPathAndValue(t,()=>!0)}subtree(t){if(le(t))return this;{const e=Y(t),i=this.children.get(e);return null!==i?i.subtree(ve(t)):new Me(null)}}set(t,e){if(le(t))return new Me(e,this.children);{const i=Y(t),u=(this.children.get(i)||new Me(null)).set(ve(t),e),c=this.children.insert(i,u);return new Me(this.value,c)}}remove(t){if(le(t))return this.children.isEmpty()?new Me(null):new Me(null,this.children);{const e=Y(t),i=this.children.get(e);if(i){const o=i.remove(ve(t));let u;return u=o.isEmpty()?this.children.remove(e):this.children.insert(e,o),null===this.value&&u.isEmpty()?new Me(null):new Me(this.value,u)}return this}}get(t){if(le(t))return this.value;{const e=Y(t),i=this.children.get(e);return i?i.get(ve(t)):null}}setTree(t,e){if(le(t))return e;{const i=Y(t),u=(this.children.get(i)||new Me(null)).setTree(ve(t),e);let c;return c=u.isEmpty()?this.children.remove(i):this.children.insert(i,u),new Me(this.value,c)}}fold(t){return this.fold_(z(),t)}fold_(t,e){const i={};return this.children.inorderTraversal((o,u)=>{i[o]=u.fold_(Re(t,o),e)}),e(t,this.value,i)}findOnPath(t,e){return this.findOnPath_(t,z(),e)}findOnPath_(t,e,i){const o=!!this.value&&i(e,this.value);if(o)return o;if(le(t))return null;{const u=Y(t),c=this.children.get(u);return c?c.findOnPath_(ve(t),Re(e,u),i):null}}foreachOnPath(t,e){return this.foreachOnPath_(t,z(),e)}foreachOnPath_(t,e,i){if(le(t))return this;{this.value&&i(e,this.value);const o=Y(t),u=this.children.get(o);return u?u.foreachOnPath_(ve(t),Re(e,o),i):new Me(null)}}foreach(t){this.foreach_(z(),t)}foreach_(t,e){this.children.inorderTraversal((i,o)=>{o.foreach_(Re(t,i),e)}),this.value&&e(t,this.value)}foreachChild(t){this.children.inorderTraversal((e,i)=>{i.value&&t(e,i.value)})}}class qt{constructor(t){this.writeTree_=t}static empty(){return new qt(new Me(null))}}function ai(n,t,e){if(le(t))return new qt(new Me(e));{const i=n.writeTree_.findRootMostValueAndPath(t);if(null!=i){const o=i.path;let u=i.value;const c=lt(o,t);return u=u.updateChild(c,e),new qt(n.writeTree_.set(o,u))}{const o=new Me(e),u=n.writeTree_.setTree(t,o);return new qt(u)}}}function Io(n,t,e){let i=n;return he(e,(o,u)=>{i=ai(i,Re(t,o),u)}),i}function Cr(n,t){if(le(t))return qt.empty();{const e=n.writeTree_.setTree(t,new Me(null));return new qt(e)}}function gs(n,t){return null!=Hn(n,t)}function Hn(n,t){const e=n.writeTree_.findRootMostValueAndPath(t);return null!=e?n.writeTree_.get(e.path).getChild(lt(e.path,t)):null}function li(n){const t=[],e=n.writeTree_.value;return null!=e?e.isLeafNode()||e.forEachChild(ke,(i,o)=>{t.push(new ne(i,o))}):n.writeTree_.children.inorderTraversal((i,o)=>{null!=o.value&&t.push(new ne(i,o.value))}),t}function An(n,t){if(le(t))return n;{const e=Hn(n,t);return new qt(null!=e?new Me(e):n.writeTree_.subtree(t))}}function qe(n){return n.writeTree_.isEmpty()}function ui(n,t){return Ar(z(),n.writeTree_,t)}function Ar(n,t,e){if(null!=t.value)return e.updateChild(n,t.value);{let i=null;return t.children.inorderTraversal((o,u)=>{".priority"===o?((0,g.hu)(null!==u.value,"Priority writes must always be leaf nodes"),i=u.value):e=Ar(Re(n,o),u,e)}),!e.getChild(n).isEmpty()&&null!==i&&(e=e.updateChild(Re(n,".priority"),i)),e}}function Sr(n,t){return Ro(t,n)}function Aa(n,t){if(n.snap)return dt(n.path,t);for(const e in n.children)if(n.children.hasOwnProperty(e)&&dt(Re(n.path,e),t))return!0;return!1}function To(n){return n.visible}function ci(n,t,e){let i=qt.empty();for(let o=0;o<n.length;++o){const u=n[o];if(t(u)){const c=u.path;let h;if(u.snap)dt(e,c)?(h=lt(e,c),i=ai(i,h,u.snap)):dt(c,e)&&(h=lt(c,e),i=ai(i,z(),u.snap.getChild(h)));else{if(!u.children)throw(0,g.g5)("WriteRecord should have .snap or .children");if(dt(e,c))h=lt(e,c),i=Io(i,h,u.children);else if(dt(c,e))if(h=lt(c,e),le(h))i=Io(i,z(),u.children);else{const _=(0,g.DV)(u.children,Y(h));if(_){const v=_.getChild(ve(h));i=ai(i,z(),v)}}}}}return i}function Vi(n,t,e,i,o){if(i||o){const u=An(n.visibleWrites,t);return!o&&qe(u)?e:o||null!=e||gs(u,z())?ui(ci(n.allWrites,function(v){return(v.visible||o)&&(!i||!~i.indexOf(v.writeId))&&(dt(v.path,t)||dt(t,v.path))},t),e||ee.EMPTY_NODE):null}{const u=Hn(n.visibleWrites,t);if(null!=u)return u;{const c=An(n.visibleWrites,t);return qe(c)?e:null!=e||gs(c,z())?ui(c,e||ee.EMPTY_NODE):null}}}function Bi(n,t,e,i){return Vi(n.writeTree,n.treePath,t,e,i)}function Es(n,t){return function Sa(n,t,e){let i=ee.EMPTY_NODE;const o=Hn(n.visibleWrites,t);if(o)return o.isLeafNode()||o.forEachChild(ke,(u,c)=>{i=i.updateImmediateChild(u,c)}),i;if(e){const u=An(n.visibleWrites,t);return e.forEachChild(ke,(c,h)=>{const _=ui(An(u,new W(c)),h);i=i.updateImmediateChild(c,_)}),li(u).forEach(c=>{i=i.updateImmediateChild(c.name,c.node)}),i}return li(An(n.visibleWrites,t)).forEach(c=>{i=i.updateImmediateChild(c.name,c.node)}),i}(n.writeTree,n.treePath,t)}function Ao(n,t,e,i){return function vs(n,t,e,i,o){(0,g.hu)(i||o,"Either existingEventSnap or existingServerSnap must exist");const u=Re(t,e);if(gs(n.visibleWrites,u))return null;{const c=An(n.visibleWrites,u);return qe(c)?o.getChild(e):ui(c,o.getChild(e))}}(n.writeTree,n.treePath,t,e,i)}function Ts(n,t){return function ys(n,t){return Hn(n.visibleWrites,t)}(n.writeTree,Re(n.treePath,t))}function Cs(n,t,e){return function Co(n,t,e,i){const o=Re(t,e),u=Hn(n.visibleWrites,o);return null!=u?u:i.isCompleteForChild(e)?ui(An(n.visibleWrites,o),i.getNode().getImmediateChild(e)):null}(n.writeTree,n.treePath,t,e)}function wo(n,t){return Ro(Re(n.treePath,t),n.writeTree)}function Ro(n,t){return{treePath:n,writeTree:t}}class As{constructor(){this.changeMap=new Map}trackChildChange(t){const e=t.type,i=t.childName;(0,g.hu)("child_added"===e||"child_changed"===e||"child_removed"===e,"Only child changes supported for tracking"),(0,g.hu)(".priority"!==i,"Only non-priority child changes can be tracked.");const o=this.changeMap.get(i);if(o){const u=o.type;if("child_added"===e&&"child_removed"===u)this.changeMap.set(i,Mi(i,t.snapshotNode,o.snapshotNode));else if("child_removed"===e&&"child_added"===u)this.changeMap.delete(i);else if("child_removed"===e&&"child_changed"===u)this.changeMap.set(i,Vn(i,o.oldSnap));else if("child_changed"===e&&"child_added"===u)this.changeMap.set(i,ni(i,t.snapshotNode));else{if("child_changed"!==e||"child_changed"!==u)throw(0,g.g5)("Illegal combination of changes: "+t+" occurred after "+o);this.changeMap.set(i,Mi(i,t.snapshotNode,o.oldSnap))}}else this.changeMap.set(i,t)}getChanges(){return Array.from(this.changeMap.values())}}const Ss=new class Ra{getCompleteChild(t){return null}getChildAfterChild(t,e,i){return null}};class Rr{constructor(t,e,i=null){this.writes_=t,this.viewCache_=e,this.optCompleteServerCache_=i}getCompleteChild(t){const e=this.viewCache_.eventCache;if(e.isCompleteForChild(t))return e.getNode().getImmediateChild(t);{const i=null!=this.optCompleteServerCache_?new kt(this.optCompleteServerCache_,!0,!1):this.viewCache_.serverCache;return Cs(this.writes_,t,i)}}getChildAfterChild(t,e,i){const o=null!=this.optCompleteServerCache_?this.optCompleteServerCache_:Cn(this.viewCache_),u=function So(n,t,e,i,o,u){return function wa(n,t,e,i,o,u,c){let h;const _=An(n.visibleWrites,t),v=Hn(_,z());if(null!=v)h=v;else{if(null==e)return[];h=ui(_,e)}if(h=h.withIndex(c),h.isEmpty()||h.isLeafNode())return[];{const P=[],b=c.getCompare(),D=u?h.getReverseIteratorFrom(i,c):h.getIteratorFrom(i,c);let G=D.getNext();for(;G&&P.length<o;)0!==b(G,i)&&P.push(G),G=D.getNext();return P}}(n.writeTree,n.treePath,t,e,i,o,u)}(this.writes_,o,e,1,i,t);return 0===u.length?null:u[0]}}function ko(n,t,e,i,o,u){const c=t.eventCache;if(null!=Ts(i,e))return t;{let h,_;if(le(e))if((0,g.hu)(t.serverCache.isFullyInitialized(),"If change path is empty, we must have complete server data"),t.serverCache.isFiltered()){const v=Cn(t),b=Es(i,v instanceof ee?v:ee.EMPTY_NODE);h=n.filter.updateFullNode(t.eventCache.getNode(),b,u)}else{const v=Bi(i,Cn(t));h=n.filter.updateFullNode(t.eventCache.getNode(),v,u)}else{const v=Y(e);if(".priority"===v){(0,g.hu)(1===de(e),"Can't have a priority with additional path components");const P=c.getNode();_=t.serverCache.getNode();const b=Ao(i,e,P,_);h=null!=b?n.filter.updatePriority(P,b):c.getNode()}else{const P=ve(e);let b;if(c.isCompleteForChild(v)){_=t.serverCache.getNode();const D=Ao(i,e,c.getNode(),_);b=null!=D?c.getNode().getImmediateChild(v).updateChild(P,D):c.getNode().getImmediateChild(v)}else b=Cs(i,v,t.serverCache);h=null!=b?n.filter.updateChild(c.getNode(),v,b,P,o,u):c.getNode()}}return Bn(t,h,c.isFullyInitialized()||le(e),n.filter.filtersNodes())}}function Pr(n,t,e,i,o,u,c,h){const _=t.serverCache;let v;const P=c?n.filter:n.filter.getIndexedFilter();if(le(e))v=P.updateFullNode(_.getNode(),i,null);else if(P.filtersNodes()&&!_.isFiltered()){const G=_.getNode().updateChild(e,i);v=P.updateFullNode(_.getNode(),G,null)}else{const G=Y(e);if(!_.isCompleteForPath(e)&&de(e)>1)return t;const q=ve(e),ft=_.getNode().getImmediateChild(G).updateChild(q,i);v=".priority"===G?P.updatePriority(_.getNode(),ft):P.updateChild(_.getNode(),G,ft,q,Ss,null)}const b=yo(t,v,_.isFullyInitialized()||le(e),P.filtersNodes());return ko(n,b,e,o,new Rr(o,b,u),h)}function Zi(n,t,e,i,o,u,c){const h=t.eventCache;let _,v;const P=new Rr(o,t,u);if(le(e))v=n.filter.updateFullNode(t.eventCache.getNode(),i,c),_=Bn(t,v,!0,n.filter.filtersNodes());else{const b=Y(e);if(".priority"===b)v=n.filter.updatePriority(t.eventCache.getNode(),i),_=Bn(t,v,h.isFullyInitialized(),h.isFiltered());else{const D=ve(e),G=h.getNode().getImmediateChild(b);let q;if(le(D))q=i;else{const Te=P.getCompleteChild(b);q=null!=Te?".priority"===gn(D)&&Te.getChild(oo(D)).isEmpty()?Te:Te.updateChild(D,i):ee.EMPTY_NODE}_=G.equals(q)?t:Bn(t,n.filter.updateChild(h.getNode(),b,q,D,P,c),h.isFullyInitialized(),n.filter.filtersNodes())}}return _}function Po(n,t){return n.eventCache.isCompleteForChild(t)}function bo(n,t,e){return e.foreach((i,o)=>{t=t.updateChild(i,o)}),t}function ws(n,t,e,i,o,u,c,h){if(t.serverCache.getNode().isEmpty()&&!t.serverCache.isFullyInitialized())return t;let v,_=t;v=le(e)?i:new Me(null).setTree(e,i);const P=t.serverCache.getNode();return v.children.inorderTraversal((b,D)=>{if(P.hasChild(b)){const q=bo(0,t.serverCache.getNode().getImmediateChild(b),D);_=Pr(n,_,new W(b),q,o,u,c,h)}}),v.children.inorderTraversal((b,D)=>{const G=!t.serverCache.isCompleteForChild(b)&&null===D.value;if(!P.hasChild(b)&&!G){const Te=bo(0,t.serverCache.getNode().getImmediateChild(b),D);_=Pr(n,_,new W(b),Te,o,u,c,h)}}),_}class xa{constructor(t,e){this.query_=t,this.eventRegistrations_=[];const i=this.query_._queryParams,o=new Fi(i.getIndex()),u=function os(n){return n.loadsAllData()?new Fi(n.getIndex()):n.hasLimit()?new ss(n):new Ui(n)}(i);this.processor_=function ka(n){return{filter:n}}(u);const c=e.serverCache,h=e.eventCache,_=o.updateFullNode(ee.EMPTY_NODE,c.getNode(),null),v=u.updateFullNode(ee.EMPTY_NODE,h.getNode(),null),P=new kt(_,c.isFullyInitialized(),o.filtersNodes()),b=new kt(v,h.isFullyInitialized(),u.filtersNodes());this.viewCache_=oi(b,P),this.eventGenerator_=new ps(this.query_)}get query(){return this.query_}}function Ma(n,t){const e=Cn(n.viewCache_);return e&&(n.query._queryParams.loadsAllData()||!le(t)&&!e.getImmediateChild(Y(t)).isEmpty())?e.getChild(t):null}function br(n){return 0===n.eventRegistrations_.length}function Nr(n,t,e){const i=[];if(e){(0,g.hu)(null==t,"A cancel should cancel all event registrations.");const o=n.query._path;n.eventRegistrations_.forEach(u=>{const c=u.createCancelEvent(e,o);c&&i.push(c)})}if(t){let o=[];for(let u=0;u<n.eventRegistrations_.length;++u){const c=n.eventRegistrations_[u];if(c.matches(t)){if(t.hasAnyCallback()){o=o.concat(n.eventRegistrations_.slice(u+1));break}}else o.push(c)}n.eventRegistrations_=o}else n.eventRegistrations_=[];return i}function Oo(n,t,e,i){t.type===Vt.MERGE&&null!==t.source.queryId&&((0,g.hu)(Cn(n.viewCache_),"We should always have a full cache before handling merges"),(0,g.hu)(Zn(n.viewCache_),"Missing event cache, even though we have a server cache"));const o=n.viewCache_,u=function kr(n,t,e,i,o){const u=new As;let c,h;if(e.type===Vt.OVERWRITE){const v=e;v.source.fromUser?c=Zi(n,t,v.path,v.snap,i,o,u):((0,g.hu)(v.source.fromServer,"Unknown source."),h=v.source.tagged||t.serverCache.isFiltered()&&!le(v.path),c=Pr(n,t,v.path,v.snap,i,o,h,u))}else if(e.type===Vt.MERGE){const v=e;v.source.fromUser?c=function Na(n,t,e,i,o,u,c){let h=t;return i.foreach((_,v)=>{const P=Re(e,_);Po(t,Y(P))&&(h=Zi(n,h,P,v,o,u,c))}),i.foreach((_,v)=>{const P=Re(e,_);Po(t,Y(P))||(h=Zi(n,h,P,v,o,u,c))}),h}(n,t,v.path,v.children,i,o,u):((0,g.hu)(v.source.fromServer,"Unknown source."),h=v.source.tagged||t.serverCache.isFiltered(),c=ws(n,t,v.path,v.children,i,o,h,u))}else if(e.type===Vt.ACK_USER_WRITE){const v=e;c=v.revert?function Da(n,t,e,i,o,u){let c;if(null!=Ts(i,e))return t;{const h=new Rr(i,t,o),_=t.eventCache.getNode();let v;if(le(e)||".priority"===Y(e)){let P;if(t.serverCache.isFullyInitialized())P=Bi(i,Cn(t));else{const b=t.serverCache.getNode();(0,g.hu)(b instanceof ee,"serverChildren would be complete if leaf node"),P=Es(i,b)}v=n.filter.updateFullNode(_,P,u)}else{const P=Y(e);let b=Cs(i,P,t.serverCache);null==b&&t.serverCache.isCompleteForChild(P)&&(b=_.getImmediateChild(P)),v=null!=b?n.filter.updateChild(_,P,b,ve(e),h,u):t.eventCache.getNode().hasChild(P)?n.filter.updateChild(_,P,ee.EMPTY_NODE,ve(e),h,u):_,v.isEmpty()&&t.serverCache.isFullyInitialized()&&(c=Bi(i,Cn(t)),c.isLeafNode()&&(v=n.filter.updateFullNode(v,c,u)))}return c=t.serverCache.isFullyInitialized()||null!=Ts(i,z()),Bn(t,v,c,n.filter.filtersNodes())}}(n,t,v.path,i,o,u):function Oa(n,t,e,i,o,u,c){if(null!=Ts(o,e))return t;const h=t.serverCache.isFiltered(),_=t.serverCache;if(null!=i.value){if(le(e)&&_.isFullyInitialized()||_.isCompleteForPath(e))return Pr(n,t,e,_.getNode().getChild(e),o,u,h,c);if(le(e)){let v=new Me(null);return _.getNode().forEachChild(Wt,(P,b)=>{v=v.set(new W(P),b)}),ws(n,t,e,v,o,u,h,c)}return t}{let v=new Me(null);return i.foreach((P,b)=>{const D=Re(e,P);_.isCompleteForPath(D)&&(v=v.set(P,_.getNode().getChild(D)))}),ws(n,t,e,v,o,u,h,c)}}(n,t,v.path,v.affectedTree,i,o,u)}else{if(e.type!==Vt.LISTEN_COMPLETE)throw(0,g.g5)("Unknown operation type: "+e.type);c=function No(n,t,e,i,o){const u=t.serverCache;return ko(n,yo(t,u.getNode(),u.isFullyInitialized()||le(e),u.isFiltered()),e,i,Ss,o)}(n,t,e.path,i,u)}const _=u.getChanges();return function ba(n,t,e){const i=t.eventCache;if(i.isFullyInitialized()){const o=i.getNode().isLeafNode()||i.getNode().isEmpty(),u=Zn(n);(e.length>0||!n.eventCache.isFullyInitialized()||o&&!i.getNode().equals(u)||!i.getNode().getPriority().equals(u.getPriority()))&&e.push(fo(Zn(t)))}}(t,c,_),{viewCache:c,changes:_}}(n.processor_,o,t,e,i);return function Pa(n,t){(0,g.hu)(t.eventCache.getNode().isIndexed(n.filter.getIndex()),"Event snap not indexed"),(0,g.hu)(t.serverCache.getNode().isIndexed(n.filter.getIndex()),"Server snap not indexed")}(n.processor_,u.viewCache),(0,g.hu)(u.viewCache.serverCache.isFullyInitialized()||!o.serverCache.isFullyInitialized(),"Once a server snap is complete, it should never go back"),n.viewCache_=u.viewCache,Hi(n,u.changes,u.viewCache.eventCache.getNode(),null)}function Hi(n,t,e,i){return function va(n,t,e,i){const o=[],u=[];return t.forEach(c=>{"child_changed"===c.type&&n.index_.indexedValueChanged(c.oldSnap,c.snapshotNode)&&u.push(function ha(n,t){return{type:"child_moved",snapshotNode:t,childName:n}}(c.childName,c.snapshotNode))}),Wi(n,o,"child_removed",t,i,e),Wi(n,o,"child_added",t,i,e),Wi(n,o,"child_moved",u,i,e),Wi(n,o,"child_changed",t,i,e),Wi(n,o,"value",t,i,e),o}(n.eventGenerator_,t,e,i?[i]:n.eventRegistrations_)}let di,hi;class Do{constructor(){this.views=new Map}}function Gi(n,t,e,i){const o=t.source.queryId;if(null!==o){const u=n.views.get(o);return(0,g.hu)(null!=u,"SyncTree gave us an op for an invalid query."),Oo(u,t,e,i)}{let u=[];for(const c of n.views.values())u=u.concat(Oo(c,t,e,i));return u}}function xo(n,t,e,i,o){const c=n.views.get(t._queryIdentifier);if(!c){let h=Bi(e,o?i:null),_=!1;h?_=!0:i instanceof ee?(h=Es(e,i),_=!1):(h=ee.EMPTY_NODE,_=!1);const v=oi(new kt(h,_,!1),new kt(i,o,!1));return new xa(t,v)}return c}function Or(n){const t=[];for(const e of n.views.values())e.query._queryParams.loadsAllData()||t.push(e);return t}function hn(n,t){let e=null;for(const i of n.views.values())e=e||Ma(i,t);return e}function Lo(n,t){return t._queryParams.loadsAllData()?Dr(n):n.views.get(t._queryIdentifier)}function Mo(n,t){return null!=Lo(n,t)}function Jt(n){return null!=Dr(n)}function Dr(n){for(const t of n.views.values())if(t.query._queryParams.loadsAllData())return t;return null}let Ns=1;class Fo{constructor(t){this.listenProvider_=t,this.syncPointTree_=new Me(null),this.pendingWriteTree_=function Is(){return{visibleWrites:qt.empty(),allWrites:[],lastWriteId:-1}}(),this.tagToQueryMap=new Map,this.queryToTagMap=new Map}}function $n(n,t,e,i,o){return function ms(n,t,e,i,o){(0,g.hu)(i>n.lastWriteId,"Stacking an older write on top of newer ones"),void 0===o&&(o=!0),n.allWrites.push({path:t,snap:e,writeId:i,visible:o}),o&&(n.visibleWrites=ai(n.visibleWrites,t,e)),n.lastWriteId=i}(n.pendingWriteTree_,t,e,i,o),o?fi(n,new si({fromUser:!0,fromServer:!1,queryId:null,tagged:!1},t,e)):[]}function Sn(n,t,e=!1){const i=function Ca(n,t){for(let e=0;e<n.allWrites.length;e++){const i=n.allWrites[e];if(i.writeId===t)return i}return null}(n.pendingWriteTree_,t);if(function Eo(n,t){const e=n.allWrites.findIndex(h=>h.writeId===t);(0,g.hu)(e>=0,"removeWrite called with nonexistent writeId.");const i=n.allWrites[e];n.allWrites.splice(e,1);let o=i.visible,u=!1,c=n.allWrites.length-1;for(;o&&c>=0;){const h=n.allWrites[c];h.visible&&(c>=e&&Aa(h,i.path)?o=!1:dt(i.path,h.path)&&(u=!0)),c--}return!!o&&(u?(function wr(n){n.visibleWrites=ci(n.allWrites,To,z()),n.lastWriteId=n.allWrites.length>0?n.allWrites[n.allWrites.length-1].writeId:-1}(n),!0):(i.snap?n.visibleWrites=Cr(n.visibleWrites,i.path):he(i.children,_=>{n.visibleWrites=Cr(n.visibleWrites,Re(i.path,_))}),!0))}(n.pendingWriteTree_,t)){let u=new Me(null);return null!=i.snap?u=u.set(z(),!0):he(i.children,c=>{u=u.set(new W(c),!0)}),fi(n,new fs(i.path,u,e))}return[]}function Kn(n,t,e){return fi(n,new si({fromUser:!1,fromServer:!0,queryId:null,tagged:!1},t,e))}function $i(n,t,e,i,o=!1){const u=t._path,c=n.syncPointTree_.get(u);let h=[];if(c&&("default"===t._queryIdentifier||Mo(c,t))){const _=function Va(n,t,e,i){const o=t._queryIdentifier,u=[];let c=[];const h=Jt(n);if("default"===o)for(const[_,v]of n.views.entries())c=c.concat(Nr(v,e,i)),br(v)&&(n.views.delete(_),v.query._queryParams.loadsAllData()||u.push(v.query));else{const _=n.views.get(o);_&&(c=c.concat(Nr(_,e,i)),br(_)&&(n.views.delete(o),_.query._queryParams.loadsAllData()||u.push(_.query)))}return h&&!Jt(n)&&u.push(new(function Ua(){return(0,g.hu)(di,"Reference.ts has not been loaded"),di}())(t._repo,t._path)),{removed:u,events:c}}(c,t,e,i);(function Gn(n){return 0===n.views.size})(c)&&(n.syncPointTree_=n.syncPointTree_.remove(u));const v=_.removed;if(h=_.events,!o){const P=-1!==v.findIndex(D=>D._queryParams.loadsAllData()),b=n.syncPointTree_.findOnPath(u,(D,G)=>Jt(G));if(P&&!b){const D=n.syncPointTree_.subtree(u);if(!D.isEmpty()){const G=function Us(n){return n.fold((t,e,i)=>{if(e&&Jt(e))return[Dr(e)];{let o=[];return e&&(o=Or(e)),he(i,(u,c)=>{o=o.concat(c)}),o}})}(D);for(let q=0;q<G.length;++q){const Te=G[q],ft=Te.query,Pn=Vo(n,Te);n.listenProvider_.startListening(_i(ft),Ki(n,ft),Pn.hashFn,Pn.onComplete)}}}!b&&v.length>0&&!i&&(P?n.listenProvider_.stopListening(_i(t),null):v.forEach(D=>{const G=n.queryToTagMap.get(pi(D));n.listenProvider_.stopListening(_i(D),G)}))}!function Ws(n,t){for(let e=0;e<t.length;++e){const i=t[e];if(!i._queryParams.loadsAllData()){const o=pi(i),u=n.queryToTagMap.get(o);n.queryToTagMap.delete(o),n.tagToQueryMap.delete(u)}}}(n,v)}return h}function xs(n,t,e,i){const o=Fs(n,i);if(null!=o){const u=zi(o),c=u.path,h=u.queryId,_=lt(c,t);return ji(n,c,new si(vo(h),_,e))}return[]}function Ls(n,t,e,i=!1){const o=t._path;let u=null,c=!1;n.syncPointTree_.foreachOnPath(o,(D,G)=>{const q=lt(D,o);u=u||hn(G,q),c=c||Jt(G)});let _,h=n.syncPointTree_.get(o);h?(c=c||Jt(h),u=u||hn(h,z())):(h=new Do,n.syncPointTree_=n.syncPointTree_.set(o,h)),null!=u?_=!0:(_=!1,u=ee.EMPTY_NODE,n.syncPointTree_.subtree(o).foreachChild((G,q)=>{const Te=hn(q,z());Te&&(u=u.updateImmediateChild(G,Te))}));const v=Mo(h,t);if(!v&&!t._queryParams.loadsAllData()){const D=pi(t);(0,g.hu)(!n.queryToTagMap.has(D),"View does not exist, but we have a tag");const G=function Ga(){return Ns++}();n.queryToTagMap.set(D,G),n.tagToQueryMap.set(G,D)}let b=function Wa(n,t,e,i,o,u){const c=xo(n,t,i,o,u);return n.views.has(t._queryIdentifier)||n.views.set(t._queryIdentifier,c),function Fa(n,t){n.eventRegistrations_.push(t)}(c,e),function ks(n,t){const e=n.viewCache_.eventCache,i=[];return e.getNode().isLeafNode()||e.getNode().forEachChild(ke,(u,c)=>{i.push(ni(u,c))}),e.isFullyInitialized()&&i.push(fo(e.getNode())),Hi(n,i,e.getNode(),t)}(c,e)}(h,t,e,Sr(n.pendingWriteTree_,o),u,_);if(!v&&!c&&!i){const D=Lo(h,t);b=b.concat(function Bo(n,t,e){const i=t._path,o=Ki(n,t),u=Vo(n,e),c=n.listenProvider_.startListening(_i(t),o,u.hashFn,u.onComplete),h=n.syncPointTree_.subtree(i);if(o)(0,g.hu)(!Jt(h.value),"If we're adding a query, it shouldn't be shadowed");else{const _=h.fold((v,P,b)=>{if(!le(v)&&P&&Jt(P))return[Dr(P).query];{let D=[];return P&&(D=D.concat(Or(P).map(G=>G.query))),he(b,(G,q)=>{D=D.concat(q)}),D}});for(let v=0;v<_.length;++v){const P=_[v];n.listenProvider_.stopListening(_i(P),Ki(n,P))}}return c}(n,t,D))}return b}function xr(n,t,e){const o=n.pendingWriteTree_,u=n.syncPointTree_.findOnPath(t,(c,h)=>{const v=hn(h,lt(c,t));if(v)return v});return Vi(o,t,u,e,!0)}function fi(n,t){return Wo(t,n.syncPointTree_,null,Sr(n.pendingWriteTree_,z()))}function Wo(n,t,e,i){if(le(n.path))return Lr(n,t,e,i);{const o=t.get(z());null==e&&null!=o&&(e=hn(o,z()));let u=[];const c=Y(n.path),h=n.operationForChild(c),_=t.children.get(c);if(_&&h){const v=e?e.getImmediateChild(c):null,P=wo(i,c);u=u.concat(Wo(h,_,v,P))}return o&&(u=u.concat(Gi(o,n,i,e))),u}}function Lr(n,t,e,i){const o=t.get(z());null==e&&null!=o&&(e=hn(o,z()));let u=[];return t.children.inorderTraversal((c,h)=>{const _=e?e.getImmediateChild(c):null,v=wo(i,c),P=n.operationForChild(c);P&&(u=u.concat(Lr(P,h,_,v)))}),o&&(u=u.concat(Gi(o,n,i,e))),u}function Vo(n,t){const e=t.query,i=Ki(n,e);return{hashFn:()=>(function La(n){return n.viewCache_.serverCache.getNode()}(t)||ee.EMPTY_NODE).hash(),onComplete:o=>{if("ok"===o)return i?function Ha(n,t,e){const i=Fs(n,e);if(i){const o=zi(i),u=o.path,c=o.queryId,h=lt(u,t);return ji(n,u,new Tr(vo(c),h))}return[]}(n,e._path,i):function Ds(n,t){return fi(n,new Tr({fromUser:!1,fromServer:!0,queryId:null,tagged:!1},t))}(n,e._path);{const u=function Ge(n,t){let e="Unknown Error";"too_big"===n?e="The data requested exceeds the maximum size that can be accessed with a single request.":"permission_denied"===n?e="Client doesn't have permission to access the desired data.":"unavailable"===n&&(e="The service is unavailable");const i=new Error(n+" at "+t._path.toString()+": "+e);return i.code=n.toUpperCase(),i}(o,e);return $i(n,e,null,u)}}}}function Ki(n,t){const e=pi(t);return n.queryToTagMap.get(e)}function pi(n){return n._path.toString()+"$"+n._queryIdentifier}function Fs(n,t){return n.tagToQueryMap.get(t)}function zi(n){const t=n.indexOf("$");return(0,g.hu)(-1!==t&&t<n.length-1,"Bad queryKey."),{queryId:n.substr(t+1),path:new W(n.substr(0,t))}}function ji(n,t,e){const i=n.syncPointTree_.get(t);return(0,g.hu)(i,"Missing sync point for query tag that we're tracking"),Gi(i,e,Sr(n.pendingWriteTree_,t),null)}function _i(n){return n._queryParams.loadsAllData()&&!n._queryParams.isDefault()?new(function bs(){return(0,g.hu)(hi,"Reference.ts has not been loaded"),hi}())(n._repo,n._path):n}class Mr{constructor(t){this.node_=t}getImmediateChild(t){const e=this.node_.getImmediateChild(t);return new Mr(e)}node(){return this.node_}}class Fr{constructor(t,e){this.syncTree_=t,this.path_=e}getImmediateChild(t){const e=Re(this.path_,t);return new Fr(this.syncTree_,e)}node(){return xr(this.syncTree_,this.path_)}}const $a=function(n){return(n=n||{}).timestamp=n.timestamp||(new Date).getTime(),n},Vs=function(n,t,e){return n&&"object"==typeof n?((0,g.hu)(".sv"in n,"Unexpected leaf node or priority contents"),"string"==typeof n[".sv"]?Bs(n[".sv"],t,e):"object"==typeof n[".sv"]?Ka(n[".sv"],t):void(0,g.hu)(!1,"Unexpected server value: "+JSON.stringify(n,null,2))):n},Bs=function(n,t,e){if("timestamp"===n)return e.timestamp;(0,g.hu)(!1,"Unexpected server value: "+n)},Ka=function(n,t,e){n.hasOwnProperty("increment")||(0,g.hu)(!1,"Unexpected server value: "+JSON.stringify(n,null,2));const i=n.increment;"number"!=typeof i&&(0,g.hu)(!1,"Unexpected increment value: "+i);const o=t.node();if((0,g.hu)(null!==o&&typeof o<"u","Expected ChildrenNode.EMPTY_NODE for nulls"),!o.isLeafNode())return i;const c=o.getValue();return"number"!=typeof c?i:c+i},Zo=function(n,t,e,i){return Yi(t,new Fr(e,n),i)},Zs=function(n,t,e){return Yi(n,new Mr(t),e)};function Yi(n,t,e){const i=n.getPriority().val(),o=Vs(i,t.getImmediateChild(".priority"),e);let u;if(n.isLeafNode()){const c=n,h=Vs(c.getValue(),t,e);return h!==c.getValue()||o!==c.getPriority().val()?new yn(h,$e(o)):n}{const c=n;return u=c,o!==c.getPriority().val()&&(u=u.updatePriority(new yn(o))),c.forEachChild(ke,(h,_)=>{const v=Yi(_,t.getImmediateChild(h),e);v!==_&&(u=u.updateImmediateChild(h,v))}),u}}class Hs{constructor(t="",e=null,i={children:{},childCount:0}){this.name=t,this.parent=e,this.node=i}}function Ur(n,t){let e=t instanceof W?t:new W(t),i=n,o=Y(e);for(;null!==o;){const u=(0,g.DV)(i.node.children,o)||{children:{},childCount:0};i=new Hs(o,i,u),e=ve(e),o=Y(e)}return i}function wn(n){return n.node.value}function Gs(n,t){n.node.value=t,$s(n)}function Qi(n){return n.node.childCount>0}function Wr(n,t){he(n.node.children,(e,i)=>{t(new Hs(e,n,i))})}function Ho(n,t,e,i){e&&!i&&t(n),Wr(n,o=>{Ho(o,t,!0,i)}),e&&i&&t(n)}function qi(n){return new W(null===n.parent?n.name:qi(n.parent)+"/"+n.name)}function $s(n){null!==n.parent&&function Ya(n,t,e){const i=function za(n){return void 0===wn(n)&&!Qi(n)}(e),o=(0,g.r3)(n.node.children,t);i&&o?(delete n.node.children[t],n.node.childCount--,$s(n)):!i&&!o&&(n.node.children[t]=e.node,n.node.childCount++,$s(n))}(n.parent,n.name,n)}const Qa=/[\[\].#$\/\u0000-\u001F\u007F]/,Ks=/[\[\].#$\u0000-\u001F\u007F]/,zs=10485760,Vr=function(n){return"string"==typeof n&&0!==n.length&&!Qa.test(n)},Go=function(n){return"string"==typeof n&&0!==n.length&&!Ks.test(n)},Ji=function(n){return null===n||"string"==typeof n||"number"==typeof n&&!Ye(n)||n&&"object"==typeof n&&(0,g.r3)(n,".sv")},Kt=function(n,t,e,i){i&&void 0===t||Xi((0,g.gK)(n,"value"),t,e)},Xi=function(n,t,e){const i=e instanceof W?new sa(e,n):e;if(void 0===t)throw new Error(n+"contains undefined "+Ft(i));if("function"==typeof t)throw new Error(n+"contains a function "+Ft(i)+" with contents = "+t.toString());if(Ye(t))throw new Error(n+"contains "+t.toString()+" "+Ft(i));if("string"==typeof t&&t.length>zs/3&&(0,g.ug)(t)>zs)throw new Error(n+"contains a string greater than "+zs+" utf8 bytes "+Ft(i)+" ('"+t.substring(0,50)+"...')");if(t&&"object"==typeof t){let o=!1,u=!1;if(he(t,(c,h)=>{if(".value"===c)o=!0;else if(".priority"!==c&&".sv"!==c&&(u=!0,!Vr(c)))throw new Error(n+" contains an invalid key ("+c+") "+Ft(i)+'.  Keys must be non-empty strings and can\'t contain ".", "#", "$", "/", "[", or "]"');(function oa(n,t){n.parts_.length>0&&(n.byteLength_+=1),n.parts_.push(t),n.byteLength_+=(0,g.ug)(t),ao(n)})(i,c),Xi(n,h,i),function aa(n){const t=n.parts_.pop();n.byteLength_-=(0,g.ug)(t),n.parts_.length>0&&(n.byteLength_-=1)}(i)}),o&&u)throw new Error(n+' contains ".value" child '+Ft(i)+" in addition to actual children.")}},$o=function(n,t,e,i){if(i&&void 0===t)return;const o=(0,g.gK)(n,"values");if(!t||"object"!=typeof t||Array.isArray(t))throw new Error(o+" must be an object containing the children to replace.");const u=[];he(t,(c,h)=>{const _=new W(c);if(Xi(o,h,Re(e,_)),".priority"===gn(_)&&!Ji(h))throw new Error(o+"contains an invalid value for '"+_.toString()+"', which must be a valid Firebase priority (a string, finite number, server value, or null).");u.push(_)}),function(n,t){let e,i;for(e=0;e<t.length;e++){i=t[e];const u=Pi(i);for(let c=0;c<u.length;c++)if((".priority"!==u[c]||c!==u.length-1)&&!Vr(u[c]))throw new Error(n+"contains an invalid key ("+u[c]+") in path "+i.toString()+'. Keys must be non-empty strings and can\'t contain ".", "#", "$", "/", "[", or "]"')}t.sort(un);let o=null;for(e=0;e<t.length;e++){if(i=t[e],null!==o&&dt(o,i))throw new Error(n+"contains a path "+o.toString()+" that is ancestor of another path "+i.toString());o=i}}(o,u)},js=function(n,t,e){if(!e||void 0!==t){if(Ye(t))throw new Error((0,g.gK)(n,"priority")+"is "+t.toString()+", but must be a valid Firebase priority (a string, finite number, server value, or null).");if(!Ji(t))throw new Error((0,g.gK)(n,"priority")+"must be a valid Firebase priority (a string, finite number, server value, or null).")}},zn=function(n,t,e,i){if(!(i&&void 0===e||Vr(e)))throw new Error((0,g.gK)(n,t)+'was an invalid key = "'+e+'".  Firebase keys must be non-empty strings and can\'t contain ".", "#", "$", "/", "[", or "]").')},er=function(n,t,e,i){if(!(i&&void 0===e||Go(e)))throw new Error((0,g.gK)(n,t)+'was an invalid path = "'+e+'". Paths must be non-empty strings and can\'t contain ".", "#", "$", "[", or "]"')},Ys=function(n,t,e,i){e&&(e=e.replace(/^\/*\.info(\/|$)/,"/")),er(n,t,e,i)},Bt=function(n,t){if(".info"===Y(t))throw new Error(n+" failed = Can't modify data under /.info/")},Qs=function(n,t){const e=t.path.toString();if("string"!=typeof t.repoInfo.host||0===t.repoInfo.host.length||!Vr(t.repoInfo.namespace)&&"localhost"!==t.repoInfo.host.split(":")[0]||0!==e.length&&!function(n){return n&&(n=n.replace(/^\/*\.info(\/|$)/,"/")),Go(n)}(e))throw new Error((0,g.gK)(n,"url")+'must be a valid firebase URL and the path can\'t contain ".", "#", "$", "[", or "]".')};class Xa{constructor(){this.eventLists_=[],this.recursionDepth_=0}}function gi(n,t){let e=null;for(let i=0;i<t.length;i++){const o=t[i],u=o.getPath();null!==e&&!mn(u,e.path)&&(n.eventLists_.push(e),e=null),null===e&&(e={events:[],path:u}),e.events.push(o)}e&&n.eventLists_.push(e)}function Ko(n,t,e){gi(n,e),qs(n,i=>mn(i,t))}function Pt(n,t,e){gi(n,e),qs(n,i=>dt(i,t)||dt(t,i))}function qs(n,t){n.recursionDepth_++;let e=!0;for(let i=0;i<n.eventLists_.length;i++){const o=n.eventLists_[i];o&&(t(o.path)?(el(n.eventLists_[i]),n.eventLists_[i]=null):e=!1)}e&&(n.eventLists_=[]),n.recursionDepth_--}function el(n){for(let t=0;t<n.events.length;t++){const e=n.events[t];if(null!==e){n.events[t]=null;const i=e.getEventRunner();ge&&fe("event: "+e.toString()),gt(i)}}}const zo="repo_interrupt",tl=25;class nl{constructor(t,e,i,o){this.repoInfo_=t,this.forceRestClient_=e,this.authTokenProvider_=i,this.appCheckProvider_=o,this.dataUpdateCount=0,this.statsListener_=null,this.eventQueue_=new Xa,this.nextWriteId_=1,this.interceptServerDataCallback_=null,this.onDisconnect_=ii(),this.transactionQueueTree_=new Hs,this.persistentConnection_=null,this.key=this.repoInfo_.toURLString()}toString(){return(this.repoInfo_.secure?"https://":"http://")+this.repoInfo_.host}}function Js(n){const e=n.infoData_.getNode(new W(".info/serverTimeOffset")).val()||0;return(new Date).getTime()+e}function tr(n){return $a({timestamp:Js(n)})}function jo(n,t,e,i,o){n.dataUpdateCount++;const u=new W(t);e=n.interceptServerDataCallback_?n.interceptServerDataCallback_(t,e):e;let c=[];if(o)if(i){const _=(0,g.UI)(e,v=>$e(v));c=function Uo(n,t,e,i){const o=Fs(n,i);if(o){const u=zi(o),c=u.path,h=u.queryId,_=lt(c,t),v=Me.fromObject(e);return ji(n,c,new Tn(vo(h),_,v))}return[]}(n.serverSyncTree_,u,_,o)}else{const _=$e(e);c=xs(n.serverSyncTree_,u,_,o)}else if(i){const _=(0,g.UI)(e,v=>$e(v));c=function Os(n,t,e){const i=Me.fromObject(e);return fi(n,new Tn({fromUser:!1,fromServer:!0,queryId:null,tagged:!1},t,i))}(n.serverSyncTree_,u,_)}else{const _=$e(e);c=Kn(n.serverSyncTree_,u,_)}let h=u;c.length>0&&(h=kn(n,u)),Pt(n.eventQueue_,h,c)}function a(n,t){s(n,"connected",t),!1===t&&function L(n){Rn(n,"onDisconnectEvents");const t=tr(n),e=ii();Er(n.onDisconnect_,z(),(o,u)=>{const c=Zo(o,u,n.serverSyncTree_,t);ri(e,o,c)});let i=[];Er(e,z(),(o,u)=>{i=i.concat(Kn(n.serverSyncTree_,o,u));const c=rl(n,o);kn(n,c)}),n.onDisconnect_=ii(),Pt(n.eventQueue_,z(),i)}(n)}function s(n,t,e){const i=new W("/.info/"+t),o=$e(e);n.infoData_.updateSnapshot(i,o);const u=Kn(n.infoSyncTree_,i,o);Pt(n.eventQueue_,i,u)}function l(n){return n.nextWriteId_++}function f(n,t,e,i,o){Rn(n,"set",{path:t.toString(),value:e,priority:i});const u=tr(n),c=$e(e,i),h=xr(n.serverSyncTree_,t),_=Zs(c,h,u),v=l(n),P=$n(n.serverSyncTree_,t,_,v,!0);gi(n.eventQueue_,P),n.server_.put(t.toString(),c.val(!0),(D,G)=>{const q="ok"===D;q||we("set at "+t+" failed: "+D);const Te=Sn(n.serverSyncTree_,v,!q);Pt(n.eventQueue_,t,Te),fn(0,o,D,G)});const b=rl(n,t);kn(n,b),Pt(n.eventQueue_,b,[])}function K(n,t,e){n.server_.onDisconnectCancel(t.toString(),(i,o)=>{"ok"===i&&En(n.onDisconnect_,t),fn(0,e,i,o)})}function Q(n,t,e,i){const o=$e(e);n.server_.onDisconnectPut(t.toString(),o.val(!0),(u,c)=>{"ok"===u&&ri(n.onDisconnect_,t,o),fn(0,i,u,c)})}function en(n,t,e){let i;i=".info"===Y(t._path)?$i(n.infoSyncTree_,t,e):$i(n.serverSyncTree_,t,e),Ko(n.eventQueue_,t._path,i)}function nr(n){n.persistentConnection_&&n.persistentConnection_.interrupt(zo)}function Rn(n,...t){let e="";n.persistentConnection_&&(e=n.persistentConnection_.id+":"),fe(e,...t)}function fn(n,t,e,i){t&&gt(()=>{if("ok"===e)t(null);else{const o=(e||"error").toUpperCase();let u=o;i&&(u+=": "+i);const c=new Error(u);c.code=o,t(c)}})}function ir(n,t,e){return xr(n.serverSyncTree_,t,e)||ee.EMPTY_NODE}function rr(n,t=n.transactionQueueTree_){if(t||ta(n,t),wn(t)){const e=Br(n,t);(0,g.hu)(e.length>0,"Sending zero length transaction queue"),e.every(o=>0===o.status)&&function qo(n,t,e){const i=e.map(v=>v.currentWriteId),o=ir(n,t,i);let u=o;const c=o.hash();for(let v=0;v<e.length;v++){const P=e[v];(0,g.hu)(0===P.status,"tryToSendTransactionQueue_: items in queue should all be run."),P.status=1,P.retryCount++;const b=lt(t,P.path);u=u.updateChild(b,P.currentOutputSnapshotRaw)}const h=u.val(!0),_=t;n.server_.put(_.toString(),h,v=>{Rn(n,"transaction put response",{path:_.toString(),status:v});let P=[];if("ok"===v){const b=[];for(let D=0;D<e.length;D++)e[D].status=2,P=P.concat(Sn(n.serverSyncTree_,e[D].currentWriteId)),e[D].onComplete&&b.push(()=>e[D].onComplete(null,!0,e[D].currentOutputSnapshotResolved)),e[D].unwatcher();ta(n,Ur(n.transactionQueueTree_,t)),rr(n,n.transactionQueueTree_),Pt(n.eventQueue_,t,P);for(let D=0;D<b.length;D++)gt(b[D])}else{if("datastale"===v)for(let b=0;b<e.length;b++)e[b].status=3===e[b].status?4:0;else{we("transaction at "+_.toString()+" failed: "+v);for(let b=0;b<e.length;b++)e[b].status=4,e[b].abortReason=v}kn(n,t)}},c)}(n,qi(t),e)}else Qi(t)&&Wr(t,e=>{rr(n,e)})}function kn(n,t){const e=Xo(n,t),i=qi(e);return function Jo(n,t,e){if(0===t.length)return;const i=[];let o=[];const c=t.filter(h=>0===h.status).map(h=>h.currentWriteId);for(let h=0;h<t.length;h++){const _=t[h],v=lt(e,_.path);let b,P=!1;if((0,g.hu)(null!==v,"rerunTransactionsUnderNode_: relativePath should not be null."),4===_.status)P=!0,b=_.abortReason,o=o.concat(Sn(n.serverSyncTree_,_.currentWriteId,!0));else if(0===_.status)if(_.retryCount>=tl)P=!0,b="maxretry",o=o.concat(Sn(n.serverSyncTree_,_.currentWriteId,!0));else{const D=ir(n,_.path,c);_.currentInputSnapshot=D;const G=t[h].update(D.val());if(void 0!==G){Xi("transaction failed: Data returned ",G,_.path);let q=$e(G);"object"==typeof G&&null!=G&&(0,g.r3)(G,".priority")||(q=q.updatePriority(D.getPriority()));const ft=_.currentWriteId,Pn=tr(n),jn=Zs(q,D,Pn);_.currentOutputSnapshotRaw=q,_.currentOutputSnapshotResolved=jn,_.currentWriteId=l(n),c.splice(c.indexOf(ft),1),o=o.concat($n(n.serverSyncTree_,_.path,jn,_.currentWriteId,_.applyLocally)),o=o.concat(Sn(n.serverSyncTree_,ft,!0))}else P=!0,b="nodata",o=o.concat(Sn(n.serverSyncTree_,_.currentWriteId,!0))}Pt(n.eventQueue_,e,o),o=[],P&&(t[h].status=2,setTimeout(t[h].unwatcher,Math.floor(0)),t[h].onComplete&&i.push("nodata"===b?()=>t[h].onComplete(null,!1,t[h].currentInputSnapshot):()=>t[h].onComplete(new Error(b),!1,null)))}ta(n,n.transactionQueueTree_);for(let h=0;h<i.length;h++)gt(i[h]);rr(n,n.transactionQueueTree_)}(n,Br(n,e),i),i}function Xo(n,t){let e,i=n.transactionQueueTree_;for(e=Y(t);null!==e&&void 0===wn(i);)i=Ur(i,e),e=Y(t=ve(t));return i}function Br(n,t){const e=[];return ea(n,t,e),e.sort((i,o)=>i.order-o.order),e}function ea(n,t,e){const i=wn(t);if(i)for(let o=0;o<i.length;o++)e.push(i[o]);Wr(t,o=>{ea(n,o,e)})}function ta(n,t){const e=wn(t);if(e){let i=0;for(let o=0;o<e.length;o++)2!==e[o].status&&(e[i]=e[o],i++);e.length=i,Gs(t,e.length>0?e:void 0)}Wr(t,i=>{ta(n,i)})}function rl(n,t){const e=qi(Xo(n,t)),i=Ur(n.transactionQueueTree_,t);return function ja(n,t,e){let i=e?n:n.parent;for(;null!==i;){if(t(i))return!0;i=i.parent}}(i,o=>{sl(n,o)}),sl(n,i),Ho(i,o=>{sl(n,o)}),e}function sl(n,t){const e=wn(t);if(e){const i=[];let o=[],u=-1;for(let c=0;c<e.length;c++)3===e[c].status||(1===e[c].status?((0,g.hu)(u===c-1,"All SENT items should be at beginning of queue."),u=c,e[c].status=3,e[c].abortReason="set"):((0,g.hu)(0===e[c].status,"Unexpected transaction status in abort"),e[c].unwatcher(),o=o.concat(Sn(n.serverSyncTree_,e[c].currentWriteId,!0)),e[c].onComplete&&i.push(e[c].onComplete.bind(null,new Error("set"),!1,null))));-1===u?Gs(t,void 0):e.length=u+1,Pt(n.eventQueue_,qi(t),o);for(let c=0;c<i.length;c++)gt(i[c])}}const ol=function(n,t){const e=jl(n),i=e.namespace;return"firebase.com"===e.domain&&Ke(e.host+" is no longer supported. Please use <YOUR FIREBASE>.firebaseio.com instead"),(!i||"undefined"===i)&&"localhost"!==e.domain&&Ke("Cannot parse Firebase url. Please use https://<YOUR FIREBASE>.firebaseio.com"),e.secure||typeof window<"u"&&window.location&&window.location.protocol&&-1!==window.location.protocol.indexOf("https:")&&we("Insecure Firebase access from a secure page. Please use https in calls to new Firebase()."),{repoInfo:new y(e.host,e.secure,i,"ws"===e.scheme||"wss"===e.scheme,t,"",i!==e.subdomain),path:new W(e.pathString)}},jl=function(n){let t="",e="",i="",o="",u="",c=!0,h="https",_=443;if("string"==typeof n){let v=n.indexOf("//");v>=0&&(h=n.substring(0,v-1),n=n.substring(v+2));let P=n.indexOf("/");-1===P&&(P=n.length);let b=n.indexOf("?");-1===b&&(b=n.length),t=n.substring(0,Math.min(P,b)),P<b&&(o=function Kl(n){let t="";const e=n.split("/");for(let i=0;i<e.length;i++)if(e[i].length>0){let o=e[i];try{o=decodeURIComponent(o.replace(/\+/g," "))}catch{}t+="/"+o}return t}(n.substring(P,b)));const D=function zl(n){const t={};"?"===n.charAt(0)&&(n=n.substring(1));for(const e of n.split("&")){if(0===e.length)continue;const i=e.split("=");2===i.length?t[decodeURIComponent(i[0])]=decodeURIComponent(i[1]):we(`Invalid query segment '${e}' in query '${n}'`)}return t}(n.substring(Math.min(n.length,b)));v=t.indexOf(":"),v>=0?(c="https"===h||"wss"===h,_=parseInt(t.substring(v+1),10)):v=t.length;const G=t.slice(0,v);if("localhost"===G.toLowerCase())e="localhost";else if(G.split(".").length<=2)e=G;else{const q=t.indexOf(".");i=t.substring(0,q).toLowerCase(),e=t.substring(q+1),u=i}"ns"in D&&(u=D.ns)}return{host:t,port:_,domain:e,subdomain:i,secure:c,scheme:h,pathString:o,namespace:u}},hl="-0123456789ABCDEFGHIJKLMNOPQRSTUVWXYZ_abcdefghijklmnopqrstuvwxyz",Yl=function(){let n=0;const t=[];return function(e){const i=e===n;let o;n=e;const u=new Array(8);for(o=7;o>=0;o--)u[o]=hl.charAt(e%64),e=Math.floor(e/64);(0,g.hu)(0===e,"Cannot push at time == 0");let c=u.join("");if(i){for(o=11;o>=0&&63===t[o];o--)t[o]=0;t[o]++}else for(o=0;o<12;o++)t[o]=Math.floor(64*Math.random());for(o=0;o<12;o++)c+=hl.charAt(t[o]);return(0,g.hu)(20===c.length,"nextPushId: Length should be 20."),c}}();class fl{constructor(t,e,i,o){this.eventType=t,this.eventRegistration=e,this.snapshot=i,this.prevName=o}getPath(){const t=this.snapshot.ref;return"value"===this.eventType?t._path:t.parent._path}getEventType(){return this.eventType}getEventRunner(){return this.eventRegistration.getEventRunner(this)}toString(){return this.getPath().toString()+":"+this.eventType+":"+(0,g.Wl)(this.snapshot.exportVal())}}class pl{constructor(t,e,i){this.eventRegistration=t,this.error=e,this.path=i}getPath(){return this.path}getEventType(){return"cancel"}getEventRunner(){return this.eventRegistration.getEventRunner(this)}toString(){return this.path.toString()+":cancel"}}class al{constructor(t,e){this.snapshotCallback=t,this.cancelCallback=e}onValue(t,e){this.snapshotCallback.call(null,t,e)}onCancel(t){return(0,g.hu)(this.hasCancelCallback,"Raising a cancel event on a listener with no cancel callback"),this.cancelCallback.call(null,t)}get hasCancelCallback(){return!!this.cancelCallback}matches(t){return this.snapshotCallback===t.snapshotCallback||void 0!==this.snapshotCallback.userCallback&&this.snapshotCallback.userCallback===t.snapshotCallback.userCallback&&this.snapshotCallback.context===t.snapshotCallback.context}}class _l{constructor(t,e){this._repo=t,this._path=e}cancel(){const t=new g.BH;return K(this._repo,this._path,t.wrapCallback(()=>{})),t.promise}remove(){Bt("OnDisconnect.remove",this._path);const t=new g.BH;return Q(this._repo,this._path,null,t.wrapCallback(()=>{})),t.promise}set(t){Bt("OnDisconnect.set",this._path),Kt("OnDisconnect.set",t,this._path,!1);const e=new g.BH;return Q(this._repo,this._path,t,e.wrapCallback(()=>{})),e.promise}setWithPriority(t,e){Bt("OnDisconnect.setWithPriority",this._path),Kt("OnDisconnect.setWithPriority",t,this._path,!1),js("OnDisconnect.setWithPriority",e,!1);const i=new g.BH;return function re(n,t,e,i,o){const u=$e(e,i);n.server_.onDisconnectPut(t.toString(),u.val(!0),(c,h)=>{"ok"===c&&ri(n.onDisconnect_,t,u),fn(0,o,c,h)})}(this._repo,this._path,t,e,i.wrapCallback(()=>{})),i.promise}update(t){Bt("OnDisconnect.update",this._path),$o("OnDisconnect.update",t,this._path,!1);const e=new g.BH;return function We(n,t,e,i){if((0,g.xb)(e))return fe("onDisconnect().update() called with empty data.  Don't do anything."),void fn(0,i,"ok",void 0);n.server_.onDisconnectMerge(t.toString(),e,(o,u)=>{"ok"===o&&he(e,(c,h)=>{const _=$e(h);ri(n.onDisconnect_,Re(t,c),_)}),fn(0,i,o,u)})}(this._repo,this._path,t,e.wrapCallback(()=>{})),e.promise}}class Zt{constructor(t,e,i,o){this._repo=t,this._path=e,this._queryParams=i,this._orderByCalled=o}get key(){return le(this._path)?null:gn(this._path)}get ref(){return new tn(this._repo,this._path)}get _queryIdentifier(){const t=po(this._queryParams),e=Ee(t);return"{}"===e?"default":e}get _queryObject(){return po(this._queryParams)}isEqual(t){if(!((t=(0,g.m9)(t))instanceof Zt))return!1;const e=this._repo===t._repo,i=mn(this._path,t._path);return e&&i&&this._queryIdentifier===t._queryIdentifier}toJSON(){return this.toString()}toString(){return this._repo.toString()+function nt(n){let t="";for(let e=n.pieceNum_;e<n.pieces_.length;e++)""!==n.pieces_[e]&&(t+="/"+encodeURIComponent(String(n.pieces_[e])));return t||"/"}(this._path)}}function na(n,t){if(!0===n._orderByCalled)throw new Error(t+": You can't combine multiple orderBy calls.")}function mi(n){let t=null,e=null;if(n.hasStart()&&(t=n.getIndexStartValue()),n.hasEnd()&&(e=n.getIndexEndValue()),n.getIndex()===Wt){const i="Query: When ordering by key, you may only pass one argument to startAt(), endAt(), or equalTo().",o="Query: When ordering by key, the argument passed to startAt(), startAfter(), endAt(), endBefore(), or equalTo() must be a string.";if(n.hasStart()){if(n.getIndexStartName()!==ot)throw new Error(i);if("string"!=typeof t)throw new Error(o)}if(n.hasEnd()){if(n.getIndexEndName()!==Z)throw new Error(i);if("string"!=typeof e)throw new Error(o)}}else if(n.getIndex()===ke){if(null!=t&&!Ji(t)||null!=e&&!Ji(e))throw new Error("Query: When ordering by priority, the first argument passed to startAt(), startAfter() endAt(), endBefore(), or equalTo() must be a valid priority value (null, a number, or a string).")}else if((0,g.hu)(n.getIndex()instanceof xi||n.getIndex()===Li,"unknown index type."),null!=t&&"object"==typeof t||null!=e&&"object"==typeof e)throw new Error("Query: First argument passed to startAt(), startAfter(), endAt(), endBefore(), or equalTo() cannot be an object.")}function ia(n){if(n.hasStart()&&n.hasEnd()&&n.hasLimit()&&!n.hasAnchoredLimit())throw new Error("Query: Can't combine startAt(), startAfter(), endAt(), endBefore(), and limit(). Use limitToFirst() or limitToLast() instead.")}class tn extends Zt{constructor(t,e){super(t,e,new mr,!1)}get parent(){const t=oo(this._path);return null===t?null:new tn(this._repo,t)}get root(){let t=this;for(;null!==t.parent;)t=t.parent;return t}}class sr{constructor(t,e,i){this._node=t,this.ref=e,this._index=i}get priority(){return this._node.getPriority().val()}get key(){return this.ref.key}get size(){return this._node.numChildren()}child(t){const e=new W(t),i=or(this.ref,t);return new sr(this._node.getChild(e),i,ke)}exists(){return!this._node.isEmpty()}exportVal(){return this._node.val(!0)}forEach(t){return!this._node.isLeafNode()&&!!this._node.forEachChild(this._index,(i,o)=>t(new sr(o,or(this.ref,i),ke)))}hasChild(t){const e=new W(t);return!this._node.getChild(e).isEmpty()}hasChildren(){return!this._node.isLeafNode()&&!this._node.isEmpty()}toJSON(){return this.exportVal()}val(){return this._node.val()}}function gl(n,t){return(n=(0,g.m9)(n))._checkNotDeleted("ref"),void 0!==t?or(n._root,t):n._root}function ml(n,t){(n=(0,g.m9)(n))._checkNotDeleted("refFromURL");const e=ol(t,n._repo.repoInfo_.nodeAdmin);Qs("refFromURL",e);const i=e.repoInfo;return!n._repo.repoInfo_.isCustomHost()&&i.host!==n._repo.repoInfo_.host&&Ke("refFromURL: Host name does not match the current database: (found "+i.host+" but expected "+n._repo.repoInfo_.host+")"),gl(n,e.path.toString())}function or(n,t){return null===Y((n=(0,g.m9)(n))._path)?Ys("child","path",t,!1):er("child","path",t,!1),new tn(n._repo,Re(n._path,t))}function ll(n,t){n=(0,g.m9)(n),Bt("set",n._path),Kt("set",t,n._path,!1);const e=new g.BH;return f(n._repo,n._path,t,null,e.wrapCallback(()=>{})),e.promise}function eu(n,t){$o("update",t,n._path,!1);const e=new g.BH;return function S(n,t,e,i){Rn(n,"update",{path:t.toString(),value:e});let o=!0;const u=tr(n),c={};if(he(e,(h,_)=>{o=!1,c[h]=Zo(Re(t,h),$e(_),n.serverSyncTree_,u)}),o)fe("update() called with empty data.  Don't do anything."),fn(0,i,"ok",void 0);else{const h=l(n),_=function Za(n,t,e,i){!function Ta(n,t,e,i){(0,g.hu)(i>n.lastWriteId,"Stacking an older merge on top of newer ones"),n.allWrites.push({path:t,children:e,writeId:i,visible:!0}),n.visibleWrites=Io(n.visibleWrites,t,e),n.lastWriteId=i}(n.pendingWriteTree_,t,e,i);const o=Me.fromObject(e);return fi(n,new Tn({fromUser:!0,fromServer:!1,queryId:null,tagged:!1},t,o))}(n.serverSyncTree_,t,c,h);gi(n.eventQueue_,_),n.server_.merge(t.toString(),e,(v,P)=>{const b="ok"===v;b||we("update at "+t+" failed: "+v);const D=Sn(n.serverSyncTree_,h,!b),G=D.length>0?kn(n,t):t;Pt(n.eventQueue_,G,D),fn(0,i,v,P)}),he(e,v=>{const P=rl(n,Re(t,v));kn(n,P)}),Pt(n.eventQueue_,t,[])}}(n._repo,n._path,t,e.wrapCallback(()=>{})),e.promise}function tu(n){n=(0,g.m9)(n);const t=new al(()=>{}),e=new Xs(t);return function d(n,t,e){const i=function Ms(n,t){const e=t._path;let i=null;n.syncPointTree_.foreachOnPath(e,(v,P)=>{const b=lt(v,e);i=i||hn(P,b)});let o=n.syncPointTree_.get(e);o?i=i||hn(o,z()):(o=new Do,n.syncPointTree_=n.syncPointTree_.set(e,o));const u=null!=i,c=u?new kt(i,!0,!1):null;return function Rs(n){return Zn(n.viewCache_)}(xo(o,t,Sr(n.pendingWriteTree_,t._path),u?c.getNode():ee.EMPTY_NODE,u))}(n.serverSyncTree_,t);return null!=i?Promise.resolve(i):n.server_.get(t).then(o=>{const u=$e(o).withIndex(t._queryParams.getIndex());let c;if(Ls(n.serverSyncTree_,t,e,!0),t._queryParams.loadsAllData())c=Kn(n.serverSyncTree_,t._path,u);else{const h=Ki(n.serverSyncTree_,t);c=xs(n.serverSyncTree_,t._path,u,h)}return Pt(n.eventQueue_,t._path,c),$i(n.serverSyncTree_,t,e,null,!0),u},o=>(Rn(n,"get for query "+(0,g.Wl)(t)+" failed: "+o),Promise.reject(new Error(o))))}(n._repo,n,e).then(i=>new sr(i,new tn(n._repo,n._path),n._queryParams.getIndex()))}class Xs{constructor(t){this.callbackContext=t}respondsTo(t){return"value"===t}createEvent(t,e){const i=e._queryParams.getIndex();return new fl("value",this,new sr(t.snapshotNode,new tn(e._repo,e._path),i))}getEventRunner(t){return"cancel"===t.getEventType()?()=>this.callbackContext.onCancel(t.error):()=>this.callbackContext.onValue(t.snapshot,null)}createCancelEvent(t,e){return this.callbackContext.hasCancelCallback?new pl(this,t,e):null}matches(t){return t instanceof Xs&&(!t.callbackContext||!this.callbackContext||t.callbackContext.matches(this.callbackContext))}hasAnyCallback(){return null!==this.callbackContext}}class ra{constructor(t,e){this.eventType=t,this.callbackContext=e}respondsTo(t){let e="children_added"===t?"child_added":t;return e="children_removed"===e?"child_removed":e,this.eventType===e}createCancelEvent(t,e){return this.callbackContext.hasCancelCallback?new pl(this,t,e):null}createEvent(t,e){(0,g.hu)(null!=t.childName,"Child events should have a childName.");const i=or(new tn(e._repo,e._path),t.childName),o=e._queryParams.getIndex();return new fl(t.type,this,new sr(t.snapshotNode,i,o),t.prevName)}getEventRunner(t){return"cancel"===t.getEventType()?()=>this.callbackContext.onCancel(t.error):()=>this.callbackContext.onValue(t.snapshot,t.prevName)}matches(t){return t instanceof ra&&this.eventType===t.eventType&&(!this.callbackContext||!t.callbackContext||this.callbackContext.matches(t.callbackContext))}hasAnyCallback(){return!!this.callbackContext}}function eo(n,t,e,i,o){let u;if("object"==typeof i&&(u=void 0,o=i),"function"==typeof i&&(u=i),o&&o.onlyOnce){const _=e,v=(P,b)=>{en(n._repo,n,h),_(P,b)};v.userCallback=e.userCallback,v.context=e.context,e=v}const c=new al(e,u||void 0),h="value"===t?new Xs(c):new ra(t,c);return function Xt(n,t,e){let i;i=".info"===Y(t._path)?Ls(n.infoSyncTree_,t,e):Ls(n.serverSyncTree_,t,e),Ko(n.eventQueue_,t._path,i)}(n._repo,n,h),()=>en(n._repo,n,h)}function ul(n,t,e,i){return eo(n,"value",t,e,i)}function vl(n,t,e,i){return eo(n,"child_added",t,e,i)}function yl(n,t,e,i){return eo(n,"child_changed",t,e,i)}function Il(n,t,e,i){return eo(n,"child_moved",t,e,i)}function El(n,t,e,i){return eo(n,"child_removed",t,e,i)}function Tl(n,t,e){let i=null;const o=e?new al(e):null;"value"===t?i=new Xs(o):t&&(i=new ra(t,o)),en(n._repo,n,i)}class pn{}class Cl extends pn{constructor(t,e){super(),this._value=t,this._key=e}_apply(t){Kt("endAt",this._value,t._path,!0);const e=cs(t._queryParams,this._value,this._key);if(ia(e),mi(e),t._queryParams.hasEnd())throw new Error("endAt: Starting point was already set (by another call to endAt, endBefore or equalTo).");return new Zt(t._repo,t._path,e,t._orderByCalled)}}class iu extends pn{constructor(t,e){super(),this._value=t,this._key=e}_apply(t){Kt("endBefore",this._value,t._path,!1);const e=function ds(n,t,e){let i;return i=cs(n,t,n.index_===Wt||e?e:ot),i.endBeforeSet_=!0,i}(t._queryParams,this._value,this._key);if(ia(e),mi(e),t._queryParams.hasEnd())throw new Error("endBefore: Starting point was already set (by another call to endAt, endBefore or equalTo).");return new Zt(t._repo,t._path,e,t._orderByCalled)}}class Al extends pn{constructor(t,e){super(),this._value=t,this._key=e}_apply(t){Kt("startAt",this._value,t._path,!0);const e=ls(t._queryParams,this._value,this._key);if(ia(e),mi(e),t._queryParams.hasStart())throw new Error("startAt: Starting point was already set (by another call to startAt, startBefore or equalTo).");return new Zt(t._repo,t._path,e,t._orderByCalled)}}class ou extends pn{constructor(t,e){super(),this._value=t,this._key=e}_apply(t){Kt("startAfter",this._value,t._path,!1);const e=function us(n,t,e){let i;return i=ls(n,t,n.index_===Wt||e?e:Z),i.startAfterSet_=!0,i}(t._queryParams,this._value,this._key);if(ia(e),mi(e),t._queryParams.hasStart())throw new Error("startAfter: Starting point was already set (by another call to startAt, startAfter, or equalTo).");return new Zt(t._repo,t._path,e,t._orderByCalled)}}class lu extends pn{constructor(t){super(),this._limit=t}_apply(t){if(t._queryParams.hasLimit())throw new Error("limitToFirst: Limit was already set (by another call to limitToFirst or limitToLast).");return new Zt(t._repo,t._path,function fa(n,t){const e=n.copy();return e.limitSet_=!0,e.limit_=t,e.viewFrom_="l",e}(t._queryParams,this._limit),t._orderByCalled)}}class cu extends pn{constructor(t){super(),this._limit=t}_apply(t){if(t._queryParams.hasLimit())throw new Error("limitToLast: Limit was already set (by another call to limitToFirst or limitToLast).");return new Zt(t._repo,t._path,function as(n,t){const e=n.copy();return e.limitSet_=!0,e.limit_=t,e.viewFrom_="r",e}(t._queryParams,this._limit),t._orderByCalled)}}class hu extends pn{constructor(t){super(),this._path=t}_apply(t){na(t,"orderByChild");const e=new W(this._path);if(le(e))throw new Error("orderByChild: cannot pass in empty path. Use orderByValue() instead.");const i=new xi(e),o=vr(t._queryParams,i);return mi(o),new Zt(t._repo,t._path,o,!0)}}class pu extends pn{_apply(t){na(t,"orderByKey");const e=vr(t._queryParams,Wt);return mi(e),new Zt(t._repo,t._path,e,!0)}}class gu extends pn{_apply(t){na(t,"orderByPriority");const e=vr(t._queryParams,ke);return mi(e),new Zt(t._repo,t._path,e,!0)}}class vu extends pn{_apply(t){na(t,"orderByValue");const e=vr(t._queryParams,Li);return mi(e),new Zt(t._repo,t._path,e,!0)}}class Iu extends pn{constructor(t,e){super(),this._value=t,this._key=e}_apply(t){if(Kt("equalTo",this._value,t._path,!1),t._queryParams.hasStart())throw new Error("equalTo: Starting point was already set (by another call to startAt/startAfter or equalTo).");if(t._queryParams.hasEnd())throw new Error("equalTo: Ending point was already set (by another call to endAt/endBefore or equalTo).");return new Cl(this._value,this._key)._apply(new Al(this._value,this._key)._apply(t))}}function _n(n,...t){let e=(0,g.m9)(n);for(const i of t)e=i._apply(e);return e}(function Ps(n){(0,g.hu)(!di,"__referenceConstructor has already been defined"),di=n})(tn),function Ba(n){(0,g.hu)(!hi,"__referenceConstructor has already been defined"),hi=n}(tn);const Tu="FIREBASE_DATABASE_EMULATOR_HOST",cl={};let Sl=!1;function wl(n,t,e,i,o){let u=i||n.options.databaseURL;void 0===u&&(n.options.projectId||Ke("Can't determine Firebase Database URL. Be sure to include  a Project ID when calling firebase.initializeApp()."),fe("Using default host for project ",n.options.projectId),u=`${n.options.projectId}-default-rtdb.firebaseio.com`);let _,v,c=ol(u,o),h=c.repoInfo;typeof process<"u"&&process.env&&(v=process.env[Tu]),v?(_=!0,u=`http://${v}?ns=${h.namespace}`,c=ol(u,o),h=c.repoInfo):_=!c.repoInfo.secure;const P=o&&_?new at(at.OWNER):new On(n.name,n.options,t);Qs("Invalid Firebase Database URL",c),le(c.path)||Ke("Database URL must point to the root of a Firebase Database (not including a child path).");const b=function Su(n,t,e,i){let o=cl[t.name];o||(o={},cl[t.name]=o);let u=o[n.toURLString()];return u&&Ke("Database initialized multiple times. Please make sure the format of the database URL matches with each database() call."),u=new nl(n,Sl,e,i),o[n.toURLString()]=u,u}(h,n,P,new jt(n.name,e));return new Ru(b,n)}class Ru{constructor(t,e){this._repoInternal=t,this.app=e,this.type="database",this._instanceStarted=!1}get _repo(){return this._instanceStarted||(function il(n,t,e){if(n.stats_=Le(n.repoInfo_),n.forceRestClient_||ze())n.server_=new Ir(n.repoInfo_,(i,o,u,c)=>{jo(n,i,o,u,c)},n.authTokenProvider_,n.appCheckProvider_),setTimeout(()=>a(n,!0),0);else{if(typeof e<"u"&&null!==e){if("object"!=typeof e)throw new Error("Only objects are supported for option databaseAuthVariableOverride");try{(0,g.Wl)(e)}catch(i){throw new Error("Invalid authOverride provided: "+i)}}n.persistentConnection_=new cn(n.repoInfo_,t,(i,o,u,c)=>{jo(n,i,o,u,c)},i=>{a(n,i)},i=>{!function r(n,t){he(t,(e,i)=>{s(n,e,i)})}(n,i)},n.authTokenProvider_,n.appCheckProvider_,e),n.server_=n.persistentConnection_}n.authTokenProvider_.addTokenChangeListener(i=>{n.server_.refreshAuthToken(i)}),n.appCheckProvider_.addTokenChangeListener(i=>{n.server_.refreshAppCheckToken(i.token)}),n.statsReporter_=function vt(n,t){const e=n.toString();return me[e]||(me[e]=t()),me[e]}(n.repoInfo_,()=>new dl(n.stats_,n.server_)),n.infoData_=new _o,n.infoSyncTree_=new Fo({startListening:(i,o,u,c)=>{let h=[];const _=n.infoData_.getNode(i._path);return _.isEmpty()||(h=Kn(n.infoSyncTree_,i._path,_),setTimeout(()=>{c("ok")},0)),h},stopListening:()=>{}}),s(n,"connected",!1),n.serverSyncTree_=new Fo({startListening:(i,o,u,c)=>(n.server_.listen(i,u,o,(h,_)=>{const v=c(h,_);Pt(n.eventQueue_,i._path,v)}),[]),stopListening:(i,o)=>{n.server_.unlisten(i,o)}})}(this._repoInternal,this.app.options.appId,this.app.options.databaseAuthVariableOverride),this._instanceStarted=!0),this._repoInternal}get _root(){return this._rootInternal||(this._rootInternal=new tn(this._repo,z())),this._rootInternal}_delete(){return null!==this._rootInternal&&(function Au(n,t){const e=cl[t];(!e||e[n.key]!==n)&&Ke(`Database ${t}(${n.repoInfo_}) has already been deleted.`),nr(n),delete e[n.key]}(this._repo,this.app.name),this._repoInternal=null,this._rootInternal=null),Promise.resolve()}_checkNotDeleted(t){null===this._rootInternal&&Ke("Cannot call "+t+" on a deleted database.")}}function Rl(){Ln.IS_TRANSPORT_INITIALIZED&&we("Transport has already been initialized. Please call this function before calling ref or setting up a listener")}function ku(){Rl(),$t.forceDisallow()}function Pu(){Rl(),Nt.forceDisallow(),$t.forceAllow()}function Ou(n,t){_t(n,t)}const xu={".sv":"timestamp"};class Fu{constructor(t,e){this.committed=t,this.snapshot=e}toJSON(){return{committed:this.committed,snapshot:this.snapshot.toJSON()}}}cn.prototype.simpleListen=function(n,t){this.sendRequest("q",{p:n},t)},cn.prototype.echo=function(n,t){this.sendRequest("echo",{d:n},t)},function Du(n){Oe(Ze.SDK_VERSION),(0,Ze._registerComponent)(new M.wA("database",(t,{instanceIdentifier:e})=>wl(t.getProvider("app").getImmediate(),t.getProvider("auth-internal"),t.getProvider("app-check-internal"),e),"PUBLIC").setMultipleInstances(!0)),(0,Ze.registerVersion)(Gt,"0.14.4",n),(0,Ze.registerVersion)(Gt,"0.14.4","esm2017")}();const Bu=new se.Yd("@firebase/database-compat"),Pl=function(n){Bu.warn("FIREBASE WARNING: "+n)};class Gu{constructor(t){this._delegate=t}cancel(t){(0,g.Dv)("OnDisconnect.cancel",0,1,arguments.length),(0,g.Wj)("OnDisconnect.cancel","onComplete",t,!0);const e=this._delegate.cancel();return t&&e.then(()=>t(null),i=>t(i)),e}remove(t){(0,g.Dv)("OnDisconnect.remove",0,1,arguments.length),(0,g.Wj)("OnDisconnect.remove","onComplete",t,!0);const e=this._delegate.remove();return t&&e.then(()=>t(null),i=>t(i)),e}set(t,e){(0,g.Dv)("OnDisconnect.set",1,2,arguments.length),(0,g.Wj)("OnDisconnect.set","onComplete",e,!0);const i=this._delegate.set(t);return e&&i.then(()=>e(null),o=>e(o)),i}setWithPriority(t,e,i){(0,g.Dv)("OnDisconnect.setWithPriority",2,3,arguments.length),(0,g.Wj)("OnDisconnect.setWithPriority","onComplete",i,!0);const o=this._delegate.setWithPriority(t,e);return i&&o.then(()=>i(null),u=>i(u)),o}update(t,e){if((0,g.Dv)("OnDisconnect.update",1,2,arguments.length),Array.isArray(t)){const o={};for(let u=0;u<t.length;++u)o[""+u]=t[u];t=o,Pl("Passing an Array to firebase.database.onDisconnect().update() is deprecated. Use set() if you want to overwrite the existing data, or an Object with integer keys if you really do want to only update some of the children.")}(0,g.Wj)("OnDisconnect.update","onComplete",e,!0);const i=this._delegate.update(t);return e&&i.then(()=>e(null),o=>e(o)),i}}class $u{constructor(t,e){this.committed=t,this.snapshot=e}toJSON(){return(0,g.Dv)("TransactionResult.toJSON",0,1,arguments.length),{committed:this.committed,snapshot:this.snapshot.toJSON()}}}class vi{constructor(t,e){this._database=t,this._delegate=e}val(){return(0,g.Dv)("DataSnapshot.val",0,0,arguments.length),this._delegate.val()}exportVal(){return(0,g.Dv)("DataSnapshot.exportVal",0,0,arguments.length),this._delegate.exportVal()}toJSON(){return(0,g.Dv)("DataSnapshot.toJSON",0,1,arguments.length),this._delegate.toJSON()}exists(){return(0,g.Dv)("DataSnapshot.exists",0,0,arguments.length),this._delegate.exists()}child(t){return(0,g.Dv)("DataSnapshot.child",0,1,arguments.length),t=String(t),er("DataSnapshot.child","path",t,!1),new vi(this._database,this._delegate.child(t))}hasChild(t){return(0,g.Dv)("DataSnapshot.hasChild",1,1,arguments.length),er("DataSnapshot.hasChild","path",t,!1),this._delegate.hasChild(t)}getPriority(){return(0,g.Dv)("DataSnapshot.getPriority",0,0,arguments.length),this._delegate.priority}forEach(t){return(0,g.Dv)("DataSnapshot.forEach",1,1,arguments.length),(0,g.Wj)("DataSnapshot.forEach","action",t,!1),this._delegate.forEach(e=>t(new vi(this._database,e)))}hasChildren(){return(0,g.Dv)("DataSnapshot.hasChildren",0,0,arguments.length),this._delegate.hasChildren()}get key(){return this._delegate.key}numChildren(){return(0,g.Dv)("DataSnapshot.numChildren",0,0,arguments.length),this._delegate.size}getRef(){return(0,g.Dv)("DataSnapshot.ref",0,0,arguments.length),new zt(this._database,this._delegate.ref)}get ref(){return this.getRef()}}class yt{constructor(t,e){this.database=t,this._delegate=e}on(t,e,i,o){var u;(0,g.Dv)("Query.on",2,4,arguments.length),(0,g.Wj)("Query.on","callback",e,!1);const c=yt.getCancelAndContextArgs_("Query.on",i,o),h=(v,P)=>{e.call(c.context,new vi(this.database,v),P)};h.userCallback=e,h.context=c.context;const _=null===(u=c.cancel)||void 0===u?void 0:u.bind(c.context);switch(t){case"value":return ul(this._delegate,h,_),e;case"child_added":return vl(this._delegate,h,_),e;case"child_removed":return El(this._delegate,h,_),e;case"child_changed":return yl(this._delegate,h,_),e;case"child_moved":return Il(this._delegate,h,_),e;default:throw new Error((0,g.gK)("Query.on","eventType")+'must be a valid event type = "value", "child_added", "child_removed", "child_changed", or "child_moved".')}}off(t,e,i){if((0,g.Dv)("Query.off",0,3,arguments.length),function(n,t,e){if(void 0!==t)switch(t){case"value":case"child_added":case"child_removed":case"child_changed":case"child_moved":break;default:throw new Error((0,g.gK)("Query.off","eventType")+'must be a valid event type = "value", "child_added", "child_removed", "child_changed", or "child_moved".')}}(0,t),(0,g.Wj)("Query.off","callback",e,!0),(0,g.lb)("Query.off","context",i,!0),e){const o=()=>{};o.userCallback=e,o.context=i,Tl(this._delegate,t,o)}else Tl(this._delegate,t)}get(){return tu(this._delegate).then(t=>new vi(this.database,t))}once(t,e,i,o){(0,g.Dv)("Query.once",1,4,arguments.length),(0,g.Wj)("Query.once","callback",e,!0);const u=yt.getCancelAndContextArgs_("Query.once",i,o),c=new g.BH,h=(v,P)=>{const b=new vi(this.database,v);e&&e.call(u.context,b,P),c.resolve(b)};h.userCallback=e,h.context=u.context;const _=v=>{u.cancel&&u.cancel.call(u.context,v),c.reject(v)};switch(t){case"value":ul(this._delegate,h,_,{onlyOnce:!0});break;case"child_added":vl(this._delegate,h,_,{onlyOnce:!0});break;case"child_removed":El(this._delegate,h,_,{onlyOnce:!0});break;case"child_changed":yl(this._delegate,h,_,{onlyOnce:!0});break;case"child_moved":Il(this._delegate,h,_,{onlyOnce:!0});break;default:throw new Error((0,g.gK)("Query.once","eventType")+'must be a valid event type = "value", "child_added", "child_removed", "child_changed", or "child_moved".')}return c.promise}limitToFirst(t){return(0,g.Dv)("Query.limitToFirst",1,1,arguments.length),new yt(this.database,_n(this._delegate,function uu(n){if("number"!=typeof n||Math.floor(n)!==n||n<=0)throw new Error("limitToFirst: First argument must be a positive integer.");return new lu(n)}(t)))}limitToLast(t){return(0,g.Dv)("Query.limitToLast",1,1,arguments.length),new yt(this.database,_n(this._delegate,function du(n){if("number"!=typeof n||Math.floor(n)!==n||n<=0)throw new Error("limitToLast: First argument must be a positive integer.");return new cu(n)}(t)))}orderByChild(t){return(0,g.Dv)("Query.orderByChild",1,1,arguments.length),new yt(this.database,_n(this._delegate,function fu(n){if("$key"===n)throw new Error('orderByChild: "$key" is invalid.  Use orderByKey() instead.');if("$priority"===n)throw new Error('orderByChild: "$priority" is invalid.  Use orderByPriority() instead.');if("$value"===n)throw new Error('orderByChild: "$value" is invalid.  Use orderByValue() instead.');return er("orderByChild","path",n,!1),new hu(n)}(t)))}orderByKey(){return(0,g.Dv)("Query.orderByKey",0,0,arguments.length),new yt(this.database,_n(this._delegate,function _u(){return new pu}()))}orderByPriority(){return(0,g.Dv)("Query.orderByPriority",0,0,arguments.length),new yt(this.database,_n(this._delegate,function mu(){return new gu}()))}orderByValue(){return(0,g.Dv)("Query.orderByValue",0,0,arguments.length),new yt(this.database,_n(this._delegate,function yu(){return new vu}()))}startAt(t=null,e){return(0,g.Dv)("Query.startAt",0,2,arguments.length),new yt(this.database,_n(this._delegate,function su(n=null,t){return zn("startAt","key",t,!0),new Al(n,t)}(t,e)))}startAfter(t=null,e){return(0,g.Dv)("Query.startAfter",0,2,arguments.length),new yt(this.database,_n(this._delegate,function au(n,t){return zn("startAfter","key",t,!0),new ou(n,t)}(t,e)))}endAt(t=null,e){return(0,g.Dv)("Query.endAt",0,2,arguments.length),new yt(this.database,_n(this._delegate,function nu(n,t){return zn("endAt","key",t,!0),new Cl(n,t)}(t,e)))}endBefore(t=null,e){return(0,g.Dv)("Query.endBefore",0,2,arguments.length),new yt(this.database,_n(this._delegate,function ru(n,t){return zn("endBefore","key",t,!0),new iu(n,t)}(t,e)))}equalTo(t,e){return(0,g.Dv)("Query.equalTo",1,2,arguments.length),new yt(this.database,_n(this._delegate,function Eu(n,t){return zn("equalTo","key",t,!0),new Iu(n,t)}(t,e)))}toString(){return(0,g.Dv)("Query.toString",0,0,arguments.length),this._delegate.toString()}toJSON(){return(0,g.Dv)("Query.toJSON",0,1,arguments.length),this._delegate.toJSON()}isEqual(t){if((0,g.Dv)("Query.isEqual",1,1,arguments.length),!(t instanceof yt))throw new Error("Query.isEqual failed: First argument must be an instance of firebase.database.Query.");return this._delegate.isEqual(t._delegate)}static getCancelAndContextArgs_(t,e,i){const o={cancel:void 0,context:void 0};if(e&&i)o.cancel=e,(0,g.Wj)(t,"cancel",o.cancel,!0),o.context=i,(0,g.lb)(t,"context",o.context,!0);else if(e)if("object"==typeof e&&null!==e)o.context=e;else{if("function"!=typeof e)throw new Error((0,g.gK)(t,"cancelOrContext")+" must either be a cancel callback or a context object.");o.cancel=e}return o}get ref(){return new zt(this.database,new tn(this._delegate._repo,this._delegate._path))}}class zt extends yt{constructor(t,e){super(t,new Zt(e._repo,e._path,new mr,!1)),this.database=t,this._delegate=e}getKey(){return(0,g.Dv)("Reference.key",0,0,arguments.length),this._delegate.key}child(t){return(0,g.Dv)("Reference.child",1,1,arguments.length),"number"==typeof t&&(t=String(t)),new zt(this.database,or(this._delegate,t))}getParent(){(0,g.Dv)("Reference.parent",0,0,arguments.length);const t=this._delegate.parent;return t?new zt(this.database,t):null}getRoot(){return(0,g.Dv)("Reference.root",0,0,arguments.length),new zt(this.database,this._delegate.root)}set(t,e){(0,g.Dv)("Reference.set",1,2,arguments.length),(0,g.Wj)("Reference.set","onComplete",e,!0);const i=ll(this._delegate,t);return e&&i.then(()=>e(null),o=>e(o)),i}update(t,e){if((0,g.Dv)("Reference.update",1,2,arguments.length),Array.isArray(t)){const o={};for(let u=0;u<t.length;++u)o[""+u]=t[u];t=o,Pl("Passing an Array to Firebase.update() is deprecated. Use set() if you want to overwrite the existing data, or an Object with integer keys if you really do want to only update some of the children.")}Bt("Reference.update",this._delegate._path),(0,g.Wj)("Reference.update","onComplete",e,!0);const i=eu(this._delegate,t);return e&&i.then(()=>e(null),o=>e(o)),i}setWithPriority(t,e,i){(0,g.Dv)("Reference.setWithPriority",2,3,arguments.length),(0,g.Wj)("Reference.setWithPriority","onComplete",i,!0);const o=function Xl(n,t,e){if(Bt("setWithPriority",n._path),Kt("setWithPriority",t,n._path,!1),js("setWithPriority",e,!1),".length"===n.key||".keys"===n.key)throw"setWithPriority failed: "+n.key+" is a read-only object.";const i=new g.BH;return f(n._repo,n._path,t,e,i.wrapCallback(()=>{})),i.promise}(this._delegate,t,e);return i&&o.then(()=>i(null),u=>i(u)),o}remove(t){(0,g.Dv)("Reference.remove",0,1,arguments.length),(0,g.Wj)("Reference.remove","onComplete",t,!0);const e=function ql(n){return Bt("remove",n._path),ll(n,null)}(this._delegate);return t&&e.then(()=>t(null),i=>t(i)),e}transaction(t,e,i){(0,g.Dv)("Reference.transaction",1,3,arguments.length),(0,g.Wj)("Reference.transaction","transactionUpdate",t,!1),(0,g.Wj)("Reference.transaction","onComplete",e,!0),function(n,t,e,i){if(void 0!==e&&"boolean"!=typeof e)throw new Error((0,g.gK)("Reference.transaction","applyLocally")+"must be a boolean.")}(0,0,i);const o=function Uu(n,t,e){var i;if(n=(0,g.m9)(n),Bt("Reference.transaction",n._path),".length"===n.key||".keys"===n.key)throw"Reference.transaction failed: "+n.key+" is a read-only object.";const o=null===(i=e?.applyLocally)||void 0===i||i,u=new g.BH,h=ul(n,()=>{});return function Qo(n,t,e,i,o,u){Rn(n,"transaction on "+t);const c={path:t,update:e,onComplete:i,status:null,order:Et(),applyLocally:u,retryCount:0,unwatcher:o,abortReason:null,currentWriteId:null,currentInputSnapshot:null,currentOutputSnapshotRaw:null,currentOutputSnapshotResolved:null},h=ir(n,t,void 0);c.currentInputSnapshot=h;const _=c.update(h.val());if(void 0===_)c.unwatcher(),c.currentOutputSnapshotRaw=null,c.currentOutputSnapshotResolved=null,c.onComplete&&c.onComplete(null,!1,c.currentInputSnapshot);else{Xi("transaction failed: Data returned ",_,c.path),c.status=0;const v=Ur(n.transactionQueueTree_,t),P=wn(v)||[];let b;P.push(c),Gs(v,P),"object"==typeof _&&null!==_&&(0,g.r3)(_,".priority")?(b=(0,g.DV)(_,".priority"),(0,g.hu)(Ji(b),"Invalid priority returned by transaction. Priority must be a valid string, finite number, server value, or null.")):b=(xr(n.serverSyncTree_,t)||ee.EMPTY_NODE).getPriority().val();const D=tr(n),G=$e(_,b),q=Zs(G,h,D);c.currentOutputSnapshotRaw=G,c.currentOutputSnapshotResolved=q,c.currentWriteId=l(n);const Te=$n(n.serverSyncTree_,t,q,c.currentWriteId,c.applyLocally);Pt(n.eventQueue_,t,Te),rr(n,n.transactionQueueTree_)}}(n._repo,n._path,t,(_,v,P)=>{let b=null;_?u.reject(_):(b=new sr(P,new tn(n._repo,n._path),ke),u.resolve(new Fu(v,b)))},h,o),u.promise}(this._delegate,t,{applyLocally:i}).then(u=>new $u(u.committed,new vi(this.database,u.snapshot)));return e&&o.then(u=>e(null,u.committed,u.snapshot),u=>e(u,!1,null)),o}setPriority(t,e){(0,g.Dv)("Reference.setPriority",1,2,arguments.length),(0,g.Wj)("Reference.setPriority","onComplete",e,!0);const i=function Jl(n,t){n=(0,g.m9)(n),Bt("setPriority",n._path),js("setPriority",t,!1);const e=new g.BH;return f(n._repo,Re(n._path,".priority"),t,null,e.wrapCallback(()=>{})),e.promise}(this._delegate,t);return e&&i.then(()=>e(null),o=>e(o)),i}push(t,e){(0,g.Dv)("Reference.push",0,2,arguments.length),(0,g.Wj)("Reference.push","onComplete",e,!0);const i=function Ql(n,t){n=(0,g.m9)(n),Bt("push",n._path),Kt("push",t,n._path,!0);const e=Js(n._repo),i=Yl(e),o=or(n,i),u=or(n,i);let c;return c=null!=t?ll(u,t).then(()=>u):Promise.resolve(u),o.then=c.then.bind(c),o.catch=c.then.bind(c,void 0),o}(this._delegate,t),o=i.then(c=>new zt(this.database,c));e&&o.then(()=>e(null),c=>e(c));const u=new zt(this.database,i);return u.then=o.then.bind(o),u.catch=o.catch.bind(o,void 0),u}onDisconnect(){return Bt("Reference.onDisconnect",this._delegate._path),new Gu(new _l(this._delegate._repo,this._delegate._path))}get key(){return this.getKey()}get parent(){return this.getParent()}get root(){return this.getRoot()}}class to{constructor(t,e){this._delegate=t,this.app=e,this.INTERNAL={delete:()=>this._delegate._delete(),forceWebSockets:ku,forceLongPolling:Pu}}useEmulator(t,e,i={}){!function kl(n,t,e,i={}){(n=(0,g.m9)(n))._checkNotDeleted("useEmulator"),n._instanceStarted&&Ke("Cannot call useEmulator() after instance has already been initialized.");const o=n._repoInternal;let u;if(o.repoInfo_.nodeAdmin)i.mockUserToken&&Ke('mockUserToken is not supported by the Admin SDK. For client access with mock users, please use the "firebase" package instead of "firebase-admin".'),u=new at(at.OWNER);else if(i.mockUserToken){const c="string"==typeof i.mockUserToken?i.mockUserToken:(0,g.Sg)(i.mockUserToken,n.app.options.projectId);u=new at(c)}!function Cu(n,t,e,i){n.repoInfo_=new y(`${t}:${e}`,!1,n.repoInfo_.namespace,n.repoInfo_.webSocketOnly,n.repoInfo_.nodeAdmin,n.repoInfo_.persistenceKey,n.repoInfo_.includeNamespaceInQueryParams,!0),i&&(n.authTokenProvider_=i)}(o,t,e,u)}(this._delegate,t,e,i)}ref(t){if((0,g.Dv)("database.ref",0,1,arguments.length),t instanceof zt){const e=ml(this._delegate,t.toString());return new zt(this,e)}{const e=gl(this._delegate,t);return new zt(this,e)}}refFromURL(t){(0,g.Dv)("database.refFromURL",1,1,arguments.length);const i=ml(this._delegate,t);return new zt(this,i)}goOffline(){return(0,g.Dv)("database.goOffline",0,0,arguments.length),function bu(n){(n=(0,g.m9)(n))._checkNotDeleted("goOffline"),nr(n._repo)}(this._delegate)}goOnline(){return(0,g.Dv)("database.goOnline",0,0,arguments.length),function Nu(n){(n=(0,g.m9)(n))._checkNotDeleted("goOnline"),function Yo(n){n.persistentConnection_&&n.persistentConnection_.resume(zo)}(n._repo)}(this._delegate)}}to.ServerValue={TIMESTAMP:function Lu(){return xu}(),increment:n=>function Mu(n){return{".sv":{increment:n}}}(n)};var zu=Object.freeze({__proto__:null,initStandalone:function Ku({app:n,url:t,version:e,customAuthImpl:i,namespace:o,nodeAdmin:u=!1}){Oe(e);const c=new M.zt("auth-internal",new M.H0("database-standalone"));return c.setComponent(new M.wA("auth-internal",()=>i,"PRIVATE")),{instance:new to(wl(n,c,void 0,t,u),n),namespace:o}}});const ju=to.ServerValue;!function Yu(n){n.INTERNAL.registerComponent(new M.wA("database-compat",(t,{instanceIdentifier:e})=>{const i=t.getProvider("app-compat").getImmediate(),o=t.getProvider("database").getImmediate({identifier:e});return new to(o,i)},"PUBLIC").setServiceProps({Reference:zt,Query:yt,Database:to,DataSnapshot:vi,enableLogging:Ou,INTERNAL:zu,ServerValue:ju}).setMultipleInstances(!0)),n.registerVersion("@firebase/database-compat","0.3.4")}(tt.Z);var yi=A(3385),Qu=A(6217);function bl(n){return null==n}function Nl(n){return"function"==typeof n.set}function Ol(n,t){return Nl(t)?t:n.ref(t)}function Dl(n,t){if(function qu(n){return"string"==typeof n}(n))return t.stringCase();if(Nl(n))return t.firebaseCase();if(function Ju(n){return"function"==typeof n.exportVal}(n))return t.snapshotCase();throw new Error("Expects a string, snapshot, or reference. Got: "+typeof n)}function no(n,t,e="on",i=te.z){return new V.y(o=>{let u=null;return u=n[e](t,(c,h)=>{i.schedule(()=>{o.next({snapshot:c,prevKey:h})}),"once"===e&&i.schedule(()=>o.complete())},c=>{i.schedule(()=>o.error(c))}),"on"===e?{unsubscribe(){null!=u&&n.off(t,u)}}:{unsubscribe(){}}}).pipe((0,R.U)(o=>{const{snapshot:u,prevKey:c}=o;let h=null;return u.exists()&&(h=u.key),{type:t,payload:u,prevKey:c,key:h}}),(0,pt.B)())}function xl(n,t){const e=n.length;for(let i=0;i<e;i++)if(n[i].payload.key===t)return i;return-1}function tc(n,t){const{payload:e,prevKey:i,key:o}=t,u=xl(n,o),c=function ec(n,t){if(bl(t))return 0;{const e=xl(n,t);return-1===e?n.length:e+1}}(n,i);switch(t.type){case"value":if(t.payload&&t.payload.exists()){let h=null;t.payload.forEach(_=>{const v={payload:_,type:"value",prevKey:h,key:_.key};return h=_.key,n=[...n,v],!1})}return n;case"child_added":if(u>-1){const h=n[u-1];(h&&h.key||null)!==i&&(n=n.filter(_=>_.payload.key!==e.key)).splice(c,0,t)}else{if(null==i)return[t,...n];(n=n.slice()).splice(c,0,t)}return n;case"child_removed":return n.filter(h=>h.payload.key!==e.key);case"child_changed":return n.map(h=>h.payload.key===o?t:h);case"child_moved":if(u>-1){const h=n.splice(u,1)[0];return(n=n.slice()).splice(c,0,h),n}return n;default:return n}}function Ll(n){return(bl(n)||0===n.length)&&(n=["child_added","child_removed","child_changed","child_moved"]),n}function Ml(n,t,e){return function Xu(n,t,e){return no(n,"value","once",e).pipe((0,C.w)(i=>{const o=[(0,j.of)(i)];return t.forEach(u=>o.push(no(n,u,"on",e))),(0,ye.T)(...o).pipe((0,ie.R)(tc,[]))}),(0,pe.x)())}(n,t=Ll(t),e)}function Fl(n,t,e){const i=(t=Ll(t)).map(o=>no(n,o,"on",e));return(0,ye.T)(...i)}function Ul(n,t){return function(i,o){return Dl(i,{stringCase:()=>n.child(i)[t](o),firebaseCase:()=>i[t](o),snapshotCase:()=>i.ref[t](o)})}}function sc(n){return function(e){return e?Dl(e,{stringCase:()=>n.child(e).remove(),firebaseCase:()=>e.remove(),snapshotCase:()=>e.ref.remove()}):n.remove()}}function Wl(n,t){return function(){return no(n,"value","on",t)}}A(9260);const lc=new H.OlP("angularfire2.realtimeDatabaseURL"),uc=new H.OlP("angularfire2.database.use-emulator");let cc=(()=>{class n{constructor(e,i,o,u,c,h,_,v,P,b,D,G,q,Te,ft){this.schedulers=h;const Pn=_,jn=(0,Je.on)(e,c,i);v&&(0,yi.nw)(jn,c,P,D,G,q,b,Te),this.database=(0,Je.cc)(`${jn.name}.database.${o}`,"AngularFireDatabase",jn.name,()=>{const Zr=c.runOutsideAngular(()=>jn.database(o||void 0));return Pn&&Zr.useEmulator(...Pn),Zr},[Pn])}list(e,i){const o=this.schedulers.ngZone.runOutsideAngular(()=>Ol(this.database,e));let u=o;return i&&(u=i(o)),function oc(n,t){const e=t.schedulers.outsideAngular,i=t.schedulers.ngZone.run(()=>n.ref);return{query:n,update:Ul(i,"update"),set:Ul(i,"set"),push:o=>i.push(o),remove:sc(i),snapshotChanges:o=>Ml(n,o,e).pipe(ue.iC),stateChanges:o=>Fl(n,o,e).pipe(ue.iC),auditTrail:o=>function nc(n,t,e){return function rc(n,t,e){return function ic(n,t){return no(n,"value","on",t).pipe((0,R.U)(e=>{let i;return e.payload.forEach(o=>(i=o.key,!1)),{data:e,lastKeyToLoad:i}}))}(n,e).pipe(function it(...n){const t=(0,je.jO)(n);return(0,Se.e)((e,i)=>{const o=n.length,u=new Array(o);let c=n.map(()=>!1),h=!1;for(let _=0;_<o;_++)(0,Ve.Xf)(n[_]).subscribe((0,Ce.x)(i,v=>{u[_]=v,!h&&!c[_]&&(c[_]=!0,(h=c.every(p.y))&&(c=null))},_e.Z));e.subscribe((0,Ce.x)(i,_=>{if(h){const v=[_,...u];i.next(t?t(...v):v)}}))})}(t),(0,R.U)(([o,u])=>{const c=o.lastKeyToLoad,h=u.map(_=>_.key);return{actions:u,lastKeyToLoad:c,loadedKeys:h}}),function Pe(n){return(0,Se.e)((t,e)=>{let i=!1,o=0;t.subscribe((0,Ce.x)(e,u=>(i||(i=!n(u,o++)))&&e.next(u)))})}(o=>-1===o.loadedKeys.indexOf(o.lastKeyToLoad)),(0,R.U)(o=>o.actions))}(n,Fl(n,t).pipe((0,ie.R)((o,u)=>[...o,u],[])),e)}(n,o,e).pipe(ue.iC),valueChanges:(o,u)=>Ml(n,o,e).pipe((0,R.U)(h=>h.map(_=>u&&u.idField?Object.assign(Object.assign({},_.payload.val()),{[u.idField]:_.key}):_.payload.val())),ue.iC)}}(u,this)}object(e){return function ac(n,t){return{query:n,snapshotChanges:()=>Wl(n,t.schedulers.outsideAngular)().pipe(ue.iC),update:e=>n.ref.update(e),set:e=>n.ref.set(e),remove:()=>n.ref.remove(),valueChanges:()=>Wl(n,t.schedulers.outsideAngular)().pipe(ue.iC,(0,R.U)(i=>i.payload.exists()?i.payload.val():null))}}(this.schedulers.ngZone.runOutsideAngular(()=>Ol(this.database,e)),this)}createPushId(){return this.schedulers.ngZone.runOutsideAngular(()=>this.database.ref()).push().key}}return n.\u0275fac=function(e){return new(e||n)(H.LFG(Je.Dh),H.LFG(Je.xv,8),H.LFG(lc,8),H.LFG(H.Lbi),H.LFG(H.R0b),H.LFG(ue.HU),H.LFG(uc,8),H.LFG(yi.zQ,8),H.LFG(yi.Qv,8),H.LFG(yi.L6,8),H.LFG(yi._Q,8),H.LFG(yi.rT,8),H.LFG(yi.lh,8),H.LFG(yi.f7,8),H.LFG(Qu.nm,8))},n.\u0275prov=H.Yz7({token:n,factory:n.\u0275fac,providedIn:"any"}),n})();const Vl="/AddNewStuff.json",Bl="/AddNewCourse.json",Zl="/AddNewFullCourse.json",Hl="/AddConfirmedCourse.json",Gl="/Question.json",$l="/doctorAnswer.json";let hc=(()=>{class n{constructor(e,i){this.apiService=e,this.firebase=i,this.dataSubject=new m.X(null)}addNewStuff(e){return this.apiService.post(Vl,e)}addNewCourse(e){return this.apiService.post(Bl,e)}addNewFullCourse(e){return this.apiService.post(Zl,e)}askQuestion(e){return this.apiService.post(Gl,e)}doctorAnswer(e){return this.apiService.post($l,e)}getQuestions(){return this.apiService.get(Gl).pipe((0,R.U)(e=>{if(e){const i=[];for(const o in e)i.push({...e[o],key:o});return i}return[]}))}getStuffs(){return this.apiService.get(Vl).pipe((0,R.U)(e=>{if(e){const i=[];for(const o in e)i.push({...e[o],key:o});return i}return[]}))}getCourses(){return this.apiService.get(Bl).pipe((0,R.U)(e=>{if(e){const i=[];for(const o in e)i.push({...e[o],key:o});return i}return[]}))}getFullCourses(){return this.apiService.get(Zl).pipe((0,R.U)(e=>{if(e){const i=[];for(const o in e)i.push({...e[o],key:o});return i}return[]}))}confirmFullCourse(e){return this.apiService.post(Hl,e)}getMyConfirmedCourses(){return this.apiService.get(Hl).pipe((0,R.U)(e=>{if(e){const i=[];for(const o in e)i.push({...e[o],key:o});return i}return[]}))}getDoctorAnswers(){return this.apiService.get($l).pipe((0,R.U)(e=>{if(e){const i=[];for(const o in e)i.push({...e[o],key:o});return i}return[]}))}deleteStuff(e){return this.apiService.delete("/AddNewStuff/",e).pipe((0,C.w)(()=>this.getStuffs().pipe((0,R.U)(i=>(this.dataSubject.next(i),i)))))}insertStuff(e){this.stuffList.push(e)}getStuffList(){this.stuffList=this.firebase.list("stuff")}}return n.\u0275fac=function(e){return new(e||n)(H.LFG(F.s),H.LFG(cc))},n.\u0275prov=H.Yz7({token:n,factory:n.\u0275fac,providedIn:"root"}),n})()},3034:(Ht,Fe,A)=>{A.d(Fe,{e:()=>ie});var m=A(5861),R=A(1135),C=A(9646),H=(()=>((H||(H={})).admin="l.dolidze11@gmail.com",H))(),te=A(8332),V=A(4650),j=A(3385),ye=A(567),pt=A(7009);let ie=(()=>{class pe{constructor(Ce,Ve,p){this.firebaseAuth=Ce,this.alert=Ve,this._snackBar=p,this.isAdminEvent$=new R.X(null)}isAdminNew(){const Ce=localStorage.getItem("user");if(Ce){const Ve=JSON.parse(Ce);return!(!Ve.emailVerified||"osQEYxPug4ZekILcy7XnIYZc1VD2"!==Ve.uid)}return!1}isAdmin(Ce){return Ce===H.admin?(this.isAdminEvent$.next(!0),localStorage.setItem("admin","1"),(0,C.of)(!0)):(this.isAdminEvent$.next(!1),(0,C.of)(!1))}signUp(Ce){var Ve=this;return(0,m.Z)(function*(){yield Ve.firebaseAuth.createUserWithEmailAndPassword(Ce.email,Ce.password).then(p=>{localStorage.setItem("user",JSON.stringify(p.user))})})()}signIn(Ce,Ve){var p=this;return(0,m.Z)(function*(){yield p.firebaseAuth.signInWithEmailAndPassword(Ce,Ve).then(_e=>{_e.user.emailVerified?localStorage.setItem("user",JSON.stringify(_e.user)):(p._snackBar.openFromComponent(te.w,{duration:2e3,data:{message:"\u10d0\u10d5\u10e2\u10dd\u10e0\u10d8\u10d6\u10d0\u10ea\u10d8\u10d0 \u10d5\u10d4\u10e0 \u10db\u10dd\u10ee\u10d3\u10d0!",type:"error"}}),console.error("error"))})})()}logOut(){var Ce=this;return(0,m.Z)(function*(){Ce.firebaseAuth.signOut(),localStorage.clear()})()}}return pe.\u0275fac=function(Ce){return new(Ce||pe)(V.LFG(j.zQ),V.LFG(ye.c),V.LFG(pt.ux))},pe.\u0275prov=V.Yz7({token:pe,factory:pe.\u0275fac,providedIn:"root"}),pe})()},3007:(Ht,Fe,A)=>{A.d(Fe,{D:()=>Ce});var m=A(5861),R=A(4006),C=A(5412),H=A(4128),F=A(4650),te=A(4617),V=A(3034),j=A(567),ye=A(6159),pt=A(4859),ie=A(9549),pe=A(4144),Se=A(9383);let Ce=(()=>{class Ve{constructor(_e,je,it,Pe,ue,Je,rt){this.dialogRef=_e,this.data=je,this.localStorageService=it,this.authService=Pe,this.alert=ue,this.fb=Je,this.router=rt}ngOnInit(){this.initForm()}initForm(){this.form=this.fb.group({userName:new R.NI(null),password:new R.NI(null)})}onSubmit(){var _e=this;return(0,m.Z)(function*(){if(!_e.form.invalid){const je=_e.form.value;yield _e.authService.signIn(je.userName,je.password).then(it=>{const Pe=_e.form.get("userName")?.value;(0,H.D)({token:_e.localStorageService.getToken(),isAdmin:_e.authService.isAdmin(Pe)}).subscribe(ue=>{_e.dialogRef.close(),_e.router.navigate([""])})})}})()}}return Ve.\u0275fac=function(_e){return new(_e||Ve)(F.Y36(C.so,8),F.Y36(C.WI),F.Y36(te.n),F.Y36(V.e),F.Y36(j.c),F.Y36(R.qu),F.Y36(ye.F0))},Ve.\u0275cmp=F.Xpm({type:Ve,selectors:[["app-log-in"]],decls:21,vars:19,consts:[[3,"formGroup","ngSubmit"],["appearance","outline"],["matInput","","formControlName","userName",3,"placeholder"],["matInput","","formControlName","password","type","password",3,"placeholder"],["type","submit","mat-raised-button","","color","primary"]],template:function(_e,je){1&_e&&(F.TgZ(0,"form",0),F.NdJ("ngSubmit",function(){return je.onSubmit()}),F.TgZ(1,"h4"),F._uU(2),F.ALo(3,"translate"),F.qZA(),F.TgZ(4,"div")(5,"mat-form-field",1)(6,"mat-label"),F._uU(7),F.ALo(8,"translate"),F.qZA(),F._UZ(9,"input",2),F.ALo(10,"translate"),F.qZA()(),F.TgZ(11,"div")(12,"mat-form-field",1)(13,"mat-label"),F._uU(14),F.ALo(15,"translate"),F.qZA(),F._UZ(16,"input",3),F.ALo(17,"translate"),F.qZA()(),F.TgZ(18,"button",4),F._uU(19),F.ALo(20,"translate"),F.qZA()()),2&_e&&(F.Q6J("formGroup",je.form),F.xp6(2),F.Oqu(F.lcZ(3,7,"logIn")),F.xp6(5),F.Oqu(F.lcZ(8,9,"user")),F.xp6(2),F.s9C("placeholder",F.lcZ(10,11,"user")),F.xp6(5),F.Oqu(F.lcZ(15,13,"password")),F.xp6(2),F.s9C("placeholder",F.lcZ(17,15,"password")),F.xp6(3),F.Oqu(F.lcZ(20,17,"logIn")))},dependencies:[pt.lW,ie.KE,ie.hX,pe.Nt,R._Y,R.Fj,R.JJ,R.JL,R.sg,R.u,Se.X$],styles:["form[_ngcontent-%COMP%]{width:100%}form[_ngcontent-%COMP%]   h4[_ngcontent-%COMP%]{margin:0 0 10px;text-align:center}form[_ngcontent-%COMP%]   div[_ngcontent-%COMP%]{width:100%}form[_ngcontent-%COMP%]   div[_ngcontent-%COMP%]   mat-form-field[_ngcontent-%COMP%]{width:100%}form[_ngcontent-%COMP%]   button[_ngcontent-%COMP%]{width:100%}"]}),Ve})()},567:(Ht,Fe,A)=>{A.d(Fe,{c:()=>F});var m=A(7579),R=(()=>{return(te=R||(R={}))[te.Success=0]="Success",te[te.Error=1]="Error",te[te.Info=2]="Info",te[te.Warning=3]="Warning",R;var te})();class C{constructor(V){Object.assign(this,V)}}var H=A(4650);let F=(()=>{class te{constructor(){this.defaultId="default-alert",this.subject=new m.x}success(j,ye){this.alert(new C({...ye,type:R.Success,message:j}))}error(j,ye){this.alert(new C({...ye,type:R.Error,message:j}))}info(j,ye){this.alert(new C({...ye,type:R.Info,message:j}))}warn(j,ye){this.alert(new C({...ye,type:R.Warning,message:j}))}alert(j){j.id=j.id||this.defaultId,j.autoClose=void 0===j.autoClose||j.autoClose,this.subject.next(j)}}return te.\u0275fac=function(j){return new(j||te)},te.\u0275prov=H.Yz7({token:te,factory:te.\u0275fac,providedIn:"root"}),te})()},4617:(Ht,Fe,A)=>{A.d(Fe,{n:()=>H});var m=A(1135),R=A(9646),C=A(4650);let H=(()=>{class F{constructor(){this.isTokenEvent$=new m.X(null)}get getTokenResult(){return this.isTokenEvent$.value}getToken(){let V=localStorage.getItem("user");if(V){let j=JSON.parse(V);return j.emailVerified?(this.isTokenEvent$.next(j),(0,R.of)(j)):(this.isTokenEvent$.next(!1),(0,R.of)(!1))}return this.isTokenEvent$.next(!1),(0,R.of)(!1)}getAdmin(){const V=localStorage.getItem("admin");return(0,R.of)(V||!1)}getStuffsDetails(V){const j=localStorage.getItem("stuff");if(j){const ye=JSON.parse(j);return(0,R.of)(ye.find(pt=>pt.key===V))}return null}}return F.\u0275fac=function(V){return new(V||F)},F.\u0275prov=C.Yz7({token:F,factory:F.\u0275fac,providedIn:"root"}),F})()},6102:(Ht,Fe,A)=>{A.d(Fe,{d:()=>j});var m=A(4004),R=A(4650),C=A(4761);const te="/CourseOrder.json",V="/StuffOrder.json";let j=(()=>{class ye{constructor(ie){this.apiService=ie}getStuffs(){return this.apiService.get("/AddNewStuff.json").pipe((0,m.U)(ie=>{if(ie){const pe=[];for(const Se in ie)pe.push({...ie[Se],key:Se});return pe}return[]}))}getCourses(){return this.apiService.get("/AddNewCourse.json").pipe((0,m.U)(ie=>{if(ie){const pe=[];for(const Se in ie)pe.push({...ie[Se],key:Se});return pe}return[]}))}buyCourse(ie){return this.apiService.post(te,ie)}buyStuff(ie){return this.apiService.post(V,ie)}getOrderedCourse(){return this.apiService.get(te).pipe((0,m.U)(ie=>{if(ie){const pe=[];for(const Se in ie)pe.push({...ie[Se],key:Se});return pe}return[]}))}getOrderedStuff(){return this.apiService.get(V).pipe((0,m.U)(ie=>{if(ie){const pe=[];for(const Se in ie)pe.push({...ie[Se],key:Se});return pe}return[]}))}}return ye.\u0275fac=function(ie){return new(ie||ye)(R.LFG(C.s))},ye.\u0275prov=R.Yz7({token:ye,factory:ye.\u0275fac,providedIn:"root"}),ye})()},8332:(Ht,Fe,A)=>{A.d(Fe,{w:()=>H});var m=A(7009),R=A(4650),C=A(6895);let H=(()=>{class F{constructor(V){this.data=V}ngOnInit(){this.message=this.data.message}alertMode(){return"error"===this.data.type?"error":"success"}}return F.\u0275fac=function(V){return new(V||F)(R.Y36(m.qD))},F.\u0275cmp=R.Xpm({type:F,selectors:[["app-alert"]],decls:2,vars:2,consts:[[3,"ngClass"]],template:function(V,j){1&V&&(R.TgZ(0,"div",0),R._uU(1),R.qZA()),2&V&&(R.Q6J("ngClass",j.alertMode()),R.xp6(1),R.hij(" ",j.message,"\n"))},dependencies:[C.mk],styles:[".success[_ngcontent-%COMP%]{color:#99eb99}.error[_ngcontent-%COMP%]{color:#e47a7a}"]}),F})()},2124:(Ht,Fe,A)=>{A.d(Fe,{$:()=>ot});var m=A(727),R=A(4128),C=A(3151),H=A(9841),F=A(3007),te=A(5861),V=A(4006),j=A(5412),ye=A(8401);A(2090),A(9681),A(1877),A(3475);const Ce_email=/^(([^<>()\[\]\\.,;:\s@"]+(\.[^<>()\[\]\\.,;:\s@"]+)*)|(".+"))@((\[[0-9]{1,3}\.[0-9]{1,3}\.[0-9]{1,3}\.[0-9]{1,3}])|(([a-zA-Z\-0-9]+\.)+[a-zA-Z]{2,}))$/;var Ve=A(8332),p=A(4650),_e=A(3034),je=A(6159),it=A(7009),Pe=A(6895),ue=A(4859),Je=A(9549),rt=A(4144),tt=A(9383);function M(Z,J){1&Z&&(p.TgZ(0,"mat-error"),p._uU(1," \u10d5\u10d4\u10da\u10d8 \u10e1\u10d0\u10d5\u10d0\u10da\u10d3\u10d4\u10d1\u10e3\u10da\u10dd\u10d0 "),p.qZA())}function Be(Z,J){1&Z&&(p.TgZ(0,"mat-error"),p._uU(1," \u10d0\u10e0\u10d0\u10e1\u10ec\u10dd\u10e0\u10d8 \u10e4\u10dd\u10e0\u10db\u10d0\u10e2\u10d8 "),p.qZA())}function Ze(Z,J){if(1&Z&&(p.ynx(0),p.YNc(1,M,2,0,"mat-error",3),p.YNc(2,Be,2,0,"mat-error",3),p.BQk()),2&Z){const N=p.oxw();p.xp6(1),p.Q6J("ngIf",null==N.form.get("email").errors?null:N.form.get("email").errors.required),p.xp6(1),p.Q6J("ngIf",null==N.form.get("email").errors?null:N.form.get("email").errors.pattern)}}function g(Z,J){1&Z&&(p.TgZ(0,"mat-error"),p._uU(1," \u10d5\u10d4\u10da\u10d8 \u10e1\u10d0\u10d5\u10d0\u10da\u10d3\u10d4\u10d1\u10e3\u10da\u10dd\u10d0 "),p.qZA())}function se(Z,J){1&Z&&(p.TgZ(0,"mat-error"),p._uU(1," \u10de\u10d0\u10e0\u10dd\u10da\u10d8\u10e1 \u10d0\u10e0\u10d0\u10e1\u10ec\u10dd\u10e0\u10d8 \u10e4\u10dd\u10e0\u10db\u10d0\u10e2\u10d8 "),p.qZA())}function Gt(Z,J){if(1&Z&&(p.ynx(0),p.YNc(1,g,2,0,"mat-error",3),p.YNc(2,se,2,0,"mat-error",3),p.BQk()),2&Z){const N=p.oxw();let $;p.xp6(1),p.Q6J("ngIf",null==N.form.get("password").errors?null:N.form.get("password").errors.required),p.xp6(1),p.Q6J("ngIf",null==($=N.form.get("password"))?null:$.hasError("minLength"))}}let Ne=(()=>{class Z{constructor(N,$,Ee,xe,he,Ct){this.dialogRef=N,this.data=$,this.authservice=Ee,this.fb=xe,this.router=he,this._snackBar=Ct}ngOnInit(){this.initForm()}initForm(){this.form=this.fb.group({email:[null,[V.kI.required,V.kI.pattern(Ce_email)]],password:[null,[V.kI.required,V.kI.minLength(6)]]})}onSignUp(){var N=this;return(0,te.Z)(function*(){if(!N.form.invalid){const $=N.form.value;yield N.authservice.signUp($),N.verifyEmail(),N.dialogRef.close(),N.router.navigate([""]),N._snackBar.openFromComponent(Ve.w,{duration:5e3,data:{message:"\u10d7\u10e5\u10d5\u10d4\u10dc\u10e1 \u10db\u10d4\u10d8\u10da\u10d6\u10d4 \u10d2\u10d0\u10d2\u10d6\u10d0\u10d5\u10dc\u10d8\u10da\u10d8\u10d0 \u10d5\u10d4\u10e0\u10d8\u10e4\u10d8\u10d9\u10d0\u10ea\u10d8\u10d8\u10e1 \u10da\u10d8\u10dc\u10d9\u10d8, \u10d2\u10d7\u10ee\u10dd\u10d5\u10d7 \u10d2\u10d0\u10ee\u10dc\u10d0\u10d7 \u10d2\u10d0\u10db\u10dd\u10d2\u10d6\u10d0\u10d5\u10dc\u10d8\u10da\u10d8 \u10da\u10d8\u10dc\u10d9\u10d8!",type:"error"}})}})()}verifyEmail(){const N=(0,ye.n)();N.currentUser&&(0,ye.ab)(N.currentUser).then(()=>{setTimeout(()=>{},3e3)})}}return Z.\u0275fac=function(N){return new(N||Z)(p.Y36(j.so,8),p.Y36(j.WI),p.Y36(_e.e),p.Y36(V.qu),p.Y36(je.F0),p.Y36(it.ux))},Z.\u0275cmp=p.Xpm({type:Z,selectors:[["app-sign-up"]],decls:23,vars:21,consts:[[3,"formGroup","ngSubmit"],["appearance","outline"],["matInput","","value","Sushi","formControlName","email",3,"placeholder"],[4,"ngIf"],["matInput","","formControlName","password","value","Sushi",3,"placeholder"],["type","submit","mat-raised-button","","color","primary"]],template:function(N,$){if(1&N&&(p.TgZ(0,"form",0),p.NdJ("ngSubmit",function(){return $.onSignUp()}),p.TgZ(1,"h4"),p._uU(2),p.ALo(3,"translate"),p.qZA(),p.TgZ(4,"div")(5,"mat-form-field",1)(6,"mat-label"),p._uU(7),p.ALo(8,"translate"),p.qZA(),p._UZ(9,"input",2),p.ALo(10,"translate"),p.qZA(),p.YNc(11,Ze,3,2,"ng-container",3),p.qZA(),p.TgZ(12,"div")(13,"mat-form-field",1)(14,"mat-label"),p._uU(15),p.ALo(16,"translate"),p.qZA(),p._UZ(17,"input",4),p.ALo(18,"translate"),p.qZA(),p.YNc(19,Gt,3,2,"ng-container",3),p.qZA(),p.TgZ(20,"button",5),p._uU(21),p.ALo(22,"translate"),p.qZA()()),2&N){let Ee,xe;p.Q6J("formGroup",$.form),p.xp6(2),p.Oqu(p.lcZ(3,9,"signUp")),p.xp6(5),p.Oqu(p.lcZ(8,11,"email")),p.xp6(2),p.s9C("placeholder",p.lcZ(10,13,"email")),p.xp6(2),p.Q6J("ngIf",null==(Ee=$.form.get("email"))?null:Ee.dirty),p.xp6(4),p.Oqu(p.lcZ(16,15,"password")),p.xp6(2),p.s9C("placeholder",p.lcZ(18,17,"password")),p.xp6(2),p.Q6J("ngIf",null==(xe=$.form.get("password"))?null:xe.dirty),p.xp6(2),p.Oqu(p.lcZ(22,19,"signUp"))}},dependencies:[Pe.O5,ue.lW,Je.TO,Je.KE,Je.hX,rt.Nt,V._Y,V.Fj,V.JJ,V.JL,V.sg,V.u,tt.X$],styles:["form[_ngcontent-%COMP%]{width:100%}form[_ngcontent-%COMP%]   h4[_ngcontent-%COMP%]{margin:0 0 10px;text-align:center}form[_ngcontent-%COMP%]   div[_ngcontent-%COMP%]{width:100%}form[_ngcontent-%COMP%]   div[_ngcontent-%COMP%]   mat-form-field[_ngcontent-%COMP%]{width:100%}form[_ngcontent-%COMP%]   button[_ngcontent-%COMP%]{width:100%}"]}),Z})();var Ue=A(4617),Oe=A(9646);let It=(()=>{class Z{constructor(N){this.authService=N}getAuthBtnMode(N,$,Ee){if($.emailVerified&&this.authService.isAdminNew())(N=[]).push({text:"logOut",type:"logOut",icon:"update",permission:"user"},{text:"admin",type:"admin",icon:"edit",permission:"admin"},{text:"",type:"userWorld",icon:"supervised_user_circle",isIcon:!0,permission:"user"});else{if($.emailVerified&&!this.authService.isAdminNew())return(N=[]).push({text:"logOut",type:"logOut",icon:"update",permission:"user"},{text:"",type:"userWorld",icon:"supervised_user_circle",isIcon:!0,permission:"user"}),(0,Oe.of)(N);if(!$.emailVerified)return(N=[]).push({text:"logIn",type:"logIn",icon:"update",permission:"user"},{text:"signUp",type:"signUp",icon:"update",permission:"user"}),(0,Oe.of)(N)}return(0,Oe.of)(N)}getAdminBtns(N,$,Ee){return $&&Ee&&this.authService.isAdminNew()?(N=[]).push({text:"ordered_courses",type:"courses",icon:"update",link:"/admin/admin-courses",permission:"user"},{text:"ordered_pregnancy_stuff",type:"items",icon:"update",link:"/admin/admin-pregnancy",permission:"user"},{text:"customer_message",type:"message",icon:"update",link:"/admin/admin-message",permission:"user"},{text:"home",type:"home",icon:"update",link:"/admin/admin-home",permission:"user"},{text:"about",type:"about",icon:"update",link:"/admin/admin-about",permission:"user"},{text:"shop",type:"shop",icon:"update",link:"/admin/admin-shop",permission:"user"},{text:"contact",type:"contact",icon:"update",link:"/admin/admin-contact",permission:"user"}):N=[],(0,Oe.of)(N)}getMyWorldBtns(N,$,Ee){return $.emailVerified&&!this.authService.isAdminNew()?(N=[]).push({text:"user_courses",type:"userWorld",icon:"update",link:"/my-courses",permission:"user"},{text:"user_communications",type:"userWorld",icon:"update",link:"/my-communication",permission:"user"}):N=[],(0,Oe.of)(N)}}return Z.\u0275fac=function(N){return new(N||Z)(p.LFG(_e.e))},Z.\u0275prov=p.Yz7({token:Z,factory:Z.\u0275fac,providedIn:"root"}),Z})();var Dt=A(5531),Xe=A(6102),Ae=A(2894),st=A(7392),He=A(2673),Et=A(8255);function De(Z,J){if(1&Z&&(p.ynx(0),p.TgZ(1,"mat-icon"),p._uU(2),p.qZA(),p.BQk()),2&Z){const N=p.oxw().$implicit;p.xp6(2),p.Oqu(N.icon)}}function oe(Z,J){if(1&Z&&p._UZ(0,"span",19),2&Z){const N=p.oxw(2);p.Q6J("matBadge",N.generalNotification)}}function ge(Z,J){if(1&Z){const N=p.EpF();p.TgZ(0,"button",16),p.NdJ("click",function(){const xe=p.CHM(N).$implicit,he=p.oxw();return p.KtG(he.initAuthActions(xe.type))}),p.YNc(1,De,3,1,"ng-container",17),p.YNc(2,oe,1,1,"span",18),p._uU(3),p.ALo(4,"translate"),p.qZA()}if(2&Z){const N=J.$implicit,$=p.oxw(),Ee=p.MAs(30),xe=p.MAs(34);p.Q6J("matMenuTriggerFor","admin"===N.type?Ee:"userWorld"===N.type?xe:null),p.xp6(1),p.Q6J("ngIf",N.isIcon),p.xp6(1),p.Q6J("ngIf","admin"===N.type&&$.generalNotification),p.xp6(1),p.hij(" ",p.lcZ(4,4,N.text)," ")}}function Tt(Z,J){if(1&Z&&p._UZ(0,"span",19),2&Z){const N=p.oxw(2);p.Q6J("matBadge",null==N.orderedCourses?null:N.orderedCourses.length)}}function _t(Z,J){if(1&Z&&p._UZ(0,"span",19),2&Z){const N=p.oxw(2);p.Q6J("matBadge",null==N.orderedItems?null:N.orderedItems.length)}}function fe(Z,J){if(1&Z&&p._UZ(0,"span",19),2&Z){const N=p.oxw(2);p.Q6J("matBadge",null==N.contact?null:N.contact.length)}}function be(Z,J){if(1&Z&&(p.TgZ(0,"button",20)(1,"span"),p._uU(2),p.YNc(3,Tt,1,1,"span",18),p.YNc(4,_t,1,1,"span",18),p.YNc(5,fe,1,1,"span",18),p.qZA(),p._uU(6),p.ALo(7,"translate"),p.qZA()),2&Z){const N=J.$implicit,$=p.oxw();p.Q6J("routerLink",N.link),p.xp6(2),p.hij(" ",N.courses," "),p.xp6(1),p.Q6J("ngIf",(null==$.orderedCourses?null:$.orderedCourses.length)&&"courses"===N.type),p.xp6(1),p.Q6J("ngIf",(null==$.orderedItems?null:$.orderedItems.length)&&"items"===N.type),p.xp6(1),p.Q6J("ngIf",(null==$.contact?null:$.contact.length)&&"contact"===N.type),p.xp6(1),p.hij(" ",p.lcZ(7,6,N.text)," ")}}function ut(Z,J){if(1&Z&&(p.TgZ(0,"button",20),p._uU(1),p.ALo(2,"translate"),p.qZA()),2&Z){const N=J.$implicit;p.Q6J("routerLink",N.link),p.xp6(1),p.hij(" ",p.lcZ(2,2,N.text)," ")}}const Ke=function(){return["/lending"]},we=function(){return["/about"]},Ie=function(){return["/courses"]},Ye=function(){return["/shop"]},Qe=function(){return["/contact"]};let ot=(()=>{class Z{constructor(N,$,Ee,xe,he,Ct,xt,nn,Ge,At){this.route=N,this.router=$,this.dialog=Ee,this.localStorageService=xe,this.translate=he,this.authService=Ct,this.autBtnService=xt,this.languageService=nn,this.shopService=Ge,this.adminHttp=At,this.prise=15,this.subscriobtion$=new m.w0,this.authActions=[],this.adminBtns=[],this.userWorldBtns=[],this.pageName=this.route.snapshot.data.pageName,this.localStorageService.getToken().subscribe(bn=>{this.authBtnInit(bn)})}ngOnInit(){this.languageService.setLanguage(),this.selectedLang=this.languageService.defaultLang,this.returnNotifications()}returnNotifications(){this.observable$=(0,R.D)({orderedCourses:this.shopService.getOrderedCourse(),orderedItems:this.shopService.getOrderedStuff(),contact:this.adminHttp.getQuestions()}).pipe((0,C.d)()),this.subscriobtion$=this.observable$.subscribe(N=>{console.log(N),this.orderedCourses=N.orderedCourses,this.orderedItems=N.orderedItems,this.contact=N.contact,this.commonNotifications(N)})}commonNotifications(N){let $=[],Ee=[N.orderedCourses,N.orderedItems,N.contact];for(const xe of Ee){for(const he of xe)$.push(he);this.generalNotification=$?.length}}ngOnDestroy(){this.subscriobtion$.unsubscribe()}authBtnInit(N){(0,H.a)({token:this.localStorageService.isTokenEvent$,admin:this.authService.isAdminEvent$}).subscribe($=>{this.autBtnService.getAuthBtnMode(this.authActions,$.token,N||$.admin).subscribe(Ee=>{this.authActions=Ee}),this.autBtnService.getAdminBtns(this.adminBtns,$.token,N||$.admin).subscribe(Ee=>{this.adminBtns=Ee}),this.autBtnService.getMyWorldBtns(this.adminBtns,$.token,N||$.admin).subscribe(Ee=>{this.userWorldBtns=Ee})})}changeLang(N){localStorage.setItem("lang",N.value),this.translate.use(N.value)}initAuthActions(N){if("logOut"===N)return this.authService.logOut(),void this.localStorageService.getToken().subscribe(xe=>{});this.dialog.open({logIn:{component:F.D,width:"500px"},signUp:{component:Ne,width:"500px"}}[N].component,{width:"500px",panelClass:"border-16"})}}return Z.\u0275fac=function(N){return new(N||Z)(p.Y36(je.gz),p.Y36(je.F0),p.Y36(j.uw),p.Y36(Ue.n),p.Y36(tt.sK),p.Y36(_e.e),p.Y36(It),p.Y36(Dt.T),p.Y36(Xe.d),p.Y36(Ae.r))},Z.\u0275cmp=p.Xpm({type:Z,selectors:[["app-layout"]],decls:41,vars:36,consts:[[1,"navbar-content"],[1,"navbar-inner"],[1,"navbar-title"],[1,"navbar-navigation"],[1,"navigation-inner"],["mat-button","",3,"routerLink"],[3,"ngModel","change","ngModelChange"],["value","ka",3,"selected"],["value","en",3,"selected"],["mat-button","",3,"matMenuTriggerFor","click",4,"ngFor","ngForOf"],["adminMenu","matMenu"],[1,"admin-menu"],["mat-menu-item","",3,"routerLink",4,"ngFor","ngForOf"],["userWorldMenu","matMenu"],[1,"page-name"],[1,"page-container"],["mat-button","",3,"matMenuTriggerFor","click"],[4,"ngIf"],["matBadgeColor","warn",3,"matBadge",4,"ngIf"],["matBadgeColor","warn",3,"matBadge"],["mat-menu-item","",3,"routerLink"]],template:function(N,$){1&N&&(p.TgZ(0,"div",0)(1,"div",1)(2,"div",2),p._uU(3),p.ALo(4,"translate"),p.qZA(),p.TgZ(5,"div",3)(6,"div",4)(7,"button",5),p._uU(8),p.ALo(9,"translate"),p.qZA(),p.TgZ(10,"button",5),p._uU(11),p.ALo(12,"translate"),p.qZA(),p.TgZ(13,"button",5),p._uU(14),p.ALo(15,"translate"),p.qZA(),p.TgZ(16,"button",5),p._uU(17),p.ALo(18,"translate"),p.qZA(),p.TgZ(19,"button",5),p._uU(20),p.ALo(21,"translate"),p.qZA(),p.TgZ(22,"span")(23,"select",6),p.NdJ("change",function(xe){return $.changeLang(xe.target)})("ngModelChange",function(xe){return $.selectedLang=xe}),p.TgZ(24,"option",7),p._uU(25,"KA"),p.qZA(),p.TgZ(26,"option",8),p._uU(27," ENG"),p.qZA()(),p.YNc(28,ge,5,6,"button",9),p.TgZ(29,"mat-menu",null,10)(31,"div",11),p.YNc(32,be,8,8,"button",12),p.qZA()(),p.TgZ(33,"mat-menu",null,13)(35,"div",11),p.YNc(36,ut,3,4,"button",12),p.qZA()()()()()(),p.TgZ(37,"div",14),p._uU(38),p.qZA(),p.TgZ(39,"div",15),p._UZ(40,"router-outlet"),p.qZA()()),2&N&&(p.xp6(3),p.AsE(" ",p.lcZ(4,19,"headerTitle")," ",$.prise," "),p.xp6(4),p.Q6J("routerLink",p.DdM(31,Ke)),p.xp6(1),p.hij(" ",p.lcZ(9,21,"home"),""),p.xp6(2),p.Q6J("routerLink",p.DdM(32,we)),p.xp6(1),p.hij(" ",p.lcZ(12,23,"about"),""),p.xp6(2),p.Q6J("routerLink",p.DdM(33,Ie)),p.xp6(1),p.Oqu(p.lcZ(15,25,"courses")),p.xp6(2),p.Q6J("routerLink",p.DdM(34,Ye)),p.xp6(1),p.Oqu(p.lcZ(18,27,"shop")),p.xp6(2),p.Q6J("routerLink",p.DdM(35,Qe)),p.xp6(1),p.Oqu(p.lcZ(21,29,"contact")),p.xp6(3),p.Q6J("ngModel",$.selectedLang),p.xp6(1),p.Q6J("selected","ka"==$.lang),p.xp6(2),p.Q6J("selected","en"==$.lang),p.xp6(2),p.Q6J("ngForOf",$.authActions),p.xp6(4),p.Q6J("ngForOf",$.adminBtns),p.xp6(4),p.Q6J("ngForOf",$.userWorldBtns),p.xp6(2),p.hij(" ",$.pageName," > "))},dependencies:[Pe.sg,Pe.O5,je.lC,je.rH,V.YN,V.Kr,V.EJ,V.JJ,V.On,st.Hw,ue.lW,He.k,Et.VK,Et.OP,Et.p6,tt.X$],styles:[".navbar-content[_ngcontent-%COMP%]{height:100%;position:relative}.navbar-content[_ngcontent-%COMP%]   .page-name[_ngcontent-%COMP%]{padding:20px}.navbar-content[_ngcontent-%COMP%]   .page-container[_ngcontent-%COMP%]{width:90%;margin:0 auto}.navbar-content[_ngcontent-%COMP%]   .footer[_ngcontent-%COMP%]{position:fixed;left:0;bottom:0;width:100%;height:200px;background-color:#fff;padding:20px;border:1px solid rgb(194,228,246)}.navbar-title[_ngcontent-%COMP%]{background-color:#c2e4f6;color:#000;text-align:center;width:100%;padding:10px 0}.navbar-navigation[_ngcontent-%COMP%]{display:flex;justify-content:center;width:100%}.navbar-navigation[_ngcontent-%COMP%]   .navigation-inner[_ngcontent-%COMP%]{padding:20px;background-color:#fff;width:100%}.navbar-navigation[_ngcontent-%COMP%]   .navigation-inner[_ngcontent-%COMP%]   span[_ngcontent-%COMP%]{float:right}.navbar-navigation[_ngcontent-%COMP%]   .navigation-inner[_ngcontent-%COMP%]   button[_ngcontent-%COMP%]{margin-right:16px}"]}),Z})()},4761:(Ht,Fe,A)=>{A.d(Fe,{s:()=>H});var m=A(529),R=A(2340),C=A(4650);let H=(()=>{class F{constructor(V){this.http=V}get(V){let j=new m.LE;return this.http.get(`${R.N.apiUrl}${V}`,{params:j})}post(V,j){return this.http.post(`${R.N.apiUrl}${V}`,j)}put(V,j){return this.http.put(`${R.N.apiUrl}${V}`,j)}delete(V,j){return this.http.delete(`${R.N.apiUrl}${V}/${j}.json`)}}return F.\u0275fac=function(V){return new(V||F)(C.LFG(m.eN))},F.\u0275prov=C.Yz7({token:F,factory:F.\u0275fac,providedIn:"root"}),F})()},5531:(Ht,Fe,A)=>{A.d(Fe,{T:()=>H});var m=A(1135),R=A(4650),C=A(9383);let H=(()=>{class F{constructor(V){this.translate=V,this.language=new m.X("")}get defaultLang(){return this.language.value}setLanguage(){const V=localStorage.getItem("lang");return V?(this.translate.use(V),this.language.next(V)):(this.translate.setDefaultLang("ka"),this.language.next("ka"))}}return F.\u0275fac=function(V){return new(V||F)(R.LFG(C.sK))},F.\u0275prov=R.Yz7({token:F,factory:F.\u0275fac,providedIn:"root"}),F})()},9568:(Ht,Fe,A)=>{A.r(Fe);var m=A(5861),R=A(3942),C=A(8401),H=A(2090),V=(A(9681),A(1877),A(3475));function j(){return window}const ye=2e3;function ie(){return ie=(0,m.Z)(function*(k,E,y){var x;const{BuildInfo:B}=j();(0,C.ap)(E.sessionId,"AuthEvent did not contain a session ID");const X=yield function je(k){return it.apply(this,arguments)}(E.sessionId),ce={};return(0,C.aq)()?ce.ibi=B.packageName:(0,C.ar)()?ce.apn=B.packageName:(0,C.as)(k,"operation-not-supported-in-this-environment"),B.displayName&&(ce.appDisplayName=B.displayName),ce.sessionId=X,(0,C.at)(k,y,E.type,void 0,null!==(x=E.eventId)&&void 0!==x?x:void 0,ce)}),ie.apply(this,arguments)}function Se(){return(Se=(0,m.Z)(function*(k){const{BuildInfo:E}=j(),y={};(0,C.aq)()?y.iosBundleId=E.packageName:(0,C.ar)()?y.androidPackageName=E.packageName:(0,C.as)(k,"operation-not-supported-in-this-environment"),yield(0,C.au)(k,y)})).apply(this,arguments)}function p(){return(p=(0,m.Z)(function*(k,E,y){const{cordova:x}=j();let B=()=>{};try{yield new Promise((X,ce)=>{let me=null;function Le(){var ae;X();const Rt=null===(ae=x.plugins.browsertab)||void 0===ae?void 0:ae.close;"function"==typeof Rt&&Rt(),"function"==typeof y?.close&&y.close()}function vt(){me||(me=window.setTimeout(()=>{ce((0,C.aw)(k,"redirect-cancelled-by-user"))},ye))}function wt(){"visible"===document?.visibilityState&&vt()}E.addPassiveListener(Le),document.addEventListener("resume",vt,!1),(0,C.ar)()&&document.addEventListener("visibilitychange",wt,!1),B=()=>{E.removePassiveListener(Le),document.removeEventListener("resume",vt,!1),document.removeEventListener("visibilitychange",wt,!1),me&&window.clearTimeout(me)}})}finally{B()}})).apply(this,arguments)}function it(){return(it=(0,m.Z)(function*(k){const E=function Pe(k){if((0,C.ap)(/[0-9a-zA-Z]+/.test(k),"Can only convert alpha-numeric strings"),typeof TextEncoder<"u")return(new TextEncoder).encode(k);const E=new ArrayBuffer(k.length),y=new Uint8Array(E);for(let x=0;x<k.length;x++)y[x]=k.charCodeAt(x);return y}(k),y=yield crypto.subtle.digest("SHA-256",E);return Array.from(new Uint8Array(y)).map(B=>B.toString(16).padStart(2,"0")).join("")})).apply(this,arguments)}const ue=20;class Je extends C.ay{constructor(){super(...arguments),this.passiveListeners=new Set,this.initPromise=new Promise(E=>{this.resolveInialized=E})}addPassiveListener(E){this.passiveListeners.add(E)}removePassiveListener(E){this.passiveListeners.delete(E)}resetRedirect(){this.queuedRedirectEvent=null,this.hasHandledPotentialRedirect=!1}onEvent(E){return this.resolveInialized(),this.passiveListeners.forEach(y=>y(E)),super.onEvent(E)}initialized(){var E=this;return(0,m.Z)(function*(){yield E.initPromise})()}}function M(k){return Be.apply(this,arguments)}function Be(){return(Be=(0,m.Z)(function*(k){const E=yield se()._get(Gt(k));return E&&(yield se()._remove(Gt(k))),E})).apply(this,arguments)}function g(){const k=[],E="1234567890abcdefghijklmnopqrstuvwxyzABCDEFGHIJKLMNOPQRSTUVWXYZ";for(let y=0;y<ue;y++){const x=Math.floor(Math.random()*E.length);k.push(E.charAt(x))}return k.join("")}function se(){return(0,C.az)(C.b)}function Gt(k){return(0,C.aA)("authEvent",k.config.apiKey,k.name)}function Oe(k){if(!k?.includes("?"))return{};const[E,...y]=k.split("?");return(0,H.zd)(y.join("?"))}const Xe=class Dt{constructor(){this._redirectPersistence=C.a,this._shouldInitProactively=!0,this.eventManagers=new Map,this.originValidationPromises={},this._completeRedirectFn=C.aB,this._overrideRedirectResult=C.aC}_initialize(E){var y=this;return(0,m.Z)(function*(){const x=E._key();let B=y.eventManagers.get(x);return B||(B=new Je(E),y.eventManagers.set(x,B),y.attachCallbackListeners(E,B)),B})()}_openPopup(E){(0,C.as)(E,"operation-not-supported-in-this-environment")}_openRedirect(E,y,x,B){var X=this;return(0,m.Z)(function*(){!function _e(k){var E,y,x,B,X,ce,me,Le,vt,wt;const ae=j();(0,C.ax)("function"==typeof(null===(E=ae?.universalLinks)||void 0===E?void 0:E.subscribe),k,"invalid-cordova-configuration",{missingPlugin:"cordova-universal-links-plugin-fix"}),(0,C.ax)(typeof(null===(y=ae?.BuildInfo)||void 0===y?void 0:y.packageName)<"u",k,"invalid-cordova-configuration",{missingPlugin:"cordova-plugin-buildInfo"}),(0,C.ax)("function"==typeof(null===(X=null===(B=null===(x=ae?.cordova)||void 0===x?void 0:x.plugins)||void 0===B?void 0:B.browsertab)||void 0===X?void 0:X.openUrl),k,"invalid-cordova-configuration",{missingPlugin:"cordova-plugin-browsertab"}),(0,C.ax)("function"==typeof(null===(Le=null===(me=null===(ce=ae?.cordova)||void 0===ce?void 0:ce.plugins)||void 0===me?void 0:me.browsertab)||void 0===Le?void 0:Le.isAvailable),k,"invalid-cordova-configuration",{missingPlugin:"cordova-plugin-browsertab"}),(0,C.ax)("function"==typeof(null===(wt=null===(vt=ae?.cordova)||void 0===vt?void 0:vt.InAppBrowser)||void 0===wt?void 0:wt.open),k,"invalid-cordova-configuration",{missingPlugin:"cordova-plugin-inappbrowser"})}(E);const ce=yield X._initialize(E);yield ce.initialized(),ce.resetRedirect(),(0,C.aD)(),yield X._originValidation(E);const me=function rt(k,E,y=null){return{type:E,eventId:y,urlResponse:null,sessionId:g(),postBody:null,tenantId:k.tenantId,error:(0,C.aw)(k,"no-auth-event")}}(E,x,B);yield function tt(k,E){return se()._set(Gt(k),E)}(E,me);const Le=yield function pt(k,E,y){return ie.apply(this,arguments)}(E,me,y),vt=yield function Ce(k){const{cordova:E}=j();return new Promise(y=>{E.plugins.browsertab.isAvailable(x=>{let B=null;x?E.plugins.browsertab.openUrl(k):B=E.InAppBrowser.open(k,(0,C.av)()?"_blank":"_system","location=yes"),y(B)})})}(Le);return function Ve(k,E,y){return p.apply(this,arguments)}(E,ce,vt)})()}_isIframeWebStorageSupported(E,y){throw new Error("Method not implemented.")}_originValidation(E){const y=E._key();return this.originValidationPromises[y]||(this.originValidationPromises[y]=function pe(k){return Se.apply(this,arguments)}(E)),this.originValidationPromises[y]}attachCallbackListeners(E,y){const{universalLinks:x,handleOpenURL:B,BuildInfo:X}=j(),ce=setTimeout((0,m.Z)(function*(){yield M(E),y.onEvent(Ae())}),500),me=function(){var wt=(0,m.Z)(function*(ae){clearTimeout(ce);const Rt=yield M(E);let xn=null;Rt&&ae?.url&&(xn=function Ze(k,E){var y,x;const B=function Ue(k){const E=Oe(k),y=E.link?decodeURIComponent(E.link):void 0,x=Oe(y).link,B=E.deep_link_id?decodeURIComponent(E.deep_link_id):void 0;return Oe(B).link||B||x||y||k}(E);if(B.includes("/__/auth/callback")){const X=Oe(B),ce=X.firebaseError?function Ne(k){try{return JSON.parse(k)}catch{return null}}(decodeURIComponent(X.firebaseError)):null,me=null===(x=null===(y=ce?.code)||void 0===y?void 0:y.split("auth/"))||void 0===x?void 0:x[1],Le=me?(0,C.aw)(me):null;return Le?{type:k.type,eventId:k.eventId,tenantId:k.tenantId,error:Le,urlResponse:null,sessionId:null,postBody:null}:{type:k.type,eventId:k.eventId,tenantId:k.tenantId,sessionId:k.sessionId,urlResponse:B,postBody:null}}return null}(Rt,ae.url)),y.onEvent(xn||Ae())});return function(Rt){return wt.apply(this,arguments)}}();typeof x<"u"&&"function"==typeof x.subscribe&&x.subscribe(null,me);const Le=B,vt=`${X.packageName.toLowerCase()}://`;j().handleOpenURL=function(){var wt=(0,m.Z)(function*(ae){if(ae.toLowerCase().startsWith(vt)&&me({url:ae}),"function"==typeof Le)try{Le(ae)}catch(Rt){console.error(Rt)}});return function(ae){return wt.apply(this,arguments)}}()}};function Ae(){return{type:"unknown",eventId:null,sessionId:null,urlResponse:null,postBody:null,tenantId:null,error:(0,C.aw)("no-auth-event")}}const De=1e3;function oe(){var k;return(null===(k=self?.location)||void 0===k?void 0:k.protocol)||null}function Tt(k=(0,H.z$)()){return!("file:"!==oe()&&"ionic:"!==oe()&&"capacitor:"!==oe()||!k.toLowerCase().match(/iphone|ipad|ipod|android/))}function Ke(){try{const k=self.localStorage,E=C.aI();if(k)return k.setItem(E,"1"),k.removeItem(E),!function ut(k=(0,H.z$)()){return function fe(){return(0,H.w1)()&&11===document?.documentMode}()||function be(k=(0,H.z$)()){return/Edge\/\d+/.test(k)}(k)}()||(0,H.hl)()}catch{return we()&&(0,H.hl)()}return!1}function we(){return typeof global<"u"&&"WorkerGlobalScope"in global&&"importScripts"in global}function Ie(){return(function ge(){return"http:"===oe()||"https:"===oe()}()||(0,H.ru)()||Tt())&&!function _t(){return(0,H.b$)()||(0,H.UG)()}()&&Ke()&&!we()}function Ye(){return Tt()&&typeof document<"u"}function ot(){return(ot=(0,m.Z)(function*(){return!!Ye()&&new Promise(k=>{const E=setTimeout(()=>{k(!1)},De);document.addEventListener("deviceready",()=>{clearTimeout(E),k(!0)})})})).apply(this,arguments)}const J={LOCAL:"local",NONE:"none",SESSION:"session"},N=C.ax,$="persistence";function xe(k){return he.apply(this,arguments)}function he(){return(he=(0,m.Z)(function*(k){yield k._initializationPromise;const E=xt(),y=C.aA($,k.config.apiKey,k.name);E&&E.setItem(y,k._getPersistence())})).apply(this,arguments)}function xt(){var k;try{return(null===(k=function Z(){return typeof window<"u"?window:null}())||void 0===k?void 0:k.sessionStorage)||null}catch{return null}}const nn=C.ax;class Ge{constructor(){this.browserResolver=C.az(C.k),this.cordovaResolver=C.az(Xe),this.underlyingResolver=null,this._redirectPersistence=C.a,this._completeRedirectFn=C.aB,this._overrideRedirectResult=C.aC}_initialize(E){var y=this;return(0,m.Z)(function*(){return yield y.selectUnderlyingResolver(),y.assertedUnderlyingResolver._initialize(E)})()}_openPopup(E,y,x,B){var X=this;return(0,m.Z)(function*(){return yield X.selectUnderlyingResolver(),X.assertedUnderlyingResolver._openPopup(E,y,x,B)})()}_openRedirect(E,y,x,B){var X=this;return(0,m.Z)(function*(){return yield X.selectUnderlyingResolver(),X.assertedUnderlyingResolver._openRedirect(E,y,x,B)})()}_isIframeWebStorageSupported(E,y){this.assertedUnderlyingResolver._isIframeWebStorageSupported(E,y)}_originValidation(E){return this.assertedUnderlyingResolver._originValidation(E)}get _shouldInitProactively(){return Ye()||this.browserResolver._shouldInitProactively}get assertedUnderlyingResolver(){return nn(this.underlyingResolver,"internal-error"),this.underlyingResolver}selectUnderlyingResolver(){var E=this;return(0,m.Z)(function*(){if(E.underlyingResolver)return;const y=yield function Qe(){return ot.apply(this,arguments)}();E.underlyingResolver=y?E.cordovaResolver:E.browserResolver})()}}function At(k){return k.unwrap()}function Nn(k){return gt(k)}function gt(k){const{_tokenResponse:E}=k instanceof H.ZR?k.customData:k;if(!E)return null;if(!(k instanceof H.ZR)&&"temporaryProof"in E&&"phoneNumber"in E)return C.P.credentialFromResult(k);const y=E.providerId;if(!y||y===C.o.PASSWORD)return null;let x;switch(y){case C.o.GOOGLE:x=C.Q;break;case C.o.FACEBOOK:x=C.N;break;case C.o.GITHUB:x=C.T;break;case C.o.TWITTER:x=C.W;break;default:const{oauthIdToken:B,oauthAccessToken:X,oauthTokenSecret:ce,pendingToken:me,nonce:Le}=E;return X||ce||B||me?me?y.startsWith("saml.")?C.aL._create(y,me):C.J._fromParams({providerId:y,signInMethod:y,pendingToken:me,idToken:B,accessToken:X}):new C.U(y).credential({idToken:B,accessToken:X,rawNonce:Le}):null}return k instanceof H.ZR?x.credentialFromError(k):x.credentialFromResult(k)}function ze(k,E){return E.catch(y=>{throw y instanceof H.ZR&&function rn(k,E){var y;const x=null===(y=E.customData)||void 0===y?void 0:y._tokenResponse;if("auth/multi-factor-auth-required"===E?.code)E.resolver=new On(k,C.an(k,E));else if(x){const B=gt(E),X=E;B&&(X.credential=B,X.tenantId=x.tenantId||void 0,X.email=x.email||void 0,X.phoneNumber=x.phoneNumber||void 0)}}(k,y),y}).then(y=>{const B=y.user;return{operationType:y.operationType,credential:Nn(y),additionalUserInfo:C.al(y),user:at.getOrCreate(B)}})}function Lt(k,E){return jt.apply(this,arguments)}function jt(){return(jt=(0,m.Z)(function*(k,E){const y=yield E;return{verificationId:y.verificationId,confirm:x=>ze(k,y.confirm(x))}})).apply(this,arguments)}class On{constructor(E,y){this.resolver=y,this.auth=function bn(k){return k.wrapped()}(E)}get session(){return this.resolver.session}get hints(){return this.resolver.hints}resolveSignIn(E){return ze(At(this.auth),this.resolver.resolveSignIn(E))}}class at{constructor(E){this._delegate=E,this.multiFactor=C.ao(E)}static getOrCreate(E){return at.USER_MAP.has(E)||at.USER_MAP.set(E,new at(E)),at.USER_MAP.get(E)}delete(){return this._delegate.delete()}reload(){return this._delegate.reload()}toJSON(){return this._delegate.toJSON()}getIdTokenResult(E){return this._delegate.getIdTokenResult(E)}getIdToken(E){return this._delegate.getIdToken(E)}linkAndRetrieveDataWithCredential(E){return this.linkWithCredential(E)}linkWithCredential(E){var y=this;return(0,m.Z)(function*(){return ze(y.auth,C.Z(y._delegate,E))})()}linkWithPhoneNumber(E,y){var x=this;return(0,m.Z)(function*(){return Lt(x.auth,C.l(x._delegate,E,y))})()}linkWithPopup(E){var y=this;return(0,m.Z)(function*(){return ze(y.auth,C.d(y._delegate,E,Ge))})()}linkWithRedirect(E){var y=this;return(0,m.Z)(function*(){return yield xe(C.aE(y.auth)),C.g(y._delegate,E,Ge)})()}reauthenticateAndRetrieveDataWithCredential(E){return this.reauthenticateWithCredential(E)}reauthenticateWithCredential(E){var y=this;return(0,m.Z)(function*(){return ze(y.auth,C._(y._delegate,E))})()}reauthenticateWithPhoneNumber(E,y){return Lt(this.auth,C.r(this._delegate,E,y))}reauthenticateWithPopup(E){return ze(this.auth,C.e(this._delegate,E,Ge))}reauthenticateWithRedirect(E){var y=this;return(0,m.Z)(function*(){return yield xe(C.aE(y.auth)),C.h(y._delegate,E,Ge)})()}sendEmailVerification(E){return C.ab(this._delegate,E)}unlink(E){var y=this;return(0,m.Z)(function*(){return yield C.ak(y._delegate,E),y})()}updateEmail(E){return C.ag(this._delegate,E)}updatePassword(E){return C.ah(this._delegate,E)}updatePhoneNumber(E){return C.u(this._delegate,E)}updateProfile(E){return C.af(this._delegate,E)}verifyBeforeUpdateEmail(E,y){return C.ac(this._delegate,E,y)}get emailVerified(){return this._delegate.emailVerified}get isAnonymous(){return this._delegate.isAnonymous}get metadata(){return this._delegate.metadata}get phoneNumber(){return this._delegate.phoneNumber}get providerData(){return this._delegate.providerData}get refreshToken(){return this._delegate.refreshToken}get tenantId(){return this._delegate.tenantId}get displayName(){return this._delegate.displayName}get email(){return this._delegate.email}get photoURL(){return this._delegate.photoURL}get providerId(){return this._delegate.providerId}get uid(){return this._delegate.uid}get auth(){return this._delegate.auth}}at.USER_MAP=new WeakMap;const Mt=C.ax;let sn=(()=>{class k{constructor(y,x){if(this.app=y,x.isInitialized())return this._delegate=x.getImmediate(),void this.linkUnderlyingAuth();const{apiKey:B}=y.options;Mt(B,"invalid-api-key",{appName:y.name}),Mt(B,"invalid-api-key",{appName:y.name});const X=typeof window<"u"?Ge:void 0;this._delegate=x.initialize({options:{persistence:mt(B,y.name),popupRedirectResolver:X}}),this._delegate._updateErrorMap(C.B),this.linkUnderlyingAuth()}get emulatorConfig(){return this._delegate.emulatorConfig}get currentUser(){return this._delegate.currentUser?at.getOrCreate(this._delegate.currentUser):null}get languageCode(){return this._delegate.languageCode}set languageCode(y){this._delegate.languageCode=y}get settings(){return this._delegate.settings}get tenantId(){return this._delegate.tenantId}set tenantId(y){this._delegate.tenantId=y}useDeviceLanguage(){this._delegate.useDeviceLanguage()}signOut(){return this._delegate.signOut()}useEmulator(y,x){C.G(this._delegate,y,x)}applyActionCode(y){return C.a2(this._delegate,y)}checkActionCode(y){return C.a3(this._delegate,y)}confirmPasswordReset(y,x){return C.a1(this._delegate,y,x)}createUserWithEmailAndPassword(y,x){var B=this;return(0,m.Z)(function*(){return ze(B._delegate,C.a5(B._delegate,y,x))})()}fetchProvidersForEmail(y){return this.fetchSignInMethodsForEmail(y)}fetchSignInMethodsForEmail(y){return C.aa(this._delegate,y)}isSignInWithEmailLink(y){return C.a8(this._delegate,y)}getRedirectResult(){var y=this;return(0,m.Z)(function*(){Mt(Ie(),y._delegate,"operation-not-supported-in-this-environment");const x=yield C.j(y._delegate,Ge);return x?ze(y._delegate,Promise.resolve(x)):{credential:null,user:null}})()}addFrameworkForLogging(y){!function st(k,E){(0,C.aE)(k)._logFramework(E)}(this._delegate,y)}onAuthStateChanged(y,x,B){const{next:X,error:ce,complete:me}=St(y,x,B);return this._delegate.onAuthStateChanged(X,ce,me)}onIdTokenChanged(y,x,B){const{next:X,error:ce,complete:me}=St(y,x,B);return this._delegate.onIdTokenChanged(X,ce,me)}sendSignInLinkToEmail(y,x){return C.a7(this._delegate,y,x)}sendPasswordResetEmail(y,x){return C.a0(this._delegate,y,x||void 0)}setPersistence(y){var x=this;return(0,m.Z)(function*(){let B;switch(function Ee(k,E){N(Object.values(J).includes(E),k,"invalid-persistence-type"),(0,H.b$)()?N(E!==J.SESSION,k,"unsupported-persistence-type"):(0,H.UG)()?N(E===J.NONE,k,"unsupported-persistence-type"):we()?N(E===J.NONE||E===J.LOCAL&&(0,H.hl)(),k,"unsupported-persistence-type"):N(E===J.NONE||Ke(),k,"unsupported-persistence-type")}(x._delegate,y),y){case J.SESSION:B=C.a;break;case J.LOCAL:B=(yield C.az(C.i)._isAvailable())?C.i:C.b;break;case J.NONE:B=C.L;break;default:return C.as("argument-error",{appName:x._delegate.name})}return x._delegate.setPersistence(B)})()}signInAndRetrieveDataWithCredential(y){return this.signInWithCredential(y)}signInAnonymously(){return ze(this._delegate,C.X(this._delegate))}signInWithCredential(y){return ze(this._delegate,C.Y(this._delegate,y))}signInWithCustomToken(y){return ze(this._delegate,C.$(this._delegate,y))}signInWithEmailAndPassword(y,x){return ze(this._delegate,C.a6(this._delegate,y,x))}signInWithEmailLink(y,x){return ze(this._delegate,C.a9(this._delegate,y,x))}signInWithPhoneNumber(y,x){return Lt(this._delegate,C.s(this._delegate,y,x))}signInWithPopup(y){var x=this;return(0,m.Z)(function*(){return Mt(Ie(),x._delegate,"operation-not-supported-in-this-environment"),ze(x._delegate,C.c(x._delegate,y,Ge))})()}signInWithRedirect(y){var x=this;return(0,m.Z)(function*(){return Mt(Ie(),x._delegate,"operation-not-supported-in-this-environment"),yield xe(x._delegate),C.f(x._delegate,y,Ge)})()}updateCurrentUser(y){return this._delegate.updateCurrentUser(y)}verifyPasswordResetCode(y){return C.a4(this._delegate,y)}unwrap(){return this._delegate}_delete(){return this._delegate._delete()}linkUnderlyingAuth(){this._delegate.wrapped=()=>this}}return k.Persistence=J,k})();function St(k,E,y){let x=k;"function"!=typeof k&&({next:x,error:E,complete:y}=k);const B=x;return{next:ce=>B(ce&&at.getOrCreate(ce)),error:E,complete:y}}function mt(k,E){const y=function Ct(k,E){const y=xt();if(!y)return[];const x=C.aA($,k,E);switch(y.getItem(x)){case J.NONE:return[C.L];case J.LOCAL:return[C.i,C.a];case J.SESSION:return[C.a];default:return[]}}(k,E);if(typeof self<"u"&&!y.includes(C.i)&&y.push(C.i),typeof window<"u")for(const x of[C.b,C.a])y.includes(x)||y.push(x);return y.includes(C.L)||y.push(C.L),y}class ct{constructor(){this.providerId="phone",this._delegate=new C.P(At(R.Z.auth()))}static credential(E,y){return C.P.credential(E,y)}verifyPhoneNumber(E,y){return this._delegate.verifyPhoneNumber(E,y)}unwrap(){return this._delegate}}ct.PHONE_SIGN_IN_METHOD=C.P.PHONE_SIGN_IN_METHOD,ct.PROVIDER_ID=C.P.PROVIDER_ID;const Dn=C.ax;class on{constructor(E,y,x=R.Z.app()){var B;Dn(null===(B=x.options)||void 0===B?void 0:B.apiKey,"invalid-api-key",{appName:x.name}),this._delegate=new C.R(E,y,x.auth()),this.type=this._delegate.type}clear(){this._delegate.clear()}render(){return this._delegate.render()}verify(){return this._delegate.verify()}}!function bt(k){k.INTERNAL.registerComponent(new V.wA("auth-compat",E=>{const y=E.getProvider("app-compat").getImmediate(),x=E.getProvider("auth");return new sn(y,x)},"PUBLIC").setServiceProps({ActionCodeInfo:{Operation:{EMAIL_SIGNIN:C.A.EMAIL_SIGNIN,PASSWORD_RESET:C.A.PASSWORD_RESET,RECOVER_EMAIL:C.A.RECOVER_EMAIL,REVERT_SECOND_FACTOR_ADDITION:C.A.REVERT_SECOND_FACTOR_ADDITION,VERIFY_AND_CHANGE_EMAIL:C.A.VERIFY_AND_CHANGE_EMAIL,VERIFY_EMAIL:C.A.VERIFY_EMAIL}},EmailAuthProvider:C.M,FacebookAuthProvider:C.N,GithubAuthProvider:C.T,GoogleAuthProvider:C.Q,OAuthProvider:C.U,SAMLAuthProvider:C.V,PhoneAuthProvider:ct,PhoneMultiFactorGenerator:C.m,RecaptchaVerifier:on,TwitterAuthProvider:C.W,Auth:sn,AuthCredential:C.H,Error:H.ZR}).setInstantiationMode("LAZY").setMultipleInstances(!1)),k.registerVersion("@firebase/auth-compat","0.3.4")}(R.Z)}}]);